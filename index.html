<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 探索网络宇宙</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            dark: '#0B0E2D',
                            light: '#1A2053',
                            accent: '#4A58F0',
                            glow: '#7B66FF',
                            star: '#E0E0FF',
                            planet: '#FF9F43'
                        },
                        day: {
                            bg: '#F0F4FF',
                            card: '#FFFFFF',
                            text: '#333333',
                            accent: '#4263EB'
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif'],
                        sans: ['Inter', 'sans-serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite',
                        'spin-slow': 'spin 20s linear infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 0.6 },
                            '50%': { opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 0 8px rgba(123, 102, 255, 0.6);
            }
            .text-glow {
                text-shadow: 0 0 10px rgba(123, 102, 255, 0.8), 0 0 20px rgba(123, 102, 255, 0.4);
            }
            .bg-stars {
                background-image: radial-gradient(circle, #ffffff 1px, transparent 1px);
                background-size: 50px 50px;
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle 2s infinite;
            }
            .clip-path-slant {
                clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%230B0E2D'/%3E%3Ccircle cx='50' cy='50' r='25' fill='%237B66FF'/%3E%3Ccircle cx='50' cy='50' r='10' fill='%23E0E0FF'/%3E%3C/svg%3E" type="image/svg+xml">
</head>
<body class="transition-colors duration-500 dark:bg-space-dark bg-day-bg text-day-text dark:text-white font-sans min-h-screen overflow-x-hidden">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0 opacity-70 dark:opacity-100 pointer-events-none"></div>
    
    <!-- 浮动行星装饰 -->
    <div class="fixed -top-20 -right-20 w-64 h-64 rounded-full bg-space-light/30 blur-3xl animate-float z-0"></div>
    <div class="fixed top-1/3 -left-32 w-80 h-80 rounded-full bg-space-accent/20 blur-3xl animate-float animation-delay-2000 z-0"></div>
    <div class="fixed bottom-0 right-1/4 w-72 h-72 rounded-full bg-space-planet/20 blur-3xl animate-float animation-delay-4000 z-0"></div>

    <!-- 导航栏 -->
    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-day-bg/80 dark:bg-space-dark/80 backdrop-blur-md">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-space-accent to-space-glow flex items-center justify-center">
                    <i class="fa fa-compass text-white text-xl"></i>
                </div>
                <h1 class="text-xl md:text-2xl font-space font-bold text-glow">星际导航</h1>
            </div>
            
            <div class="flex items-center space-x-1 md:space-x-4">
                <!-- 主题切换按钮 -->
                <div class="relative group">
                    <button id="theme-toggle" class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-day-card/50 dark:hover:bg-space-light/30 transition-colors">
                        <i class="fa fa-moon-o dark:hidden text-day-accent"></i>
                        <i class="fa fa-sun-o hidden dark:block text-space-planet"></i>
                    </button>
                    <div class="absolute right-0 mt-2 w-36 bg-day-card dark:bg-space-light rounded-lg shadow-lg p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
                        <p class="text-sm mb-1 font-medium">切换主题</p>
                        <div class="flex space-x-2">
                            <button data-theme="light" class="px-3 py-1 text-xs rounded bg-day-bg dark:bg-space-dark/50 hover:bg-day-accent/10 dark:hover:bg-space-accent/20 transition-colors">白天模式</button>
                            <button data-theme="dark" class="px-3 py-1 text-xs rounded bg-day-bg dark:bg-space-dark/50 hover:bg-day-accent/10 dark:hover:bg-space-accent/20 transition-colors">黑夜模式</button>
                        </div>
                    </div>
                </div>
                
                <!-- 编辑页入口 -->
                <button id="edit-btn" class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-day-card/50 dark:hover:bg-space-light/30 transition-colors">
                    <i class="fa fa-cog text-day-accent dark:text-space-glow"></i>
                </button>
                
                <!-- 世界时间快速切换 -->
                <div class="relative group hidden md:block">
                    <button id="time-quick-toggle" class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-day-card/50 dark:hover:bg-space-light/30 transition-colors">
                        <i class="fa fa-clock-o text-day-accent dark:text-space-glow"></i>
                    </button>
                    <div id="time-zones-dropdown" class="absolute right-0 mt-2 w-64 bg-day-card dark:bg-space-light rounded-lg shadow-lg p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 max-h-60 overflow-y-auto">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-sm font-medium">世界时间</p>
                            <button id="add-timezone" class="text-xs text-day-accent dark:text-space-glow hover:underline">+ 添加</button>
                        </div>
                        <div id="time-zones-list" class="space-y-2">
                            <!-- 时区将通过JS动态添加 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16 relative z-10">
        <!-- 主页内容 -->
        <section id="home-page" class="space-y-8">
            <!-- 顶部小组件 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- 在线时长统计 -->
                <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-4 shadow-lg hover:shadow-xl transition-shadow border border-day-accent/10 dark:border-space-glow/20">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-space font-semibold text-lg">在线时长</h3>
                        <i class="fa fa-line-chart text-day-accent dark:text-space-glow text-xl"></i>
                    </div>
                    <div class="h-32">
                        <canvas id="online-time-chart"></canvas>
                    </div>
                    <div class="mt-2 text-sm text-center">
                        <span id="total-online-time" class="font-medium">本周总计: 12小时30分钟</span>
                    </div>
                </div>
                
                <!-- 健康提醒 -->
                <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-4 shadow-lg hover:shadow-xl transition-shadow border border-day-accent/10 dark:border-space-glow/20">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-space font-semibold text-lg">健康提醒</h3>
                        <i class="fa fa-heartbeat text-day-accent dark:text-space-glow text-xl"></i>
                    </div>
                    <div id="health-reminders" class="space-y-3">
                        <div class="flex items-center p-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/10">
                            <i class="fa fa-eye mr-2 text-day-accent dark:text-space-glow"></i>
                            <div>
                                <p class="font-medium text-sm">眼部休息</p>
                                <p class="text-xs opacity-70">每45分钟休息5分钟</p>
                            </div>
                        </div>
                        <div class="flex items-center p-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/10">
                            <i class="fa fa-coffee mr-2 text-day-accent dark:text-space-glow"></i>
                            <div>
                                <p class="font-medium text-sm">起身活动</p>
                                <p class="text-xs opacity-70">每小时起身活动5分钟</p>
                            </div>
                        </div>
                        <div class="flex items-center p-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/10">
                            <i class="fa fa-tint mr-2 text-day-accent dark:text-space-glow"></i>
                            <div>
                                <p class="font-medium text-sm">补充水分</p>
                                <p class="text-xs opacity-70">记得多喝水保持水分</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 世界时间 -->
                <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-4 shadow-lg hover:shadow-xl transition-shadow border border-day-accent/10 dark:border-space-glow/20">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-space font-semibold text-lg">世界时间</h3>
                        <i class="fa fa-globe text-day-accent dark:text-space-glow text-xl"></i>
                    </div>
                    <div id="world-clocks" class="space-y-3">
                        <!-- 时钟将通过JS动态添加 -->
                    </div>
                </div>
            </div>
            
            <!-- 广告位1 -->
            <div class="ad-slot relative overflow-hidden rounded-xl shadow-lg group h-40 md:h-56">
                <div class="absolute inset-0 bg-gradient-to-r from-space-accent/20 to-space-glow/20 dark:from-space-accent/40 dark:to-space-glow/40"></div>
                <img id="ad1-image" src="https://picsum.photos/1200/300?random=1" alt="广告图片1" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <a id="ad1-link" href="#" target="_blank" class="absolute inset-0"></a>
            </div>
            
            <!-- 书签收藏夹 -->
            <div>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-space font-bold">网站收藏</h2>
                    <span id="bookmark-count" class="px-3 py-1 rounded-full text-sm bg-day-accent/10 dark:bg-space-glow/20 text-day-accent dark:text-space-glow">0 个网站</span>
                </div>
                
                <div id="bookmark-groups" class="space-y-6">
                    <!-- 书签组将通过JS动态添加 -->
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="fa fa-bookmark-o text-4xl mb-3 opacity-50"></i>
                        <p>暂无收藏的网站</p>
                        <p class="text-sm mt-1">请在编辑页面添加您的书签</p>
                    </div>
                </div>
            </div>
            
            <!-- 广告位2 -->
            <div class="ad-slot relative overflow-hidden rounded-xl shadow-lg group h-40 md:h-56">
                <div class="absolute inset-0 bg-gradient-to-r from-space-accent/20 to-space-glow/20 dark:from-space-accent/40 dark:to-space-glow/40"></div>
                <img id="ad2-image" src="https://picsum.photos/1200/300?random=2" alt="广告图片2" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <a id="ad2-link" href="#" target="_blank" class="absolute inset-0"></a>
            </div>
            
            <!-- 广告位3 -->
            <div class="ad-slot relative overflow-hidden rounded-xl shadow-lg group h-40 md:h-56">
                <div class="absolute inset-0 bg-gradient-to-r from-space-accent/20 to-space-glow/20 dark:from-space-accent/40 dark:to-space-glow/40"></div>
                <img id="ad3-image" src="https://picsum.photos/1200/300?random=3" alt="广告图片3" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <a id="ad3-link" href="#" target="_blank" class="absolute inset-0"></a>
            </div>
        </section>

        <!-- 编辑页内容 -->
        <section id="edit-page" class="space-y-8 hidden">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-space font-bold">编辑中心</h2>
                <button id="back-to-home" class="px-4 py-2 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors">
                    <i class="fa fa-arrow-left mr-1"></i> 返回主页
                </button>
            </div>
            
            <!-- GitHub配置 -->
            <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-5 shadow-lg border border-day-accent/10 dark:border-space-glow/20">
                <h3 class="font-space font-semibold text-lg mb-4">GitHub 配置</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">用户名 (username)</label>
                        <input type="text" id="github-username" placeholder="your username" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">仓库名 (repo-name)</label>
                        <input type="text" id="github-repo" placeholder="your repo" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">访问令牌 (token)</label>
                        <input type="password" id="github-token" placeholder="your personal token" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                    </div>
                </div>
                <div class="mt-3 text-sm text-gray-500 dark:text-gray-400">
                    <p>未配置时将使用默认仓库: jiezione/jznav</p>
                    <p class="mt-1">需要创建 <a href="https://github.com/settings/tokens" target="_blank" class="text-day-accent dark:text-space-glow hover:underline">GitHub Personal Token</a> 并授予 repo 权限</p>
                </div>
            </div>
            
            <!-- 书签管理 -->
            <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-5 shadow-lg border border-day-accent/10 dark:border-space-glow/20">
                <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
                    <h3 class="font-space font-semibold text-lg">书签管理</h3>
                    <div class="flex space-x-2">
                        <label class="flex items-center px-3 py-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/20 text-day-accent dark:text-space-glow cursor-pointer hover:bg-day-accent/20 dark:hover:bg-space-glow/30 transition-colors">
                            <i class="fa fa-upload mr-1"></i> 导入HTML
                            <input type="file" id="import-html" accept=".html" class="hidden">
                        </label>
                        <button id="export-html" class="px-3 py-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/20 text-day-accent dark:text-space-glow hover:bg-day-accent/20 dark:hover:bg-space-glow/30 transition-colors">
                            <i class="fa fa-download mr-1"></i> 导出HTML
                        </button>
                        <button id="add-bookmark" class="px-3 py-2 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors">
                            <i class="fa fa-plus mr-1"></i> 添加书签
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex flex-wrap justify-between items-center gap-2 mb-2">
                        <p class="text-sm font-medium">书签组</p>
                        <button id="add-bookmark-group" class="text-sm text-day-accent dark:text-space-glow hover:underline">
                            <i class="fa fa-plus-circle mr-1"></i> 添加组
                        </button>
                    </div>
                    <div id="edit-bookmark-groups" class="space-y-6 max-h-[500px] overflow-y-auto pr-2">
                        <!-- 编辑模式的书签组将通过JS动态添加 -->
                        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <i class="fa fa-bookmark-o text-4xl mb-3 opacity-50"></i>
                            <p>暂无书签数据</p>
                            <p class="text-sm mt-1">请导入书签或添加新书签</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 备份与恢复 -->
            <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-5 shadow-lg border border-day-accent/10 dark:border-space-glow/20">
                <h3 class="font-space font-semibold text-lg mb-4">备份与恢复</h3>
                <div class="flex flex-wrap gap-4">
                    <button id="export-json" class="px-4 py-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/20 text-day-accent dark:text-space-glow hover:bg-day-accent/20 dark:hover:bg-space-glow/30 transition-colors">
                        <i class="fa fa-download mr-1"></i> 导出JSON备份
                    </button>
                    <label class="flex items-center px-4 py-2 rounded-lg bg-day-accent/10 dark:bg-space-glow/20 text-day-accent dark:text-space-glow cursor-pointer hover:bg-day-accent/20 dark:hover:bg-space-glow/30 transition-colors">
                        <i class="fa fa-upload mr-1"></i> 导入JSON备份
                        <input type="file" id="import-json" accept=".json" class="hidden">
                    </label>
                    <button id="load-default-data" class="px-4 py-2 rounded-lg bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 hover:bg-amber-200 dark:hover:bg-amber-900/40 transition-colors">
                        <i class="fa fa-refresh mr-1"></i> 加载默认数据
                    </button>
                </div>
            </div>
            
            <!-- 广告管理 -->
            <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-5 shadow-lg border border-day-accent/10 dark:border-space-glow/20">
                <h3 class="font-space font-semibold text-lg mb-4">广告管理</h3>
                <div class="space-y-6">
                    <!-- 广告1 -->
                    <div class="p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                        <h4 class="font-medium mb-3">广告位 1</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-1">广告图片 (最大3M)</label>
                                <label class="flex items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <i class="fa fa-cloud-upload text-2xl text-gray-400"></i>
                                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">点击上传</span> 或拖放文件</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">支持 PNG, JPG, GIF</p>
                                    </div>
                                    <input id="ad1-upload" type="file" accept="image/*" class="hidden" />
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">广告链接</label>
                                <input type="url" id="ad1-url" placeholder="https://example.com" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all mb-3">
                                <button id="remove-ad1" class="w-full px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-sm">
                                    <i class="fa fa-trash mr-1"></i> 移除广告
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 广告2 -->
                    <div class="p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                        <h4 class="font-medium mb-3">广告位 2</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-1">广告图片 (最大3M)</label>
                                <label class="flex items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <i class="fa fa-cloud-upload text-2xl text-gray-400"></i>
                                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">点击上传</span> 或拖放文件</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">支持 PNG, JPG, GIF</p>
                                    </div>
                                    <input id="ad2-upload" type="file" accept="image/*" class="hidden" />
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">广告链接</label>
                                <input type="url" id="ad2-url" placeholder="https://example.com" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all mb-3">
                                <button id="remove-ad2" class="w-full px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-sm">
                                    <i class="fa fa-trash mr-1"></i> 移除广告
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 广告3 -->
                    <div class="p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                        <h4 class="font-medium mb-3">广告位 3</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-1">广告图片 (最大3M)</label>
                                <label class="flex items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                        <i class="fa fa-cloud-upload text-2xl text-gray-400"></i>
                                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">点击上传</span> 或拖放文件</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">支持 PNG, JPG, GIF</p>
                                    </div>
                                    <input id="ad3-upload" type="file" accept="image/*" class="hidden" />
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">广告链接</label>
                                <input type="url" id="ad3-url" placeholder="https://example.com" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all mb-3">
                                <button id="remove-ad3" class="w-full px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-sm">
                                    <i class="fa fa-trash mr-1"></i> 移除广告
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 世界时间管理 -->
            <div class="bg-day-card/80 dark:bg-space-light/30 backdrop-blur-sm rounded-xl p-5 shadow-lg border border-day-accent/10 dark:border-space-glow/20">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-space font-semibold text-lg">世界时间管理</h3>
                    <button id="add-timezone-btn" class="px-3 py-2 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors text-sm">
                        <i class="fa fa-plus mr-1"></i> 添加时区
                    </button>
                </div>
                
                <div id="timezones-management" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                    <!-- 时区管理项将通过JS动态添加 -->
                </div>
            </div>
            
            <!-- 保存按钮 -->
            <div class="flex justify-end">
                <button id="save-changes" class="px-6 py-3 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors text-lg font-medium shadow-lg hover:shadow-xl">
                    <i class="fa fa-save mr-2"></i> 保存更改
                </button>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="relative z-10 py-6 border-t border-gray-200 dark:border-gray-800">
        <div class="container mx-auto px-4">
            <div class="dark-white flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div id="total-websites" class="text-sm">共收录 0 个网站</div>
                </div>
                <div class="text-sm">
                    <span id="copyright">Copyright © 2018-2025 , All Rights Reserved</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- 添加书签模态框 -->
    <div id="add-bookmark-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-day-card dark:bg-space-light rounded-xl p-5 w-full max-w-md shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-space font-semibold text-lg">添加新书签</h3>
                <button id="close-bookmark-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="bookmark-form">
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">书签组</label>
                    <select id="bookmark-group-select" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                        <option value="">-- 选择或创建组 --</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">网站名称</label>
                    <input type="text" id="bookmark-title" placeholder="网站名称" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">网站URL</label>
                    <input type="url" id="bookmark-url" placeholder="https://example.com" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">备注 (可选)</label>
                    <input type="text" id="bookmark-notes" placeholder="添加备注" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-bookmark" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">取消</button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 添加时区模态框 -->
    <div id="add-timezone-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-day-card dark:bg-space-light rounded-xl p-5 w-full max-w-md shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-space font-semibold text-lg">添加时区</h3>
                <button id="close-timezone-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="timezone-form">
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">城市名称</label>
                    <input type="text" id="timezone-city" placeholder="例如：北京" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium mb-1">时区偏移 (小时)</label>
                    <input type="number" step="0.5" id="timezone-offset" placeholder="例如：8" value="8" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">显示格式</label>
                    <select id="timezone-format" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                        <option value="HH:mm:ss">24小时制带秒 (14:30:45)</option>
                        <option value="HH:mm">24小时制 (14:30)</option>
                        <option value="h:mm:ss a">12小时制带秒 (2:30:45 PM)</option>
                        <option value="h:mm a">12小时制 (2:30 PM)</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-timezone" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">取消</button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 添加书签组模态框 -->
    <div id="add-group-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-day-card dark:bg-space-light rounded-xl p-5 w-full max-w-md shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-space font-semibold text-lg">添加书签组</h3>
                <button id="close-group-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="group-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">组名称</label>
                    <input type="text" id="group-name" placeholder="例如：常用工具" class="w-full px-3 py-2 rounded-lg bg-day-bg dark:bg-space-dark border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-day-accent dark:focus:ring-space-glow transition-all">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-group" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">取消</button>
                    <button type="submit" class="px-4 py-2 rounded-lg bg-day-accent dark:bg-space-glow text-white hover:bg-day-accent/90 dark:hover:bg-space-glow/90 transition-colors">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 max-w-xs"></div>

    <script>
        // 全局数据存储
        const appData = {
            bookmarks: [],
            timezones: [
                { id: '1', city: '北京', offset: 8, format: 'HH:mm' },
                { id: '2', city: '伦敦', offset: 0, format: 'HH:mm' },
                { id: '3', city: '纽约', offset: -4, format: 'HH:mm' }
            ],
            ads: [
                { id: '1', image: 'https://picsum.photos/1200/300?random=1', url: '#' },
                { id: '2', image: 'https://picsum.photos/1200/300?random=2', url: '#' },
                { id: '3', image: 'https://picsum.photos/1200/300?random=3', url: '#' }
            ],
            onlineTimeData: {
                labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                data: [2.5, 1.8, 3.2, 2.1, 2.9, 4.2, 3.5]
            },
            githubConfig: {
                username: '',
                repo: '',
                token: ''
            }
        };

        // DOM 元素
        const elements = {
            homePage: document.getElementById('home-page'),
            editPage: document.getElementById('edit-page'),
            editBtn: document.getElementById('edit-btn'),
            backToHome: document.getElementById('back-to-home'),
            themeToggle: document.getElementById('theme-toggle'),
            themeButtons: document.querySelectorAll('[data-theme]'),
            navbar: document.getElementById('navbar'),
            bookmarkGroups: document.getElementById('bookmark-groups'),
            editBookmarkGroups: document.getElementById('edit-bookmark-groups'),
            bookmarkCount: document.getElementById('bookmark-count'),
            totalWebsites: document.getElementById('total-websites'),
            copyright: document.getElementById('copyright'),
            addBookmarkBtn: document.getElementById('add-bookmark'),
            addBookmarkModal: document.getElementById('add-bookmark-modal'),
            closeBookmarkModal: document.getElementById('close-bookmark-modal'),
            cancelBookmark: document.getElementById('cancel-bookmark'),
            bookmarkForm: document.getElementById('bookmark-form'),
            bookmarkGroupSelect: document.getElementById('bookmark-group-select'),
            addBookmarkGroupBtn: document.getElementById('add-bookmark-group'),
            addGroupModal: document.getElementById('add-group-modal'),
            closeGroupModal: document.getElementById('close-group-modal'),
            cancelGroup: document.getElementById('cancel-group'),
            groupForm: document.getElementById('group-form'),
            importHtml: document.getElementById('import-html'),
            exportHtml: document.getElementById('export-html'),
            importJson: document.getElementById('import-json'),
            exportJson: document.getElementById('export-json'),
            loadDefaultData: document.getElementById('load-default-data'),
            saveChanges: document.getElementById('save-changes'),
            notification: document.getElementById('notification'),
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            worldClocks: document.getElementById('world-clocks'),
            timezonesList: document.getElementById('time-zones-list'),
            timezonesManagement: document.getElementById('timezones-management'),
            addTimezoneBtn: document.getElementById('add-timezone-btn'),
            addTimezone: document.getElementById('add-timezone'),
            addTimezoneModal: document.getElementById('add-timezone-modal'),
            closeTimezoneModal: document.getElementById('close-timezone-modal'),
            cancelTimezone: document.getElementById('cancel-timezone'),
            timezoneForm: document.getElementById('timezone-form'),
            ad1Upload: document.getElementById('ad1-upload'),
            ad1Url: document.getElementById('ad1-url'),
            removeAd1: document.getElementById('remove-ad1'),
            ad2Upload: document.getElementById('ad2-upload'),
            ad2Url: document.getElementById('ad2-url'),
            removeAd2: document.getElementById('remove-ad2'),
            ad3Upload: document.getElementById('ad3-upload'),
            ad3Url: document.getElementById('ad3-url'),
            removeAd3: document.getElementById('remove-ad3'),
            ad1Image: document.getElementById('ad1-image'),
            ad1Link: document.getElementById('ad1-link'),
            ad2Image: document.getElementById('ad2-image'),
            ad2Link: document.getElementById('ad2-link'),
            ad3Image: document.getElementById('ad3-image'),
            ad3Link: document.getElementById('ad3-link')
        };

        // 初始化函数
        async function init() {
            createStars();
            initTheme();
            initOnlineTimeChart();
            await loadGitHubConfig();
            await loadDataFromGitHub();
            renderBookmarks();
            renderEditBookmarks();
            renderTimezones();
            renderTimezonesManagement();
            updateCopyright();
            setupEventListeners();
            startScrollTimer();
            updateTotalWebsites();
            updateAdLinks();
        }

        // 创建星空背景
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starsCount = 150;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                
                const delay = Math.random() * 5;
                star.style.animationDelay = `${delay}s`;
                
                const opacity = Math.random() * 0.8 + 0.2;
                star.style.opacity = opacity;
                
                starsContainer.appendChild(star);
            }
        }

        // 初始化主题
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 
                              (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.classList.toggle('dark', savedTheme === 'dark');
        }

        // 初始化在线时长图表
        function initOnlineTimeChart() {
            const ctx = document.getElementById('online-time-chart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: appData.onlineTimeData.labels,
                    datasets: [{
                        label: '小时',
                        data: appData.onlineTimeData.data,
                        backgroundColor: isDark ? 'rgba(123, 102, 255, 0.6)' : 'rgba(66, 99, 235, 0.6)',
                        borderColor: isDark ? 'rgba(123, 102, 255, 1)' : 'rgba(66, 99, 235, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: isDark ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: isDark ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            const totalHours = appData.onlineTimeData.data.reduce((sum, hours) => sum + hours, 0);
            const hours = Math.floor(totalHours);
            const minutes = Math.round((totalHours - hours) * 60);
            document.getElementById('total-online-time').textContent = `本周总计: ${hours}小时${minutes}分钟`;
        }

        // 加载GitHub配置
        function loadGitHubConfig() {
            return new Promise(resolve => {
                const savedConfig = localStorage.getItem('githubConfig');
                if (savedConfig) {
                    try {
                        const config = JSON.parse(savedConfig);
                        appData.githubConfig = config;
                        elements.githubUsername.value = config.username || '';
                        elements.githubRepo.value = config.repo || '';
                        elements.githubToken.value = config.token || '';
                    } catch (e) {
                        console.error('Failed to parse GitHub config:', e);
                    }
                }
                resolve();
            });
        }

        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            try {
                const { username, repo, token } = appData.githubConfig;
                let url;
                
                if (username && repo && token) {
                    url = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                } else {
                    url = 'https://raw.githubusercontent.com/jiezione/jznav/main/bookmarks.json';
                }
                
                const options = {};
                if (token) {
                    options.headers = {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    };
                }
                
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                let data;
                if (token && username && repo) {
                    const githubData = await response.json();
                    data = JSON.parse(atob(githubData.content));
                } else {
                    data = await response.json();
                }
                
                if (data.bookmarks) appData.bookmarks = data.bookmarks;
                if (data.timezones) appData.timezones = data.timezones;
                if (data.ads) appData.ads = data.ads;
                
                showNotification('数据加载成功', 'success');
            } catch (error) {
                console.error('Failed to load data from GitHub:', error);
                showNotification('加载默认数据', 'info');
                loadDefaultBookmarks();
            }
        }

        // 加载默认书签
        function loadDefaultBookmarks() {
            appData.bookmarks = [
                {
                    id: 'g1',
                    name: '搜索引擎',
                    bookmarks: [
                        { id: '1', title: 'Google', url: 'https://google.com', notes: '' },
                        { id: '2', title: '百度', url: 'https://baidu.com', notes: '' },
                        { id: '3', title: '必应', url: 'https://bing.com', notes: '' }
                    ]
                },
                {
                    id: 'g2',
                    name: '开发工具',
                    bookmarks: [
                        { id: '4', title: 'GitHub', url: 'https://github.com', notes: '' },
                        { id: '5', title: 'Stack Overflow', url: 'https://stackoverflow.com', notes: '' }
                    ]
                }
            ];
        }

        // 保存数据到GitHub
        async function saveDataToGitHub() {
            try {
                const { username, repo, token } = appData.githubConfig;
                let apiUrl, contentUrl;
                
                if (username && repo && token) {
                    apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                    contentUrl = apiUrl;
                } else {
                    apiUrl = `https://api.github.com/repos/jiezione/jznav/contents/bookmarks.json`;
                    contentUrl = apiUrl;
                }
                
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    timezones: appData.timezones,
                    ads: appData.ads
                };
                
                const content = JSON.stringify(dataToSave, null, 2);
                
                let sha;
                try {
                    const response = await fetch(contentUrl, {
                        headers: token ? { 'Authorization': `token ${token}` } : {}
                    });
                    
                    if (response.ok) {
                        const fileData = await response.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    console.log('File does not exist yet, will create it');
                }
                
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': token ? `token ${token}` : '',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via星际导航',
                        content: base64Content,
                        ...(sha && { sha })
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                showNotification('数据已成功保存到GitHub', 'success');
                return true;
            } catch (error) {
                console.error('Failed to save data to GitHub:', error);
                showNotification('保存到GitHub失败，请检查配置', 'error');
                return false;
            }
        }

        // 渲染书签到主页
        function renderBookmarks() {
            elements.bookmarkGroups.innerHTML = '';
            
            if (appData.bookmarks.length === 0) {
                elements.bookmarkGroups.innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="fa fa-bookmark-o text-4xl mb-3 opacity-50"></i>
                        <p>暂无收藏的网站</p>
                        <p class="text-sm mt-1">请在编辑页面添加您的书签</p>
                    </div>
                `;
                elements.bookmarkCount.textContent = '0 个网站';
                return;
            }
            
            let totalCount = 0;
            
            appData.bookmarks.forEach(group => {
                totalCount += group.bookmarks.length;
                
                const groupElement = document.createElement('div');
                groupElement.className = 'space-y-3';
                
                groupElement.innerHTML = `
                    <h3 class="text-xl font-space font-semibold flex items-center">
                        <span class="w-2 h-2 rounded-full bg-space-glow dark:bg-space-planet mr-2"></span>
                        ${group.name} <span class="text-sm font-normal ml-2 text-gray-500 dark:text-gray-400">(${group.bookmarks.length})</span>
                    </h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                        ${group.bookmarks.map(bookmark => `
                            <a href="${bookmark.url}" target="_blank" 
                               class="group bg-day-card dark:bg-space-light/50 rounded-lg p-3 shadow hover:shadow-md transition-all border border-gray-100 dark:border-gray-800 hover:border-day-accent/30 dark:hover:border-space-glow/30">
                                <div class="flex items-center mb-2">
                                    <div class="w-6 h-6 rounded bg-gray-100 dark:bg-gray-800 flex items-center justify-center mr-2 overflow-hidden">
                                        <img src="https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(bookmark.url)}&size=16" 
                                             alt="${bookmark.title} favicon" class="w-full h-full object-contain">
                                    </div>
                                    <span class="font-medium text-sm truncate">${bookmark.title}</span>
                                </div>
                                ${bookmark.notes ? `<p class="text-xs text-gray-500 dark:text-gray-400 truncate">${bookmark.notes}</p>` : ''}
                            </a>
                        `).join('')}
                    </div>
                `;
                
                elements.bookmarkGroups.appendChild(groupElement);
            });
            
            elements.bookmarkCount.textContent = `${totalCount} 个网站`;
            updateTotalWebsites();
        }

        // 渲染编辑页的书签
        function renderEditBookmarks() {
            elements.editBookmarkGroups.innerHTML = '';
            elements.bookmarkGroupSelect.innerHTML = '<option value="">-- 选择或创建组 --</option>';
            
            if (appData.bookmarks.length === 0) {
                elements.editBookmarkGroups.innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <i class="fa fa-bookmark-o text-4xl mb-3 opacity-50"></i>
                        <p>暂无书签数据</p>
                        <p class="text-sm mt-1">请导入书签或添加新书签</p>
                    </div>
                `;
                return;
            }
            
            appData.bookmarks.forEach(group => {
                elements.bookmarkGroupSelect.innerHTML += `
                    <option value="${group.id}">${group.name}</option>
                `;
                
                const groupElement = document.createElement('div');
                groupElement.className = 'p-4 rounded-lg border border-gray-200 dark:border-gray-700';
                
                groupElement.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center">
                            <h3 class="font-medium">${group.name}</h3>
                            <span class="ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100 dark:bg-gray-800">${group.bookmarks.length} 个书签</span>
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-group text-sm text-blue-600 dark:text-blue-400 hover:underline" data-id="${group.id}">
                                <i class="fa fa-pencil mr-1"></i> 编辑
                            </button>
                            <button class="delete-group text-sm text-red-600 dark:text-red-400 hover:underline" data-id="${group.id}">
                                <i class="fa fa-trash mr-1"></i> 删除
                            </button>
                        </div>
                    </div>
                    <div class="space-y-2 max-h-60 overflow-y-auto pr-2">
                        ${group.bookmarks.length > 0 ? group.bookmarks.map(bookmark => `
                            <div class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                                <div class="flex items-center">
                                    <div class="w-6 h-6 rounded bg-gray-100 dark:bg-gray-800 flex items-center justify-center mr-2 overflow-hidden">
                                        <img src="https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(bookmark.url)}&size=16" 
                                             alt="${bookmark.title} favicon" class="w-full h-full object-contain">
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium">${bookmark.title}</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 truncate max-w-xs">${bookmark.url}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="edit-bookmark p-1.5 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded" data-group-id="${group.id}" data-id="${bookmark.id}">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <button class="delete-bookmark p-1.5 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded" data-group-id="${group.id}" data-id="${bookmark.id}">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('') : `
                            <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                                该组暂无书签
                            </div>
                        `}
                    </div>
                `;
                
                elements.editBookmarkGroups.appendChild(groupElement);
            });
            
            // 添加组编辑和删除事件监听
            document.querySelectorAll('.edit-group').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupId = e.currentTarget.dataset.id;
                    editGroup(groupId);
                });
            });
            
            document.querySelectorAll('.delete-group').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupId = e.currentTarget.dataset.id;
                    deleteGroup(groupId);
                });
            });
            
            // 添加书签编辑和删除事件监听
            document.querySelectorAll('.edit-bookmark').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupId = e.currentTarget.dataset.groupId;
                    const bookmarkId = e.currentTarget.dataset.id;
                    editBookmark(groupId, bookmarkId);
                });
            });
            
            document.querySelectorAll('.delete-bookmark').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupId = e.currentTarget.dataset.groupId;
                    const bookmarkId = e.currentTarget.dataset.id;
                    deleteBookmark(groupId, bookmarkId);
                });
            });
        }

        // 渲染世界时间
        function renderTimezones() {
            elements.worldClocks.innerHTML = '';
            elements.timezonesList.innerHTML = '';
            
            if (appData.timezones.length === 0) {
                elements.worldClocks.innerHTML = `
                    <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                        暂无时区，请添加
                    </div>
                `;
                return;
            }
            
            appData.timezones.forEach(timezone => {
                // 主页时钟
                const clockElement = document.createElement('div');
                clockElement.className = 'p-2 rounded-lg bg-day-accent/5 dark:bg-space-glow/5';
                
                clockElement.innerHTML = `
                    <p class="font-medium">${timezone.city}</p>
                    <p class="text-lg font-mono timezone-time" data-id="${timezone.id}" data-offset="${timezone.offset}" data-format="${timezone.format}">--:--</p>
                `;
                
                elements.worldClocks.appendChild(clockElement);
                
                // 下拉菜单时钟
                const dropdownClock = document.createElement('div');
                dropdownClock.className = 'flex justify-between items-center';
                
                dropdownClock.innerHTML = `
                    <div>
                        <p class="text-sm font-medium">${timezone.city}</p>
                        <p class="text-xs font-mono timezone-time" data-id="${timezone.id}" data-offset="${timezone.offset}" data-format="${timezone.format}">--:--</p>
                    </div>
                    <button class="delete-timezone text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300" data-id="${timezone.id}">
                        <i class="fa fa-times"></i>
                    </button>
                `;
                
                elements.timezonesList.appendChild(dropdownClock);
            });
            
            // 更新时间
            updateTimezones();
            setInterval(updateTimezones, 1000);
            
            // 添加删除时区事件
            document.querySelectorAll('.delete-timezone').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const timezoneId = e.currentTarget.dataset.id;
                    deleteTimezone(timezoneId);
                });
            });
        }

        // 渲染时区管理
        function renderTimezonesManagement() {
            elements.timezonesManagement.innerHTML = '';
            
            if (appData.timezones.length === 0) {
                elements.timezonesManagement.innerHTML = `
                    <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                        暂无时区，请添加
                    </div>
                `;
                return;
            }
            
            appData.timezones.forEach(timezone => {
                const timezoneElement = document.createElement('div');
                timezoneElement.className = 'flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700';
                
                timezoneElement.innerHTML = `
                    <div>
                        <p class="font-medium">${timezone.city}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">UTC${timezone.offset >= 0 ? '+' : ''}${timezone.offset}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-timezone px-2 py-1 text-sm rounded bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors" data-id="${timezone.id}">
                            编辑
                        </button>
                        <button class="delete-timezone px-2 py-1 text-sm rounded bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/40 transition-colors" data-id="${timezone.id}">
                            删除
                        </button>
                    </div>
                `;
                
                elements.timezonesManagement.appendChild(timezoneElement);
            });
            
            // 添加事件监听
            document.querySelectorAll('.edit-timezone').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const timezoneId = e.currentTarget.dataset.id;
                    editTimezone(timezoneId);
                });
            });
            
            document.querySelectorAll('.delete-timezone').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const timezoneId = e.currentTarget.dataset.id;
                    deleteTimezone(timezoneId);
                });
            });
        }

        // 更新时区时间
        function updateTimezones() {
            const now = new Date();
            const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
            
            document.querySelectorAll('.timezone-time').forEach(element => {
                const offset = parseFloat(element.dataset.offset);
                const format = element.dataset.format;
                const timezoneTime = new Date(utcTime + offset * 3600000);
                
                let timeString;
                switch (format) {
                    case 'HH:mm:ss':
                        timeString = timezoneTime.toLocaleTimeString('zh-CN', { hour12: false });
                        break;
                    case 'HH:mm':
                        timeString = timezoneTime.toLocaleTimeString('zh-CN', { hour12: false, hour: '2-digit', minute: '2-digit' });
                        break;
                    case 'h:mm:ss a':
                        timeString = timezoneTime.toLocaleTimeString('zh-CN', { hour12: true });
                        break;
                    case 'h:mm a':
                        timeString = timezoneTime.toLocaleTimeString('zh-CN', { hour12: true, hour: 'numeric', minute: '2-digit' });
                        break;
                    default:
                        timeString = timezoneTime.toLocaleTimeString('zh-CN', { hour12: false });
                }
                
                element.textContent = timeString;
            });
        }

        // 更新广告链接
        function updateAdLinks() {
            appData.ads.forEach(ad => {
                const imgElement = document.getElementById(`ad${ad.id}-image`);
                const linkElement = document.getElementById(`ad${ad.id}-link`);
                const urlInput = document.getElementById(`ad${ad.id}-url`);
                
                if (imgElement && ad.image) imgElement.src = ad.image;
                if (linkElement && ad.url) linkElement.href = ad.url;
                if (urlInput && ad.url) urlInput.value = ad.url;
            });
        }

        // 更新总网站数
        function updateTotalWebsites() {
            const total = appData.bookmarks.reduce((sum, group) => sum + group.bookmarks.length, 0);
            elements.totalWebsites.textContent = `共收录 ${total} 个网站`;
        }

        // 更新版权信息
        function updateCopyright() {
            const year = new Date().getFullYear();
            const hostname = window.location.hostname || '星际导航';
            elements.copyright.textContent = `Copyright © 2018-${year} ${hostname}, All Rights Reserved`;
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const notification = elements.notification;
            notification.textContent = message;
            
            // 设置样式
            notification.className = 'fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 z-50 max-w-xs';
            
            switch (type) {
                case 'success':
                    notification.classList.add('bg-green-50', 'text-green-800', 'dark:bg-green-900/30', 'dark:text-green-300', 'border', 'border-green-200', 'dark:border-green-800');
                    break;
                case 'error':
                    notification.classList.add('bg-red-50', 'text-red-800', 'dark:bg-red-900/30', 'dark:text-red-300', 'border', 'border-red-200', 'dark:border-red-800');
                    break;
                case 'warning':
                    notification.classList.add('bg-yellow-50', 'text-yellow-800', 'dark:bg-yellow-900/30', 'dark:text-yellow-300', 'border', 'border-yellow-200', 'dark:border-yellow-800');
                    break;
                default:
                    notification.classList.add('bg-blue-50', 'text-blue-800', 'dark:bg-blue-900/30', 'dark:text-blue-300', 'border', 'border-blue-200', 'dark:border-blue-800');
            }
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // 添加书签
        function addBookmark(groupId, bookmarkData) {
            const group = appData.bookmarks.find(g => g.id === groupId);
            if (!group) return false;
            
            const newBookmark = {
                id: Date.now().toString(),
                title: bookmarkData.title || '未命名网站',
                url: bookmarkData.url || '',
                notes: bookmarkData.notes || ''
            };
            
            // 去重检查
            const isDuplicate = group.bookmarks.some(b => b.url === newBookmark.url);
            if (isDuplicate) {
                showNotification('该网址已存在于书签组中', 'warning');
                return false;
            }
            
            group.bookmarks.push(newBookmark);
            renderBookmarks();
            renderEditBookmarks();
            showNotification('书签添加成功', 'success');
            return true;
        }

        // 编辑书签
        function editBookmark(groupId, bookmarkId) {
            const group = appData.bookmarks.find(g => g.id === groupId);
            if (!group) return;
            
            const bookmark = group.bookmarks.find(b => b.id === bookmarkId);
            if (!bookmark) return;
            
            // 填充表单
            elements.bookmarkGroupSelect.value = groupId;
            elements.bookmarkTitle.value = bookmark.title;
            elements.bookmarkUrl.value = bookmark.url;
            elements.bookmarkNotes.value = bookmark.notes || '';
            
            // 保存原ID用于更新
            elements.bookmarkForm.dataset.editGroupId = groupId;
            elements.bookmarkForm.dataset.editId = bookmarkId;
            
            // 显示模态框
            elements.addBookmarkModal.classList.remove('hidden');
        }

        // 更新书签
        function updateBookmark(groupId, bookmarkId, newData) {
            const group = appData.bookmarks.find(g => g.id === groupId);
            if (!group) return false;
            
            const bookmarkIndex = group.bookmarks.findIndex(b => b.id === bookmarkId);
            if (bookmarkIndex === -1) return false;
            
            // 检查重复（排除自身）
            const isDuplicate = group.bookmarks.some((b, index) => 
                index !== bookmarkIndex && b.url === newData.url
            );
            
            if (isDuplicate) {
                showNotification('该网址已存在于书签组中', 'warning');
                return false;
            }
            
            // 更新书签
            group.bookmarks[bookmarkIndex] = {
                ...group.bookmarks[bookmarkIndex],
                title: newData.title || '未命名网站',
                url: newData.url || '',
                notes: newData.notes || ''
            };
            
            renderBookmarks();
            renderEditBookmarks();
            showNotification('书签更新成功', 'success');
            return true;
        }

        // 删除书签
        function deleteBookmark(groupId, bookmarkId) {
            if (!confirm('确定要删除这个书签吗？')) return;
            
            const group = appData.bookmarks.find(g => g.id === groupId);
            if (!group) return;
            
            const initialLength = group.bookmarks.length;
            group.bookmarks = group.bookmarks.filter(b => b.id !== bookmarkId);
            
            if (group.bookmarks.length < initialLength) {
                renderBookmarks();
                renderEditBookmarks();
                showNotification('书签已删除', 'info');
            }
        }

        // 添加书签组
        function addBookmarkGroup(groupName) {
            if (!groupName.trim()) {
                showNotification('组名称不能为空', 'warning');
                return false;
            }
            
            // 检查是否已存在同名组
            const exists = appData.bookmarks.some(g => g.name.trim() === groupName.trim());
            if (exists) {
                showNotification('已存在同名的书签组', 'warning');
                return false;
            }
            
            const newGroup = {
                id: `g${Date.now()}`,
                name: groupName.trim(),
                bookmarks: []
            };
            
            appData.bookmarks.push(newGroup);
            renderBookmarks();
            renderEditBookmarks();
            showNotification('书签组添加成功', 'success');
            return true;
        }

        // 编辑书签组
        function editGroup(groupId) {
            const group = appData.bookmarks.find(g => g.id === groupId);
            if (!group) return;
            
            // 填充表单
            elements.groupForm.dataset.editId = groupId;
            elements.groupForm.querySelector('#group-name').value = group.name;
            
            // 显示模态框
            elements.addGroupModal.classList.remove('hidden');
        }

        // 更新书签组
        function updateBookmarkGroup(groupId, newName) {
            if (!newName.trim()) {
                showNotification('组名称不能为空', 'warning');
                return false;
            }
            
            const groupIndex = appData.bookmarks.findIndex(g => g.id === groupId);
            if (groupIndex === -1) return false;
            
            // 检查是否已存在同名组（排除自身）
            const exists = appData.bookmarks.some((g, index) => 
                index !== groupIndex && g.name.trim() === newName.trim()
            );
            
            if (exists) {
                showNotification('已存在同名的书签组', 'warning');
                return false;
            }
            
            appData.bookmarks[groupIndex].name = newName.trim();
            renderBookmarks();
            renderEditBookmarks();
            showNotification('书签组更新成功', 'success');
            return true;
        }

        // 删除书签组
        function deleteGroup(groupId) {
            if (!confirm('确定要删除这个书签组吗？组内所有书签也将被删除。')) return;
            
            const initialLength = appData.bookmarks.length;
            appData.bookmarks = appData.bookmarks.filter(g => g.id !== groupId);
            
            if (appData.bookmarks.length < initialLength) {
                renderBookmarks();
                renderEditBookmarks();
                showNotification('书签组已删除', 'info');
            }
        }

        // 添加时区
        function addTimezone(data) {
            if (!data.city.trim()) {
                showNotification('城市名称不能为空', 'warning');
                return false;
            }
            
            const newTimezone = {
                id: Date.now().toString(),
                city: data.city.trim(),
                offset: parseFloat(data.offset) || 0,
                format: data.format || 'HH:mm'
            };
            
            appData.timezones.push(newTimezone);
            renderTimezones();
            renderTimezonesManagement();
            showNotification('时区添加成功', 'success');
            return true;
        }

        // 编辑时区
        function editTimezone(timezoneId) {
            const timezone = appData.timezones.find(t => t.id === timezoneId);
            if (!timezone) return;
            
            // 填充表单
            elements.timezoneForm.dataset.editId = timezoneId;
            elements.timezoneForm.querySelector('#timezone-city').value = timezone.city;
            elements.timezoneForm.querySelector('#timezone-offset').value = timezone.offset;
            elements.timezoneForm.querySelector('#timezone-format').value = timezone.format;
            
            // 显示模态框
            elements.addTimezoneModal.classList.remove('hidden');
        }

        // 更新时区
        function updateTimezone(timezoneId, newData) {
            if (!newData.city.trim()) {
                showNotification('城市名称不能为空', 'warning');
                return false;
            }
            
            const timezoneIndex = appData.timezones.findIndex(t => t.id === timezoneId);
            if (timezoneIndex === -1) return false;
            
            appData.timezones[timezoneIndex] = {
                ...appData.timezones[timezoneIndex],
                city: newData.city.trim(),
                offset: parseFloat(newData.offset) || 0,
                format: newData.format || 'HH:mm'
            };
            
            renderTimezones();
            renderTimezonesManagement();
            showNotification('时区更新成功', 'success');
            return true;
        }

        // 删除时区
        function deleteTimezone(timezoneId) {
            if (!confirm('确定要删除这个时区吗？')) return;
            
            const initialLength = appData.timezones.length;
            appData.timezones = appData.timezones.filter(t => t.id !== timezoneId);
            
            if (appData.timezones.length < initialLength) {
                renderTimezones();
                renderTimezonesManagement();
                showNotification('时区已删除', 'info');
            }
        }

        // 导入HTML书签
        function importHtmlBookmarks(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(e.target.result, 'text/html');
                    const bookmarkElements = doc.querySelectorAll('a');
                    
                    if (bookmarkElements.length === 0) {
                        showNotification('未找到书签数据', 'warning');
                        return;
                    }
                    
                    const importedGroups = {};
                    
                    bookmarkElements.forEach(link => {
                        let groupName = '导入的书签';
                        let parent = link.parentNode;
                        
                        while (parent && parent.tagName !== 'DL' && parent.tagName !== 'BODY') {
                            if (parent.tagName === 'H3') {
                                groupName = parent.textContent.trim() || groupName;
                                break;
                            }
                            parent = parent.parentNode;
                        }
                        
                        if (!importedGroups[groupName]) {
                            importedGroups[groupName] = [];
                        }
                        
                        importedGroups[groupName].push({
                            title: link.textContent.trim() || '未命名',
                            url: link.href,
                            notes: link.getAttribute('add_date') ? `添加于: ${new Date(parseInt(link.getAttribute('add_date')) * 1000).toLocaleString()}` : ''
                        });
                    });
                    
                    // 合并到现有书签组
                    Object.keys(importedGroups).forEach(groupName => {
                        let group = appData.bookmarks.find(g => g.name === groupName);
                        
                        if (!group) {
                            group = {
                                id: `g${Date.now()}`,
                                name: groupName,
                                bookmarks: []
                            };
                            appData.bookmarks.push(group);
                        }
                        
                        importedGroups[groupName].forEach(bookmark => {
                            // 去重检查
                            const isDuplicate = group.bookmarks.some(b => b.url === bookmark.url);
                            if (!isDuplicate) {
                                group.bookmarks.push({
                                    id: Date.now().toString() + Math.random().toString(36).substr(2, 5),
                                    ...bookmark
                                });
                            }
                        });
                    });
                    
                    renderBookmarks();
                    renderEditBookmarks();
                    showNotification(`成功导入 ${bookmarkElements.length} 个书签（已自动去重）`, 'success');
                } catch (error) {
                    console.error('Failed to import HTML bookmarks:', error);
                    showNotification('导入书签失败，请检查文件格式', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // 导出HTML书签
        function exportHtmlBookmarks() {
            if (appData.bookmarks.length === 0 || appData.bookmarks.every(g => g.bookmarks.length === 0)) {
                showNotification('没有可导出的书签', 'warning');
                return;
            }
            
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            appData.bookmarks.forEach(group => {
                if (group.bookmarks.length === 0) return;
                
                html += `<DT><H3>${group.name}</H3>
<DL><p>`;
                
                group.bookmarks.forEach(bookmark => {
                    html += `<DT><A HREF="${bookmark.url}" ADD_DATE="${Math.floor(Date.now() / 1000)}">${bookmark.title}</A>`;
                    if (bookmark.notes) {
                        html += `<DD>${bookmark.notes}</DD>`;
                    }
                    html += '\n';
                });
                
                html += `</DL><p>`;
            });
            
            html += `</DL>`;
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bookmarks_${new Date().toISOString().slice(0, 10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('书签已导出为HTML文件', 'success');
        }

        // 导出JSON备份
        function exportJsonBackup() {
            const dataToExport = {
                bookmarks: appData.bookmarks,
                timezones: appData.timezones,
                ads: appData.ads,
                exportedAt: new Date().toISOString()
            };
            
            const json = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([json], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('数据已导出为JSON备份', 'success');
        }

        // 导入JSON备份
        function importJsonBackup(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.bookmarks) appData.bookmarks = data.bookmarks;
                    if (data.timezones) appData.timezones = data.timezones;
                    if (data.ads) appData.ads = data.ads;
                    
                    renderBookmarks();
                    renderEditBookmarks();
                    renderTimezones();
                    renderTimezonesManagement();
                    updateAdLinks();
                    
                    showNotification('JSON备份导入成功', 'success');
                } catch (error) {
                    console.error('Failed to import JSON backup:', error);
                    showNotification('导入备份失败，请检查文件格式', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // 处理广告图片上传
        function handleAdImageUpload(event, adId) {
            const file = event.target.files[0];
            if (!file) return;
            
            // 检查文件大小
            if (file.size > 3 * 1024 * 1024) {
                showNotification('图片大小不能超过3MB', 'warning');
                return;
            }
            
            // 检查文件类型
            if (!file.type.startsWith('image/')) {
                showNotification('请上传图片文件', 'warning');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const adIndex = appData.ads.findIndex(a => a.id === adId);
                if (adIndex !== -1) {
                    appData.ads[adIndex].image = e.target.result;
                    document.getElementById(`ad${adId}-image`).src = e.target.result;
                    showNotification('广告图片已更新', 'success');
                }
            };
            
            reader.readAsDataURL(file);
        }

        // 移除广告
        function removeAd(adId) {
            const adIndex = appData.ads.findIndex(a => a.id === adId);
            if (adIndex !== -1) {
                appData.ads[adIndex].image = '';
                appData.ads[adIndex].url = '#';
                document.getElementById(`ad${adId}-image`).src = `https://picsum.photos/1200/300?random=${adId}`;
                document.getElementById(`ad${adId}-url`).value = '';
                document.getElementById(`ad${adId}-link`).href = '#';
                showNotification('广告已移除', 'info');
            }
        }

        // 更新广告链接
        function updateAdUrl(adId, url) {
            const adIndex = appData.ads.findIndex(a => a.id === adId);
            if (adIndex !== -1) {
                appData.ads[adIndex].url = url;
                document.getElementById(`ad${adId}-link`).href = url;
            }
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 页面切换
            elements.editBtn.addEventListener('click', () => {
                elements.homePage.classList.add('hidden');
                elements.editPage.classList.remove('hidden');
            });
            
            elements.backToHome.addEventListener('click', () => {
                elements.editPage.classList.add('hidden');
                elements.homePage.classList.remove('hidden');
            });
            
            // 主题切换
            elements.themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                initOnlineTimeChart();
            });
            
            elements.themeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    document.documentElement.classList.toggle('dark', theme === 'dark');
                    localStorage.setItem('theme', theme);
                    initOnlineTimeChart();
                });
            });
            
            // 添加书签
            elements.addBookmarkBtn.addEventListener('click', () => {
                // 重置表单
                elements.bookmarkForm.reset();
                delete elements.bookmarkForm.dataset.editGroupId;
                delete elements.bookmarkForm.dataset.editId;
                elements.addBookmarkModal.classList.remove('hidden');
            });
            
            // 关闭书签模态框
            elements.closeBookmarkModal.addEventListener('click', () => {
                elements.addBookmarkModal.classList.add('hidden');
            });
            
            elements.cancelBookmark.addEventListener('click', () => {
                elements.addBookmarkModal.classList.add('hidden');
            });
            
            // 提交书签表单
            elements.bookmarkForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const groupId = elements.bookmarkGroupSelect.value;
                const title = elements.bookmarkTitle.value;
                const url = elements.bookmarkUrl.value;
                const notes = elements.bookmarkNotes.value;
                
                if (!groupId) {
                    showNotification('请选择书签组', 'warning');
                    return;
                }
                
                if (!url) {
                    showNotification('请输入网站URL', 'warning');
                    return;
                }
                
                // 检查是否是编辑模式
                const editGroupId = elements.bookmarkForm.dataset.editGroupId;
                const editId = elements.bookmarkForm.dataset.editId;
                
                if (editGroupId && editId) {
                    updateBookmark(editGroupId, editId, { title, url, notes });
                } else {
                    addBookmark(groupId, { title, url, notes });
                }
                
                elements.addBookmarkModal.classList.add('hidden');
            });
            
            // 添加书签组
            elements.addBookmarkGroupBtn.addEventListener('click', () => {
                elements.groupForm.reset();
                delete elements.groupForm.dataset.editId;
                elements.addGroupModal.classList.remove('hidden');
            });
            
            // 关闭组模态框
            elements.closeGroupModal.addEventListener('click', () => {
                elements.addGroupModal.classList.add('hidden');
            });
            
            elements.cancelGroup.addEventListener('click', () => {
                elements.addGroupModal.classList.add('hidden');
            });
            
            // 提交组表单
            elements.groupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const groupName = document.getElementById('group-name').value;
                
                // 检查是否是编辑模式
                const editId = elements.groupForm.dataset.editId;
                
                if (editId) {
                    updateBookmarkGroup(editId, groupName);
                } else {
                    addBookmarkGroup(groupName);
                }
                
                elements.addGroupModal.classList.add('hidden');
            });
            
            // 导入HTML书签
            elements.importHtml.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    importHtmlBookmarks(file);
                }
                // 重置输入，允许重复选择同一文件
                elements.importHtml.value = '';
            });
            
            // 导出HTML书签
            elements.exportHtml.addEventListener('click', exportHtmlBookmarks);
            
            // 导出JSON备份
            elements.exportJson.addEventListener('click', exportJsonBackup);
            
            // 导入JSON备份
            elements.importJson.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    importJsonBackup(file);
                }
                // 重置输入
                elements.importJson.value = '';
            });
            
            // 加载默认数据
            elements.loadDefaultData.addEventListener('click', () => {
                if (confirm('确定要加载默认数据吗？当前数据将被覆盖。')) {
                    loadDefaultBookmarks();
                    renderBookmarks();
                    renderEditBookmarks();
                    showNotification('已加载默认数据', 'info');
                }
            });
            
            // 保存更改
            elements.saveChanges.addEventListener(async () => {
                // 保存GitHub配置
                appData.githubConfig = {
                    username: elements.githubUsername.value,
                    repo: elements.githubRepo.value,
                    token: elements.githubToken.value
                };
                
                localStorage.setItem('githubConfig', JSON.stringify(appData.githubConfig));
                
                // 保存广告链接
                appData.ads.forEach(ad => {
                    const urlInput = document.getElementById(`ad${ad.id}-url`);
                    if (urlInput) {
                        ad.url = urlInput.value;
                    }
                });
                
                // 保存到GitHub
                await saveDataToGitHub();
            });
            
            // 时区管理
            elements.addTimezoneBtn.addEventListener('click', () => {
                elements.timezoneForm.reset();
                delete elements.timezoneForm.dataset.editId;
                elements.addTimezoneModal.classList.remove('hidden');
            });
            
            elements.addTimezone.addEventListener('click', () => {
                elements.timezoneForm.reset();
                delete elements.timezoneForm.dataset.editId;
                elements.addTimezoneModal.classList.remove('hidden');
            });
            
            elements.closeTimezoneModal.addEventListener('click', () => {
                elements.addTimezoneModal.classList.add('hidden');
            });
            
            elements.cancelTimezone.addEventListener('click', () => {
                elements.addTimezoneModal.classList.add('hidden');
            });
            
            elements.timezoneForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const city = document.getElementById('timezone-city').value;
                const offset = document.getElementById('timezone-offset').value;
                const format = document.getElementById('timezone-format').value;
                
                if (!city.trim()) {
                    showNotification('请输入城市名称', 'warning');
                    return;
                }
                
                // 检查是否是编辑模式
                const editId = elements.timezoneForm.dataset.editId;
                
                if (editId) {
                    updateTimezone(editId, { city, offset, format });
                } else {
                    addTimezone({ city, offset, format });
                }
                
                elements.addTimezoneModal.classList.add('hidden');
            });
            
            // 广告管理
            elements.ad1Upload.addEventListener('change', (e) => handleAdImageUpload(e, '1'));
            elements.ad2Upload.addEventListener('change', (e) => handleAdImageUpload(e, '2'));
            elements.ad3Upload.addEventListener('change', (e) => handleAdImageUpload(e, '3'));
            
            elements.removeAd1.addEventListener('click', () => removeAd('1'));
            elements.removeAd2.addEventListener('click', () => removeAd('2'));
            elements.removeAd3.addEventListener('click', () => removeAd('3'));
            
            elements.ad1Url.addEventListener('change', (e) => updateAdUrl('1', e.target.value));
            elements.ad2Url.addEventListener('change', (e) => updateAdUrl('2', e.target.value));
            elements.ad3Url.addEventListener('change', (e) => updateAdUrl('3', e.target.value));
        }

        // 导航栏滚动隐藏
        function startScrollTimer() {
            let scrollTimeout;
            const navbar = elements.navbar;
            
            window.addEventListener('scroll', () => {
                // 显示导航栏
                navbar.classList.remove('translate-y-[-100%]');
                navbar.classList.add('py-3');
                navbar.classList.remove('py-2');
                
                // 清除之前的超时
                clearTimeout(scrollTimeout);
                
                // 设置新的超时
                scrollTimeout = setTimeout(() => {
                    // 如果滚动位置大于100px，则隐藏导航栏
                    if (window.scrollY > 100) {
                        navbar.classList.add('translate-y-[-100%]');
                    }
                }, 3000);
            });
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
