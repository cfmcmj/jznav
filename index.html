<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 探索网络宇宙</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            black: '#0a0e17',
                            dark: '#12192c',
                            blue: '#1e3a8a',
                            purple: '#4c1d95',
                            pink: '#ec4899',
                            neon: '#3b82f6',
                            glow: '#60a5fa'
                        },
                        day: {
                            light: '#f8fafc',
                            blue: '#eff6ff',
                            text: '#334155'
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif']
                    },
                    animation: {
                        'twinkle': 'twinkle 3s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        twinkle: {
                            '0%, 100%': { opacity: 0.5 },
                            '50%': { opacity: 1 },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle var(--twinkle-duration, 3s) ease-in-out infinite;
            }
            .text-shadow {
                text-shadow: 0 0 8px rgba(96, 165, 250, 0.8);
            }
            .glow {
                box-shadow: 0 0 15px rgba(96, 165, 250, 0.5);
            }
            .glow-pink {
                box-shadow: 0 0 15px rgba(236, 72, 153, 0.5);
            }
            .planet {
                position: absolute;
                border-radius: 50%;
                filter: blur(0.5px);
            }
            .transition-theme {
                transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231e3a8a'/%3E%3Ccircle cx='50' cy='50' r='30' fill='%233b82f6'/%3E%3Ccircle cx='50' cy='50' r='15' fill='%2360a5fa'/%3E%3C/svg%3E" type="image/svg+xml">
</head>
<body class="bg-space-black text-white transition-theme font-space min-h-screen overflow-x-hidden relative" id="app-body">
    <!-- 星空背景 -->
    <div id="stars-container" class="fixed inset-0 -z-10"></div>
    
    <!-- 行星装饰 -->
    <div class="planet bg-space-purple/30 w-64 h-64 top-20 -left-32 blur-md animate-float" style="animation-delay: 0s;"></div>
    <div class="planet bg-space-blue/20 w-40 h-40 bottom-40 -right-20 blur-md animate-float" style="animation-delay: 2s;"></div>
    <div class="planet bg-space-pink/20 w-24 h-24 top-1/3 right-1/4 blur-md animate-float" style="animation-delay: 4s;"></div>

    <!-- 顶部导航栏 -->
    <header class="sticky top-0 z-50 backdrop-blur-lg bg-space-black/70 border-b border-space-neon/30 transition-theme">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-space-neon to-space-pink flex items-center justify-center glow">
                    <i class="fa fa-compass text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-shadow">星际导航</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <!-- 主题切换按钮 -->
                <button id="theme-toggle" class="relative p-2 rounded-full hover:bg-space-dark transition-all duration-300">
                    <i class="fa fa-moon-o text-space-glow"></i>
                    <span class="absolute invisible opacity-0 group-hover:visible group-hover:opacity-100 bg-space-dark p-2 rounded shadow-lg whitespace-nowrap -top-12 left-1/2 transform -translate-x-1/2 transition-all duration-300 w-max z-50 glow">
                        切换到白天模式
                    </span>
                </button>
                
                <!-- 编辑页入口 -->
                <button id="edit-btn" class="relative p-2 rounded-full hover:bg-space-dark transition-all duration-300">
                    <i class="fa fa-cog text-space-glow"></i>
                    <span class="absolute invisible opacity-0 hover:visible hover:opacity-100 bg-space-dark p-2 rounded shadow-lg whitespace-nowrap -top-12 left-1/2 transform -translate-x-1/2 transition-all duration-300 w-max z-50 glow">
                        编辑书签和设置
                    </span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 小组件区域 -->
        <section class="mb-10 grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- 在线时长统计 -->
            <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow card-hover">
                <h2 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-clock-o text-space-glow mr-2"></i>在线时长统计
                </h2>
                <div class="h-40">
                    <canvas id="usageChart"></canvas>
                </div>
                <div class="mt-3 text-sm text-gray-300">
                    本周总时长: <span id="total-usage" class="text-space-glow">0小时</span>
                </div>
            </div>
            
            <!-- 健康提醒 -->
            <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow card-hover">
                <h2 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-heartbeat text-space-glow mr-2"></i>健康提醒
                </h2>
                <div id="health-reminders" class="space-y-3">
                    <div class="p-3 bg-space-blue/20 rounded-lg border border-space-neon/30">
                        <div class="font-medium">休息提醒</div>
                        <div class="text-sm text-gray-300">每50分钟休息10分钟</div>
                    </div>
                    <div class="p-3 bg-space-purple/20 rounded-lg border border-space-pink/30">
                        <div class="font-medium">用眼健康</div>
                        <div class="text-sm text-gray-300">保持60cm以上观看距离</div>
                    </div>
                    <div class="p-3 bg-space-pink/20 rounded-lg border border-space-pink/30">
                        <div class="font-medium">活动提醒</div>
                        <div class="text-sm text-gray-300">每小时起身活动5分钟</div>
                    </div>
                </div>
            </div>
            
            <!-- 世界时间 -->
            <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow card-hover">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-globe text-space-glow mr-2"></i>世界时间
                    </h2>
                    <button id="add-timezone" class="text-space-glow hover:text-space-pink transition-colors">
                        <i class="fa fa-plus-circle"></i>
                    </button>
                </div>
                <div id="timezones" class="space-y-3 max-h-40 overflow-y-auto pr-2">
                    <!-- 时区将通过JS动态添加 -->
                </div>
            </div>
        </section>
        
        <!-- 广告位 1 -->
        <section class="mb-10 rounded-xl overflow-hidden border border-space-neon/30 glow">
            <div id="ad-1" class="w-full h-40 md:h-56 bg-space-blue/20 flex items-center justify-center">
                <div class="text-center p-4">
                    <div class="text-space-glow mb-2">广告位 1</div>
                    <div class="text-sm text-gray-400">可在编辑页面自定义</div>
                </div>
            </div>
        </section>
        
        <!-- 书签分类区域 -->
        <section id="bookmarks-container" class="mb-10">
            <!-- 书签将通过JS动态添加 -->
        </section>
        
        <!-- 广告位 2 -->
        <section class="mb-10 rounded-xl overflow-hidden border border-space-neon/30 glow">
            <div id="ad-2" class="w-full h-40 md:h-56 bg-space-purple/20 flex items-center justify-center">
                <div class="text-center p-4">
                    <div class="text-space-glow mb-2">广告位 2</div>
                    <div class="text-sm text-gray-400">可在编辑页面自定义</div>
                </div>
            </div>
        </section>
        
        <!-- 广告位 3 -->
        <section class="mb-10 rounded-xl overflow-hidden border border-space-neon/30 glow">
            <div id="ad-3" class="w-full h-40 md:h-56 bg-space-pink/20 flex items-center justify-center">
                <div class="text-center p-4">
                    <div class="text-space-glow mb-2">广告位 3</div>
                    <div class="text-sm text-gray-400">可在编辑页面自定义</div>
                </div>
            </div>
        </section>
    </main>

    <!-- 编辑页面 (默认隐藏) -->
    <div id="edit-page" class="fixed inset-0 z-50 bg-space-black/95 backdrop-blur-md transform translate-x-full transition-transform duration-500 ease-in-out">
        <div class="h-full overflow-y-auto p-6">
            <div class="container mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-shadow">书签编辑中心</h2>
                    <button id="close-edit" class="p-2 rounded-full hover:bg-space-dark transition-all duration-300">
                        <i class="fa fa-times text-space-glow text-xl"></i>
                    </button>
                </div>
                
                <!-- GitHub 配置 -->
                <div class="mb-8 bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-github text-space-glow mr-2"></i>GitHub 配置
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm mb-1">用户名 (Username)</label>
                            <input type="text" id="github-username" placeholder="your username" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                        </div>
                        <div>
                            <label class="block text-sm mb-1">仓库名 (Repository)</label>
                            <input type="text" id="github-repo" placeholder="your repo" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                        </div>
                        <div>
                            <label class="block text-sm mb-1">访问令牌 (Token)</label>
                            <input type="password" id="github-token" placeholder="your token (可选)" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                        </div>
                    </div>
                    <div class="mt-4">
                        <button id="save-github-config" class="bg-space-neon hover:bg-space-glow text-white px-4 py-2 rounded transition-colors">
                            保存配置
                        </button>
                        <span id="github-config-status" class="ml-3 text-sm"></span>
                    </div>
                </div>
                
                <!-- 书签管理 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold flex items-center">
                            <i class="fa fa-bookmark text-space-glow mr-2"></i>书签管理
                            <span id="bookmark-count" class="ml-2 text-sm bg-space-neon/20 px-2 py-0.5 rounded">0 个书签</span>
                        </h3>
                        <div class="flex space-x-2">
                            <button id="import-bookmarks" class="bg-space-blue hover:bg-space-blue/80 text-white px-3 py-1.5 rounded text-sm transition-colors">
                                <i class="fa fa-upload mr-1"></i>导入书签
                            </button>
                            <button id="export-bookmarks" class="bg-space-purple hover:bg-space-purple/80 text-white px-3 py-1.5 rounded text-sm transition-colors">
                                <i class="fa fa-download mr-1"></i>导出书签
                            </button>
                            <button id="add-bookmark" class="bg-space-pink hover:bg-space-pink/80 text-white px-3 py-1.5 rounded text-sm transition-colors">
                                <i class="fa fa-plus mr-1"></i>添加书签
                            </button>
                        </div>
                    </div>
                    
                    <div id="bookmarks-edit-container" class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow">
                        <!-- 编辑模式下的书签将通过JS动态添加 -->
                        <div id="no-bookmarks-message" class="text-center py-10 text-gray-400">
                            暂无书签数据，点击"导入书签"添加
                        </div>
                    </div>
                </div>
                
                <!-- 备份与恢复 -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-database text-space-glow mr-2"></i>备份与恢复
                    </h3>
                    <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow flex flex-wrap gap-4">
                        <button id="backup-data" class="bg-space-blue hover:bg-space-blue/80 text-white px-4 py-2 rounded transition-colors flex items-center">
                            <i class="fa fa-save mr-2"></i>创建JSON备份
                        </button>
                        <button id="restore-data" class="bg-space-purple hover:bg-space-purple/80 text-white px-4 py-2 rounded transition-colors flex items-center">
                            <i class="fa fa-refresh mr-2"></i>从JSON恢复
                        </button>
                        <input type="file" id="restore-file" accept=".json" class="hidden">
                        <button id="save-changes" class="bg-space-pink hover:bg-space-pink/80 text-white px-4 py-2 rounded transition-colors flex items-center ml-auto">
                            <i class="fa fa-paper-plane mr-2"></i>保存更改到GitHub
                        </button>
                        <span id="save-status" class="ml-3 text-sm"></span>
                    </div>
                </div>
                
                <!-- 广告管理 -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-bullhorn text-space-glow mr-2"></i>广告管理
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 广告1设置 -->
                        <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow">
                            <h4 class="font-medium mb-3">广告位 1</h4>
                            <div class="mb-3">
                                <label class="block text-sm mb-1">广告图片 (最大3M)</label>
                                <input type="file" id="ad1-image" accept="image/*" class="w-full text-sm text-gray-300">
                            </div>
                            <div class="mb-3">
                                <label class="block text-sm mb-1">链接地址</label>
                                <input type="url" id="ad1-url" placeholder="https://example.com" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-space-glow transition-colors">
                            </div>
                            <button data-ad="1" class="delete-ad bg-red-500/20 hover:bg-red-500/30 text-red-400 px-3 py-1 rounded text-sm transition-colors">
                                <i class="fa fa-trash mr-1"></i>删除广告
                            </button>
                        </div>
                        
                        <!-- 广告2设置 -->
                        <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow">
                            <h4 class="font-medium mb-3">广告位 2</h4>
                            <div class="mb-3">
                                <label class="block text-sm mb-1">广告图片 (最大3M)</label>
                                <input type="file" id="ad2-image" accept="image/*" class="w-full text-sm text-gray-300">
                            </div>
                            <div class="mb-3">
                                <label class="block text-sm mb-1">链接地址</label>
                                <input type="url" id="ad2-url" placeholder="https://example.com" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-space-glow transition-colors">
                            </div>
                            <button data-ad="2" class="delete-ad bg-red-500/20 hover:bg-red-500/30 text-red-400 px-3 py-1 rounded text-sm transition-colors">
                                <i class="fa fa-trash mr-1"></i>删除广告
                            </button>
                        </div>
                        
                        <!-- 广告3设置 -->
                        <div class="bg-space-dark/50 backdrop-blur-sm rounded-xl p-5 border border-space-neon/20 glow">
                            <h4 class="font-medium mb-3">广告位 3</h4>
                            <div class="mb-3">
                                <label class="block text-sm mb-1">广告图片 (最大3M)</label>
                                <input type="file" id="ad3-image" accept="image/*" class="w-full text-sm text-gray-300">
                            </div>
                            <div class="mb-3">
                                <label class="block text-sm mb-1">链接地址</label>
                                <input type="url" id="ad3-url" placeholder="https://example.com" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-space-glow transition-colors">
                            </div>
                            <button data-ad="3" class="delete-ad bg-red-500/20 hover:bg-red-500/30 text-red-400 px-3 py-1 rounded text-sm transition-colors">
                                <i class="fa fa-trash mr-1"></i>删除广告
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑书签模态框 (默认隐藏) -->
    <div id="bookmark-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-space-dark border border-space-neon/30 rounded-xl p-6 w-full max-w-md transform scale-95 transition-transform duration-300">
            <h3 id="modal-title" class="text-xl font-semibold mb-4">添加新书签</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm mb-1">书签名称</label>
                    <input type="text" id="bookmark-name" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                </div>
                
                <div>
                    <label class="block text-sm mb-1">网址 (URL)</label>
                    <input type="url" id="bookmark-url" placeholder="https://" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                </div>
                
                <div>
                    <label class="block text-sm mb-1">分组</label>
                    <select id="bookmark-folder" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                        <option value="默认分组">默认分组</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm mb-1">新分组名称 (可选)</label>
                    <input type="text" id="new-folder-name" placeholder="创建新分组" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-bookmark" class="px-4 py-2 border border-gray-600 rounded hover:bg-gray-800 transition-colors">
                    取消
                </button>
                <button id="save-bookmark" class="px-4 py-2 bg-space-pink hover:bg-space-pink/80 text-white rounded transition-colors">
                    保存
                </button>
            </div>
            
            <input type="hidden" id="bookmark-id">
        </div>
    </div>

    <!-- 确认删除模态框 (默认隐藏) -->
    <div id="confirm-delete-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-space-dark border border-space-neon/30 rounded-xl p-6 w-full max-w-md transform scale-95 transition-transform duration-300">
            <h3 class="text-xl font-semibold mb-2">确认删除</h3>
            <p class="text-gray-300 mb-6" id="delete-message">你确定要删除这个项目吗？此操作无法撤销。</p>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="px-4 py-2 border border-gray-600 rounded hover:bg-gray-800 transition-colors">
                    取消
                </button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors">
                    确认删除
                </button>
            </div>
            
            <input type="hidden" id="delete-type">
            <input type="hidden" id="delete-id">
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-6 right-6 bg-space-dark border border-space-neon/30 rounded-lg p-4 max-w-sm transform translate-y-20 opacity-0 transition-all duration-300 z-50 glow">
        <div class="flex items-start">
            <div id="notification-icon" class="mr-3 text-xl">
                <i class="fa fa-info-circle text-space-glow"></i>
            </div>
            <div>
                <h4 id="notification-title" class="font-medium"></h4>
                <p id="notification-message" class="text-sm text-gray-300 mt-1"></p>
            </div>
        </div>
    </div>

    <!-- 添加时区模态框 -->
    <div id="timezone-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-space-dark border border-space-neon/30 rounded-xl p-6 w-full max-w-md transform scale-95 transition-transform duration-300">
            <h3 class="text-xl font-semibold mb-4">添加时区</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm mb-1">城市名称</label>
                    <input type="text" id="timezone-city" placeholder="例如：北京" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                </div>
                
                <div>
                    <label class="block text-sm mb-1">时区偏移 (小时)</label>
                    <input type="number" id="timezone-offset" step="1" min="-12" max="14" value="8" class="w-full bg-space-black/70 border border-space-neon/30 rounded px-3 py-2 text-white focus:outline-none focus:border-space-glow transition-colors">
                </div>
            </div>
            
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-timezone" class="px-4 py-2 border border-gray-600 rounded hover:bg-gray-800 transition-colors">
                    取消
                </button>
                <button id="save-timezone" class="px-4 py-2 bg-space-pink hover:bg-space-pink/80 text-white rounded transition-colors">
                    保存
                </button>
            </div>
        </div>
    </div>

    <!-- 导入书签文件输入 (隐藏) -->
    <input type="file" id="import-file" accept=".html" class="hidden">

    <!-- 底部版权信息 -->
    <footer class="border-t border-space-neon/30 py-6 transition-theme">
        <div class="container mx-auto px-4">
            <div class="dark-white text-center space-y-2">
                <div id="total-websites">共收录 0 个网站</div>
                <div id="copyright">Copyright © 2018-<span id="current-year"></span> 星际导航, All Rights Reserved</div>
            </div>
        </div>
    </footer>

    <script>
        // 全局数据存储
        const appData = {
            bookmarks: {},
            ads: {
                1: { image: '', url: '' },
                2: { image: '', url: '' },
                3: { image: '', url: '' }
            },
            timezones: [
                { city: '北京', offset: 8 },
                { city: '伦敦', offset: 0 },
                { city: '纽约', offset: -4 }
            ],
            githubConfig: {
                username: '',
                repo: '',
                token: ''
            },
            usageData: {
                labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                data: [1.5, 2.3, 0.8, 3.1, 2.7, 4.2, 3.5]
            }
        };

        // DOM 元素
        const elements = {
            body: document.getElementById('app-body'),
            themeToggle: document.getElementById('theme-toggle'),
            editBtn: document.getElementById('edit-btn'),
            editPage: document.getElementById('edit-page'),
            closeEdit: document.getElementById('close-edit'),
            bookmarksContainer: document.getElementById('bookmarks-container'),
            bookmarksEditContainer: document.getElementById('bookmarks-edit-container'),
            noBookmarksMessage: document.getElementById('no-bookmarks-message'),
            bookmarkCount: document.getElementById('bookmark-count'),
            importBookmarks: document.getElementById('import-bookmarks'),
            exportBookmarks: document.getElementById('export-bookmarks'),
            addBookmark: document.getElementById('add-bookmark'),
            bookmarkModal: document.getElementById('bookmark-modal'),
            modalTitle: document.getElementById('modal-title'),
            bookmarkName: document.getElementById('bookmark-name'),
            bookmarkUrl: document.getElementById('bookmark-url'),
            bookmarkFolder: document.getElementById('bookmark-folder'),
            newFolderName: document.getElementById('new-folder-name'),
            cancelBookmark: document.getElementById('cancel-bookmark'),
            saveBookmark: document.getElementById('save-bookmark'),
            bookmarkId: document.getElementById('bookmark-id'),
            confirmDeleteModal: document.getElementById('confirm-delete-modal'),
            deleteMessage: document.getElementById('delete-message'),
            cancelDelete: document.getElementById('cancel-delete'),
            confirmDelete: document.getElementById('confirm-delete'),
            deleteType: document.getElementById('delete-type'),
            deleteId: document.getElementById('delete-id'),
            notification: document.getElementById('notification'),
            notificationTitle: document.getElementById('notification-title'),
            notificationMessage: document.getElementById('notification-message'),
            notificationIcon: document.getElementById('notification-icon'),
            backupData: document.getElementById('backup-data'),
            restoreData: document.getElementById('restore-data'),
            restoreFile: document.getElementById('restore-file'),
            saveChanges: document.getElementById('save-changes'),
            saveStatus: document.getElementById('save-status'),
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            saveGithubConfig: document.getElementById('save-github-config'),
            githubConfigStatus: document.getElementById('github-config-status'),
            importFile: document.getElementById('import-file'),
            totalWebsites: document.getElementById('total-websites'),
            currentYear: document.getElementById('current-year'),
            addTimezone: document.getElementById('add-timezone'),
            timezoneModal: document.getElementById('timezone-modal'),
            timezoneCity: document.getElementById('timezone-city'),
            timezoneOffset: document.getElementById('timezone-offset'),
            cancelTimezone: document.getElementById('cancel-timezone'),
            saveTimezone: document.getElementById('save-timezone'),
            timezonesContainer: document.getElementById('timezones'),
            totalUsage: document.getElementById('total-usage')
        };

        // 初始化
        async function init() {
            createStars();
            initUsageChart();
            loadGithubConfig();
            await loadDataFromGitHub();
            renderTimezones();
            renderBookmarks();
            renderAds();
            updateBookmarkCount();
            updateTotalWebsites();
            elements.currentYear.textContent = new Date().getFullYear();
            setupEventListeners();
        }

        // 创建星空背景
        function createStars() {
            const container = document.getElementById('stars-container');
            const count = 150;
            
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                const size = Math.random() * 2;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                const duration = 2 + Math.random() * 5;
                star.style.setProperty('--twinkle-duration', `${duration}s`);
                
                const delay = Math.random() * 5;
                star.style.animationDelay = `${delay}s`;
                
                container.appendChild(star);
            }
        }

        // 初始化使用时长图表
        function initUsageChart() {
            const ctx = document.getElementById('usageChart').getContext('2d');
            
            const total = appData.usageData.data.reduce((sum, val) => sum + val, 0).toFixed(1);
            elements.totalUsage.textContent = `${total}小时`;
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: appData.usageData.labels,
                    datasets: [{
                        label: '小时',
                        data: appData.usageData.data,
                        backgroundColor: 'rgba(96, 165, 250, 0.6)',
                        borderColor: 'rgba(96, 165, 250, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            let username, repo, token;
            
            if (appData.githubConfig.username && appData.githubConfig.repo) {
                username = appData.githubConfig.username;
                repo = appData.githubConfig.repo;
                token = appData.githubConfig.token;
            } else {
                username = 'jiezione';
                repo = 'jznav';
                token = '';
            }
            
            try {
                let url, options = {};
                
                if (token) {
                    url = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                    options = {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    };
                } else {
                    url = `https://raw.githubusercontent.com/${username}/${repo}/main/bookmarks.json`;
                }
                
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                let data;
                if (token) {
                    const githubData = await response.json();
                    const content = atob(githubData.content.replace(/\n/g, ''));
                    data = JSON.parse(content);
                } else {
                    data = await response.json();
                }
                
                if (data.bookmarks) appData.bookmarks = data.bookmarks;
                if (data.ads) appData.ads = data.ads;
                if (data.timezones) appData.timezones = data.timezones;
                
                showNotification('成功', '已从GitHub加载数据', 'success');
                return true;
            } catch (error) {
                console.error('加载GitHub数据失败:', error);
                showNotification('警告', '使用本地默认数据，无法连接到GitHub', 'warning');
                return false;
            }
        }

        // 保存数据到GitHub
        async function saveDataToGitHub() {
            elements.saveStatus.textContent = '正在保存...';
            elements.saveStatus.className = 'ml-3 text-sm text-yellow-400';
            
            const dataToSave = {
                bookmarks: appData.bookmarks,
                ads: appData.ads,
                timezones: appData.timezones
            };
            
            let username, repo, token;
            
            if (appData.githubConfig.username && appData.githubConfig.repo) {
                username = appData.githubConfig.username;
                repo = appData.githubConfig.repo;
                token = appData.githubConfig.token;
            } else {
                username = 'jiezione';
                repo = 'jznav';
                token = '';
            }
            
            try {
                if (!token) {
                    throw new Error('需要GitHub令牌才能保存更改');
                }
                
                const url = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                const content = JSON.stringify(dataToSave, null, 2);
                
                let sha;
                try {
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const existingData = await response.json();
                        sha = existingData.sha;
                    }
                } catch (error) {
                    console.log('文件可能不存在，将创建新文件');
                }
                
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: '更新书签数据',
                        content: base64Content,
                        sha: sha
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`保存失败: ${response.statusText}`);
                }
                
                elements.saveStatus.textContent = '保存成功!';
                elements.saveStatus.className = 'ml-3 text-sm text-green-400';
                showNotification('成功', '数据已保存到GitHub', 'success');
                return true;
            } catch (error) {
                console.error('保存数据到GitHub失败:', error);
                elements.saveStatus.textContent = `保存失败: ${error.message}`;
                elements.saveStatus.className = 'ml-3 text-sm text-red-400';
                showNotification('错误', `无法保存到GitHub: ${error.message}`, 'error');
                return false;
            }
        }

        // 加载GitHub配置
        function loadGithubConfig() {
            const savedConfig = localStorage.getItem('githubConfig');
            if (savedConfig) {
                try {
                    appData.githubConfig = JSON.parse(savedConfig);
                    elements.githubUsername.value = appData.githubConfig.username || '';
                    elements.githubRepo.value = appData.githubConfig.repo || '';
                    elements.githubToken.value = appData.githubConfig.token || '';
                } catch (error) {
                    console.error('加载GitHub配置失败:', error);
                }
            }
        }

        // 保存GitHub配置
        function saveGithubConfig() {
            appData.githubConfig = {
                username: elements.githubUsername.value.trim(),
                repo: elements.githubRepo.value.trim(),
                token: elements.githubToken.value.trim()
            };
            
            localStorage.setItem('githubConfig', JSON.stringify(appData.githubConfig));
            
            elements.githubConfigStatus.textContent = '配置已保存';
            elements.githubConfigStatus.className = 'ml-3 text-sm text-green-400';
            
            setTimeout(() => {
                elements.githubConfigStatus.textContent = '';
            }, 3000);
        }

        // 渲染书签
        function renderBookmarks() {
            elements.bookmarksContainer.innerHTML = '';
            elements.bookmarksEditContainer.innerHTML = '';
            
            const hasBookmarks = Object.keys(appData.bookmarks).length > 0;
            elements.noBookmarksMessage.style.display = hasBookmarks ? 'none' : 'block';
            
            Object.keys(appData.bookmarks).forEach(folder => {
                const bookmarks = appData.bookmarks[folder];
                
                // 主页渲染
                const folderSection = document.createElement('div');
                folderSection.className = 'mb-8';
                
                const folderHeader = document.createElement('h2');
                folderHeader.className = 'text-xl font-semibold mb-4 text-space-glow border-b border-space-neon/30 pb-2';
                folderHeader.textContent = folder;
                folderSection.appendChild(folderHeader);
                
                const bookmarksGrid = document.createElement('div');
                bookmarksGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4';
                
                bookmarks.forEach(bookmark => {
                    const bookmarkCard = createBookmarkCard(bookmark, false);
                    bookmarksGrid.appendChild(bookmarkCard);
                });
                
                folderSection.appendChild(bookmarksGrid);
                elements.bookmarksContainer.appendChild(folderSection);
                
                // 编辑页渲染
                const editFolderDiv = document.createElement('div');
                editFolderDiv.className = 'mb-6';
                
                const editFolderHeader = document.createElement('div');
                editFolderHeader.className = 'flex justify-between items-center mb-3';
                
                const editFolderTitle = document.createElement('h4');
                editFolderTitle.className = 'font-semibold text-space-glow';
                editFolderTitle.textContent = folder;
                editFolderHeader.appendChild(editFolderTitle);
                
                const deleteFolderBtn = document.createElement('button');
                deleteFolderBtn.className = 'text-red-400 hover:text-red-300 text-sm';
                deleteFolderBtn.innerHTML = '<i class="fa fa-trash mr-1"></i>删除分组';
                deleteFolderBtn.addEventListener('click', () => confirmDelete('folder', folder, `确定要删除分组"${folder}"及其所有书签吗？`));
                editFolderHeader.appendChild(deleteFolderBtn);
                
                editFolderDiv.appendChild(editFolderHeader);
                
                const editBookmarksList = document.createElement('div');
                editBookmarksList.className = 'grid grid-cols-1 md:grid-cols-2 gap-3 pl-2 border-l border-space-neon/20';
                
                bookmarks.forEach(bookmark => {
                    const editBookmarkCard = createBookmarkCard(bookmark, true);
                    editBookmarksList.appendChild(editBookmarkCard);
                });
                
                editFolderDiv.appendChild(editBookmarksList);
                elements.bookmarksEditContainer.appendChild(editFolderDiv);
            });
            
            // 更新文件夹下拉选项
            updateFolderOptions();
        }

        // 创建书签卡片
        function createBookmarkCard(bookmark, isEditMode) {
            const card = document.createElement('div');
            
            if (!isEditMode) {
                card.className = 'bg-space-dark/60 backdrop-blur-sm rounded-lg p-3 border border-space-neon/20 hover:border-space-glow transition-all duration-300 card-hover flex flex-col items-center text-center';
                
                const link = document.createElement('a');
                link.href = bookmark.url;
                link.target = '_blank';
                link.className = 'w-full';
                
                const faviconContainer = document.createElement('div');
                faviconContainer.className = 'w-10 h-10 rounded-full bg-space-blue/30 flex items-center justify-center mb-2 mx-auto';
                
                const favicon = document.createElement('img');
                const urlObj = new URL(bookmark.url);
                favicon.src = `https://${urlObj.hostname}/favicon.ico`;
                favicon.alt = `${bookmark.name}的图标`;
                favicon.className = 'w-6 h-6 object-contain';
                favicon.onerror = () => {
                    favicon.src = 'https://picsum.photos/24/24?random=' + Math.random();
                };
                
                faviconContainer.appendChild(favicon);
                link.appendChild(faviconContainer);
                
                const name = document.createElement('div');
                name.className = 'text-sm truncate';
                name.textContent = bookmark.name;
                link.appendChild(name);
                
                card.appendChild(link);
            } else {
                card.className = 'bg-space-black/40 rounded-lg p-3 border border-space-neon/20 flex justify-between items-center';
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'flex items-center';
                
                const favicon = document.createElement('img');
                const urlObj = new URL(bookmark.url);
                favicon.src = `https://${urlObj.hostname}/favicon.ico`;
                favicon.alt = `${bookmark.name}的图标`;
                favicon.className = 'w-6 h-6 mr-3 rounded';
                favicon.onerror = () => {
                    favicon.src = 'https://picsum.photos/24/24?random=' + Math.random();
                };
                
                infoDiv.appendChild(favicon);
                
                const detailsDiv = document.createElement('div');
                
                const name = document.createElement('div');
                name.className = 'font-medium';
                name.textContent = bookmark.name;
                detailsDiv.appendChild(name);
                
                const url = document.createElement('div');
                url.className = 'text-xs text-gray-400 truncate max-w-[200px]';
                url.textContent = bookmark.url;
                detailsDiv.appendChild(url);
                
                infoDiv.appendChild(detailsDiv);
                card.appendChild(infoDiv);
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'flex space-x-2';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'text-space-glow hover:text-space-pink';
                editBtn.innerHTML = '<i class="fa fa-pencil"></i>';
                editBtn.title = '编辑';
                editBtn.addEventListener('click', () => editBookmark(bookmark.id));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-red-400 hover:text-red-300';
                deleteBtn.innerHTML = '<i class="fa fa-trash"></i>';
                deleteBtn.title = '删除';
                deleteBtn.addEventListener('click', () => confirmDelete('bookmark', bookmark.id, `确定要删除书签"${bookmark.name}"吗？`));
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                card.appendChild(actionsDiv);
            }
            
            return card;
        }

        // 更新文件夹选项
        function updateFolderOptions() {
            elements.bookmarkFolder.innerHTML = '';
            
            Object.keys(appData.bookmarks).forEach(folder => {
                const option = document.createElement('option');
                option.value = folder;
                option.textContent = folder;
                elements.bookmarkFolder.appendChild(option);
            });
        }

        // 渲染广告
        function renderAds() {
            for (let i = 1; i <= 3; i++) {
                const adElement = document.getElementById(`ad-${i}`);
                const adData = appData.ads[i];
                
                if (adData.image && adData.url) {
                    adElement.innerHTML = `<a href="${adData.url}" target="_blank"><img src="${adData.image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
                    document.getElementById(`ad${i}-url`).value = adData.url;
                } else {
                    adElement.innerHTML = `
                        <div class="text-center p-4">
                            <div class="text-space-glow mb-2">广告位 ${i}</div>
                            <div class="text-sm text-gray-400">可在编辑页面自定义</div>
                        </div>
                    `;
                    document.getElementById(`ad${i}-url`).value = '';
                }
            }
        }

        // 更新书签计数
        function updateBookmarkCount() {
            let count = 0;
            Object.values(appData.bookmarks).forEach(bookmarks => {
                count += bookmarks.length;
            });
            elements.bookmarkCount.textContent = `${count} 个书签`;
            elements.totalWebsites.textContent = `共收录 ${count} 个网站`;
        }

        // 更新总网站数
        function updateTotalWebsites() {
            let count = 0;
            Object.values(appData.bookmarks).forEach(bookmarks => {
                count += bookmarks.length;
            });
            elements.totalWebsites.textContent = `共收录 ${count} 个网站`;
        }

        // 渲染时区
        function renderTimezones() {
            elements.timezonesContainer.innerHTML = '';
            
            appData.timezones.forEach((timezone, index) => {
                const timezoneDiv = document.createElement('div');
                timezoneDiv.className = 'bg-space-black/40 rounded-lg p-3 border border-space-neon/20 flex justify-between items-center';
                
                const infoDiv = document.createElement('div');
                
                const city = document.createElement('div');
                city.className = 'font-medium';
                city.textContent = timezone.city;
                infoDiv.appendChild(city);
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'text-sm text-gray-300';
                timeDiv.id = `time-${index}`;
                infoDiv.appendChild(timeDiv);
                
                timezoneDiv.appendChild(infoDiv);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-red-400 hover:text-red-300 p-1';
                deleteBtn.innerHTML = '<i class="fa fa-times"></i>';
                deleteBtn.title = '删除时区';
                deleteBtn.addEventListener('click', () => confirmDelete('timezone', index, `确定要删除时区"${timezone.city}"吗？`));
                
                timezoneDiv.appendChild(deleteBtn);
                elements.timezonesContainer.appendChild(timezoneDiv);
                
                updateTimeForTimezone(index, timezone.offset);
            });
            
            // 设置定时器更新时间
            clearInterval(window.timezoneInterval);
            window.timezoneInterval = setInterval(() => {
                appData.timezones.forEach((timezone, index) => {
                    updateTimeForTimezone(index, timezone.offset);
                });
            }, 1000);
        }

        // 更新特定时区的时间
        function updateTimeForTimezone(index, offset) {
            const timeElement = document.getElementById(`time-${index}`);
            if (!timeElement) return;
            
            const now = new Date();
            const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
            const timezoneTime = new Date(utcTime + offset * 3600000);
            
            timeElement.textContent = timezoneTime.toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
        }

        // 显示通知
        function showNotification(title, message, type = 'info') {
            elements.notificationTitle.textContent = title;
            elements.notificationMessage.textContent = message;
            
            let icon, colorClass;
            switch (type) {
                case 'success':
                    icon = 'fa-check-circle';
                    colorClass = 'text-green-400';
                    break;
                case 'error':
                    icon = 'fa-exclamation-circle';
                    colorClass = 'text-red-400';
                    break;
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    colorClass = 'text-yellow-400';
                    break;
                default:
                    icon = 'fa-info-circle';
                    colorClass = 'text-space-glow';
            }
            
            elements.notificationIcon.innerHTML = `<i class="fa ${icon} ${colorClass}"></i>`;
            
            elements.notification.classList.remove('translate-y-20', 'opacity-0');
            elements.notification.classList.add('translate-y-0', 'opacity-100');
            
            setTimeout(() => {
                elements.notification.classList.remove('translate-y-0', 'opacity-100');
                elements.notification.classList.add('translate-y-20', 'opacity-0');
            }, 5000);
        }

        // 打开添加书签模态框
        function openAddBookmarkModal() {
            elements.modalTitle.textContent = '添加新书签';
            elements.bookmarkName.value = '';
            elements.bookmarkUrl.value = '';
            elements.newFolderName.value = '';
            elements.bookmarkId.value = '';
            
            openModal(elements.bookmarkModal);
        }

        // 打开编辑书签模态框
        function editBookmark(id) {
            let foundBookmark = null;
            let foundFolder = null;
            
            Object.keys(appData.bookmarks).some(folder => {
                return appData.bookmarks[folder].some(bookmark => {
                    if (bookmark.id === id) {
                        foundBookmark = bookmark;
                        foundFolder = folder;
                        return true;
                    }
                    return false;
                });
            });
            
            if (foundBookmark && foundFolder) {
                elements.modalTitle.textContent = '编辑书签';
                elements.bookmarkName.value = foundBookmark.name;
                elements.bookmarkUrl.value = foundBookmark.url;
                elements.bookmarkFolder.value = foundFolder;
                elements.newFolderName.value = '';
                elements.bookmarkId.value = foundBookmark.id;
                
                openModal(elements.bookmarkModal);
            }
        }

        // 保存书签
        function saveBookmark() {
            const name = elements.bookmarkName.value.trim();
            let url = elements.bookmarkUrl.value.trim();
            let folder = elements.bookmarkFolder.value;
            const newFolderName = elements.newFolderName.value.trim();
            const id = elements.bookmarkId.value;
            
            if (!name || !url) {
                showNotification('错误', '名称和网址不能为空', 'error');
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            
            if (newFolderName) {
                folder = newFolderName;
            }
            
            if (!appData.bookmarks[folder]) {
                appData.bookmarks[folder] = [];
            }
            
            if (id) {
                // 更新现有书签
                Object.keys(appData.bookmarks).forEach(existingFolder => {
                    const index = appData.bookmarks[existingFolder].findIndex(b => b.id === id);
                    if (index !== -1) {
                        // 如果文件夹变了，先删除再添加
                        if (existingFolder !== folder) {
                            appData.bookmarks[existingFolder].splice(index, 1);
                            if (appData.bookmarks[existingFolder].length === 0) {
                                delete appData.bookmarks[existingFolder];
                            }
                            
                            appData.bookmarks[folder].push({
                                id,
                                name,
                                url
                            });
                        } else {
                            // 只更新内容
                            appData.bookmarks[existingFolder][index] = {
                                ...appData.bookmarks[existingFolder][index],
                                name,
                                url
                            };
                        }
                    }
                });
                showNotification('成功', '书签已更新', 'success');
            } else {
                // 添加新书签
                const newId = 'bm_' + Date.now();
                
                // 检查是否已存在相同URL的书签（去重）
                const isDuplicate = Object.values(appData.bookmarks).some(bookmarks => 
                    bookmarks.some(b => b.url === url)
                );
                
                if (isDuplicate) {
                    showNotification('警告', '已存在相同网址的书签', 'warning');
                    return;
                }
                
                appData.bookmarks[folder].push({
                    id: newId,
                    name,
                    url
                });
                showNotification('成功', '已添加新书签', 'success');
            }
            
            renderBookmarks();
            updateBookmarkCount();
            closeModal(elements.bookmarkModal);
        }

        // 确认删除
        function confirmDelete(type, id, message) {
            elements.deleteType.value = type;
            elements.deleteId.value = id;
            elements.deleteMessage.textContent = message;
            
            openModal(elements.confirmDeleteModal);
        }

        // 执行删除
        function performDelete() {
            const type = elements.deleteType.value;
            const id = elements.deleteId.value;
            
            if (type === 'bookmark') {
                Object.keys(appData.bookmarks).forEach(folder => {
                    const index = appData.bookmarks[folder].findIndex(b => b.id === id);
                    if (index !== -1) {
                        const bookmarkName = appData.bookmarks[folder][index].name;
                        appData.bookmarks[folder].splice(index, 1);
                        
                        if (appData.bookmarks[folder].length === 0) {
                            delete appData.bookmarks[folder];
                        }
                        
                        showNotification('成功', `书签"${bookmarkName}"已删除`, 'success');
                    }
                });
            } else if (type === 'folder') {
                const folderName = id;
                delete appData.bookmarks[folderName];
                showNotification('成功', `分组"${folderName}"已删除`, 'success');
            } else if (type === 'timezone') {
                const index = parseInt(id);
                const timezoneName = appData.timezones[index].city;
                appData.timezones.splice(index, 1);
                renderTimezones();
                showNotification('成功', `时区"${timezoneName}"已删除`, 'success');
            } else if (type === 'ad') {
                const adId = id;
                appData.ads[adId] = { image: '', url: '' };
                renderAds();
                document.getElementById(`ad${adId}-url`).value = '';
                showNotification('成功', `广告位 ${adId} 已重置`, 'success');
            }
            
            renderBookmarks();
            updateBookmarkCount();
            closeModal(elements.confirmDeleteModal);
        }

        // 导入书签
        function importBookmarks() {
            elements.importFile.click();
        }

        // 处理导入的书签文件
        function handleImportedFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(e.target.result, 'text/html');
                    const bookmarkNodes = doc.querySelectorAll('a');
                    
                    if (bookmarkNodes.length === 0) {
                        showNotification('错误', '未找到有效的书签数据', 'error');
                        return;
                    }
                    
                    let importedCount = 0;
                    let duplicateCount = 0;
                    
                    bookmarkNodes.forEach(node => {
                        const name = node.textContent.trim() || '未命名书签';
                        let url = node.getAttribute('href') || '';
                        
                        if (!url) return;
                        
                        if (!url.startsWith('http://') && !url.startsWith('https://')) {
                            url = 'https://' + url;
                        }
                        
                        // 检查是否已存在相同URL的书签（去重）
                        const isDuplicate = Object.values(appData.bookmarks).some(bookmarks => 
                            bookmarks.some(b => b.url === url)
                        );
                        
                        if (isDuplicate) {
                            duplicateCount++;
                            return;
                        }
                        
                        // 尝试获取文件夹信息
                        let folder = '默认分组';
                        let parentNode = node.parentNode;
                        
                        while (parentNode && parentNode.tagName !== 'DL') {
                            if (parentNode.tagName === 'H3') {
                                folder = parentNode.textContent.trim() || folder;
                                break;
                            }
                            parentNode = parentNode.parentNode;
                        }
                        
                        if (!appData.bookmarks[folder]) {
                            appData.bookmarks[folder] = [];
                        }
                        
                        appData.bookmarks[folder].push({
                            id: 'bm_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                            name,
                            url
                        });
                        
                        importedCount++;
                    });
                    
                    renderBookmarks();
                    updateBookmarkCount();
                    showNotification('成功', `成功导入 ${importedCount} 个书签，跳过 ${duplicateCount} 个重复书签`, 'success');
                } catch (error) {
                    console.error('导入书签失败:', error);
                    showNotification('错误', '导入书签失败，请确保文件格式正确', 'error');
                }
            };
            reader.readAsText(file);
            
            // 重置文件输入，允许重复选择同一文件
            elements.importFile.value = '';
        }

        // 导出书签
        function exportBookmarks() {
            let totalCount = 0;
            Object.values(appData.bookmarks).forEach(bookmarks => {
                totalCount += bookmarks.length;
            });
            
            if (totalCount === 0) {
                showNotification('警告', '没有可导出的书签', 'warning');
                return;
            }
            
            let htmlContent = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            Object.keys(appData.bookmarks).forEach(folder => {
                const bookmarks = appData.bookmarks[folder];
                if (bookmarks.length === 0) return;
                
                htmlContent += `<DT><H3>${folder}</H3>
<DL><p>`;
                
                bookmarks.forEach(bookmark => {
                    htmlContent += `<DT><A HREF="${bookmark.url}">${bookmark.name}</A>`;
                });
                
                htmlContent += `</DL><p>`;
            });
            
            htmlContent += `</DL><p>`;
            
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `星际导航书签_${new Date().toISOString().slice(0,10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('成功', `已导出 ${totalCount} 个书签`, 'success');
        }

        // 创建备份
        function createBackup() {
            const dataToBackup = {
                bookmarks: appData.bookmarks,
                ads: appData.ads,
                timezones: appData.timezones
            };
            
            const jsonString = JSON.stringify(dataToBackup, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `星际导航备份_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('成功', '已创建JSON备份', 'success');
        }

        // 恢复备份
        function restoreBackup() {
            elements.restoreFile.click();
        }

        // 处理恢复文件
        function handleRestoreFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    
                    if (restoredData.bookmarks) appData.bookmarks = restoredData.bookmarks;
                    if (restoredData.ads) appData.ads = restoredData.ads;
                    if (restoredData.timezones) appData.timezones = restoredData.timezones;
                    
                    renderBookmarks();
                    renderAds();
                    renderTimezones();
                    updateBookmarkCount();
                    showNotification('成功', '已从备份恢复数据', 'success');
                } catch (error) {
                    console.error('恢复备份失败:', error);
                    showNotification('错误', '恢复备份失败，请确保文件格式正确', 'error');
                }
            };
            reader.readAsText(file);
            
            // 重置文件输入
            elements.restoreFile.value = '';
        }

        // 处理广告图片上传
        function handleAdImageUpload(event, adId) {
            const file = event.target.files[0];
            if (!file) return;
            
            // 检查文件大小
            if (file.size > 3 * 1024 * 1024) {
                showNotification('错误', '图片大小不能超过3MB', 'error');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                appData.ads[adId].image = e.target.result;
                renderAds();
                showNotification('成功', `广告位 ${adId} 图片已更新`, 'success');
            };
            reader.readAsDataURL(file);
            
            // 重置文件输入
            event.target.value = '';
        }

        // 更新广告链接
        function updateAdUrl(adId) {
            const url = document.getElementById(`ad${adId}-url`).value.trim();
            appData.ads[adId].url = url;
            renderAds();
        }

        // 保存时区
        function saveTimezone() {
            const city = elements.timezoneCity.value.trim();
            const offset = parseInt(elements.timezoneOffset.value);
            
            if (!city || isNaN(offset)) {
                showNotification('错误', '城市名称和时区偏移不能为空', 'error');
                return;
            }
            
            // 检查是否已存在相同城市
            const isDuplicate = appData.timezones.some(tz => tz.city === city);
            if (isDuplicate) {
                showNotification('警告', '该城市时区已存在', 'warning');
                return;
            }
            
            appData.timezones.push({ city, offset });
            renderTimezones();
            closeModal(elements.timezoneModal);
            showNotification('成功', `已添加时区"${city}"`, 'success');
        }

        // 打开模态框
        function openModal(modal) {
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100', 'pointer-events-auto');
            
            const modalContent = modal.querySelector('div[class*="max-w-md"]');
            if (modalContent) {
                setTimeout(() => {
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                }, 10);
            }
        }

        // 关闭模态框
        function closeModal(modal) {
            modal.classList.remove('opacity-100', 'pointer-events-auto');
            modal.classList.add('opacity-0', 'pointer-events-none');
            
            const modalContent = modal.querySelector('div[class*="max-w-md"]');
            if (modalContent) {
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
            }
        }

        // 切换主题
        function toggleTheme() {
            elements.body.classList.toggle('dark');
            elements.body.classList.toggle('bg-space-black');
            elements.body.classList.toggle('bg-day-light');
            elements.body.classList.toggle('text-white');
            elements.body.classList.toggle('text-day-text');
            
            const isDarkMode = elements.body.classList.contains('bg-space-black');
            const iconElement = elements.themeToggle.querySelector('i');
            
            if (isDarkMode) {
                iconElement.classList.remove('fa-sun-o');
                iconElement.classList.add('fa-moon-o');
                elements.themeToggle.querySelector('span').textContent = '切换到白天模式';
            } else {
                iconElement.classList.remove('fa-moon-o');
                iconElement.classList.add('fa-sun-o');
                elements.themeToggle.querySelector('span').textContent = '切换到黑夜模式';
            }
            
            localStorage.setItem('darkMode', !isDarkMode);
        }

        // 打开编辑页
        function openEditPage() {
            elements.editPage.classList.remove('translate-x-full');
        }

        // 关闭编辑页
        function closeEditPage() {
            elements.editPage.classList.add('translate-x-full');
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 主题切换
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // 编辑页切换
            elements.editBtn.addEventListener('click', openEditPage);
            elements.closeEdit.addEventListener('click', closeEditPage);
            
            // 书签操作
            elements.importBookmarks.addEventListener('click', importBookmarks);
            elements.exportBookmarks.addEventListener('click', exportBookmarks);
            elements.addBookmark.addEventListener('click', openAddBookmarkModal);
            elements.cancelBookmark.addEventListener('click', () => closeModal(elements.bookmarkModal));
            elements.saveBookmark.addEventListener('click', saveBookmark);
            
            // 确认删除
            elements.cancelDelete.addEventListener('click', () => closeModal(elements.confirmDeleteModal));
            elements.confirmDelete.addEventListener('click', performDelete);
            
            // 备份与恢复
            elements.backupData.addEventListener('click', createBackup);
            elements.restoreData.addEventListener('click', restoreBackup);
            elements.restoreFile.addEventListener('change', handleRestoreFile);
            elements.saveChanges.addEventListener('click', saveDataToGitHub);
            
            // GitHub配置
            elements.saveGithubConfig.addEventListener('click', saveGithubConfig);
            
            // 导入文件处理
            elements.importFile.addEventListener('change', handleImportedFile);
            
            // 广告管理
            document.getElementById('ad1-image').addEventListener('change', (e) => handleAdImageUpload(e, 1));
            document.getElementById('ad2-image').addEventListener('change', (e) => handleAdImageUpload(e, 2));
            document.getElementById('ad3-image').addEventListener('change', (e) => handleAdImageUpload(e, 3));
            
            document.getElementById('ad1-url').addEventListener('change', () => updateAdUrl(1));
            document.getElementById('ad2-url').addEventListener('change', () => updateAdUrl(2));
            document.getElementById('ad3-url').addEventListener('change', () => updateAdUrl(3));
            
            document.querySelectorAll('.delete-ad').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const adId = e.currentTarget.getAttribute('data-ad');
                    confirmDelete('ad', adId, `确定要删除广告位 ${adId} 吗？`);
                });
            });
            
            // 时区管理
            elements.addTimezone.addEventListener('click', () => openModal(elements.timezoneModal));
            elements.cancelTimezone.addEventListener('click', () => closeModal(elements.timezoneModal));
            elements.saveTimezone.addEventListener('click', saveTimezone);
            
            // 检查本地存储的主题偏好
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === 'true') {
                toggleTheme();
            }
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
