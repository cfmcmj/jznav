<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 探索网络宇宙</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231a1a2e'/%3E%3Ccircle cx='50' cy='50' r='25' fill='%23e2b13c'/%3E%3Ccircle cx='50' cy='35' r='5' fill='white'/%3E%3C/svg%3E" type="image/svg+xml">
    <style id="space-styles">
        /* 基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #e2b13c;
            --accent-color: #6d84b4;
            --dark-bg: #0d1117;
            --light-bg: #f5f5f7;
            --dark-card: #161b22;
            --light-card: #ffffff;
            --dark-text: #c9d1d9;
            --light-text: #1f2328;
            --danger-color: #d73a49;
            --success-color: #2ea44f;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }

        body {
            transition: background-color var(--transition-speed);
            min-height: 100vh;
            padding-bottom: 80px;
            position: relative;
        }

        /* 星空背景 */
        .stars, .twinkling, .planets {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: -1;
        }

        .stars {
            background: #000 url("data:image/svg+xml,%3Csvg viewBox='0 0 1000 1000' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='glow'%3E%3CfeGaussianBlur stdDeviation='2' result='coloredBlur'/%3E%3CfeMerge%3E%3CfeMergeNode in='coloredBlur'/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3Cg filter='url(%23glow)'%3E%3Ccircle cx='120' cy='200' r='1' fill='white'/%3E%3Ccircle cx='320' cy='150' r='1' fill='white'/%3E%3Ccircle cx='520' cy='300' r='1' fill='white'/%3E%3Ccircle cx='720' cy='250' r='1' fill='white'/%3E%3Ccircle cx='920' cy='180' r='1' fill='white'/%3E%3Ccircle cx='150' cy='400' r='1' fill='white'/%3E%3Ccircle cx='350' cy='450' r='1' fill='white'/%3E%3Ccircle cx='550' cy='500' r='1' fill='white'/%3E%3Ccircle cx='750' cy='420' r='1' fill='white'/%3E%3Ccircle cx='950' cy='480' r='1' fill='white'/%3E%3Ccircle cx='180' cy='600' r='1' fill='white'/%3E%3Ccircle cx='380' cy='650' r='1' fill='white'/%3E%3Ccircle cx='580' cy='700' r='1' fill='white'/%3E%3Ccircle cx='780' cy='620' r='1' fill='white'/%3E%3Ccircle cx='980' cy='680' r='1' fill='white'/%3E%3Ccircle cx='220' cy='800' r='1' fill='white'/%3E%3Ccircle cx='420' cy='850' r='1' fill='white'/%3E%3Ccircle cx='620' cy='900' r='1' fill='white'/%3E%3Ccircle cx='820' cy='820' r='1' fill='white'/%3E%3Ccircle cx='920' cy='980' r='1' fill='white'/%3E%3C/g%3E%3C/svg%3E") repeat top center;
        }

        .twinkling {
            background: transparent url("data:image/svg+xml,%3Csvg viewBox='0 0 1000 1000' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='glow2'%3E%3CfeGaussianBlur stdDeviation='1' result='coloredBlur'/%3E%3CfeMerge%3E%3CfeMergeNode in='coloredBlur'/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3Cg filter='url(%23glow2)'%3E%3Ccircle cx='220' cy='100' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='420' cy='250' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='620' cy='100' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='820' cy='350' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='120' cy='500' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='320' cy='650' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='520' cy='500' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='720' cy='750' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='920' cy='600' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='220' cy='900' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='420' cy='750' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='620' cy='900' r='0.5' fill='%23aaaaaa'/%3E%3Ccircle cx='820' cy='700' r='0.5' fill='%23aaaaaa'/%3E%3C/g%3E%3C/svg%3E") repeat top center;
            animation: twinkle 20s linear infinite;
        }

        .planets {
            background: transparent url("data:image/svg+xml,%3Csvg viewBox='0 0 1000 1000' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='800' cy='200' r='5' fill='%23e2b13c' opacity='0.7'/%3E%3Ccircle cx='200' cy='700' r='8' fill='%234a6fa5' opacity='0.6'/%3E%3C/svg%3E") no-repeat top center;
        }

        @keyframes twinkle {
            0% { background-position: 0 0; }
            100% { background-position: -1000px 1000px; }
        }

        /* 顶部控制栏 */
        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            transition: opacity var(--transition-speed);
        }

        .search-container {
            position: relative;
            max-width: 600px;
            width: 100%;
        }

        #search-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 20px;
            border: none;
            outline: none;
            font-size: 14px;
        }

        #search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform var(--transition-speed);
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        /* 小组件样式 */
        .widgets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .widget {
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform var(--transition-speed);
            position: relative;
        }

        .widget:hover {
            transform: translateY(-5px);
        }

        .widget h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            font-size: 18px;
        }

        #uptime-display, #reminder-text {
            font-size: 16px;
            line-height: 1.5;
        }

        #cities-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .city-time {
            display: flex;
            justify-content: space-between;
        }

        .edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .edit-btn:hover {
            opacity: 1;
        }

        /* 广告位样式 */
        .ad-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .ad-slot {
            height: 150px;
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-slot::before {
            content: attr(data-placeholder);
            position: absolute;
            color: var(--secondary-color);
            opacity: 0.7;
        }

        .ad-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 书签样式 */
        .bookmark-folders {
            padding: 20px;
        }

        .bookmark-folder {
            margin-bottom: 25px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .folder-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .folder-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .folder-icon {
            color: var(--secondary-color);
        }

        .folder-content {
            padding: 0 20px 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-speed);
        }

        .folder-expanded .folder-content {
            max-height: 1000px;
        }

        .bookmark-item {
            padding: 15px 10px;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-height: 80px;
        }

        .bookmark-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .bookmark-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background-color: rgba(74, 111, 165, 0.2);
        }

        .bookmark-favicon {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .bookmark-name {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        /* 底部样式 */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            font-size: 14px;
        }

        .dark-white {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--dark-text);
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            margin: 50px auto;
            padding: 25px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            position: relative;
            animation: modalSlideIn 0.3s;
        }

        .edit-modal-content {
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-btn, .close-edit-btn, .close-add-bookmark {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
        }

        /* 按钮样式 */
        .btn {
            padding: 10px 15px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: background-color var(--transition-speed);
        }

        .primary {
            background-color: var(--primary-color);
            color: white;
        }

        .primary:hover {
            background-color: #3a5a8c;
        }

        .secondary {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .secondary:hover {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .success {
            background-color: var(--success-color);
            color: white;
        }

        .success:hover {
            background-color: #238636;
        }

        .danger {
            background-color: var(--danger-color);
            color: white;
        }

        .danger:hover {
            background-color: #c92a36;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* 设置样式 */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
        }

        .github-settings {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        input, select {
            padding: 10px 15px;
            border-radius: var(--border-radius);
            border: 1px solid;
            font-size: 14px;
        }

        .status-indicator {
            padding: 10px 15px;
            border-radius: var(--border-radius);
            font-size: 14px;
        }

        /* 编辑标签页样式 */
        .edit-tabs {
            display: flex;
            border-bottom: 1px solid;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            position: relative;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--secondary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 书签编辑样式 */
        .bookmark-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .import-export {
            display: flex;
            gap: 10px;
        }

        .edit-bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }

        .edit-bookmark-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .edit-bookmark-actions {
            display: flex;
            gap: 10px;
        }

        .edit-bookmark-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        /* 城市编辑样式 */
        .add-city-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #city-name, #city-timezone {
            flex: 1;
        }

        .city-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }

        /* 广告编辑样式 */
        .ad-item {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .ad-item h4 {
            margin-bottom: 10px;
        }

        .ad-image-upload, .ad-link {
            width: 100%;
            margin-bottom: 10px;
        }

        /* 编辑操作区 */
        .edit-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }

        /* 添加书签表单 */
        .bookmark-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        /* 提示消息 */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            background-color: var(--dark-card);
            color: var(--dark-text);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity var(--transition-speed);
        }

        .toast.show {
            opacity: 1;
        }

        /* 加载动画 */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .widgets, .ad-slots {
                grid-template-columns: 1fr;
            }
            
            .control-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .search-container {
                width: 100%;
                max-width: none;
            }
            
            .footer {
                flex-direction: column;
                gap: 10px;
                text-align: center;
                padding: 15px;
            }
            
            .add-city-form {
                flex-direction: column;
            }
            
            .bookmark-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .import-export {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* 主题样式 */
        .dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .dark-mode .widget,
        .dark-mode .bookmark-folder,
        .dark-mode .modal-content {
            background-color: var(--dark-card);
        }

        .dark-mode #search-input,
        .dark-mode input,
        .dark-mode select {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--dark-text);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .light-mode {
            background-color: var(--light-bg);
            color: var(--light-text);
        }

        .light-mode .widget,
        .light-mode .bookmark-folder,
        .light-mode .modal-content {
            background-color: var(--light-card);
        }

        .light-mode #search-input,
        .light-mode input,
        .light-mode select {
            background-color: white;
            color: var(--light-text);
            border-color: #ddd;
        }

        .light-mode .status-indicator {
            background-color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body class="dark-mode">
    <div class="stars"></div>
    <div class="twinkling"></div>
    <div class="planets"></div>

    <!-- 顶部控制栏 -->
    <div class="control-bar">
        <div class="search-container">
            <input type="text" id="search-input" placeholder="搜索书签...">
            <button id="search-btn">🔍</button>
        </div>
        <div class="controls">
            <button id="theme-toggle" class="control-btn" title="切换主题">🌓</button>
            <button id="settings-btn" class="control-btn" title="设置">⚙️</button>
        </div>
    </div>

    <!-- 小组件区域 -->
    <div class="widgets">
        <div class="widget" id="space-time">
            <h3>太空航行时间</h3>
            <div id="uptime-display">0天 0时 0分</div>
        </div>
        <div class="widget" id="health-reminder">
            <h3>健康提醒</h3>
            <div id="reminder-text">准备就绪，开始探索</div>
        </div>
        <div class="widget" id="world-clock">
            <h3>世界时钟</h3>
            <div id="cities-container">
                <!-- 城市时钟将动态添加 -->
            </div>
            <button id="add-city-btn" class="edit-btn" title="添加城市">+</button>
        </div>
    </div>

    <!-- 广告位区域 -->
    <div class="ad-slots">
        <div class="ad-slot" id="ad-1" data-placeholder="广告位 1" onclick="window.open(adLinks[0], '_blank')">
            <img src="" alt="广告位1" class="ad-img">
        </div>
        <div class="ad-slot" id="ad-2" data-placeholder="广告位 2" onclick="window.open(adLinks[1], '_blank')">
            <img src="" alt="广告位2" class="ad-img">
        </div>
        <div class="ad-slot" id="ad-3" data-placeholder="广告位 3" onclick="window.open(adLinks[2], '_blank')">
            <img src="" alt="广告位3" class="ad-img">
        </div>
    </div>

    <!-- 书签文件夹区域 -->
    <div class="bookmark-folders">
        <!-- 书签将动态添加 -->
    </div>

    <!-- 底部信息 -->
    <div class="dark-white footer">
        <div>共收录<span id="total-bookmarks">0</span>个网站</div>
        <div>Copyright © 2018-<span id="current-year">2025</span> <span id="hostname">SpaceNav</span>, All Rights Reserved</div>
    </div>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>设置中心</h2>
            
            <div class="settings-section">
                <h3>GitHub 验证</h3>
                <p>完成验证以启用编辑功能</p>
                <div class="github-settings">
                    <input type="text" id="github-username" placeholder="GitHub 用户名" readonly>
                    <input type="text" id="github-repo" placeholder="仓库名称" readonly>
                    <input type="password" id="github-token" placeholder="GitHub Personal Access Token">
                    <div class="btn-group">
                        <button id="validate-github" class="btn primary">验证</button>
                        <span id="github-status" class="status-indicator">未验证</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <button id="open-edit-center" class="btn success" disabled>进入编辑中心</button>
            </div>
        </div>
    </div>

    <!-- 编辑中心模态框 -->
    <div id="edit-modal" class="modal">
        <div class="modal-content edit-modal-content">
            <span class="close-edit-btn">&times;</span>
            <h2>编辑中心</h2>
            
            <div class="edit-tabs">
                <button class="tab-btn active" data-tab="bookmarks">书签管理</button>
                <button class="tab-btn" data-tab="clocks">时钟设置</button>
                <button class="tab-btn" data-tab="ads">广告管理</button>
            </div>
            
            <!-- 书签管理标签页 -->
            <div class="tab-content active" id="bookmarks-tab">
                <div class="bookmark-actions">
                    <button id="add-bookmark-btn" class="btn primary">添加书签</button>
                    <div class="import-export">
                        <button id="import-bookmarks" class="btn secondary">导入书签</button>
                        <input type="file" id="bookmark-import-file" accept=".html" style="display: none;">
                        <button id="export-bookmarks" class="btn secondary">导出书签</button>
                    </div>
                </div>
                <div id="edit-bookmarks-container">
                    <!-- 编辑书签内容将动态添加 -->
                </div>
            </div>
            
            <!-- 时钟设置标签页 -->
            <div class="tab-content" id="clocks-tab">
                <div class="clock-controls">
                    <div class="add-city-form">
                        <input type="text" id="city-name" placeholder="城市名称">
                        <input type="text" id="city-timezone" placeholder="时区 (例如: Asia/Shanghai)">
                        <button id="save-city-btn" class="btn primary">添加城市</button>
                    </div>
                    <div id="cities-list">
                        <!-- 城市列表将动态添加 -->
                    </div>
                </div>
            </div>
            
            <!-- 广告管理标签页 -->
            <div class="tab-content" id="ads-tab">
                <div id="ads-list">
                    <div class="ad-item">
                        <h4>广告位 1</h4>
                        <input type="file" class="ad-image-upload" data-ad="0" accept="image/*">
                        <input type="text" class="ad-link" data-ad="0" placeholder="广告链接">
                        <button class="remove-ad btn danger" data-ad="0">移除</button>
                    </div>
                    <div class="ad-item">
                        <h4>广告位 2</h4>
                        <input type="file" class="ad-image-upload" data-ad="1" accept="image/*">
                        <input type="text" class="ad-link" data-ad="1" placeholder="广告链接">
                        <button class="remove-ad btn danger" data-ad="1">移除</button>
                    </div>
                    <div class="ad-item">
                        <h4>广告位 3</h4>
                        <input type="file" class="ad-image-upload" data-ad="2" accept="image/*">
                        <input type="text" class="ad-link" data-ad="2" placeholder="广告链接">
                        <button class="remove-ad btn danger" data-ad="2">移除</button>
                    </div>
                </div>
            </div>
            
            <div class="edit-actions">
                <button id="save-changes" class="btn success">保存更改</button>
                <button id="cancel-edits" class="btn danger">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加书签模态框 -->
    <div id="add-bookmark-modal" class="modal">
        <div class="modal-content">
            <span class="close-add-bookmark">&times;</span>
            <h2>添加新书签</h2>
            <div class="bookmark-form">
                <input type="text" id="new-bookmark-name" placeholder="网站名称" required>
                <input type="url" id="new-bookmark-url" placeholder="网站URL" required>
                <select id="new-bookmark-folder">
                    <option value="default">默认文件夹</option>
                </select>
                <button id="save-bookmark" class="btn success">保存</button>
            </div>
        </div>
    </div>

    <!-- 提示消息 -->
    <div id="toast" class="toast"></div>

    <!-- 加载动画 -->
    <div id="loader" class="loader" style="display: none;">
        <div class="spinner"></div>
    </div>

    <script>
        // 全局变量
        const appData = {
            bookmarks: {
                default: []
            },
            cities: [],
            ads: [{}, {}, {}],
            deploymentDate: new Date(),
            github: {
                username: '',
                repo: '',
                token: '',
                validated: false
            }
        };
        
        let adLinks = ['', '', ''];
        let searchTimeout;
        let elements = {};

        // DOM 元素引用
        function getElements() {
            return {
                themeToggle: document.getElementById('theme-toggle'),
                settingsBtn: document.getElementById('settings-btn'),
                settingsModal: document.getElementById('settings-modal'),
                closeSettingsBtn: document.querySelector('.close-btn'),
                openEditCenter: document.getElementById('open-edit-center'),
                editModal: document.getElementById('edit-modal'),
                closeEditBtn: document.querySelector('.close-edit-btn'),
                validateGithub: document.getElementById('validate-github'),
                githubUsername: document.getElementById('github-username'),
                githubRepo: document.getElementById('github-repo'),
                githubToken: document.getElementById('github-token'),
                githubStatus: document.getElementById('github-status'),
                searchInput: document.getElementById('search-input'),
                searchBtn: document.getElementById('search-btn'),
                tabBtns: document.querySelectorAll('.tab-btn'),
                tabContents: document.querySelectorAll('.tab-content'),
                addBookmarkBtn: document.getElementById('add-bookmark-btn'),
                addBookmarkModal: document.getElementById('add-bookmark-modal'),
                closeAddBookmark: document.querySelector('.close-add-bookmark'),
                saveBookmark: document.getElementById('save-bookmark'),
                newBookmarkName: document.getElementById('new-bookmark-name'),
                newBookmarkUrl: document.getElementById('new-bookmark-url'),
                newBookmarkFolder: document.getElementById('new-bookmark-folder'),
                importBookmarks: document.getElementById('import-bookmarks'),
                exportBookmarks: document.getElementById('export-bookmarks'),
                bookmarkImportFile: document.getElementById('bookmark-import-file'),
                addCityBtn: document.getElementById('add-city-btn'),
                saveCityBtn: document.getElementById('save-city-btn'),
                cityName: document.getElementById('city-name'),
                cityTimezone: document.getElementById('city-timezone'),
                citiesList: document.getElementById('cities-list'),
                citiesContainer: document.getElementById('cities-container'),
                saveChanges: document.getElementById('save-changes'),
                cancelEdits: document.getElementById('cancel-edits'),
                totalBookmarks: document.getElementById('total-bookmarks'),
                currentYear: document.getElementById('current-year'),
                toast: document.getElementById('toast'),
                loader: document.getElementById('loader')
            };
        }

        // 初始化
        async function init() {
            elements = getElements();
            
            // 设置当前年份
            elements.currentYear.textContent = new Date().getFullYear();
            
            // 从本地存储加载 GitHub 信息
            loadGithubInfoFromLocalStorage();
            
            // 注入默认仓库信息（来自 deploy.yml）
            if (window.defaultRepoInfo) {
                appData.github.username = window.defaultRepoInfo.username;
                appData.github.repo = window.defaultRepoInfo.repo;
                elements.githubUsername.value = appData.github.username;
                elements.githubRepo.value = appData.github.repo;
            }
            
            // 加载数据
            showLoader();
            await loadDataFromGitHub();
            hideLoader();
            
            // 渲染页面
            renderBookmarks();
            renderCities();
            renderEditBookmarks();
            renderEditCities();
            updateBookmarkCount();
            updateEditFeaturesStatus();
            
            // 设置事件监听
            setupEventListeners();
            
            // 启动时钟和计时器
            updateUptime();
            setInterval(updateUptime, 60000);
            updateWorldClock();
            setInterval(updateWorldClock, 1000);
            updateHealthReminder();
            setInterval(updateHealthReminder, 3600000); // 每小时更新一次
            
            // 加载主题偏好
            loadThemePreference();
        }

        // 设置事件监听
        function setupEventListeners() {
            // 主题切换
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // 设置模态框
            elements.settingsBtn.addEventListener('click', () => {
                elements.settingsModal.style.display = 'block';
            });
            
            elements.closeSettingsBtn.addEventListener('click', () => {
                elements.settingsModal.style.display = 'none';
            });
            
            // 编辑中心
            elements.openEditCenter.addEventListener('click', () => {
                if (appData.github.validated) {
                    elements.editModal.style.display = 'block';
                    renderEditBookmarks();
                    renderEditCities();
                }
            });
            
            elements.closeEditBtn.addEventListener('click', () => {
                elements.editModal.style.display = 'none';
            });
            
            // GitHub 验证
            elements.validateGithub.addEventListener('click', validateGitHubToken);
            
            // 搜索功能
            elements.searchBtn.addEventListener('click', performSearch);
            elements.searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => performSearch(), 300);
            });
            
            // 标签页切换
            elements.tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    switchTab(tab);
                });
            });
            
            // 书签操作
            elements.addBookmarkBtn.addEventListener('click', () => {
                elements.addBookmarkModal.style.display = 'block';
                elements.newBookmarkName.value = '';
                elements.newBookmarkUrl.value = '';
                elements.newBookmarkFolder.value = 'default';
            });
            
            elements.closeAddBookmark.addEventListener('click', () => {
                elements.addBookmarkModal.style.display = 'none';
            });
            
            elements.saveBookmark.addEventListener('click', saveNewBookmark);
            
            // 导入导出书签
            elements.importBookmarks.addEventListener('click', () => {
                elements.bookmarkImportFile.click();
            });
            
            elements.bookmarkImportFile.addEventListener('change', importBookmarksFromFile);
            elements.exportBookmarks.addEventListener('click', exportBookmarksToFile);
            
            // 城市操作
            elements.addCityBtn.addEventListener('click', () => {
                if (appData.github.validated) {
                    elements.editModal.style.display = 'block';
                    switchTab('clocks');
                    elements.cityName.focus();
                } else {
                    showToast('请先完成 GitHub 验证');
                }
            });
            
            elements.saveCityBtn.addEventListener('click', addNewCity);
            
            // 广告上传
            document.querySelectorAll('.ad-image-upload').forEach(input => {
                input.addEventListener('change', handleAdImageUpload);
            });
            
            document.querySelectorAll('.ad-link').forEach(input => {
                input.addEventListener('change', handleAdLinkChange);
            });

            document.querySelectorAll('.remove-ad').forEach(btn => {
                btn.addEventListener('click', handleRemoveAd);
            });
            
            // 保存和取消编辑
            elements.saveChanges.addEventListener('click', saveAllChanges);
            elements.cancelEdits.addEventListener('click', () => {
                elements.editModal.style.display = 'none';
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', (e) => {
                if (e.target === elements.settingsModal) elements.settingsModal.style.display = 'none';
                if (e.target === elements.editModal) elements.editModal.style.display = 'none';
                if (e.target === elements.addBookmarkModal) elements.addBookmarkModal.style.display = 'none';
            });
            
            // 控制栏自动隐藏
            let controlBar = document.querySelector('.control-bar');
            let hideTimeout;
            
            function showControlBar() {
                clearTimeout(hideTimeout);
                controlBar.style.opacity = '1';
                controlBar.style.pointerEvents = 'auto';
            }
            
            function hideControlBar() {
                hideTimeout = setTimeout(() => {
                    controlBar.style.opacity = '0.7';
                    controlBar.style.pointerEvents = 'none';
                }, 3000);
            }
            
            document.addEventListener('scroll', showControlBar);
            showControlBar();
            hideControlBar();
        }

        // 主题切换
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // 加载主题偏好
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'light' || (!savedTheme && !prefersDark)) {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
            }
        }

        // 切换标签页
        function switchTab(tabName) {
            elements.tabBtns.forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-tab') === tabName);
            });
            
            elements.tabContents.forEach(content => {
                content.classList.toggle('active', content.id === `${tabName}-tab`);
            });
        }

        // 从 GitHub 加载数据
        async function loadDataFromGitHub() {
            try {
                let url;
                if (appData.github.token) {
                    // 使用 GitHub API
                    url = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                } else if (appData.github.username && appData.github.repo) {
                    // 使用公开 raw URL
                    url = `https://raw.githubusercontent.com/${appData.github.username}/${appData.github.repo}/main/bookmarks.json`;
                } else {
                    // 使用默认数据
                    return;
                }
                
                const headers = appData.github.token ? {
                    'Authorization': `token ${appData.github.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                } : {};
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        // 文件不存在，使用默认数据
                        console.log('Bookmarks file not found, using default data');
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                let data;
                if (appData.github.token) {
                    const json = await response.json();
                    data = JSON.parse(atob(json.content));
                } else {
                    data = await response.json();
                }
                
                // 合并数据
                if (data.bookmarks) appData.bookmarks = data.bookmarks;
                if (data.cities) appData.cities = data.cities;
                if (data.ads) appData.ads = data.ads;
                if (data.deploymentDate) appData.deploymentDate = new Date(data.deploymentDate);
                
                // 更新广告链接
                appData.ads.forEach((ad, index) => {
                    adLinks[index] = ad.link || '';
                    const imgElement = document.querySelector(`#ad-${index + 1} .ad-img`);
                    if (ad.image) {
                        imgElement.src = ad.image;
                        imgElement.alt = `广告 ${index + 1}`;
                    } else {
                        imgElement.src = '';
                        imgElement.alt = `广告位 ${index + 1}`;
                    }
                });
                
                // 更新广告链接输入框
                document.querySelectorAll('.ad-link').forEach((input, index) => {
                    input.value = appData.ads[index].link || '';
                });
                
            } catch (error) {
                console.error('Error loading data from GitHub:', error);
                showToast('加载数据失败，使用默认数据');
            }
        }

        // 保存数据到 GitHub
        async function saveDataToGitHub() {
            showLoader();
            try {
                if (!appData.github.username || !appData.github.repo || !appData.github.token) {
                    throw new Error('GitHub 信息不完整');
                }
                
                // 准备数据
                const data = {
                    bookmarks: appData.bookmarks,
                    cities: appData.cities,
                    ads: appData.ads,
                    deploymentDate: appData.deploymentDate.toISOString()
                };
                
                const content = JSON.stringify(data, null, 2);
                
                // 先获取现有文件的 SHA
                const url = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = '';
                if (response.ok) {
                    const json = await response.json();
                    sha = json.sha;
                }
                
                // 编码内容为 base64 并确保只包含 Latin1 字符
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                // 保存文件
                const saveResponse = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks',
                        content: base64Content,
                        sha: sha // 只有文件存在时才需要
                    })
                });
                
                if (!saveResponse.ok) {
                    throw new Error(`保存失败: ${saveResponse.statusText}`);
                }
                
                showToast('数据已成功保存');
                return true;
            } catch (error) {
                console.error('Error saving data to GitHub:', error);
                showToast(`保存失败: ${error.message}`);
                return false;
            } finally {
                hideLoader();
            }
        }

        // 验证 GitHub Token
        async function validateGitHubToken() {
            showLoader();
            try {
                const username = elements.githubUsername.value.trim();
                const repo = elements.githubRepo.value.trim();
                const token = elements.githubToken.value.trim();
                
                if (!username || !repo || !token) {
                    showToast('请填写所有 GitHub 信息');
                    return;
                }
                
                // 验证 token
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Token 无效');
                }
                
                // 验证仓库访问权限
                const repoResponse = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                if (!repoResponse.ok) {
                    throw new Error('无法访问仓库，请检查权限');
                }
                
                // 验证成功
                appData.github.username = username;
                appData.github.repo = repo;
                appData.github.token = token;
                appData.github.validated = true;
                
                // 保存到本地存储
                saveGithubInfoToLocalStorage();
                
                // 更新状态
                elements.githubStatus.textContent = '已验证';
                elements.githubStatus.style.color = 'var(--success-color)';
                elements.githubStatus.style.backgroundColor = 'rgba(46, 164, 79, 0.1)';

                showToast('GitHub 验证成功');
                updateEditFeaturesStatus();
                
            } catch (error) {
                console.error('GitHub validation error:', error);
                appData.github.validated = false;
                elements.githubStatus.textContent = `验证失败: ${error.message}`;
                elements.githubStatus.style.color = 'var(--danger-color)';
                elements.githubStatus.style.backgroundColor = 'rgba(215, 58, 73, 0.1)';
                showToast(`验证失败: ${error.message}`);
            } finally {
                hideLoader();
            }
        }

        // 更新编辑功能状态
        function updateEditFeaturesStatus() {
            const isEnabled = appData.github.validated;
            elements.openEditCenter.disabled = !isEnabled;
            elements.addCityBtn.disabled = !isEnabled;
            elements.saveCityBtn.disabled = !isEnabled;
            elements.addBookmarkBtn.disabled = !isEnabled;
            elements.importBookmarks.disabled = !isEnabled;
            elements.exportBookmarks.disabled = !isEnabled;
            
            document.querySelectorAll('.ad-image-upload, .ad-link, .remove-ad').forEach(el => {
                el.disabled = !isEnabled;
            });
        }

        // 从本地存储加载 GitHub 信息
        function loadGithubInfoFromLocalStorage() {
            const savedGithub = localStorage.getItem('github-info');
            if (savedGithub) {
                try {
                    const data = JSON.parse(savedGithub);
                    appData.github = { ...appData.github, ...data };
                    elements.githubUsername.value = appData.github.username;
                    elements.githubRepo.value = appData.github.repo;
                    elements.githubToken.value = appData.github.token;
                    
                    if (appData.github.validated) {
                        elements.githubStatus.textContent = '已验证';
                        elements.githubStatus.style.color = 'var(--success-color)';
                        elements.githubStatus.style.backgroundColor = 'rgba(46, 164, 79, 0.1)';
                    }
                } catch (error) {
                    console.error('Error loading GitHub info from localStorage:', error);
                }
            }
        }

        // 保存 GitHub 信息到本地存储
        function saveGithubInfoToLocalStorage() {
            localStorage.setItem('github-info', JSON.stringify({
                username: appData.github.username,
                repo: appData.github.repo,
                token: appData.github.token,
                validated: appData.github.validated
            }));
        }

        // 渲染书签
        function renderBookmarks(filter = '') {
            const container = document.querySelector('.bookmark-folders');
            container.innerHTML = '';
            
            // 确保默认文件夹存在
            if (!appData.bookmarks.default) {
                appData.bookmarks.default = [];
            }
            
            // 过滤书签
            const filteredBookmarks = {};
            Object.keys(appData.bookmarks).forEach(folder => {
                filteredBookmarks[folder] = appData.bookmarks[folder].filter(bookmark => 
                    !filter || 
                    bookmark.name.toLowerCase().includes(filter.toLowerCase()) || 
                    bookmark.url.toLowerCase().includes(filter.toLowerCase())
                );
                
                // 只保留有书签的文件夹
                if (filteredBookmarks[folder].length === 0) {
                    delete filteredBookmarks[folder];
                }
            });
            
            // 如果没有匹配的书签
            if (Object.keys(filteredBookmarks).length === 0) {
                container.innerHTML = '<div class="no-bookmarks">没有找到匹配的书签</div>';
                return;
            }
            
            // 创建文件夹和书签
            Object.keys(filteredBookmarks).forEach(folder => {
                const folderElement = document.createElement('div');
                folderElement.className = 'bookmark-folder folder-expanded';
                
                const folderHeader = document.createElement('div');
                folderHeader.className = 'folder-header';

                folderHeader.innerHTML = `
                    <div class="folder-title">
                        <span class="folder-icon">📁</span>
                        <span>${folder === 'default' ? '默认文件夹' : folder}</span>
                        <span>(${filteredBookmarks[folder].length})</span>
                    </div>
                    <span class="folder-toggle">−</span>
                `;
                
                folderHeader.addEventListener('click', () => {
                    folderElement.classList.toggle('folder-expanded');
                    const toggle = folderHeader.querySelector('.folder-toggle');
                    toggle.textContent = folderElement.classList.contains('folder-expanded') ? '−' : '+';
                });
                
                const folderContent = document.createElement('div');
                folderContent.className = 'folder-content';
                
                filteredBookmarks[folder].forEach(bookmark => {
                    const bookmarkElement = document.createElement('div');
                    bookmarkElement.className = 'bookmark-item';
                    bookmarkElement.title = bookmark.url;
                    
                    // 尝试获取 favicon，失败则显示首字母
                    let faviconHtml = '';
                    if (bookmark.url) {
                        try {
                            const url = new URL(bookmark.url);
                            const faviconUrl = `${url.protocol}//${url.hostname}/favicon.ico`;
                            faviconHtml = `<img src="${faviconUrl}" class="bookmark-favicon" onerror="this.style.display='none'">`;
                        } catch (e) {
                            console.error('Invalid URL for favicon:', bookmark.url);
                        }
                    }
                    
                    // 如果没有 favicon，显示首字母
                    const firstLetter = bookmark.name.charAt(0).toUpperCase();
                    faviconHtml += `<span class="bookmark-letter" style="display: none;">${firstLetter}</span>`;
                    
                    bookmarkElement.innerHTML = `
                        <div class="bookmark-icon">
                            ${faviconHtml}
                        </div>
                        <div class="bookmark-name">${bookmark.name}</div>
                    `;
                    
                    bookmarkElement.addEventListener('click', () => {
                        window.open(bookmark.url, '_blank');
                    });
                    
                    folderContent.appendChild(bookmarkElement);
                });
                
                folderElement.appendChild(folderHeader);
                folderElement.appendChild(folderContent);
                container.appendChild(folderElement);
            });
        }

        // 在编辑中心渲染书签
        function renderEditBookmarks() {
            const container = document.getElementById('edit-bookmarks-container');
            container.innerHTML = '';
            
            // 清空文件夹选择下拉框
            elements.newBookmarkFolder.innerHTML = '';
            
            // 添加所有文件夹到下拉框
            Object.keys(appData.bookmarks).forEach(folder => {
                const option = document.createElement('option');
                option.value = folder;
                option.textContent = folder === 'default' ? '默认文件夹' : folder;
                elements.newBookmarkFolder.appendChild(option);
            });
            
            // 添加新建文件夹选项
            const newFolderOption = document.createElement('option');
            newFolderOption.value = '__new__';
            newFolderOption.textContent = '+ 新建文件夹';
            elements.newBookmarkFolder.appendChild(newFolderOption);
            
            // 监听文件夹选择变化
            elements.newBookmarkFolder.addEventListener('change', function() {
                if (this.value === '__new__') {
                    const folderName = prompt('请输入新文件夹名称:');
                    if (folderName && folderName.trim()) {
                        const trimmedName = folderName.trim();
                        if (!appData.bookmarks[trimmedName]) {
                            appData.bookmarks[trimmedName] = [];
                            this.value = trimmedName;
                            
                            // 更新下拉框
                            renderEditBookmarks();
                        } else {
                            alert('该文件夹已存在');
                            this.value = 'default';
                        }
                    } else {
                        this.value = 'default';
                    }
                }
            });
            
            // 渲染所有书签
            Object.keys(appData.bookmarks).forEach(folder => {
                if (appData.bookmarks[folder].length === 0) return;
                
                const folderLabel = document.createElement('h3');
                folderLabel.textContent = folder === 'default' ? '默认文件夹' : folder;
                container.appendChild(folderLabel);
                
                appData.bookmarks[folder].forEach((bookmark, index) => {
                    const bookmarkElement = document.createElement('div');
                    bookmarkElement.className = 'edit-bookmark-item';
                    bookmarkElement.innerHTML = `
                        <div class="edit-bookmark-info">
                            <div class="bookmark-icon" style="width: 24px; height: 24px;">
                                ${bookmark.url ? `<img src="${new URL(bookmark.url).protocol}//${new URL(bookmark.url).hostname}/favicon.ico" class="bookmark-favicon" onerror="this.style.display='none'">` : ''}
                                <span class="bookmark-letter" style="display: none;">${bookmark.name.charAt(0).toUpperCase()}</span>
                            </div>
                            <div>
                                <div>${bookmark.name}</div>
                                <div style="font-size: 12px; opacity: 0.7;">${bookmark.url}</div>
                            </div>
                        </div>
                        <div class="edit-bookmark-actions">
                            <button class="edit-bookmark-btn edit" data-folder="${folder}" data-index="${index}">✏️</button>
                            <button class="edit-bookmark-btn delete" data-folder="${folder}" data-index="${index}">🗑️</button>
                        </div>
                    `;
                    
                    container.appendChild(bookmarkElement);
                });
            });
            
            // 添加编辑和删除事件监听
            document.querySelectorAll('.edit-bookmark-btn.edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const folder = e.currentTarget.getAttribute('data-folder');
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    editBookmark(folder, index);
                });
            });
            
            document.querySelectorAll('.edit-bookmark-btn.delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const folder = e.currentTarget.getAttribute('data-folder');
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    if (confirm(`确定要删除书签 "${appData.bookmarks[folder][index].name}" 吗？`)) {
                        deleteBookmark(folder, index);
                    }
                });
            });
        }

        // 保存新书签
        function saveNewBookmark() {
            const name = elements.newBookmarkName.value.trim();
            let url = elements.newBookmarkUrl.value.trim();
            let folder = elements.newBookmarkFolder.value;
            
            if (!name || !url) {
                showToast('请填写书签名称和 URL');
                return;
            }
            
            // 确保 URL 有协议
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            
            // 检查是否已存在相同 URL 的书签
            let isDuplicate = false;
            Object.keys(appData.bookmarks).forEach(f => {
                appData.bookmarks[f].forEach(b => {
                    if (b.url === url) {
                        isDuplicate = true;
                    }
                });
            });
            
            if (isDuplicate) {
                if (!confirm('已存在相同 URL 的书签，是否继续添加？')) {
                    return;
                }
            }
            
            // 确保文件夹存在
            if (!appData.bookmarks[folder]) {
                appData.bookmarks[folder] = [];
            }
            
            // 添加新书签
            appData.bookmarks[folder].push({
                name,
                url
            });
            
            // 更新界面
            elements.addBookmarkModal.style.display = 'none';
            showToast('书签添加成功');
            renderEditBookmarks();
            updateBookmarkCount();
        }

        // 编辑书签
        function editBookmark(folder, index) {
            const bookmark = appData.bookmarks[folder][index];
            const newName = prompt('编辑书签名称:', bookmark.name);
            if (newName === null) return; // 用户取消
            
            let newUrl = prompt('编辑书签 URL:', bookmark.url);
            if (newUrl === null) return; // 用户取消
            
            newUrl = newUrl.trim();
            const trimmedName = newName.trim();
            
            if (!trimmedName || !newUrl) {
                showToast('名称和 URL 不能为空');
                return;
            }
            
            // 确保 URL 有协议
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                newUrl = 'https://' + newUrl;
            }
            
            // 更新书签
            appData.bookmarks[folder][index] = {
                name: trimmedName,
                url: newUrl
            };
            
            showToast('书签更新成功');
            renderEditBookmarks();
        }

        // 删除书签
        function deleteBookmark(folder, index) {
            appData.bookmarks[folder].splice(index, 1);
            
            // 如果文件夹为空，删除文件夹
            if (appData.bookmarks[folder].length === 0 && folder !== 'default') {
                delete appData.bookmarks[folder];
            }
            
            showToast('书签已删除');
            renderEditBookmarks();
            updateBookmarkCount();
        }

        // 导入书签
        function importBookmarksFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    const bookmarks = doc.querySelectorAll('a');
                    
                    if (bookmarks.length === 0) {
                        showToast('未找到书签数据');
                        return;
                    }
                    
                    let importedCount = 0;
                    let duplicateCount = 0;
                    
                    bookmarks.forEach(bookmark => {
                        const name = bookmark.textContent.trim();
                        let url = bookmark.getAttribute('href');
                        
                        if (!name || !url) return;
                        
                        // 过滤无效链接
                        if (url.startsWith('javascript:') || url.startsWith('data:')) return;
                        
                        // 确保 URL 有协议
                        if (!url.startsWith('http://') && !url.startsWith('https://')) {
                            url = 'https://' + url;
                        }
                        
                        // 检查是否重复
                        let isDuplicate = false;
                        Object.keys(appData.bookmarks).forEach(folder => {
                            appData.bookmarks[folder].forEach(b => {
                                if (b.url === url) {
                                    isDuplicate = true;
                                }
                            });
                        });
                        
                        if (isDuplicate) {
                            duplicateCount++;
                            return;
                        }
                        
                        // 获取文件夹（从父节点获取）
                        let folder = 'default';
                        let parent = bookmark.parentNode;
                        while (parent && parent.tagName !== 'DL') {
                            if (parent.tagName === 'H3') {
                                folder = parent.textContent.trim();
                                break;
                            }
                            parent = parent.parentNode;
                        }
                        
                        // 确保文件夹存在
                        if (!appData.bookmarks[folder]) {
                            appData.bookmarks[folder] = [];
                        }
                        
                        // 添加书签
                        appData.bookmarks[folder].push({ name, url });
                        importedCount++;
                    });
                    
                    showToast(`导入完成: 新增 ${importedCount} 个书签，跳过 ${duplicateCount} 个重复书签`);
                    renderEditBookmarks();
                    updateBookmarkCount();
                    
                    // 重置文件输入
                    elements.bookmarkImportFile.value = '';
                } catch (error) {
                    console.error('Error importing bookmarks:', error);
                    showToast(`导入失败: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
        }

        // 导出书签
        function exportBookmarksToFile() {
            // 创建 HTML 书签格式
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            // 添加文件夹和书签
            Object.keys(appData.bookmarks).forEach(folder => {
                html += `<DT><H3>${folder === 'default' ? '默认文件夹' : folder}</H3>
<DL><p>`;
                
                appData.bookmarks[folder].forEach(bookmark => {
                    html += `<DT><A HREF="${bookmark.url}">${bookmark.name}</A><p>`;
                });
                
                html += `</DL><p>`;
            });
            
            html += `</DL><p>`;
            
            // 创建下载
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bookmarks-export-${new Date().toISOString().slice(0, 10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('书签导出成功');
        }

        // 渲染城市时钟
        function renderCities() {
            elements.citiesContainer.innerHTML = '';
            
            appData.cities.forEach(city => {
                const cityElement = document.createElement('div');
                cityElement.className = 'city-time';
                cityElement.innerHTML = `
                    <span>${city.name}</span>
                    <span class="city-clock" data-timezone="${city.timezone}"></span>
                `;
                elements.citiesContainer.appendChild(cityElement);
            });
            
            updateWorldClock();
        }

        // 在编辑中心渲染城市列表
        function renderEditCities() {
            elements.citiesList.innerHTML = '';
            
            appData.cities.forEach((city, index) => {
                const cityElement = document.createElement('div');
                cityElement.className = 'city-item';
                cityElement.innerHTML = `
                    <div>
                        <strong>${city.name}</strong>
                        <div style="font-size: 12px; opacity: 0.7;">${city.timezone}</div>
                    </div>
                    <button class="delete-city btn danger" data-index="${index}">删除</button>
                `;
                elements.citiesList.appendChild(cityElement);
            });
            
            // 添加删除事件监听
            document.querySelectorAll('.delete-city').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    if (confirm(`确定要删除城市 "${appData.cities[index].name}" 吗？`)) {
                        appData.cities.splice(index, 1);
                        renderEditCities();
                        renderCities();
                        showToast('城市已删除');
                    }
                });
            });
        }

        // 添加新城市
        function addNewCity() {
            const name = elements.cityName.value.trim();
            const timezone = elements.cityTimezone.value.trim();
            
            if (!name || !timezone) {
                showToast('请填写城市名称和时区');
                return;
            }
            
            // 检查时区是否有效
            try {
                new Intl.DateTimeFormat('en-US', { timeZone: timezone });
            } catch (e) {
                showToast('无效的时区格式，请使用类似 "Asia/Shanghai" 的格式');
                return;
            }
            
            // 检查是否已存在
            const exists = appData.cities.some(city => city.timezone === timezone);
            if (exists) {
                showToast('该时区已存在');
                return;
            }
            
            appData.cities.push({ name, timezone });
            elements.cityName.value = '';
            elements.cityTimezone.value = '';
            renderEditCities();
            renderCities();
            showToast('城市添加成功');
        }

        // 处理广告图片上传
        function handleAdImageUpload(e) {
            const file = e.target.files[0];
            const adIndex = parseInt(e.target.getAttribute('data-ad'));
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    appData.ads[adIndex].image = event.target.result;
                    document.querySelector(`#ad-${adIndex + 1} .ad-img`).src = event.target.result;
                    showToast('广告图片已更新');
                };
                reader.readAsDataURL(file);
            }
        }

        // 处理广告链接更改
        function handleAdLinkChange(e) {
            const adIndex = parseInt(e.target.getAttribute('data-ad'));
            const link = e.target.value.trim();
            
            appData.ads[adIndex].link = link;
            adLinks[adIndex] = link;
            showToast('广告链接已更新');
        }

        // 移除广告
        function handleRemoveAd(e) {
            const adIndex = parseInt(e.target.getAttribute('data-ad'));
            
            appData.ads[adIndex] = {};
            adLinks[adIndex] = '';
            document.querySelector(`#ad-${adIndex + 1} .ad-img`).src = '';
            document.querySelector(`.ad-link[data-ad="${adIndex}"]`).value = '';
            showToast('广告已移除');
        }

        // 保存所有更改
        async function saveAllChanges() {
            const success = await saveDataToGitHub();
            if (success) {
                renderBookmarks();
                renderCities();
                elements.editModal.style.display = 'none';
            }
        }

        // 执行搜索
        function performSearch() {
            const query = elements.searchInput.value.trim();
            renderBookmarks(query);
        }

        // 更新运行时间
        function updateUptime() {
            const now = new Date();
            const uptimeMs = now - appData.deploymentDate;
            const days = Math.floor(uptimeMs / (1000 * 60 * 60 * 24));
            const hours = Math.floor((uptimeMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((uptimeMs % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById('uptime-display').textContent = 
                `${days}天 ${hours}时 ${minutes}分`;
        }

        // 更新世界时钟
        function updateWorldClock() {
            document.querySelectorAll('.city-clock').forEach(clock => {
                const timezone = clock.getAttribute('data-timezone');
                const options = { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit',
                    hour12: false,
                    timeZone: timezone
                };
                
                clock.textContent = new Intl.DateTimeFormat('zh-CN', options).format(new Date());
            });
        }

        // 更新健康提醒
        function updateHealthReminder() {
            const hour = new Date().getHours();
            const reminders = [
                "现在是休息时间，起来活动一下吧！",
                "记得多喝水，保持身体水分充足",
                "长时间盯着屏幕对眼睛不好，远眺一会儿吧",
                "深呼吸几次，放松一下心情",
                "保持正确的坐姿，保护你的脊椎"
            ];
            
            // 根据时间段选择不同的提醒
            let reminder;
            if (hour >= 6 && hour < 9) {
                reminder = "早上好！新的一天开始了，记得吃早餐哦";
            } else if (hour >= 12 && hour < 14) {
                reminder = "午餐时间到了，补充能量才能高效工作";
            } else if (hour >= 18 && hour < 20) {
                reminder = "傍晚了，适当运动一下有助于晚上的休息";
            } else if (hour >= 22) {
                reminder = "夜深了，注意休息，不要熬夜哦";
            } else {
                reminder = reminders[Math.floor(Math.random() * reminders.length)];
            }
            
            document.getElementById('reminder-text').textContent = reminder;
        }

        // 更新书签计数
        function updateBookmarkCount() {
            let total = 0;
            Object.values(appData.bookmarks).forEach(bookmarks => {
                total += bookmarks.length;
            });
            elements.totalBookmarks.textContent = total;
        }

        // 显示提示消息
        function showToast(message) {
            const toast = elements.toast;
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // 显示加载动画
        function showLoader() {
            elements.loader.style.display = 'flex';
        }

        // 隐藏加载动画
        function hideLoader() {
            elements.loader.style.display = 'none';
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>