<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 外太空书签</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231a1a2e'/%3E%3Ccircle cx='50' cy='50' r='25' fill='%23e2b13c'/%3E%3Ccircle cx='35' cy='40' r='5' fill='white'/%3E%3Ccircle cx='65' cy='40' r='3' fill='white'/%3E%3Ccircle cx='40' cy='60' r='4' fill='white'/%3E%3Ccircle cx='60' cy='65' r='6' fill='white'/%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-timezone@0.5.43/moment-timezone-with-data.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            dark: '#0d1117',
                            darker: '#0a0e14',
                            blue: '#165DFF',
                            purple: '#7b2cbf',
                            pink: '#e63946',
                            accent: '#4cc9f0',
                            glow: '#48cae4',
                        },
                        star: {
                            white: '#ffffff',
                            yellow: '#f1faee',
                            blue: '#a8dadc',
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif', 'system-ui'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite',
                        'spin-slow': 'spin 20s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 0.6 },
                            '50%': { opacity: 1 },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 0 8px rgba(72, 202, 228, 0.8);
            }
            .text-shadow-lg {
                text-shadow: 0 0 12px rgba(72, 202, 228, 0.8);
            }
            .glow {
                box-shadow: 0 0 10px rgba(72, 202, 228, 0.6);
            }
            .glow-lg {
                box-shadow: 0 0 15px rgba(72, 202, 228, 0.8);
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle 2s infinite ease-in-out;
            }
            .space-gradient {
                background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            }
            .folder-open {
                transform: rotate(90deg);
                transition: transform 0.3s ease;
            }
            .folder-closed {
                transform: rotate(0);
                transition: transform 0.3s ease;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .button-hover-effect {
                transition: all 0.2s ease;
            }
            .button-hover-effect:hover {
                transform: translateY(-1px);
            }
            .button-hover-effect:active {
                transform: translateY(1px);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-space-dark text-gray-200 min-h-screen overflow-x-hidden font-space relative">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0 pointer-events-none"></div>
    
    <!-- 顶部导航栏 -->
    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-space-dark/80 backdrop-blur-md border-b border-space-accent/20">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="text-space-glow text-2xl">
                    <i class="fa fa-globe"></i>
                </div>
                <h1 class="text-xl md:text-2xl font-bold text-space-glow text-shadow">星际导航</h1>
            </div>
            
            <div class="hidden md:flex items-center space-x-6">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索书签..." 
                        class="bg-space-darker border border-space-accent/30 rounded-full px-4 py-2 pl-10 text-sm focus:outline-none focus:border-space-glow focus:glow w-48 lg:w-64 transition-all">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-space-darker transition-colors button-hover-effect" title="切换主题" aria-label="切换主题">
                    <i class="fa fa-moon-o text-space-glow"></i>
                </button>
                <button id="settings-btn" class="p-2 rounded-full hover:bg-space-darker transition-colors button-hover-effect" title="设置" aria-label="设置">
                    <i class="fa fa-cog text-space-glow"></i>
                </button>
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-full hover:bg-space-darker transition-colors button-hover-effect" title="菜单" aria-label="菜单">
                    <i class="fa fa-bars text-space-glow"></i>
                </button>
            </div>
        </div>
        
        <!-- 移动端搜索栏 -->
        <div class="md:hidden px-4 pb-3">
            <div class="relative">
                <input type="text" id="mobile-search-input" placeholder="搜索书签..." 
                    class="bg-space-darker border border-space-accent/30 rounded-full px-4 py-2 pl-10 text-sm focus:outline-none focus:border-space-glow focus:glow w-full transition-all">
                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16 relative z-10">
        <!-- 顶部小组件 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- 在线时长统计 -->
            <div class="bg-space-darker/60 backdrop-blur-sm rounded-xl p-4 border border-space-accent/20 hover:border-space-accent/40 transition-all group">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-space-glow font-semibold">星际航行时间</h3>
                    <div class="text-space-glow/70 group-hover:text-space-glow transition-colors">
                        <i class="fa fa-clock-o"></i>
                    </div>
                </div>
                <div class="text-center">
                    <div id="online-duration" class="text-2xl md:text-3xl font-bold text-white mb-2">00:00:00</div>
                    <p class="text-sm text-gray-400">自部署以来</p>
                </div>
            </div>
            
            <!-- 健康提醒 -->
            <div class="bg-space-darker/60 backdrop-blur-sm rounded-xl p-4 border border-space-accent/20 hover:border-space-accent/40 transition-all group">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-space-glow font-semibold">健康提醒</h3>
                    <div class="text-space-glow/70 group-hover:text-space-glow transition-colors">
                        <i class="fa fa-heartbeat"></i>
                    </div>
                </div>
                <div id="health-reminder" class="text-center">
                    <p class="text-lg text-white mb-2">准备好探索宇宙了吗？</p>
                    <p class="text-sm text-gray-400">保持健康，探索更远</p>
                </div>
            </div>
            
            <!-- 世界时钟 -->
            <div class="bg-space-darker/60 backdrop-blur-sm rounded-xl p-4 border border-space-accent/20 hover:border-space-accent/40 transition-all group">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-space-glow font-semibold">星际时间</h3>
                    <div class="text-space-glow/70 group-hover:text-space-glow transition-colors">
                        <i class="fa fa-globe"></i>
                    </div>
                </div>
                <div id="world-clock" class="grid grid-cols-2 gap-2">
                    <!-- 时钟内容将通过JS动态生成 -->
                </div>
            </div>
        </div>
        
        <!-- 广告位1 -->
        <div id="ad-1" class="mb-8 rounded-xl overflow-hidden border border-space-accent/20 hover:border-space-accent/40 transition-all h-40 md:h-52 relative group">
            <div class="absolute inset-0 flex items-center justify-center bg-space-darker/40">
                <p class="text-gray-500 text-center px-4">广告位 1</p>
            </div>
        </div>
        
        <!-- 书签区域 -->
        <div class="mb-8">
            <h2 class="text-xl font-bold mb-4 text-space-glow text-shadow">
                <i class="fa fa-bookmark-o mr-2"></i>星际书签
            </h2>
            
            <!-- 书签文件夹和内容 -->
            <div id="bookmarks-container" class="space-y-6">
                <!-- 书签内容将通过JS动态生成 -->
                <div class="text-center py-10 text-gray-500">
                    <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                    <p>尚未添加书签</p>
                    <p class="text-sm mt-1">在编辑中心添加您的第一个书签</p>
                </div>
            </div>
        </div>
        
        <!-- 广告位2 -->
        <div id="ad-2" class="mb-8 rounded-xl overflow-hidden border border-space-accent/20 hover:border-space-accent/40 transition-all h-40 md:h-52 relative group">
            <div class="absolute inset-0 flex items-center justify-center bg-space-darker/40">
                <p class="text-gray-500 text-center px-4">广告位 2</p>
            </div>
        </div>
        
        <!-- 广告位3 -->
        <div id="ad-3" class="mb-8 rounded-xl overflow-hidden border border-space-accent/20 hover:border-space-accent/40 transition-all h-40 md:h-52 relative group">
            <div class="absolute inset-0 flex items-center justify-center bg-space-darker/40">
                <p class="text-gray-500 text-center px-4">广告位 3</p>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-space-darker/80 backdrop-blur-md border-t border-space-accent/20 py-6 relative z-10">
        <div class="container mx-auto px-4">
            <div class="dark-white text-center space-y-2">
                <div id="total-bookmarks">共收录 0 个网站</div>
                <div id="copyright">Copyright © 2018-2025 example.com, All Rights Reserved</div>
            </div>
        </div>
    </footer>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-space-dark border border-space-accent/30 rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto scrollbar-hide">
            <div class="p-5 border-b border-space-accent/20 flex justify-between items-center">
                <h3 class="text-xl font-bold text-space-glow">设置</h3>
                <button id="close-settings" class="p-2 hover:bg-space-darker rounded-full transition-colors button-hover-effect" title="关闭" aria-label="关闭设置">
                    <i class="fa fa-times text-gray-400 hover:text-white"></i>
                </button>
            </div>
            
            <div class="p-5 space-y-6">
                <!-- GitHub 配置 -->
                <div class="space-y-4">
                    <h4 class="font-semibold text-white flex items-center">
                        <i class="fa fa-github mr-2 text-space-glow"></i> GitHub 配置
                    </h4>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" for="github-username">用户名</label>
                            <input type="text" id="github-username" class="w-full bg-space-darker border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="GitHub 用户名">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" for="github-repo">仓库名</label>
                            <input type="text" id="github-repo" class="w-full bg-space-darker border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="仓库名称">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" for="github-token">个人访问令牌</label>
                            <div class="relative">
                                <input type="password" id="github-token" class="w-full bg-space-darker border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="ghp_...">
                                <button id="toggle-token-visibility" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white button-hover-effect" title="显示/隐藏令牌" aria-label="显示或隐藏令牌">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">需要 repo 权限，用于同步书签数据</p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button id="save-github-settings" class="flex-1 bg-space-blue hover:bg-space-blue/80 text-white rounded-lg py-2 text-sm transition-colors button-hover-effect">
                                保存设置
                            </button>
                            <button id="validate-github-token" class="flex-1 bg-space-purple hover:bg-space-purple/80 text-white rounded-lg py-2 text-sm transition-colors button-hover-effect">
                                验证令牌
                            </button>
                        </div>
                        
                        <div id="github-validation-status" class="hidden text-sm p-2 rounded-lg">
                            <!-- 验证状态将通过JS动态更新 -->
                        </div>
                    </div>
                </div>
                
                <div class="border-t border-gray-800 pt-4">
                    <button id="enter-edit-center" class="w-full bg-space-glow hover:bg-space-glow/80 text-space-dark font-semibold rounded-lg py-3 transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        进入编辑中心
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑中心模态框 -->
    <div id="edit-center-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-space-dark border border-space-accent/30 rounded-xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-5 border-b border-space-accent/20 flex justify-between items-center">
                <h3 class="text-xl font-bold text-space-glow">编辑中心</h3>
                <button id="close-edit-center" class="p-2 hover:bg-space-darker rounded-full transition-colors button-hover-effect" title="关闭" aria-label="关闭编辑中心">
                    <i class="fa fa-times text-gray-400 hover:text-white"></i>
                </button>
            </div>
            
            <div class="flex flex-1 overflow-hidden">
                <!-- 编辑中心导航 -->
                <div class="w-48 border-r border-gray-800 bg-space-darker/50">
                    <nav class="p-2 space-y-1">
                        <button class="edit-tab w-full text-left px-3 py-2 rounded-lg hover:bg-space-dark transition-colors active" data-tab="bookmarks">
                            <i class="fa fa-bookmark-o mr-2"></i>书签管理
                        </button>
                        <button class="edit-tab w-full text-left px-3 py-2 rounded-lg hover:bg-space-dark transition-colors" data-tab="cities">
                            <i class="fa fa-clock-o mr-2"></i>城市时间
                        </button>
                        <button class="edit-tab w-full text-left px-3 py-2 rounded-lg hover:bg-space-dark transition-colors" data-tab="ads">
                            <i class="fa fa-bullhorn mr-2"></i>广告管理
                        </button>
                    </nav>
                </div>
                
                <!-- 编辑中心内容 -->
                <div class="flex-1 overflow-y-auto p-5 space-y-6">
                    <!-- 加载动画 -->
                    <div id="edit-loading" class="hidden absolute inset-0 bg-space-dark/80 flex items-center justify-center z-10">
                        <div class="text-center">
                            <div class="inline-block w-10 h-10 border-2 border-space-glow border-t-transparent rounded-full animate-spin mb-3"></div>
                            <p class="text-space-glow">处理中...</p>
                        </div>
                    </div>
                    
                    <!-- 书签管理标签页 -->
                    <div id="bookmarks-tab" class="edit-content space-y-6">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold text-white text-lg">书签管理</h4>
                            <div class="flex space-x-2">
                                <button id="import-bookmarks" class="px-3 py-1.5 bg-space-blue hover:bg-space-blue/80 text-white rounded-lg text-sm transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fa fa-upload mr-1"></i>导入
                                </button>
                                <button id="export-bookmarks" class="px-3 py-1.5 bg-space-purple hover:bg-space-purple/80 text-white rounded-lg text-sm transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fa fa-download mr-1"></i>导出
                                </button>
                                <input type="file" id="bookmarks-file-input" accept=".html" class="hidden">
                            </div>
                        </div>
                        
                        <!-- 添加新书签 -->
                        <div class="bg-space-darker/50 p-4 rounded-xl border border-gray-800">
                            <h5 class="font-medium text-white mb-3">添加新书签</h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="new-bookmark-folder">文件夹</label>
                                    <select id="new-bookmark-folder" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm">
                                        <option value="">无文件夹</option>
                                        <!-- 文件夹选项将通过JS动态生成 -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="new-bookmark-title">标题</label>
                                    <input type="text" id="new-bookmark-title" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="网站标题">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="new-bookmark-url">URL</label>
                                    <input type="url" id="new-bookmark-url" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="https://example.com">
                                </div>
                            </div>
                            <div class="mt-3 text-right">
                                <button id="add-bookmark" class="px-4 py-1.5 bg-space-glow hover:bg-space-glow/80 text-space-dark rounded-lg text-sm transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed">
                                    添加书签
                                </button>
                            </div>
                        </div>
                        
                        <!-- 添加新文件夹 -->
                        <div class="bg-space-darker/50 p-4 rounded-xl border border-gray-800">
                            <h5 class="font-medium text-white mb-3">添加新文件夹</h5>
                            <div class="flex space-x-3">
                                <input type="text" id="new-folder-name" class="flex-1 bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="文件夹名称">
                                <button id="add-folder" class="px-4 py-1.5 bg-space-purple hover:bg-space-purple/80 text-white rounded-lg text-sm transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed">
                                    添加文件夹
                                </button>
                            </div>
                        </div>
                        
                        <!-- 书签列表 -->
                        <div>
                            <h5 class="font-medium text-white mb-3">书签列表</h5>
                            <div id="bookmarks-list" class="space-y-4">
                                <!-- 书签列表将通过JS动态生成 -->
                                <div class="text-center py-8 text-gray-500">
                                    <p>暂无书签</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 城市时间标签页 -->
                    <div id="cities-tab" class="edit-content space-y-6 hidden">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold text-white text-lg">城市时间管理</h4>
                        </div>
                        
                        <!-- 添加新城市 -->
                        <div class="bg-space-darker/50 p-4 rounded-xl border border-gray-800">
                            <h5 class="font-medium text-white mb-3">添加新城市</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="new-city-name">城市名称</label>
                                    <input type="text" id="new-city-name" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="例如：巴黎">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="new-city-timezone">时区</label>
                                    <input type="text" id="new-city-timezone" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="例如：Europe/Paris">
                                    <p class="text-xs text-gray-500 mt-1">时区列表参考：<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" class="text-space-glow hover:underline">tz database 时区列表</a></p>
                                </div>
                            </div>
                            <div class="mt-3 text-right">
                                <button id="add-city" class="px-4 py-1.5 bg-space-glow hover:bg-space-glow/80 text-space-dark rounded-lg text-sm transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed">
                                    添加城市
                                </button>
                            </div>
                        </div>
                        
                        <!-- 城市列表 -->
                        <div>
                            <h5 class="font-medium text-white mb-3">城市列表</h5>
                            <div id="cities-list" class="space-y-3">
                                <!-- 城市列表将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- 广告管理标签页 -->
                    <div id="ads-tab" class="edit-content space-y-6 hidden">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold text-white text-lg">广告管理</h4>
                            <p class="text-sm text-gray-500">支持JPG、PNG格式，最大3MB</p>
                        </div>
                        
                        <!-- 广告位1 -->
                        <div class="bg-space-darker/50 p-4 rounded-xl border border-gray-800">
                            <h5 class="font-medium text-white mb-3">广告位 1</h5>
                            <div class="space-y-3">
                                <div class="border-2 border-dashed border-gray-700 rounded-lg p-4 text-center hover:border-space-glow transition-colors cursor-pointer" id="ad-1-upload">
                                    <input type="file" id="ad-1-file" accept="image/jpeg,image/png" class="hidden">
                                    <i class="fa fa-upload text-2xl text-gray-500 mb-2"></i>
                                    <p class="text-sm text-gray-500">点击上传图片</p>
                                </div>
                                <div id="ad-1-preview" class="hidden">
                                    <img src="" alt="广告预览" class="max-h-40 mx-auto rounded-lg mb-2">
                                    <button class="text-sm text-red-500 hover:text-red-400 transition-colors button-hover-effect" data-ad="1" id="remove-ad-1">
                                        <i class="fa fa-trash-o mr-1"></i>移除图片
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="ad-1-url">链接地址</label>
                                    <input type="url" id="ad-1-url" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="https://example.com">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 广告位2 -->
                        <div class="bg-space-darker/50 p-4 rounded-xl border border-gray-800">
                            <h5 class="font-medium text-white mb-3">广告位 2</h5>
                            <div class="space-y-3">
                                <div class="border-2 border-dashed border-gray-700 rounded-lg p-4 text-center hover:border-space-glow transition-colors cursor-pointer" id="ad-2-upload">
                                    <input type="file" id="ad-2-file" accept="image/jpeg,image/png" class="hidden">
                                    <i class="fa fa-upload text-2xl text-gray-500 mb-2"></i>
                                    <p class="text-sm text-gray-500">点击上传图片</p>
                                </div>
                                <div id="ad-2-preview" class="hidden">
                                    <img src="" alt="广告预览" class="max-h-40 mx-auto rounded-lg mb-2">
                                    <button class="text-sm text-red-500 hover:text-red-400 transition-colors button-hover-effect" data-ad="2" id="remove-ad-2">
                                        <i class="fa fa-trash-o mr-1"></i>移除图片
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="ad-2-url">链接地址</label>
                                    <input type="url" id="ad-2-url" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="https://example.com">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 广告位3 -->
                        <div class="bg-space-darker/50 p-4 rounded-xl border border-gray-800">
                            <h5 class="font-medium text-white mb-3">广告位 3</h5>
                            <div class="space-y-3">
                                <div class="border-2 border-dashed border-gray-700 rounded-lg p-4 text-center hover:border-space-glow transition-colors cursor-pointer" id="ad-3-upload">
                                    <input type="file" id="ad-3-file" accept="image/jpeg,image/png" class="hidden">
                                    <i class="fa fa-upload text-2xl text-gray-500 mb-2"></i>
                                    <p class="text-sm text-gray-500">点击上传图片</p>
                                </div>
                                <div id="ad-3-preview" class="hidden">
                                    <img src="" alt="广告预览" class="max-h-40 mx-auto rounded-lg mb-2">
                                    <button class="text-sm text-red-500 hover:text-red-400 transition-colors button-hover-effect" data-ad="3" id="remove-ad-3">
                                        <i class="fa fa-trash-o mr-1"></i>移除图片
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1" for="ad-3-url">链接地址</label>
                                    <input type="url" id="ad-3-url" class="w-full bg-space-dark border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:border-space-glow focus:glow transition-all text-sm" placeholder="https://example.com">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-t border-space-accent/20 flex justify-end">
                <button id="save-changes" class="px-6 py-2 bg-space-glow hover:bg-space-glow/80 text-space-dark font-medium rounded-lg transition-colors button-hover-effect disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    保存更改
                </button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-space-dark border border-space-accent/30 rounded-xl w-full max-w-md p-5">
            <h3 class="text-lg font-bold text-white mb-3" id="confirm-title">确认操作</h3>
            <p class="text-gray-300 mb-5" id="confirm-message">您确定要执行此操作吗？</p>
            <div class="flex space-x-3">
                <button id="confirm-cancel" class="flex-1 bg-gray-800 hover:bg-gray-700 text-white rounded-lg py-2 transition-colors button-hover-effect">
                    取消
                </button>
                <button id="confirm-ok" class="flex-1 bg-red-600 hover:bg-red-500 text-white rounded-lg py-2 transition-colors button-hover-effect">
                    确认
                </button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-5 right-5 bg-space-dark border border-space-accent/30 rounded-lg p-4 max-w-sm transform translate-y-20 opacity-0 transition-all duration-300 z-50 hidden">
        <div class="flex items-start">
            <div id="notification-icon" class="mr-3 text-xl">
                <i class="fa fa-check-circle text-green-500"></i>
            </div>
            <div class="flex-1">
                <h4 id="notification-title" class="font-semibold text-white"></h4>
                <p id="notification-message" class="text-sm text-gray-400 mt-1"></p>
            </div>
            <button id="close-notification" class="ml-2 text-gray-500 hover:text-gray-300 button-hover-effect" title="关闭通知" aria-label="关闭通知">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // 应用数据存储
        const appData = {
            bookmarks: [],
            folders: [],
            cities: ["北京", "纽约", "伦敦", "东京"],
            cityTimezones: {
                "北京": "Asia/Shanghai",
                "纽约": "America/New_York",
                "伦敦": "Europe/London",
                "东京": "Asia/Tokyo"
            },
            ads: [
                { id: 1, image: "", url: "" },
                { id: 2, image: "", url: "" },
                { id: 3, image: "", url: "" }
            ],
            deployDate: new Date().toISOString(),
            github: {
                username: "",
                repo: "",
                token: "",
                validated: false
            },
            settings: {
                darkMode: true
            }
        };

        // 初始化函数
        async function init() {
            try {
                // 创建星空背景
                createStars();
                
                // 加载本地存储的设置
                loadLocalSettings();
                
                // 从meta标签获取仓库信息
                const repoMeta = document.querySelector('meta[name="github-repo-info"]');
                if (repoMeta && repoMeta.content) {
                    const [username, repo] = repoMeta.content.split('/');
                    if (username && repo) {
                        appData.github.username = username;
                        appData.github.repo = repo;
                        document.getElementById('github-username').value = username;
                        document.getElementById('github-repo').value = repo;
                    }
                }
                
                // 从GitHub加载数据
                await loadDataFromGitHub();
                
                // 渲染页面内容
                renderWorldClock();
                renderBookmarks();
                renderAds();
                updateOnlineDuration();
                updateHealthReminder();
                updateFooter();
                
                // 初始化编辑中心
                initEditCenter();
                
                // 设置事件监听 - 确保DOM元素加载完成后绑定
                setupEventListeners();
                
                // 启动定时任务
                startTimers();
                
                console.log("初始化完成，所有按钮事件已绑定");
            } catch (error) {
                console.error("初始化失败:", error);
                showNotification('初始化错误', '页面加载过程中出现错误', 'error');
            }
        }

        // 创建星空背景
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = window.innerWidth < 768 ? 100 : 200;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // 随机大小
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // 随机位置
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // 随机亮度和闪烁动画
                const opacity = Math.random() * 0.8 + 0.2;
                star.style.opacity = opacity;
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                // 随机颜色
                const colors = ['#ffffff', '#f1faee', '#a8dadc'];
                star.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                starsContainer.appendChild(star);
            }
        }

        // 加载本地设置
        function loadLocalSettings() {
            const savedSettings = localStorage.getItem('spaceBookmarkSettings');
            if (savedSettings) {
                try {
                    const parsed = JSON.parse(savedSettings);
                    appData.settings = { ...appData.settings, ...parsed.settings };
                    appData.github = { ...appData.github, ...parsed.github };
                    
                    // 更新表单
                    document.getElementById('github-username').value = appData.github.username || '';
                    document.getElementById('github-repo').value = appData.github.repo || '';
                    document.getElementById('github-token').value = appData.github.token || '';
                    
                    // 应用主题
                    if (!appData.settings.darkMode) {
                        document.documentElement.classList.remove('dark');
                        document.getElementById('theme-toggle').innerHTML = '<i class="fa fa-sun-o text-space-glow"></i>';
                    }
                } catch (e) {
                    console.error('加载本地设置失败:', e);
                }
            }
            
            // 更新编辑功能状态
            updateEditFeaturesStatus();
        }

        // 保存本地设置
        function saveLocalSettings() {
            try {
                localStorage.setItem('spaceBookmarkSettings', JSON.stringify({
                    settings: appData.settings,
                    github: {
                        username: appData.github.username,
                        repo: appData.github.repo,
                        token: appData.github.token,
                        validated: appData.github.validated
                    }
                }));
            } catch (e) {
                console.error('保存本地设置失败:', e);
            }
        }

        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            showLoading();
            
            try {
                let url;
                const { username, repo, token } = appData.github;
                
                // 检查是否有仓库信息
                if (!username || !repo) {
                    // 使用默认仓库（从meta标签获取）
                    const repoMeta = document.querySelector('meta[name="github-repo-info"]');
                    if (repoMeta && repoMeta.content) {
                        const [defaultUser, defaultRepo] = repoMeta.content.split('/');
                        if (defaultUser && defaultRepo) {
                            url = `https://raw.githubusercontent.com/${defaultUser}/${defaultRepo}/gh-pages/bookmarks.json`;
                        }
                    }
                } else if (token) {
                    // 有token，使用API
                    url = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                } else {
                    // 无token，使用raw地址
                    url = `https://raw.githubusercontent.com/${username}/${repo}/gh-pages/bookmarks.json`;
                }
                
                if (!url) {
                    hideLoading();
                    showNotification('警告', '无法确定数据来源，使用默认数据', 'warning');
                    return;
                }
                
                const headers = {};
                if (token) {
                    headers['Authorization'] = `token ${token}`;
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                let data;
                if (token) {
                    // 处理API响应
                    const apiData = await response.json();
                    data = JSON.parse(atob(apiData.content));
                } else {
                    // 处理raw响应
                    data = await response.json();
                }
                
                // 更新应用数据
                if (data.bookmarks) appData.bookmarks = data.bookmarks;
                if (data.folders) appData.folders = data.folders;
                if (data.cities) appData.cities = data.cities;
                if (data.cityTimezones) appData.cityTimezones = data.cityTimezones;
                if (data.ads) appData.ads = data.ads;
                if (data.deployDate) appData.deployDate = data.deployDate;
                
                showNotification('成功', '数据加载成功', 'success');
            } catch (error) {
                console.error('从GitHub加载数据失败:', error);
                showNotification('错误', '加载数据失败，使用本地数据', 'error');
            } finally {
                hideLoading();
            }
        }

        // 保存数据到GitHub
        async function saveDataToGitHub() {
            showLoading();
            
            try {
                const { username, repo, token } = appData.github;
                
                if (!username || !repo || !token) {
                    throw new Error('GitHub信息不完整');
                }
                
                // 先获取当前文件的SHA
                const getUrl = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                const getResponse = await fetch(getUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = '';
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    sha = data.sha;
                }
                
                // 准备要保存的数据
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    folders: appData.folders,
                    cities: appData.cities,
                    cityTimezones: appData.cityTimezones,
                    ads: appData.ads,
                    deployDate: appData.deployDate
                };
                
                // 处理特殊字符，避免btoa错误
                const content = JSON.stringify(dataToSave, null, 2);
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                // 保存数据
                const putUrl = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                const putResponse = await fetch(putUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: '更新书签数据',
                        content: base64Content,
                        sha: sha // 仅当文件已存在时需要
                    })
                });
                
                if (!putResponse.ok) {
                    const errorData = await putResponse.json();
                    throw new Error(errorData.message || `HTTP错误: ${putResponse.status}`);
                }
                
                showNotification('成功', '数据已保存到GitHub', 'success');
                return true;
            } catch (error) {
                console.error('保存数据到GitHub失败:', error);
                showNotification('错误', `保存失败: ${error.message}`, 'error');
                return false;
            } finally {
                hideLoading();
            }
        }

        // 验证GitHub令牌
        async function validateGitHubToken(token) {
            showLoading();
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    return { valid: true, message: `验证成功，欢迎 ${userData.login}` };
                } else {
                    return { valid: false, message: `验证失败: ${response.statusText}` };
                }
            } catch (error) {
                console.error('验证GitHub令牌失败:', error);
                return { valid: false, message: `验证出错: ${error.message}` };
            } finally {
                hideLoading();
            }
        }

        // 更新编辑功能状态
        function updateEditFeaturesStatus() {
            const isEnabled = appData.github.validated;
            
            // 更新按钮状态并确保事件可触发
            const updateButtonState = (id, enabled) => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.disabled = !enabled;
                    // 移除disabled类以确保视觉反馈
                    if (enabled) {
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
            };
            
            updateButtonState('enter-edit-center', isEnabled);
            updateButtonState('import-bookmarks', isEnabled);
            updateButtonState('export-bookmarks', isEnabled);
            updateButtonState('add-bookmark', isEnabled);
            updateButtonState('add-folder', isEnabled);
            updateButtonState('add-city', isEnabled);
            updateButtonState('save-changes', isEnabled);
            
            // 更新编辑中心的所有输入元素
            const editInputs = document.querySelectorAll('#edit-center-modal input, #edit-center-modal select, #edit-center-modal textarea');
            editInputs.forEach(input => {
                if (input.id !== 'github-username' && input.id !== 'github-repo' && input.id !== 'github-token') {
                    input.disabled = !isEnabled;
                }
            });
            
            // 更新上传区域
            const uploadAreas = document.querySelectorAll('[id$="-upload"]');
            uploadAreas.forEach(area => {
                if (!isEnabled) {
                    area.classList.add('opacity-50', 'cursor-not-allowed');
                    area.removeEventListener('click', handleAdUploadClick);
                } else {
                    area.classList.remove('opacity-50', 'cursor-not-allowed');
                    area.addEventListener('click', handleAdUploadClick);
                }
            });
        }

        // 渲染世界时钟
        function renderWorldClock() {
            const clockContainer = document.getElementById('world-clock');
            clockContainer.innerHTML = '';
            
            appData.cities.forEach(city => {
                const timezone = appData.cityTimezones[city] || 'UTC';
                const time = moment().tz(timezone).format('HH:mm:ss');
                const date = moment().tz(timezone).format('MM-DD');
                
                const cityElement = document.createElement('div');
                cityElement.className = 'bg-space-dark/50 rounded-lg p-3 text-center';
                cityElement.innerHTML = `
                    <div class="font-medium text-white">${city}</div>
                    <div class="text-lg font-bold text-space-glow mt-1">${time}</div>
                    <div class="text-xs text-gray-500 mt-1">${date}</div>
                `;
                
                // 添加数据属性以便更新
                cityElement.setAttribute('data-city', city);
                cityElement.setAttribute('data-timezone', timezone);
                
                clockContainer.appendChild(cityElement);
            });
        }

        // 渲染书签
        function renderBookmarks() {
            const container = document.getElementById('bookmarks-container');
            container.innerHTML = '';
            
            // 统计书签总数
            const totalBookmarks = appData.bookmarks.length;
            document.getElementById('total-bookmarks').textContent = `共收录 ${totalBookmarks} 个网站`;
            
            if (totalBookmarks === 0) {
                container.innerHTML = `
                    <div class="text-center py-10 text-gray-500">
                        <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                        <p>尚未添加书签</p>
                        <p class="text-sm mt-1">在编辑中心添加您的第一个书签</p>
                    </div>
                `;
                return;
            }
            
            // 按文件夹分组
            const bookmarksByFolder = {};
            
            // 添加无文件夹的书签
            bookmarksByFolder[''] = appData.bookmarks.filter(bookmark => !bookmark.folder);
            
            // 添加有文件夹的书签
            appData.folders.forEach(folder => {
                bookmarksByFolder[folder.id] = appData.bookmarks.filter(bookmark => bookmark.folder === folder.id);
            });
            
            // 先渲染无文件夹的书签
            if (bookmarksByFolder[''].length > 0) {
                const folderSection = createBookmarkSection('', '未分类', bookmarksByFolder['']);
                container.appendChild(folderSection);
            }
            
            // 渲染各个文件夹
            appData.folders.forEach(folder => {
                if (bookmarksByFolder[folder.id] && bookmarksByFolder[folder.id].length > 0) {
                    const folderSection = createBookmarkSection(folder.id, folder.name, bookmarksByFolder[folder.id]);
                    container.appendChild(folderSection);
                }
            });
            
            // 更新编辑中心的书签列表
            renderEditBookmarksList();
            // 更新文件夹下拉菜单
            updateFolderSelect();
        }

        // 创建书签分组
        function createBookmarkSection(folderId, folderName, bookmarks) {
            const section = document.createElement('div');
            section.className = 'space-y-3';
            
            // 文件夹标题
            const header = document.createElement('div');
            header.className = 'flex items-center justify-between';
            header.innerHTML = `
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <i class="fa fa-folder-o mr-2 text-space-glow"></i>${folderName}
                    <span class="ml-2 text-sm bg-space-dark px-2 py-0.5 rounded-full text-gray-400">${bookmarks.length}</span>
                </h3>
                <button class="folder-toggle p-1.5 rounded-full hover:bg-space-darker transition-colors button-hover-effect" data-folder="${folderId}">
                    <i class="fa fa-chevron-right text-gray-500 folder-closed"></i>
                </button>
            `;
            
            // 书签网格
            const bookmarksGrid = document.createElement('div');
            bookmarksGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3 folder-content';
            bookmarksGrid.setAttribute('data-folder', folderId);
            
            bookmarks.forEach(bookmark => {
                const bookmarkElement = createBookmarkElement(bookmark);
                bookmarksGrid.appendChild(bookmarkElement);
            });
            
            section.appendChild(header);
            section.appendChild(bookmarksGrid);
            
            return section;
        }

        // 创建单个书签元素
        function createBookmarkElement(bookmark) {
            const bookmarkElement = document.createElement('a');
            bookmarkElement.href = bookmark.url;
            bookmarkElement.target = '_blank';
            bookmarkElement.className = 'bg-space-darker/60 backdrop-blur-sm rounded-lg p-3 border border-gray-800 hover:border-space-glow hover:glow transition-all flex flex-col items-center justify-center text-center h-24 group button-hover-effect';
            
            // 获取favicon或使用首字母
            let faviconHtml = '';
            try {
                const url = new URL(bookmark.url);
                const faviconUrl = `${url.protocol}//${url.hostname}/favicon.ico`;
                faviconHtml = `<img src="${faviconUrl}" alt="${bookmark.title}图标" class="w-8 h-8 mb-2 object-contain favicon-placeholder">`;
            } catch (e) {
                // URL无效，使用首字母
                const firstChar = bookmark.title.charAt(0).toUpperCase();
                faviconHtml = `<div class="w-8 h-8 mb-2 rounded-full bg-space-blue flex items-center justify-center font-bold">${firstChar}</div>`;
            }
            
            bookmarkElement.innerHTML = `
                ${faviconHtml}
                <span class="text-sm font-medium truncate w-full">${bookmark.title}</span>
            `;
            
            // 处理favicon加载失败
            const img = bookmarkElement.querySelector('img');
            if (img) {
                img.addEventListener('error', function() {
                    const firstChar = bookmark.title.charAt(0).toUpperCase();
                    this.outerHTML = `<div class="w-8 h-8 mb-2 rounded-full bg-space-blue flex items-center justify-center font-bold">${firstChar}</div>`;
                });
            }
            
            return bookmarkElement;
        }

        // 渲染编辑中心的书签列表
        function renderEditBookmarksList() {
            const container = document.getElementById('bookmarks-list');
            container.innerHTML = '';
            
            if (appData.bookmarks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p>暂无书签</p>
                    </div>
                `;
                return;
            }
            
            // 按文件夹分组显示
            const bookmarksByFolder = {};
            bookmarksByFolder[''] = [];
            
            appData.folders.forEach(folder => {
                bookmarksByFolder[folder.id] = [];
            });
            
            appData.bookmarks.forEach(bookmark => {
                const folderId = bookmark.folder || '';
                if (bookmarksByFolder[folderId] !== undefined) {
                    bookmarksByFolder[folderId].push(bookmark);
                } else {
                    bookmarksByFolder[''].push(bookmark);
                }
            });
            
            // 先显示无文件夹的书签
            if (bookmarksByFolder[''].length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `<h6 class="text-gray-400 text-sm mb-3">未分类</h6>`;
                
                bookmarksByFolder[''].forEach(bookmark => {
                    const item = createEditBookmarkItem(bookmark);
                    section.appendChild(item);
                });
                
                container.appendChild(section);
            }
            
            // 显示各个文件夹的书签
            appData.folders.forEach(folder => {
                if (bookmarksByFolder[folder.id].length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `<h6 class="text-gray-400 text-sm mb-3">${folder.name}</h6>`;
                    
                    bookmarksByFolder[folder.id].forEach(bookmark => {
                        const item = createEditBookmarkItem(bookmark);
                        section.appendChild(item);
                    });
                    
                    container.appendChild(section);
                }
            });
        }

        // 创建编辑中心的书签项
        function createEditBookmarkItem(bookmark) {
            const folderName = bookmark.folder 
                ? appData.folders.find(f => f.id === bookmark.folder)?.name || ''
                : '未分类';
            
            const item = document.createElement('div');
            item.className = 'bg-space-dark border border-gray-800 rounded-lg p-3 flex items-center justify-between hover:border-gray-700 transition-colors';
            item.innerHTML = `
                <div class="flex-1 min-w-0">
                    <div class="flex items-center">
                        <div class="text-sm text-gray-400 mr-2 px-2 py-0.5 bg-gray-800 rounded">${folderName}</div>
                        <div class="font-medium text-white truncate">${bookmark.title}</div>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${bookmark.url}</div>
                </div>
                <div class="flex items-center space-x-2 ml-4">
                    <button class="edit-bookmark p-1.5 rounded hover:bg-gray-800 transition-colors button-hover-effect" data-id="${bookmark.id}" title="编辑">
                        <i class="fa fa-pencil text-gray-400 hover:text-white"></i>
                    </button>
                    <button class="delete-bookmark p-1.5 rounded hover:bg-gray-800 transition-colors button-hover-effect" data-id="${bookmark.id}" title="删除">
                        <i class="fa fa-trash-o text-gray-400 hover:text-red-500"></i>
                    </button>
                </div>
            `;
            
            return item;
        }

        // 更新文件夹下拉菜单
        function updateFolderSelect() {
            const select = document.getElementById('new-bookmark-folder');
            const currentValue = select.value;
            
            // 保留第一个"无文件夹"选项
            const firstOption = select.options[0];
            select.innerHTML = '';
            select.appendChild(firstOption);
            
            // 添加所有文件夹
            appData.folders.forEach(folder => {
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                select.appendChild(option);
            });
            
            // 恢复之前的值（如果存在）
            if (currentValue && [...select.options].some(o => o.value === currentValue)) {
                select.value = currentValue;
            }
        }

        // 渲染广告
        function renderAds() {
            appData.ads.forEach(ad => {
                const container = document.getElementById(`ad-${ad.id}`);
                container.innerHTML = '';
                
                if (ad.image && ad.url) {
                    container.innerHTML = `
                        <a href="${ad.url}" target="_blank" class="block h-full">
                            <img src="${ad.image}" alt="广告图片 ${ad.id}" class="w-full h-full object-cover">
                        </a>
                    `;
                } else if (ad.image) {
                    container.innerHTML = `
                        <img src="${ad.image}" alt="广告图片 ${ad.id}" class="w-full h-full object-cover">
                    `;
                } else {
                    container.innerHTML = `
                        <div class="absolute inset-0 flex items-center justify-center bg-space-darker/40">
                            <p class="text-gray-500 text-center px-4">广告位 ${ad.id}</p>
                        </div>
                    `;
                }
                
                // 更新编辑中心的广告预览
                const previewContainer = document.getElementById(`ad-${ad.id}-preview`);
                const previewImg = previewContainer ? previewContainer.querySelector('img') : null;
                const urlInput = document.getElementById(`ad-${ad.id}-url`);
                
                if (previewImg && urlInput) {
                    urlInput.value = ad.url || '';
                    
                    if (ad.image) {
                        previewImg.src = ad.image;
                        previewContainer.classList.remove('hidden');
                        document.getElementById(`ad-${ad.id}-upload`).classList.add('hidden');
                    } else {
                        previewContainer.classList.add('hidden');
                        document.getElementById(`ad-${ad.id}-upload`).classList.remove('hidden');
                    }
                }
            });
        }

        // 渲染城市列表（编辑中心）
        function renderCitiesList() {
            const container = document.getElementById('cities-list');
            container.innerHTML = '';
            
            appData.cities.forEach(city => {
                const timezone = appData.cityTimezones[city] || 'UTC';
                const item = document.createElement('div');
                item.className = 'bg-space-dark border border-gray-800 rounded-lg p-3 flex items-center justify-between hover:border-gray-700 transition-colors';
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="font-medium text-white">${city}</div>
                        <div class="text-xs text-gray-500">${timezone}</div>
                    </div>
                    <button class="delete-city p-1.5 rounded hover:bg-gray-800 transition-colors button-hover-effect" data-city="${city}" title="删除">
                        <i class="fa fa-trash-o text-gray-400 hover:text-red-500"></i>
                    </button>
                `;
                
                container.appendChild(item);
            });
        }

        // 更新在线时长
        function updateOnlineDuration() {
            const deployDate = new Date(appData.deployDate);
            const now = new Date();
            const diff = now - deployDate;
            
            // 计算天、时、分、秒
            const seconds = Math.floor((diff / 1000) % 60);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            let durationText = '';
            if (days > 0) {
                durationText = `${days}天 ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                durationText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            document.getElementById('online-duration').textContent = durationText;
        }

        // 更新健康提醒
        function updateHealthReminder() {
            const hour = new Date().getHours();
            let reminder = '';
            
            if (hour >= 6 && hour < 9) {
                reminder = '早上好！开始新的一天探索吧';
            } else if (hour >= 9 && hour < 12) {
                reminder = '上午好！记得定时休息眼睛';
            } else if (hour >= 12 && hour < 14) {
                reminder = '午餐时间，补充能量继续探索';
            } else if (hour >= 14 && hour < 17) {
                reminder = '下午好！站起来活动一下吧';
            } else if (hour >= 17 && hour < 19) {
                reminder = '傍晚了，整理一下今天的发现';
            } else if (hour >= 19 && hour < 22) {
                reminder = '晚上好！享受轻松的浏览时光';
            } else {
                reminder = '夜深了，注意休息，明天再继续探索';
            }
            
            document.querySelector('#health-reminder p:first-child').textContent = reminder;
        }

        // 更新页脚信息
        function updateFooter() {
            const year = new Date().getFullYear();
            const hostname = window.location.hostname;
            document.getElementById('copyright').textContent = `Copyright © 2018-${year} ${hostname}, All Rights Reserved`;
        }

        // 初始化编辑中心
        function initEditCenter() {
            // 渲染城市列表
            renderCitiesList();
            
            // 渲染广告预览
            appData.ads.forEach(ad => {
                if (ad.image) {
                    const previewContainer = document.getElementById(`ad-${ad.id}-preview`);
                    const previewImg = previewContainer.querySelector('img');
                    if (previewImg) {
                        previewImg.src = ad.image;
                        previewContainer.classList.remove('hidden');
                        document.getElementById(`ad-${ad.id}-upload`).classList.add('hidden');
                    }
                }
            });
        }

        // 显示通知
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const titleElement = document.getElementById('notification-title');
            const messageElement = document.getElementById('notification-message');
            const iconElement = document.getElementById('notification-icon');
            
            titleElement.textContent = title;
            messageElement.textContent = message;
            
            // 设置图标
            let icon = '';
            switch (type) {
                case 'success':
                    icon = '<i class="fa fa-check-circle text-green-500"></i>';
                    break;
                case 'error':
                    icon = '<i class="fa fa-exclamation-circle text-red-500"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fa fa-exclamation-triangle text-yellow-500"></i>';
                    break;
                default:
                    icon = '<i class="fa fa-info-circle text-blue-500"></i>';
            }
            iconElement.innerHTML = icon;
            
            // 显示通知
            notification.classList.remove('hidden', 'translate-y-20', 'opacity-0');
            notification.classList.add('translate-y-0', 'opacity-100');
            
            // 3秒后自动关闭
            setTimeout(() => {
                closeNotification();
            }, 3000);
        }

        // 关闭通知
        function closeNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('translate-y-0', 'opacity-100');
            notification.classList.add('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 300);
        }

        // 显示加载动画
        function showLoading() {
            const loading = document.getElementById('edit-loading');
            if (loading) {
                loading.classList.remove('hidden');
            }
        }

        // 隐藏加载动画
        function hideLoading() {
            const loading = document.getElementById('edit-loading');
            if (loading) {
                loading.classList.add('hidden');
            }
        }

        // 显示确认对话框
        function showConfirmDialog(title, message, confirmCallback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-modal').classList.remove('hidden');
            
            // 设置确认回调
            const okButton = document.getElementById('confirm-ok');
            // 移除之前的事件监听，防止多次触发
            okButton.removeEventListener('click', okButton._clickHandler);
            okButton._clickHandler = async function() {
                document.getElementById('confirm-modal').classList.add('hidden');
                if (confirmCallback) {
                    try {
                        await confirmCallback();
                    } catch (error) {
                        console.error("确认操作失败:", error);
                        showNotification('操作失败', error.message, 'error');
                    }
                }
            };
            okButton.addEventListener('click', okButton._clickHandler);
        }

        // 处理广告上传点击
        function handleAdUploadClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const adId = this.id.split('-')[1];
            const fileInput = document.getElementById(`ad-${adId}-file`);
            if (fileInput) {
                fileInput.click();
            }
        }

        // 处理广告文件选择
        function handleAdFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // 检查文件大小
            if (file.size > 3 * 1024 * 1024) {
                showNotification('错误', '文件大小不能超过3MB', 'error');
                return;
            }
            
            // 检查文件类型
            if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                showNotification('错误', '只支持JPG和PNG格式', 'error');
                return;
            }
            
            const adId = e.target.id.split('-')[1];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                // 更新广告数据
                const adIndex = appData.ads.findIndex(a => a.id === parseInt(adId));
                if (adIndex !== -1) {
                    appData.ads[adIndex].image = event.target.result;
                    
                    // 更新预览
                    const previewContainer = document.getElementById(`ad-${adId}-preview`);
                    const previewImg = previewContainer.querySelector('img');
                    previewImg.src = event.target.result;
                    previewContainer.classList.remove('hidden');
                    document.getElementById(`ad-${adId}-upload`).classList.add('hidden');
                    
                    // 更新主页面广告
                    renderAds();
                }
            };
            
            reader.readAsDataURL(file);
            
            // 重置输入，允许重复选择同一文件
            e.target.value = '';
        }

        // 处理移除广告图片
        function handleRemoveAd(e) {
            e.preventDefault();
            const adId = parseInt(this.getAttribute('data-ad'));
            
            // 更新广告数据
            const adIndex = appData.ads.findIndex(a => a.id === adId);
            if (adIndex !== -1) {
                appData.ads[adIndex].image = '';
                
                // 更新预览
                const previewContainer = document.getElementById(`ad-${adId}-preview`);
                previewContainer.classList.add('hidden');
                document.getElementById(`ad-${adId}-upload`).classList.remove('hidden');
                
                // 更新主页面广告
                renderAds();
                
                showNotification('成功', '广告图片已移除', 'success');
            }
        }

        // 导入书签
        function importBookmarks(file) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(event.target.result, 'text/html');
                    const bookmarkElements = doc.querySelectorAll('a');
                    
                    if (bookmarkElements.length === 0) {
                        showNotification('警告', '未找到书签数据', 'warning');
                        return;
                    }
                    
                    // 提取文件夹结构
                    const folders = {};
                    let currentFolder = null;
                    
                    // 先处理所有DT和H3元素来识别文件夹
                    const allElements = doc.querySelectorAll('dt, h3');
                    allElements.forEach(el => {
                        if (el.tagName === 'H3') {
                            // 这是一个文件夹
                            const folderName = el.textContent.trim();
                            const folderId = 'folder_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            currentFolder = { id: folderId, name: folderName };
                            folders[folderId] = currentFolder;
                        } else if (el.tagName === 'DT' && el.firstElementChild && el.firstElementChild.tagName === 'A') {
                            // 这是一个书签，但我们暂时只关心文件夹结构
                        } else if (el.tagName === 'DT' && el.firstElementChild && el.firstElementChild.tagName === 'DL') {
                            // 文件夹结束
                            currentFolder = null;
                        }
                    });
                    
                    // 将新文件夹添加到应用数据（去重）
                    Object.values(folders).forEach(folder => {
                        if (!appData.folders.some(f => f.name === folder.name)) {
                            appData.folders.push(folder);
                        }
                    });
                    
                    // 提取书签
                    const newBookmarks = [];
                    allElements.forEach(el => {
                        if (el.tagName === 'DT' && el.firstElementChild && el.firstElementChild.tagName === 'A') {
                            const aTag = el.firstElementChild;
                            const title = aTag.textContent.trim() || '无标题';
                            const url = aTag.getAttribute('href') || '';
                            
                            if (url) {
                                // 查找对应的文件夹
                                let folderId = '';
                                if (currentFolder) {
                                    // 检查是否已存在同名文件夹
                                    const existingFolder = appData.folders.find(f => f.name === currentFolder.name);
                                    folderId = existingFolder ? existingFolder.id : currentFolder.id;
                                }
                                
                                // 去重检查
                                const isDuplicate = appData.bookmarks.some(b => 
                                    b.url.toLowerCase() === url.toLowerCase()
                                );
                                
                                if (!isDuplicate) {
                                    newBookmarks.push({
                                        id: 'bookmark_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                                        title: title,
                                        url: url,
                                        folder: folderId
                                    });
                                }
                            }
                        }
                    });
                    
                    // 添加新书签
                    appData.bookmarks = [...appData.bookmarks, ...newBookmarks];
                    
                    // 更新界面
                    renderBookmarks();
                    updateFolderSelect();
                    
                    showNotification('成功', `已导入 ${newBookmarks.length} 个新书签`, 'success');
                } catch (error) {
                    console.error('导入书签失败:', error);
                    showNotification('错误', '导入书签失败，请检查文件格式', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // 导出书签
        function exportBookmarks() {
            if (appData.bookmarks.length === 0) {
                showNotification('警告', '没有书签可导出', 'warning');
                return;
            }
            
            // 创建HTML书签文件内容
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            // 先处理有文件夹的书签
            appData.folders.forEach(folder => {
                const folderBookmarks = appData.bookmarks.filter(b => b.folder === folder.id);
                if (folderBookmarks.length > 0) {
                    html += `<DT><H3>${folder.name}</H3>
<DL><p>`;
                    
                    folderBookmarks.forEach(bookmark => {
                        html += `<DT><A HREF="${bookmark.url}">${bookmark.title}</A>`;
                    });
                    
                    html += `</DL><p>`;
                }
            });
            
            // 处理无文件夹的书签
            const uncategorizedBookmarks = appData.bookmarks.filter(b => !b.folder);
            if (uncategorizedBookmarks.length > 0) {
                html += `<DT><H3>未分类</H3>
<DL><p>`;
                
                uncategorizedBookmarks.forEach(bookmark => {
                    html += `<DT><A HREF="${bookmark.url}">${bookmark.title}</A>`;
                });
                
                html += `</DL><p>`;
            }
            
            html += `</DL>`;
            
            // 创建下载链接
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `星际书签_${new Date().toLocaleDateString()}.html`;
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
            
            showNotification('成功', `已导出 ${appData.bookmarks.length} 个书签`, 'success');
        }

        // 设置事件监听 - 确保所有DOM元素加载完成后再绑定
        function setupEventListeners() {
            // 检查关键元素是否存在
            const criticalElements = [
                'theme-toggle', 'settings-btn', 'close-settings', 
                'enter-edit-center', 'close-edit-center', 'save-github-settings',
                'validate-github-token', 'toggle-token-visibility', 'save-changes'
            ];
            
            criticalElements.forEach(id => {
                const el = document.getElementById(id);
                if (!el) {
                    console.warn(`元素 ${id} 未找到，可能导致功能异常`);
                }
            });

            // 主题切换
            document.getElementById('theme-toggle')?.addEventListener('click', function() {
                appData.settings.darkMode = !appData.settings.darkMode;
                saveLocalSettings();
                
                if (appData.settings.darkMode) {
                    document.documentElement.classList.add('dark');
                    this.innerHTML = '<i class="fa fa-moon-o text-space-glow"></i>';
                } else {
                    document.documentElement.classList.remove('dark');
                    this.innerHTML = '<i class="fa fa-sun-o text-space-glow"></i>';
                }
            });
            
            // 设置按钮
            document.getElementById('settings-btn')?.addEventListener('click', function() {
                document.getElementById('settings-modal').classList.remove('hidden');
            });
            
            // 关闭设置
            document.getElementById('close-settings')?.addEventListener('click', function() {
                document.getElementById('settings-modal').classList.add('hidden');
            });
            
            // 进入编辑中心
            document.getElementById('enter-edit-center')?.addEventListener('click', function() {
                document.getElementById('settings-modal').classList.add('hidden');
                document.getElementById('edit-center-modal').classList.remove('hidden');
            });
            
            // 关闭编辑中心
            document.getElementById('close-edit-center')?.addEventListener('click', function() {
                document.getElementById('edit-center-modal').classList.add('hidden');
            });
            
            // 编辑中心标签切换
            document.querySelectorAll('.edit-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // 移除所有标签的活动状态
                    document.querySelectorAll('.edit-tab').forEach(t => t.classList.remove('active', 'bg-space-dark', 'text-space-glow'));
                    
                    // 添加当前标签的活动状态
                    this.classList.add('active', 'bg-space-dark', 'text-space-glow');
                    
                    // 隐藏所有内容
                    document.querySelectorAll('.edit-content').forEach(content => content.classList.add('hidden'));
                    
                    // 显示当前内容
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.remove('hidden');
                });
            });
            
            // 保存GitHub设置
            document.getElementById('save-github-settings')?.addEventListener('click', function() {
                appData.github.username = document.getElementById('github-username').value.trim();
                appData.github.repo = document.getElementById('github-repo').value.trim();
                
                // 只在有变化时更新token
                const newToken = document.getElementById('github-token').value;
                if (newToken) {
                    appData.github.token = newToken;
                }
                
                saveLocalSettings();
                showNotification('成功', 'GitHub设置已保存', 'success');
            });
            
            // 验证GitHub令牌
            document.getElementById('validate-github-token')?.addEventListener('click', async function() {
                const token = document.getElementById('github-token').value;
                
                if (!token) {
                    showNotification('错误', '请输入GitHub令牌', 'error');
                    return;
                }
                
                const result = await validateGitHubToken(token);
                const statusElement = document.getElementById('github-validation-status');
                
                statusElement.classList.remove('hidden', 'bg-green-900/30', 'text-green-400', 'bg-red-900/30', 'text-red-400');
                
                if (result.valid) {
                    appData.github.validated = true;
                    appData.github.token = token;
                    saveLocalSettings();
                    updateEditFeaturesStatus();
                    
                    statusElement.classList.add('bg-green-900/30', 'text-green-400');
                    statusElement.innerHTML = `<i class="fa fa-check-circle mr-1"></i>${result.message}`;
                } else {
                    appData.github.validated = false;
                    saveLocalSettings();
                    updateEditFeaturesStatus();
                    
                    statusElement.classList.add('bg-red-900/30', 'text-red-400');
                    statusElement.innerHTML = `<i class="fa fa-times-circle mr-1"></i>${result.message}`;
                }
            });
            
            // 切换令牌可见性
            document.getElementById('toggle-token-visibility')?.addEventListener('click', function() {
                const tokenInput = document.getElementById('github-token');
                if (tokenInput) {
                    const type = tokenInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    tokenInput.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fa fa-eye"></i>' : '<i class="fa fa-eye-slash"></i>';
                }
            });
            
            // 关闭通知
            document.getElementById('close-notification')?.addEventListener('click', closeNotification);
            
            // 确认对话框取消
            document.getElementById('confirm-cancel')?.addEventListener('click', function() {
                document.getElementById('confirm-modal').classList.add('hidden');
            });
            
            // 保存更改
            document.getElementById('save-changes')?.addEventListener('click', async function() {
                showConfirmDialog('保存更改', '确定要保存所有更改并同步到GitHub吗？', async () => {
                    // 更新广告链接
                    appData.ads.forEach(ad => {
                        const urlInput = document.getElementById(`ad-${ad.id}-url`);
                        if (urlInput) {
                            ad.url = urlInput.value.trim();
                        }
                    });
                    
                    // 保存到GitHub
                    const success = await saveDataToGitHub();
                    if (success) {
                        // 更新主页面
                        renderBookmarks();
                        renderWorldClock();
                        renderAds();
                    }
                });
            });
            
            // 添加书签
            document.getElementById('add-bookmark')?.addEventListener('click', function() {
                const folder = document.getElementById('new-bookmark-folder').value;
                const title = document.getElementById('new-bookmark-title').value.trim();
                const url = document.getElementById('new-bookmark-url').value.trim();
                
                if (!title || !url) {
                    showNotification('错误', '标题和URL不能为空', 'error');
                    return;
                }
                
                // 检查URL格式
                try {
                    new URL(url);
                } catch (e) {
                    // 尝试添加http://前缀
                    try {
                        new URL('http://' + url);
                        url = 'http://' + url;
                    } catch (e2) {
                        showNotification('错误', 'URL格式无效', 'error');
                        return;
                    }
                }
                
                // 检查重复
                const isDuplicate = appData.bookmarks.some(b => 
                    b.url.toLowerCase() === url.toLowerCase()
                );
                
                if (isDuplicate) {
                    showNotification('警告', '该URL已存在', 'warning');
                    return;
                }
                
                // 添加新书签
                appData.bookmarks.push({
                    id: 'bookmark_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: title,
                    url: url,
                    folder: folder
                });
                
                // 清空表单
                document.getElementById('new-bookmark-title').value = '';
                document.getElementById('new-bookmark-url').value = '';
                
                // 更新界面
                renderBookmarks();
                
                showNotification('成功', '书签已添加', 'success');
            });
            
            // 添加文件夹
            document.getElementById('add-folder')?.addEventListener('click', function() {
                const name = document.getElementById('new-folder-name').value.trim();
                
                if (!name) {
                    showNotification('错误', '文件夹名称不能为空', 'error');
                    return;
                }
                
                // 检查重复
                if (appData.folders.some(f => f.name === name)) {
                    showNotification('警告', '该文件夹已存在', 'warning');
                    return;
                }
                
                // 添加新文件夹
                appData.folders.push({
                    id: 'folder_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name
                });
                
                // 清空表单
                document.getElementById('new-folder-name').value = '';
                
                // 更新界面
                updateFolderSelect();
                renderBookmarks();
                
                showNotification('成功', '文件夹已添加', 'success');
            });
            
            // 导入书签
            document.getElementById('import-bookmarks')?.addEventListener('click', function() {
                const fileInput = document.getElementById('bookmarks-file-input');
                if (fileInput) {
                if (fileInput) {
                    fileInput.click();
                }
            });
            
            // 处理书签文件选择
            document.getElementById('bookmarks-file-input')?.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    importBookmarks(file);
                }
                
                // 重置输入，允许重复选择同一文件
                this.value = '';
            });
            
            // 导出书签
            document.getElementById('export-bookmarks')?.addEventListener('click', exportBookmarks);
            
            // 添加城市
            document.getElementById('add-city')?.addEventListener('click', function() {
                const name = document.getElementById('new-city-name').value.trim();
                const timezone = document.getElementById('new-city-timezone').value.trim();
                
                if (!name || !timezone) {
                    showNotification('错误', '城市名称和时区不能为空', 'error');
                    return;
                }
                
                // 检查重复
                if (appData.cities.includes(name)) {
                    showNotification('警告', '该城市已存在', 'warning');
                    return;
                }
                
                // 添加新城市
                appData.cities.push(name);
                appData.cityTimezones[name] = timezone;
                
                // 清空表单
                document.getElementById('new-city-name').value = '';
                document.getElementById('new-city-timezone').value = '';
                
                // 更新界面
                renderCitiesList();
                renderWorldClock();
                
                showNotification('成功', '城市已添加', 'success');
            });
            
            // 广告上传区域点击
            document.querySelectorAll('[id$="-upload"]').forEach(area => {
                area.addEventListener('click', handleAdUploadClick);
            });
            
            // 广告文件选择
            document.querySelectorAll('[id^="ad-"][id$="-file"]').forEach(input => {
                input.addEventListener('change', handleAdFileSelect);
            });
            
            // 移除广告图片
            document.querySelectorAll('[id^="remove-ad-"]').forEach(button => {
                button.addEventListener('click', handleRemoveAd);
            });
            
            // 搜索书签
            const searchInputs = [
                document.getElementById('search-input'),
                document.getElementById('mobile-search-input')
            ];
            
            searchInputs.forEach(input => {
                if (input) {
                    input.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase().trim();
                        const bookmarkElements = document.querySelectorAll('#bookmarks-container a');
                        
                        bookmarkElements.forEach(el => {
                            const title = el.querySelector('span').textContent.toLowerCase();
                            const url = el.href.toLowerCase();
                            
                            if (title.includes(searchTerm) || url.includes(searchTerm)) {
                                el.style.display = '';
                                el.closest('.folder-content').style.display = '';
                                el.closest('.folder-content').previousElementSibling.style.display = '';
                            } else {
                                el.style.display = 'none';
                                
                                // 检查文件夹是否还有可见书签
                                const folderContent = el.closest('.folder-content');
                                const visibleBookmarks = folderContent.querySelectorAll('a:not([style*="display: none"])');
                                
                                if (visibleBookmarks.length === 0) {
                                    folderContent.style.display = 'none';
                                    folderContent.previousElementSibling.style.display = 'none';
                                }
                            }
                        });
                    });
                }
            });
            
            // 文件夹折叠/展开
            document.addEventListener('click', function(e) {
                if (e.target.closest('.folder-toggle')) {
                    const toggle = e.target.closest('.folder-toggle');
                    const folderId = toggle.getAttribute('data-folder');
                    const content = document.querySelector(`.folder-content[data-folder="${folderId}"]`);
                    const icon = toggle.querySelector('i');
                    
                    if (content.style.display === 'none') {
                        content.style.display = '';
                        icon.classList.remove('folder-closed');
                        icon.classList.add('folder-open');
                    } else {
                        content.style.display = 'none';
                        icon.classList.remove('folder-open');
                        icon.classList.add('folder-closed');
                    }
                }
            });
            
            // 删除书签
            document.addEventListener('click', function(e) {
                if (e.target.closest('.delete-bookmark')) {
                    const button = e.target.closest('.delete-bookmark');
                    const bookmarkId = button.getAttribute('data-id');
                    const bookmark = appData.bookmarks.find(b => b.id === bookmarkId);
                    
                    if (bookmark) {
                        showConfirmDialog('删除书签', `确定要删除书签"${bookmark.title}"吗？`, () => {
                            // 从数组中移除书签
                            appData.bookmarks = appData.bookmarks.filter(b => b.id !== bookmarkId);
                            
                            // 更新界面
                            renderBookmarks();
                            
                            showNotification('成功', '书签已删除', 'success');
                        });
                    }
                }
            });
            
            // 删除城市
            document.addEventListener('click', function(e) {
                if (e.target.closest('.delete-city')) {
                    const button = e.target.closest('.delete-city');
                    const city = button.getAttribute('data-city');
                    
                    if (city) {
                        showConfirmDialog('删除城市', `确定要删除城市"${city}"吗？`, () => {
                            // 从数组中移除城市
                            appData.cities = appData.cities.filter(c => c !== city);
                            delete appData.cityTimezones[city];
                            
                            // 更新界面
                            renderCitiesList();
                            renderWorldClock();
                            
                            showNotification('成功', '城市已删除', 'success');
                        });
                    }
                }
            });
            
            // 导航栏自动隐藏
            let lastScrollTop = 0;
            let scrollTimer;
            const navbar = document.getElementById('navbar');
            
            if (navbar) {
                window.addEventListener('scroll', function() {
                    // 显示导航栏
                    navbar.classList.remove('translate-y-[-100%]');
                    
                    // 清除之前的定时器
                    clearTimeout(scrollTimer);
                    
                    // 设置新的定时器，3秒后隐藏导航栏
                    scrollTimer = setTimeout(() => {
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        
                        // 只在页面顶部以下时隐藏
                        if (scrollTop > 100) {
                            navbar.classList.add('translate-y-[-100%]');
                        }
                        
                        lastScrollTop = scrollTop;
                    }, 3000);
                });
            }
        }

        // 启动定时任务
        function startTimers() {
            // 每秒更新时钟和在线时长
            setInterval(() => {
                renderWorldClock();
                updateOnlineDuration();
            }, 1000);
            
            // 每小时更新健康提醒
            setInterval(updateHealthReminder, 3600000);
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    