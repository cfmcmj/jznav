<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 宇宙书签</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%230f172a'/%3E%3Ccircle cx='50' cy='50' r='20' fill='%238b5cf6'/%3E%3Ccircle cx='50' cy='35' r='4' fill='white'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            black: '#070a13',
                            dark: '#0f172a',
                            medium: '#1e293b',
                            light: '#334155',
                            accent: '#8b5cf6',
                            glow: '#a78bfa',
                            star: '#e2e8f0'
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif']
                    },
                    animation: {
                        'pulse-slow': 'pulse 6s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 8s ease-in-out infinite',
                        'twinkle': 'twinkle 4s ease-in-out infinite',
                        'rotate': 'rotate 30s linear infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 0.6 },
                            '50%': { opacity: 1 }
                        },
                        rotate: {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .star { position: absolute; background-color: white; border-radius: 50%; animation: twinkle 2s infinite; }
            .planet { border-radius: 50%; position: absolute; background: radial-gradient(circle at 30% 30%, var(--tw-gradient-stops)); }
            .text-shadow { text-shadow: 0 0 8px rgba(167, 139, 250, 0.6); }
            .card-hover { transition: all 0.3s ease; }
            .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4); }
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 dark:from-space-black dark:to-space-dark text-slate-800 dark:text-slate-100 min-h-screen transition-colors duration-500 relative overflow-x-hidden">
    <div id="stars" class="fixed inset-0 z-0 pointer-events-none"></div>
    <div class="container mx-auto px-4 relative z-10">
        <header id="header" class="py-4 transition-all duration-500">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-space-accent to-space-glow flex items-center justify-center shadow-lg shadow-space-accent/20">
                        <i class="fa fa-compass text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-space font-bold text-shadow">星际导航</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-space-medium transition-colors">
                        <i class="fa fa-moon-o dark:hidden text-xl"></i>
                        <i class="fa fa-sun-o hidden dark:block text-xl text-yellow-300"></i>
                    </button>
                    <button id="settings-btn" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-space-medium transition-colors">
                        <i class="fa fa-cog text-xl"></i>
                    </button>
                    <button id="edit-btn" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-space-medium transition-colors hidden">
                        <i class="fa fa-pencil text-xl"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <div id="widgets" class="flex flex-wrap gap-4 my-6 bg-white/80 dark:bg-space-medium/30 backdrop-blur-sm rounded-xl p-4 shadow-lg">
            <div class="flex-1 min-w-[200px] p-3 rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-space-dark/50 dark:to-space-medium/50">
                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">航行时间</h3>
                <div class="flex items-center">
                    <i class="fa fa-clock-o text-space-accent mr-2"></i>
                    <span id="online-time" class="font-space text-lg"></span>
                </div>
            </div>
            <div class="flex-1 min-w-[200px] p-3 rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 dark:from-space-dark/50 dark:to-space-medium/50">
                <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">星际提示</h3>
                <div class="flex items-center">
                    <i class="fa fa-heartbeat text-pink-500 mr-2"></i>
                    <span id="health-reminder" class="font-medium"></span>
                </div>
            </div>
            <div class="flex-1 min-w-[200px] p-3 rounded-lg bg-gradient-to-br from-green-50 to-teal-50 dark:from-space-dark/50 dark:to-space-medium/50">
                <div class="flex justify-between items-center mb-1">
                    <h3 class="text-sm font-medium text-slate-500 dark:text-slate-400">星际时间</h3>
                    <button id="add-timezone" class="text-xs text-space-accent hover:underline hidden">
                        <i class="fa fa-plus-circle"></i>
                    </button>
                </div>
                <div id="timezones-container" class="space-y-1 max-h-20 overflow-y-auto scrollbar-hide">
                </div>
            </div>
        </div>
        
        <div id="ad-1" class="my-6 rounded-xl overflow-hidden shadow-xl relative group">
            <div class="aspect-video bg-slate-200 dark:bg-slate-700 flex items-center justify-center">
                <img src="https://picsum.photos/1200/400?random=1" alt="广告图片" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
                    <a href="#" class="w-full p-4 text-white font-medium"></a>
                </div>
            </div>
        </div>
        
        <div id="bookmarks-container" class="my-8 space-y-6">
            <div class="text-center py-10 text-slate-400 dark:text-slate-500">
                <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                <p>暂无书签，请在编辑页面添加</p>
            </div>
        </div>
        
        <div id="ad-2" class="my-6 rounded-xl overflow-hidden shadow-xl relative group">
            <div class="aspect-video bg-slate-200 dark:bg-slate-700 flex items-center justify-center">
                <img src="https://picsum.photos/1200/400?random=2" alt="广告图片" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
                    <a href="#" class="w-full p-4 text-white font-medium"></a>
                </div>
            </div>
        </div>
        
        <div id="ad-3" class="my-6 rounded-xl overflow-hidden shadow-xl relative group">
            <div class="aspect-video bg-slate-200 dark:bg-slate-700 flex items-center justify-center">
                <img src="https://picsum.photos/1200/400?random=3" alt="广告图片" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
                    <a href="#" class="w-full p-4 text-white font-medium"></a>
                </div>
            </div>
        </div>
        
        <footer class="mt-12 py-6 border-t border-slate-200 dark:border-slate-700">
            <div class="dark-white flex flex-col md:flex-row justify-between items-center gap-4">
                <div id="total-sites" class="text-slate-500 dark:text-slate-400">共收录 0 个网站</div>
                <div class="text-slate-500 dark:text-slate-400">
                    Copyright © 2018-<span id="current-year"></span> <span id="hostname">星际导航</span>, All Rights Reserved
                </div>
            </div>
        </footer>
    </div>
    
    <div id="edit-page" class="fixed inset-0 bg-white dark:bg-space-dark z-50 transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-space font-bold">书签编辑中心</h2>
                <button id="close-edit" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-space-medium transition-colors">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-10">
                <h3 class="text-xl font-space font-semibold mb-4 flex items-center">
                    <i class="fa fa-bookmark text-space-accent mr-2"></i>书签管理
                </h3>
                
                <div class="flex flex-wrap gap-3 mb-6">
                    <button id="import-bookmarks" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors flex items-center">
                        <i class="fa fa-upload mr-2"></i>导入书签
                    </button>
                    <input type="file" id="bookmark-file" accept=".html" class="hidden">
                    
                    <button id="export-bookmarks" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors flex items-center">
                        <i class="fa fa-download mr-2"></i>导出书签
                    </button>
                    
                    <button id="add-bookmark-group" class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors flex items-center">
                        <i class="fa fa-folder-open mr-2"></i>添加书签组
                    </button>
                    
                    <button id="save-changes" class="px-4 py-2 bg-space-accent hover:bg-space-glow text-white rounded-lg transition-colors flex items-center ml-auto">
                        <i class="fa fa-save mr-2"></i>保存更改
                    </button>
                </div>
                
                <div id="edit-bookmarks-container" class="space-y-6 max-h-[500px] overflow-y-auto p-2 scrollbar-hide">
                </div>
                
                <div class="mt-4 text-sm text-slate-500 dark:text-slate-400">
                    <span id="bookmark-count">共 0 个书签</span>
                </div>
            </div>
            
            <div class="mb-10">
                <h3 class="text-xl font-space font-semibold mb-4 flex items-center">
                    <i class="fa fa-bullhorn text-space-accent mr-2"></i>广告管理
                </h3>
                
                <div class="space-y-6">
                    <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
                        <h4 class="font-medium mb-3">广告位 1</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-1">
                                <div class="aspect-video bg-slate-100 dark:bg-slate-800 rounded overflow-hidden flex items-center justify-center">
                                    <img id="ad1-preview" src="https://picsum.photos/300/200?random=1" alt="广告预览" class="w-full h-full object-cover">
                                </div>
                                <input type="file" id="ad1-upload" accept="image/*" class="mt-2 w-full">
                            </div>
                            <div class="md:col-span-2 space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">广告链接</label>
                                    <input type="url" id="ad1-url" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-medium focus:outline-none focus:ring-2 focus:ring-space-accent" placeholder="https://example.com">
                                </div>
                                <button class="delete-ad-btn px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm" data-ad="1">
                                    <i class="fa fa-trash mr-1"></i>删除广告
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
                        <h4 class="font-medium mb-3">广告位 2</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-1">
                                <div class="aspect-video bg-slate-100 dark:bg-slate-800 rounded overflow-hidden flex items-center justify-center">
                                    <img id="ad2-preview" src="https://picsum.photos/300/200?random=2" alt="广告预览" class="w-full h-full object-cover">
                                </div>
                                <input type="file" id="ad2-upload" accept="image/*" class="mt-2 w-full">
                            </div>
                            <div class="md:col-span-2 space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">广告链接</label>
                                    <input type="url" id="ad2-url" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-medium focus:outline-none focus:ring-2 focus:ring-space-accent" placeholder="https://example.com">
                                </div>
                                <button class="delete-ad-btn px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm" data-ad="2">
                                    <i class="fa fa-trash mr-1"></i>删除广告
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
                        <h4 class="font-medium mb-3">广告位 3</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-1">
                                <div class="aspect-video bg-slate-100 dark:bg-slate-800 rounded overflow-hidden flex items-center justify-center">
                                    <img id="ad3-preview" src="https://picsum.photos/300/200?random=3" alt="广告预览" class="w-full h-full object-cover">
                                </div>
                                <input type="file" id="ad3-upload" accept="image/*" class="mt-2 w-full">
                            </div>
                            <div class="md:col-span-2 space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">广告链接</label>
                                    <input type="url" id="ad3-url" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-medium focus:outline-none focus:ring-2 focus:ring-space-accent" placeholder="https://example.com">
                                </div>
                                <button class="delete-ad-btn px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm" data-ad="3">
                                    <i class="fa fa-trash mr-1"></i>删除广告
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mb-10">
                <h3 class="text-xl font-space font-semibold mb-4 flex items-center">
                    <i class="fa fa-clock-o text-space-accent mr-2"></i>时区管理
                </h3>
                
                <div class="flex mb-4">
                    <input type="text" id="new-timezone-name" placeholder="时区名称" class="px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-l-md bg-white dark:bg-space-medium focus:outline-none focus:ring-2 focus:ring-space-accent w-40">
                    <input type="text" id="new-timezone-offset" placeholder="UTC偏移 (例如: +8)" class="px-3 py-2 border-y border-slate-300 dark:border-slate-600 bg-white dark:bg-space-medium focus:outline-none focus:ring-2 focus:ring-space-accent w-32">
                    <button id="save-timezone" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-r-md transition-colors">
                        添加
                    </button>
                </div>
                
                <div id="timezones-edit-container" class="space-y-2 max-h-[300px] overflow-y-auto p-2 scrollbar-hide">
                </div>
            </div>
            
            <div id="status-message" class="fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
                <i id="status-icon" class="mr-2"></i>
                <span id="status-text"></span>
            </div>
        </div>
    </div>
    
    <div id="settings-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white dark:bg-space-medium rounded-xl p-6 w-full max-w-md transform scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-space font-bold">GitHub 设置</h3>
                <button id="close-settings" class="p-1 hover:bg-slate-200 dark:hover:bg-space-dark rounded-full">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">GitHub 仓库 (owner/repo)</label>
                    <input type="text" id="github-repo" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-dark focus:outline-none focus:ring-2 focus:ring-space-accent" placeholder="username/repository">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">GitHub 令牌 (可选，用于私有仓库)</label>
                    <input type="password" id="github-token" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-dark focus:outline-none focus:ring-2 focus:ring-space-accent" placeholder="ghp_...">
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">仅需要 repo 权限的个人访问令牌</p>
                </div>
                
                <div class="pt-2">
                    <button id="save-settings" class="w-full px-4 py-2 bg-space-accent hover:bg-space-glow text-white rounded-lg transition-colors">
                        保存并验证
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="confirm-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white dark:bg-space-medium rounded-xl p-6 w-full max-w-md transform scale-95 transition-transform duration-300">
            <h3 class="text-xl font-medium mb-4" id="confirm-title">确认操作</h3>
            <p class="text-slate-600 dark:text-slate-300 mb-6" id="confirm-message">您确定要执行此操作吗？</p>
            
            <div class="flex justify-end space-x-3">
                <button id="cancel-confirm" class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-space-dark transition-colors">
                    取消
                </button>
                <button id="confirm-action" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                    确认
                </button>
            </div>
        </div>
    </div>
    
    <script>
        let appData = { bookmarks: [], ads: [], timezones: [] };
        const DEFAULT_REPO = "{{DEFAULT_REPO}}";
        const DEFAULT_RAW_URL = "{{DEFAULT_RAW_URL}}";
        let isGitHubVerified = false;
        
        const themeToggle = document.getElementById('theme-toggle');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const saveSettings = document.getElementById('save-settings');
        const githubRepoInput = document.getElementById('github-repo');
        const githubTokenInput = document.getElementById('github-token');
        const editPage = document.getElementById('edit-page');
        const editBtn = document.getElementById('edit-btn');
        const closeEdit = document.getElementById('close-edit');
        const importBookmarksBtn = document.getElementById('import-bookmarks');
        const bookmarkFileInput = document.getElementById('bookmark-file');
        const exportBookmarksBtn = document.getElementById('export-bookmarks');
        const addBookmarkGroupBtn = document.getElementById('add-bookmark-group');
        const saveChangesBtn = document.getElementById('save-changes');
        const editBookmarksContainer = document.getElementById('edit-bookmarks-container');
        const bookmarksContainer = document.getElementById('bookmarks-container');
        const bookmarkCountEl = document.getElementById('bookmark-count');
        const totalSitesEl = document.getElementById('total-sites');
        const currentYearEl = document.getElementById('current-year');
        const hostnameEl = document.getElementById('hostname');
        const confirmModal = document.getElementById('confirm-modal');
        const confirmTitle = document.getElementById('confirm-title');
        const confirmMessage = document.getElementById('confirm-message');
        const cancelConfirm = document.getElementById('cancel-confirm');
        const confirmAction = document.getElementById('confirm-action');
        const statusMessage = document.getElementById('status-message');
        const statusIcon = document.getElementById('status-icon');
        const statusText = document.getElementById('status-text');
        const addTimezoneBtn = document.getElementById('add-timezone');
        const newTimezoneNameInput = document.getElementById('new-timezone-name');
        const newTimezoneOffsetInput = document.getElementById('new-timezone-offset');
        const saveTimezoneBtn = document.getElementById('save-timezone');
        const timezonesContainer = document.getElementById('timezones-container');
        const timezonesEditContainer = document.getElementById('timezones-edit-container');
        const onlineTimeEl = document.getElementById('online-time');
        const healthReminderEl = document.getElementById('health-reminder');
        const headerEl = document.getElementById('header');
        
        const adUploadInputs = {
            1: document.getElementById('ad1-upload'),
            2: document.getElementById('ad2-upload'),
            3: document.getElementById('ad3-upload')
        };
        const adPreviewImages = {
            1: document.getElementById('ad1-preview'),
            2: document.getElementById('ad2-preview'),
            3: document.getElementById('ad3-preview')
        };
        const adUrlInputs = {
            1: document.getElementById('ad1-url'),
            2: document.getElementById('ad2-url'),
            3: document.getElementById('ad3-url')
        };
        const adElements = {
            1: document.getElementById('ad-1'),
            2: document.getElementById('ad-2'),
            3: document.getElementById('ad-3')
        };
        const deleteAdBtns = document.querySelectorAll('.delete-ad-btn');
        
        let confirmCallback = null;
        
        async function init() {
            currentYearEl.textContent = new Date().getFullYear();
            initTheme();
            generateStars();
            loadGitHubSettings();
            await checkGitHubVerification();
            await loadDataFromGitHub();
            renderBookmarks();
            renderAds();
            renderTimezones();
            updateBookmarkCount();
            initOnlineTime();
            initHealthReminder();
            initScrollListener();
            updateHostname();
        }
        
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        function generateStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 200;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const size = Math.random() * 2 + 1;
                const delay = Math.random() * 3;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDelay = `${delay}s`;
                starsContainer.appendChild(star);
            }
            
            addPlanets();
        }
        
        function addPlanets() {
            const starsContainer = document.getElementById('stars');
            
            const planets = [
                { size: 70, top: '10%', right: '15%', colors: ['#f59e0b', '#d97706'], animation: 'float' },
                { size: 40, top: '65%', left: '8%', colors: ['#3b82f6', '#1d4ed8'], animation: 'float 10s ease-in-out infinite' },
                { size: 55, top: '75%', right: '25%', colors: ['#ec4899', '#8b5cf6'], animation: 'rotate' }
            ];
            
            planets.forEach(planet => {
                const planetEl = document.createElement('div');
                planetEl.classList.add('planet', 'opacity-70', 'dark:opacity-40');
                planetEl.style.width = `${planet.size}px`;
                planetEl.style.height = `${planet.size}px`;
                planetEl.style.top = planet.top;
                planetEl.style.right = planet.right || 'auto';
                planetEl.style.left = planet.left || 'auto';
                planetEl.style.setProperty('--tw-gradient-from', planet.colors[0]);
                planetEl.style.setProperty('--tw-gradient-to', planet.colors[1]);
                planetEl.style.animation = planet.animation;
                starsContainer.appendChild(planetEl);
            });
        }
        
        function loadGitHubSettings() {
            const savedRepo = localStorage.getItem('githubRepo');
            const savedToken = localStorage.getItem('githubToken');
            
            if (savedRepo) {
                githubRepoInput.value = savedRepo;
            } else if (DEFAULT_REPO && DEFAULT_REPO !== '{{DEFAULT_REPO}}') {
                githubRepoInput.value = DEFAULT_REPO;
            }
            
            if (savedToken) {
                githubTokenInput.value = savedToken;
            }
        }
        
        async function verifyGitHubSettings(repo, token) {
            try {
                if (!repo || repo === '{{DEFAULT_REPO}}') {
                    return false;
                }
                
                const url = `https://api.github.com/repos/${repo}`;
                const headers = {};
                
                if (token) {
                    headers['Authorization'] = `token ${token}`;
                }
                
                const response = await fetch(url, { headers });
                return response.ok;
            } catch (error) {
                console.error('GitHub验证失败:', error);
                return false;
            }
        }
        
        async function checkGitHubVerification() {
            const repo = localStorage.getItem('githubRepo') || DEFAULT_REPO;
            const token = localStorage.getItem('githubToken');
            
            if (repo && repo !== '{{DEFAULT_REPO}}') {
                isGitHubVerified = await verifyGitHubSettings(repo, token);
            } else {
                isGitHubVerified = false;
            }
            
            updateEditButtonVisibility();
            return isGitHubVerified;
        }
        
        function updateEditButtonVisibility() {
            if (isGitHubVerified) {
                editBtn.classList.remove('hidden');
                addTimezoneBtn.classList.remove('hidden');
            } else {
                editBtn.classList.add('hidden');
                addTimezoneBtn.classList.add('hidden');
            }
        }
        
        async function saveGitHubSettings() {
            const repo = githubRepoInput.value.trim();
            const token = githubTokenInput.value.trim();
            
            if (!repo) {
                showStatus('请输入GitHub仓库信息', 'error');
                return;
            }
            
            const isValid = await verifyGitHubSettings(repo, token);
            
            if (isValid) {
                if (repo) {
                    localStorage.setItem('githubRepo', repo);
                } else {
                    localStorage.removeItem('githubRepo');
                }
                
                if (token) {
                    localStorage.setItem('githubToken', token);
                } else {
                    localStorage.removeItem('githubToken');
                }
                
                isGitHubVerified = true;
                updateEditButtonVisibility();
                hideSettingsModal();
                showStatus('GitHub设置验证通过', 'success');
                updateHostname();
            } else {
                showStatus('GitHub设置验证失败，请检查信息', 'error');
            }
        }
        
        async function loadDataFromGitHub() {
            try {
                let repo = localStorage.getItem('githubRepo') || DEFAULT_REPO;
                const token = localStorage.getItem('githubToken');
                let url;
                let headers = {};
                
                if (token && repo && repo !== '{{DEFAULT_REPO}}') {
                    url = `https://api.github.com/repos/${repo}/contents/bookmarks.json`;
                    headers['Authorization'] = `token ${token}`;
                } else {
                    url = DEFAULT_RAW_URL !== '{{DEFAULT_RAW_URL}}' ? DEFAULT_RAW_URL : 'https://raw.githubusercontent.com/example/repo/main/bookmarks.json';
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        appData = { bookmarks: [], ads: [], timezones: [] };
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                if (token && repo && repo !== '{{DEFAULT_REPO}}') {
                    const data = await response.json();
                    const content = atob(data.content);
                    appData = JSON.parse(content);
                } else {
                    appData = await response.json();
                }
                
                if (!appData.bookmarks) appData.bookmarks = [];
                if (!appData.ads) appData.ads = [];
                if (!appData.timezones) appData.timezones = [];
                
            } catch (error) {
                console.error('加载GitHub数据失败:', error);
                appData = { bookmarks: [], ads: [], timezones: [] };
            }
        }
        
        async function saveDataToGitHub() {
            try {
                const repo = localStorage.getItem('githubRepo') || DEFAULT_REPO;
                const token = localStorage.getItem('githubToken');
                
                if (!repo || repo === '{{DEFAULT_REPO}}' || !isGitHubVerified) {
                    showStatus('请先配置并验证GitHub仓库信息', 'error');
                    return false;
                }
                
                const url = `https://api.github.com/repos/${repo}/contents/bookmarks.json`;
                const content = JSON.stringify(appData, null, 2);
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                let sha;
                try {
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        sha = data.sha;
                    }
                } catch (error) {
                    console.log('文件可能不存在，将创建新文件');
                }
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via web interface',
                        content: base64Content,
                        ...(sha && { sha })
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                showStatus('数据已保存到GitHub', 'success');
                return true;
            } catch (error) {
                console.error('保存数据到GitHub失败:', error);
                showStatus('保存失败: ' + error.message, 'error');
                return false;
            }
        }
        
        function renderBookmarks() {
            bookmarksContainer.innerHTML = '';
            
            if (appData.bookmarks.length === 0) {
                bookmarksContainer.innerHTML = `
                    <div class="text-center py-10 text-slate-400 dark:text-slate-500">
                        <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                        <p>暂无书签，请在编辑页面添加</p>
                    </div>
                `;
                return;
            }
            
            appData.bookmarks.forEach((group, groupIndex) => {
                const groupEl = document.createElement('div');
                groupEl.className = 'bookmark-group';
                
                let bookmarksHtml = '';
                group.bookmarks.forEach((bookmark, bookmarkIndex) => {
                    let faviconHtml = '';
                    if (bookmark.favicon) {
                        faviconHtml = `<img src="${bookmark.favicon}" alt="${bookmark.title}" class="w-6 h-6 rounded">`;
                    } else if (bookmark.title) {
                        const firstChar = bookmark.title.charAt(0).toUpperCase();
                        faviconHtml = `<div class="w-6 h-6 rounded bg-space-accent/20 dark:bg-space-accent/30 text-space-accent flex items-center justify-center text-xs font-medium">${firstChar}</div>`;
                    } else {
                        faviconHtml = `<i class="fa fa-globe w-6 h-6 text-slate-400"></i>`;
                    }
                    
                    bookmarksHtml += `
                        <a href="${bookmark.url}" target="_blank" class="flex items-center gap-2 p-3 bg-white dark:bg-space-medium rounded-lg shadow-sm hover:shadow-md transition-shadow card-hover">
                            <div class="flex-shrink-0">${faviconHtml}</div>
                            <span class="font-medium truncate">${bookmark.title || '无标题'}</span>
                        </a>
                    `;
                });
                
                groupEl.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-space font-semibold flex items-center">
                            <i class="fa fa-folder text-space-accent mr-2"></i>
                            ${group.name || '未命名组'}
                        </h3>
                        <button class="toggle-group p-1 hover:bg-slate-200 dark:hover:bg-space-dark rounded-full">
                            <i class="fa fa-chevron-down text-slate-500"></i>
                        </button>
                    </div>
                    <div class="bookmark-items grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3">
                        ${bookmarksHtml}
                    </div>
                `;
                
                bookmarksContainer.appendChild(groupEl);
                
                const toggleBtn = groupEl.querySelector('.toggle-group');
                const itemsContainer = groupEl.querySelector('.bookmark-items');
                
                toggleBtn.addEventListener('click', () => {
                    itemsContainer.classList.toggle('hidden');
                    const icon = toggleBtn.querySelector('i');
                    if (itemsContainer.classList.contains('hidden')) {
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-right');
                    } else {
                        icon.classList.remove('fa-chevron-right');
                        icon.classList.add('fa-chevron-down');
                    }
                });
            });
            
            updateBookmarkCount();
        }
        
        function renderEditBookmarks() {
            editBookmarksContainer.innerHTML = '';
            
            if (appData.bookmarks.length === 0) {
                editBookmarksContainer.innerHTML = `
                    <div class="text-center py-10 text-slate-400 dark:text-slate-500">
                        <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                        <p>暂无书签组，请添加</p>
                    </div>
                `;
                return;
            }
            
            appData.bookmarks.forEach((group, groupIndex) => {
                const groupEl = document.createElement('div');
                groupEl.className = 'p-4 border border-slate-200 dark:border-slate-700 rounded-lg';
                
                let bookmarksHtml = '';
                group.bookmarks.forEach((bookmark, bookmarkIndex) => {
                    bookmarksHtml += `
                        <div class="flex items-center gap-3 p-2 border-b border-slate-100 dark:border-slate-800 last:border-0">
                            <div class="flex-1">
                                <input type="text" value="${escapeHtml(bookmark.title || '')}" 
                                    class="w-full px-2 py-1 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-dark focus:outline-none focus:ring-1 focus:ring-space-accent mb-1"
                                    placeholder="书签标题"
                                    onchange="appData.bookmarks[${groupIndex}].bookmarks[${bookmarkIndex}].title = this.value">
                                <input type="url" value="${escapeHtml(bookmark.url || '')}" 
                                    class="w-full px-2 py-1 text-sm border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-dark focus:outline-none focus:ring-1 focus:ring-space-accent"
                                    placeholder="https://example.com"
                                    onchange="appData.bookmarks[${groupIndex}].bookmarks[${bookmarkIndex}].url = this.value">
                            </div>
                            <button class="delete-bookmark p-2 text-red-500 hover:text-red-700" 
                                    data-group="${groupIndex}" data-bookmark="${bookmarkIndex}">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    `;
                });
                
                groupEl.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <input type="text" value="${escapeHtml(group.name || '')}" 
                            class="px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-space-dark focus:outline-none focus:ring-2 focus:ring-space-accent font-medium"
                            placeholder="书签组名称"
                            onchange="appData.bookmarks[${groupIndex}].name = this.value">
                        <div class="flex gap-2">
                            <button class="add-bookmark px-2 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-sm" 
                                    data-group="${groupIndex}">
                                <i class="fa fa-plus mr-1"></i>添加
                            </button>
                            <button class="delete-group px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm" 
                                    data-group="${groupIndex}">
                                <i class="fa fa-trash mr-1"></i>删除组
                            </button>
                        </div>
                    </div>
                    <div class="bookmark-edit-items">
                        ${bookmarksHtml || '<div class="text-sm text-slate-500 dark:text-slate-400 p-2">该组暂无书签</div>'}
                    </div>
                `;
                
                editBookmarksContainer.appendChild(groupEl);
            });
            
            document.querySelectorAll('.add-bookmark').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupIndex = parseInt(e.currentTarget.dataset.group);
                    addBookmarkToGroup(groupIndex);
                });
            });
            
            document.querySelectorAll('.delete-bookmark').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupIndex = parseInt(e.currentTarget.dataset.group);
                    const bookmarkIndex = parseInt(e.currentTarget.dataset.bookmark);
                    confirmDeleteBookmark(groupIndex, bookmarkIndex);
                });
            });
            
            document.querySelectorAll('.delete-group').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const groupIndex = parseInt(e.currentTarget.dataset.group);
                    confirmDeleteGroup(groupIndex);
                });
            });
            
            updateBookmarkCount();
        }
        
        function updateBookmarkCount() {
            let total = 0;
            appData.bookmarks.forEach(group => {
                total += group.bookmarks ? group.bookmarks.length : 0;
            });
            
            bookmarkCountEl.textContent = `共 ${total} 个书签`;
            totalSitesEl.textContent = `共收录 ${total} 个网站`;
        }
        
        function renderAds() {
            appData.ads.forEach(ad => {
                if (ad.id && adPreviewImages[ad.id]) {
                    adPreviewImages[ad.id].src = ad.image || `https://picsum.photos/300/200?random=${ad.id}`;
                    adUrlInputs[ad.id].value = ad.url || '';
                    
                    if (adElements[ad.id]) {
                        const adLink = adElements[ad.id].querySelector('a');
                        const adImg = adElements[ad.id].querySelector('img');
                        
                        if (adLink && ad.url) {
                            adLink.href = ad.url;
                        }
                        if (adImg && ad.image) {
                            adImg.src = ad.image;
                        }
                    }
                }
            });
        }
        
        function renderTimezones() {
            timezonesContainer.innerHTML = '';
            
            if (appData.timezones.length === 0) {
                timezonesContainer.innerHTML = `
                    <div class="text-sm text-slate-500 dark:text-slate-400">
                        点击"+"添加时区
                    </div>
                `;
            } else {
                appData.timezones.forEach((timezone, index) => {
                    const timezoneEl = document.createElement('div');
                    timezoneEl.className = 'flex justify-between items-center';
                    timezoneEl.innerHTML = `
                        <span class="font-medium">${timezone.name}</span>
                        <span class="text-right" data-timezone="${index}">--:--:--</span>
                    `;
                    timezonesContainer.appendChild(timezoneEl);
                });
                
                updateTimezones();
                setInterval(updateTimezones, 1000);
            }
            
            timezonesEditContainer.innerHTML = '';
            
            appData.timezones.forEach((timezone, index) => {
                const timezoneEl = document.createElement('div');
                timezoneEl.className = 'flex items-center justify-between p-2 border border-slate-200 dark:border-slate-700 rounded';
                timezoneEl.innerHTML = `
                    <div>
                        <div class="font-medium">${timezone.name}</div>
                        <div class="text-sm text-slate-500 dark:text-slate-400">UTC${timezone.offset}</div>
                    </div>
                    <button class="delete-timezone p-2 text-red-500 hover:text-red-700" data-index="${index}">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                timezonesEditContainer.appendChild(timezoneEl);
            });
            
            document.querySelectorAll('.delete-timezone').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    confirmDeleteTimezone(index);
                });
            });
        }
        
        function updateTimezones() {
            const now = new Date();
            
            appData.timezones.forEach((timezone, index) => {
                const element = document.querySelector(`[data-timezone="${index}"]`);
                if (!element) return;
                
                let offsetHours = 0;
                const offsetMatch = timezone.offset.match(/^([+-]?\d+)$/);
                if (offsetMatch) {
                    offsetHours = parseInt(offsetMatch[1]);
                }
                
                const timezoneTime = new Date(now.getTime() + (offsetHours - now.getTimezoneOffset() / 60) * 3600000);
                element.textContent = timezoneTime.toTimeString().slice(0, 8);
            });
        }
        
        function initOnlineTime() {
            const startTime = localStorage.getItem('startTime') || new Date().toISOString();
            localStorage.setItem('startTime', startTime);
            
            function updateOnlineTime() {
                const start = new Date(startTime);
                const now = new Date();
                const diffMs = now - start;
                
                const hours = Math.floor(diffMs / 3600000);
                const minutes = Math.floor((diffMs % 3600000) / 60000);
                const seconds = Math.floor((diffMs % 60000) / 1000);
                
                onlineTimeEl.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateOnlineTime();
            setInterval(updateOnlineTime, 1000);
        }
        
        function initHealthReminder() {
            const reminders = [
                "每隔一小时起身活动一下吧",
                "记得多喝水，保持身体水分",
                "眺望远方，缓解眼部疲劳",
                "深呼吸，放松一下心情",
                "保持正确坐姿，保护脊椎健康"
            ];
            
            function updateReminder() {
                const hour = new Date().getHours();
                let reminder;
                
                if (hour >= 23 || hour < 6) {
                    reminder = "夜深了，注意休息，保持充足睡眠";
                } else if (hour >= 11 && hour < 14) {
                    reminder = "午餐时间到了，补充能量再继续";
                } else if (hour >= 17 && hour < 19) {
                    reminder = "傍晚时分，适当运动有益健康";
                } else {
                    reminder = reminders[Math.floor(Math.random() * reminders.length)];
                }
                
                healthReminderEl.textContent = reminder;
            }
            
            updateReminder();
            setInterval(updateReminder, 30 * 60 * 1000);
        }
        
        function initScrollListener() {
            let lastScrollTime = 0;
            let isHeaderVisible = true;
            
            function checkScroll() {
                const now = Date.now();
                
                if (now - lastScrollTime < 3000) {
                    if (!isHeaderVisible) {
                        headerEl.classList.remove('translate-y-[-100%]');
                        isHeaderVisible = true;
                    }
                } else {
                    if (isHeaderVisible && window.scrollY > 100) {
                        headerEl.classList.add('translate-y-[-100%]');
                        isHeaderVisible = false;
                    }
                }
                
                lastScrollTime = now;
            }
            
            window.addEventListener('scroll', checkScroll);
            setInterval(checkScroll, 1000);
        }
        
        function addBookmarkGroup() {
            appData.bookmarks.push({
                name: '新书签组',
                bookmarks: []
            });
            
            renderEditBookmarks();
        }
        
        function addBookmarkToGroup(groupIndex) {
            if (!appData.bookmarks[groupIndex].bookmarks) {
                appData.bookmarks[groupIndex].bookmarks = [];
            }
            
            appData.bookmarks[groupIndex].bookmarks.push({
                title: '新书签',
                url: 'https://example.com',
                favicon: ''
            });
            
            renderEditBookmarks();
        }
        
        function confirmDeleteBookmark(groupIndex, bookmarkIndex) {
            confirmTitle.textContent = '删除书签';
            confirmMessage.textContent = '您确定要删除这个书签吗？此操作无法撤销。';
            
            confirmCallback = () => {
                appData.bookmarks[groupIndex].bookmarks.splice(bookmarkIndex, 1);
                renderEditBookmarks();
            };
            
            showConfirmModal();
        }
        
        function confirmDeleteGroup(groupIndex) {
            confirmTitle.textContent = '删除书签组';
            confirmMessage.textContent = '您确定要删除这个书签组及其所有书签吗？此操作无法撤销。';
            
            confirmCallback = () => {
                appData.bookmarks.splice(groupIndex, 1);
                renderEditBookmarks();
            };
            
            showConfirmModal();
        }
        
        function confirmDeleteTimezone(index) {
            confirmTitle.textContent = '删除时区';
            confirmMessage.textContent = '您确定要删除这个时区吗？';
            
            confirmCallback = () => {
                appData.timezones.splice(index, 1);
                renderTimezones();
            };
            
            showConfirmModal();
        }
        
        function confirmDeleteAd(adId) {
            confirmTitle.textContent = '删除广告';
            confirmMessage.textContent = '您确定要删除这个广告吗？';
            
            confirmCallback = () => {
                appData.ads = appData.ads.filter(ad => ad.id !== adId);
                
                adPreviewImages[adId].src = `https://picsum.photos/300/200?random=${adId}`;
                adUrlInputs[adId].value = '';
                
                if (adElements[adId]) {
                    const adLink = adElements[adId].querySelector('a');
                    const adImg = adElements[adId].querySelector('img');
                    
                    if (adLink) adLink.href = '#';
                    if (adImg) adImg.src = `https://picsum.photos/1200/400?random=${adId}`;
                }
            };
            
            showConfirmModal();
        }
        
        function importBookmarks(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(e.target.result, 'text/html');
                    const bookmarkNodes = doc.querySelectorAll('dt > a');
                    const folderNodes = doc.querySelectorAll('h3');
                    
                    const importedGroups = [];
                    let currentGroup = null;
                    let folderIndex = 0;
                    
                    bookmarkNodes.forEach(node => {
                        if (folderNodes.length > folderIndex && !currentGroup) {
                            currentGroup = {
                                name: folderNodes[folderIndex].textContent.trim() || `导入的文件夹 ${folderIndex + 1}`,
                                bookmarks: []
                            };
                            importedGroups.push(currentGroup);
                            folderIndex++;
                        }
                        
                        if (!currentGroup) {
                            currentGroup = {
                                name: '未分组书签',
                                bookmarks: []
                            };
                            importedGroups.push(currentGroup);
                        }
                        
                        const title = node.textContent.trim() || '无标题';
                        const url = node.href;
                        let favicon = '';
                        
                        try {
                            const urlObj = new URL(url);
                            favicon = `https://${urlObj.hostname}/favicon.ico`;
                        } catch (e) {
                            console.log('无法解析URL获取favicon:', url);
                        }
                        
                        currentGroup.bookmarks.push({ title, url, favicon });
                    });
                    
                    importedGroups.forEach(newGroup => {
                        let existingGroup = appData.bookmarks.find(g => g.name === newGroup.name);
                        
                        if (existingGroup) {
                            newGroup.bookmarks.forEach(newBookmark => {
                                const isDuplicate = existingGroup.bookmarks.some(
                                    b => b.url === newBookmark.url
                                );
                                
                                if (!isDuplicate) {
                                    existingGroup.bookmarks.push(newBookmark);
                                }
                            });
                        } else {
                            appData.bookmarks.push(newGroup);
                        }
                    });
                    
                    renderEditBookmarks();
                    showStatus(`成功导入 ${bookmarkNodes.length} 个书签`, 'success');
                } catch (error) {
                    console.error('导入书签失败:', error);
                    showStatus('导入书签失败，请检查文件格式', 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        function exportBookmarks() {
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            appData.bookmarks.forEach(group => {
                html += `<DT><H3>${escapeHtml(group.name || '未命名组')}</H3>
<DL><p>`;
                
                group.bookmarks.forEach(bookmark => {
                    if (bookmark.url) {
                        html += `<DT><A HREF="${escapeHtml(bookmark.url)}">${escapeHtml(bookmark.title || '无标题')}</A>`;
                    }
                });
                
                html += `</DL><p>`;
            });
            
            html += `</DL>`;
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bookmarks_${new Date().toISOString().slice(0, 10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('书签导出成功', 'success');
        }
        
        function addNewTimezone() {
            const name = newTimezoneNameInput.value.trim();
            const offset = newTimezoneOffsetInput.value.trim();
            
            if (!name || !offset) {
                showStatus('请输入时区名称和偏移量', 'error');
                return;
            }
            
            if (!/^[+-]?\d+$/.test(offset)) {
                showStatus('偏移量格式应为整数，例如 +8 或 -5', 'error');
                return;
            }
            
            const exists = appData.timezones.some(tz => tz.name === name);
            if (exists) {
                showStatus('该时区名称已存在', 'error');
                return;
            }
            
            appData.timezones.push({ name, offset });
            
            newTimezoneNameInput.value = '';
            newTimezoneOffsetInput.value = '';
            
            renderTimezones();
            showStatus('时区添加成功', 'success');
        }
        
        function showConfirmModal() {
            confirmModal.classList.remove('opacity-0', 'pointer-events-none');
            confirmModal.querySelector('div').classList.remove('scale-95');
            confirmModal.querySelector('div').classList.add('scale-100');
        }
        
        function hideConfirmModal() {
            confirmModal.classList.add('opacity-0', 'pointer-events-none');
            confirmModal.querySelector('div').classList.remove('scale-100');
            confirmModal.querySelector('div').classList.add('scale-95');
            confirmCallback = null;
        }
        
        function showStatus(message, type = 'info') {
            statusText.textContent = message;
            
            statusIcon.className = '';
            if (type === 'success') {
                statusIcon.classList.add('fa', 'fa-check-circle', 'text-green-500');
                statusMessage.classList.remove('bg-red-50', 'border-red-200', 'text-red-800');
                statusMessage.classList.add('bg-green-50', 'border-green-200', 'text-green-800', 'dark:bg-green-900/30', 'dark:border-green-800', 'dark:text-green-300');
            } else if (type === 'error') {
                statusIcon.classList.add('fa', 'fa-exclamation-circle', 'text-red-500');
                statusMessage.classList.remove('bg-green-50', 'border-green-200', 'text-green-800');
                statusMessage.classList.add('bg-red-50', 'border-red-200', 'text-red-800', 'dark:bg-red-900/30', 'dark:border-red-800', 'dark:text-red-300');
            } else {
                statusIcon.classList.add('fa', 'fa-info-circle', 'text-blue-500');
                statusMessage.classList.remove('bg-green-50', 'border-green-200', 'text-green-800', 'bg-red-50', 'border-red-200', 'text-red-800');
                statusMessage.classList.add('bg-blue-50', 'border-blue-200', 'text-blue-800', 'dark:bg-blue-900/30', 'dark:border-blue-800', 'dark:text-blue-300');
            }
            
            statusMessage.classList.remove('translate-y-20', 'opacity-0');
            statusMessage.classList.add('translate-y-0', 'opacity-100');
            
            setTimeout(() => {
                statusMessage.classList.remove('translate-y-0', 'opacity-100');
                statusMessage.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
        
        function showSettingsModal() {
            settingsModal.classList.remove('opacity-0', 'pointer-events-none');
            settingsModal.querySelector('div').classList.remove('scale-95');
            settingsModal.querySelector('div').classList.add('scale-100');
        }
        
        function hideSettingsModal() {
            settingsModal.classList.add('opacity-0', 'pointer-events-none');
            settingsModal.querySelector('div').classList.remove('scale-100');
            settingsModal.querySelector('div').classList.add('scale-95');
        }
        
        function showEditPage() {
            if (!isGitHubVerified) {
                showSettingsModal();
                showStatus('请先配置并验证GitHub仓库信息', 'info');
                return;
            }
            
            renderEditBookmarks();
            editPage.classList.remove('translate-x-full');
        }
        
        function hideEditPage() {
            editPage.classList.add('translate-x-full');
        }
        
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }
        
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        function updateHostname() {
            const repo = localStorage.getItem('githubRepo') || DEFAULT_REPO;
            if (repo && repo !== '{{DEFAULT_REPO}}') {
                hostnameEl.textContent = repo.split('/')[0] || '星际导航';
            }
        }
        
        themeToggle.addEventListener('click', toggleTheme);
        settingsBtn.addEventListener('click', showSettingsModal);
        closeSettings.addEventListener('click', hideSettingsModal);
        saveSettings.addEventListener('click', saveGitHubSettings);
        saveChangesBtn.addEventListener('click', async () => {
            const success = await saveDataToGitHub();
            if (success) {
                renderBookmarks();
                renderAds();
                renderTimezones();
                hideEditPage();
            }
        });
        editBtn.addEventListener('click', showEditPage);
        closeEdit.addEventListener('click', hideEditPage);
        importBookmarksBtn.addEventListener('click', () => bookmarkFileInput.click());
        bookmarkFileInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                importBookmarks(e.target.files[0]);
                e.target.value = '';
            }
        });
        exportBookmarksBtn.addEventListener('click', exportBookmarks);
        addBookmarkGroupBtn.addEventListener('click', addBookmarkGroup);
        cancelConfirm.addEventListener('click', hideConfirmModal);
        confirmAction.addEventListener('click', () => {
            if (confirmCallback) {
                confirmCallback();
            }
            hideConfirmModal();
        });
        addTimezoneBtn.addEventListener('click', showEditPage);
        saveTimezoneBtn.addEventListener('click', addNewTimezone);
        
        Object.keys(adUploadInputs).forEach(adId => {
            adUploadInputs[adId].addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                if (file.size > 3 * 1024 * 1024) {
                    showStatus('文件大小不能超过3MB', 'error');
                    e.target.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    adPreviewImages[adId].src = event.target.result;
                    
                    let ad = appData.ads.find(a => a.id === adId);
                    if (!ad) {
                        ad = { id: adId };
                        appData.ads.push(ad);
                    }
                    ad.image = event.target.result;
                    
                    if (!adUrlInputs[adId].value) {
                        const nameWithoutExt = file.name.replace(/\.[^/.]+$/, "");
                        adUrlInputs[adId].value = `https://${nameWithoutExt}.com`;
                        ad.url = adUrlInputs[adId].value;
                    }
                };
                reader.readAsDataURL(file);
                e.target.value = '';
            });
            
            adUrlInputs[adId].addEventListener('change', (e) => {
                let ad = appData.ads.find(a => a.id === adId);
                if (!ad) {
                    ad = { id: adId };
                    appData.ads.push(ad);
                }
                ad.url = e.target.value;
            });
        });
        
        deleteAdBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const adId = e.currentTarget.dataset.ad;
                confirmDeleteAd(adId);
            });
        });
        
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                hideSettingsModal();
            }
        });
        
        confirmModal.addEventListener('click', (e) => {
            if (e.target === confirmModal) {
                hideConfirmModal();
            }
        });
        
        window.appData = appData;
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
