<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 探索网络宇宙</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231a202c'/%3E%3Ccircle cx='50' cy='50' r='35' fill='%232d3748'/%3E%3Ccircle cx='50' cy='50' r='25' fill='%234a5568'/%3E%3Ccircle cx='50' cy='50' r='15' fill='%23805ad5'/%3E%3Ccircle cx='50' cy='50' r='5' fill='%23d69e2e'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            dark: '#0b0e1a',
                            darker: '#070912',
                            blue: '#165DFF',
                            purple: '#7B61FF',
                            pink: '#FF5CA8',
                            accent: '#4ADEDE',
                            glow: '#4ADEDE33'
                        }
                    },
                    fontFamily: {
                        space: ['Segoe UI', 'Roboto', 'sans-serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 0.6 },
                            '50%': { opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 0 10px rgba(74, 222, 222, 0.5);
            }
            .bg-stars {
                background-image: radial-gradient(circle, #ffffff 1px, transparent 1px);
                background-size: 50px 50px;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .backdrop-blur-xs {
                backdrop-filter: blur(2px);
            }
        }
    </style>
</head>
<body class="font-space bg-gray-50 text-gray-900 dark:bg-space-dark dark:text-gray-100 transition-colors duration-300 min-h-screen">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0 opacity-0 dark:opacity-100 transition-opacity duration-1000"></div>
    
    <!-- 顶部控制栏 - 滚动时显示，静置后隐藏 -->
    <div id="controls" class="fixed top-0 left-0 right-0 z-50 flex justify-between items-center px-4 py-2 bg-white/80 dark:bg-space-darker/80 backdrop-blur-xs rounded-b-lg shadow-lg transform transition-transform duration-300">
        <div class="flex items-center gap-2">
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">
                <i class="fa fa-moon-o dark:hidden" aria-hidden="true"></i>
                <i class="fa fa-sun-o hidden dark:inline" aria-hidden="true"></i>
            </button>
            <button id="settings-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">
                <i class="fa fa-cog" aria-hidden="true"></i>
            </button>
        </div>
        <div>
            <button id="edit-center-btn" class="px-4 py-2 bg-space-blue text-white rounded-full hover:bg-space-blue/80 transition-colors" disabled>
                编辑中心
            </button>
        </div>
    </div>

    <!-- 主容器 -->
    <div class="container mx-auto px-4 pt-20 pb-16 relative z-10">
        <!-- 标题 -->
        <div class="text-center mb-8 mt-6 animate-float">
            <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold bg-clip-text text-transparent bg-gradient-to-r from-space-blue via-space-purple to-space-pink text-shadow">
                星际导航
            </h1>
            <p class="text-gray-600 dark:text-gray-400 mt-2 text-[clamp(1rem,2vw,1.2rem)]">
                探索网络宇宙的每一个角落
            </p>
        </div>

        <!-- 搜索框 -->
        <div class="max-w-2xl mx-auto mb-10 relative">
            <input type="text" id="search-input" placeholder="搜索书签..." 
                class="w-full px-6 py-4 rounded-full bg-white dark:bg-gray-800 shadow-lg focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all">
            <i class="fa fa-search absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" aria-hidden="true"></i>
        </div>

        <!-- 小组件 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <!-- 在线时长 -->
            <div class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-xs rounded-xl p-5 shadow-lg border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-clock-o text-space-blue mr-2" aria-hidden="true"></i>
                    航行时间
                </h3>
                <div class="text-2xl font-mono" id="uptime-display">00:00:00</div>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">自部署以来</p>
            </div>

            <!-- 健康提醒 -->
            <div class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-xs rounded-xl p-5 shadow-lg border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-heartbeat text-space-pink mr-2" aria-hidden="true"></i>
                    健康提醒
                </h3>
                <div id="health-reminder" class="text-lg">
                    保持专注，探索宇宙
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2" id="next-reminder">
                    下次提醒: 即将到来
                </p>
            </div>

            <!-- 世界时钟 -->
            <div class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-xs rounded-xl p-5 shadow-lg border border-gray-100 dark:border-gray-700 hover:shadow-xl transition-shadow">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-globe text-space-purple mr-2" aria-hidden="true"></i>
                    世界时钟
                </h3>
                <div id="world-clocks" class="space-y-2 max-h-32 overflow-y-auto scrollbar-hide">
                    <!-- 时钟将通过JS动态生成 -->
                </div>
                <button id="add-clock-btn" class="text-xs text-space-blue mt-2 hidden" disabled>
                    <i class="fa fa-plus-circle" aria-hidden="true"></i> 添加城市
                </button>
            </div>
        </div>

        <!-- 广告位1 -->
        <div class="mb-10 rounded-xl overflow-hidden shadow-lg bg-gray-100 dark:bg-gray-800 h-32 md:h-40 flex items-center justify-center relative group" id="ad-1">
            <div class="text-center p-4">
                <p class="text-gray-500 dark:text-gray-400">广告位 1</p>
                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">编辑中心可配置</p>
            </div>
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <span class="bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm">可点击广告</span>
            </div>
        </div>

        <!-- 书签区域 -->
        <div class="mb-10">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fa fa-bookmark text-space-blue mr-2" aria-hidden="true"></i>
                书签导航
                <span class="ml-2 text-sm font-normal text-gray-500 dark:text-gray-400" id="bookmark-count">(0)</span>
            </h2>
            
            <!-- 书签文件夹和书签将通过JS动态生成 -->
            <div id="bookmark-container" class="space-y-6">
                <!-- 初始提示 -->
                <div id="empty-bookmark-msg" class="text-center py-10 text-gray-500 dark:text-gray-400">
                    <i class="fa fa-folder-open-o text-4xl mb-3" aria-hidden="true"></i>
                    <p>暂无书签，前往编辑中心添加</p>
                </div>
            </div>
        </div>

        <!-- 广告位2 -->
        <div class="mb-10 rounded-xl overflow-hidden shadow-lg bg-gray-100 dark:bg-gray-800 h-32 md:h-40 flex items-center justify-center relative group" id="ad-2">
            <div class="text-center p-4">
                <p class="text-gray-500 dark:text-gray-400">广告位 2</p>
                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">编辑中心可配置</p>
            </div>
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <span class="bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm">可点击广告</span>
            </div>
        </div>

        <!-- 广告位3 -->
        <div class="mb-16 rounded-xl overflow-hidden shadow-lg bg-gray-100 dark:bg-gray-800 h-32 md:h-40 flex items-center justify-center relative group" id="ad-3">
            <div class="text-center p-4">
                <p class="text-gray-500 dark:text-gray-400">广告位 3</p>
                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">编辑中心可配置</p>
            </div>
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <span class="bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm">可点击广告</span>
            </div>
        </div>
    </div>

    <!-- 底部信息 -->
    <footer class="bg-white dark:bg-space-darker py-6 border-t border-gray-200 dark:border-gray-800 relative z-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div>共收录<span id="total-bookmarks">0</span>个网站</div>
                </div>
                <div class="text-gray-500 dark:text-gray-400">
                    <div>Copyright © 2018-<span id="current-year">2023</span> <span id="footer-hostname">星际导航</span>, All Rights Reserved</div>
                </div>
            </div>
        </div>
    </footer>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="settings-modal-backdrop"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <button id="close-settings" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fa fa-times" aria-hidden="true"></i>
            </button>
            
            <h2 class="text-2xl font-bold mb-6">设置</h2>
            
            <div class="space-y-6">
                <!-- GitHub 配置 -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">GitHub 配置</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">用户名</label>
                            <input type="text" id="github-username" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="GitHub 用户名">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">仓库名</label>
                            <input type="text" id="github-repo" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="仓库名称">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">访问令牌 <span class="text-xs text-gray-500">(需要 repo 权限)</span></label>
                            <input type="password" id="github-token" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="GitHub Personal Access Token">
                        </div>
                        <div class="flex gap-2">
                            <button id="validate-github" class="flex-1 px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                                验证
                            </button>
                            <button id="save-github" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                保存
                            </button>
                        </div>
                        <div id="github-validation-status" class="text-sm hidden"></div>
                    </div>
                </div>
                
                <div class="pt-2">
                    <button id="enter-edit-center" class="w-full py-3 bg-space-purple text-white rounded-lg hover:bg-space-purple/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        进入编辑中心
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑中心模态框 -->
    <div id="edit-center-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="edit-center-backdrop"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col transform transition-all">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h2 class="text-2xl font-bold">编辑中心</h2>
                <button id="close-edit-center" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            </div>
            
            <div class="flex overflow-hidden flex-1">
                <!-- 编辑中心侧边栏 -->
                <div class="w-48 border-r border-gray-200 dark:border-gray-700 flex-shrink-0">
                    <div class="p-4">
                        <button class="edit-tab w-full text-left py-2 px-3 rounded-lg bg-space-blue/10 text-space-blue font-medium" data-tab="bookmarks">
                            <i class="fa fa-bookmark mr-2" aria-hidden="true"></i>书签管理
                        </button>
                        <button class="edit-tab w-full text-left py-2 px-3 rounded-lg mt-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" data-tab="clocks">
                            <i class="fa fa-clock-o mr-2" aria-hidden="true"></i>时钟设置
                        </button>
                        <button class="edit-tab w-full text-left py-2 px-3 rounded-lg mt-1 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" data-tab="ads">
                            <i class="fa fa-bullhorn mr-2" aria-hidden="true"></i>广告管理
                        </button>
                    </div>
                </div>
                
                <!-- 编辑内容区域 -->
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- 书签管理标签页 -->
                    <div class="edit-content" id="bookmarks-tab">
                        <h3 class="text-xl font-semibold mb-4">书签管理</h3>
                        
                        <div class="mb-6">
                            <div class="flex flex-wrap gap-3">
                                <button id="import-bookmarks" class="px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors flex items-center">
                                    <i class="fa fa-upload mr-2" aria-hidden="true"></i>导入书签
                                </button>
                                <input type="file" id="bookmark-file" accept=".html" class="hidden">
                                <button id="export-bookmarks" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center">
                                    <i class="fa fa-download mr-2" aria-hidden="true"></i>导出书签
                                </button>
                                <button id="add-bookmark-btn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center">
                                    <i class="fa fa-plus mr-2" aria-hidden="true"></i>添加书签
                                </button>
                            </div>
                            <div class="mt-3 text-sm text-gray-500 dark:text-gray-400">
                                支持导入浏览器导出的HTML书签文件，自动按文件夹结构组织并去重
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium">书签文件夹</h4>
                                <button id="add-folder-btn" class="text-sm px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                    <i class="fa fa-folder-open-o mr-1" aria-hidden="true"></i> 添加文件夹
                                </button>
                            </div>
                            
                            <!-- 书签文件夹树 -->
                            <div id="folder-tree" class="space-y-2 max-h-96 overflow-y-auto pr-2 scrollbar-hide">
                                <!-- 文件夹结构将通过JS动态生成 -->
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <div id="selected-folder-info" class="text-sm text-gray-500 dark:text-gray-400 mb-3">
                                请选择一个文件夹查看内容
                            </div>
                            
                            <!-- 选中文件夹的书签列表 -->
                            <div id="folder-bookmarks" class="space-y-3 hidden">
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="font-medium" id="current-folder-name">文件夹名称</h4>
                                    <div>
                                        <button id="rename-folder-btn" class="text-sm px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                            <i class="fa fa-pencil mr-1" aria-hidden="true"></i> 重命名
                                        </button>
                                        <button id="delete-folder-btn" class="text-sm px-2 py-1 ml-1 bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors">
                                            <i class="fa fa-trash mr-1" aria-hidden="true"></i> 删除
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="folder-bookmarks-list" class="space-y-2 max-h-64 overflow-y-auto pr-2 scrollbar-hide">
                                    <!-- 书签列表将通过JS动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 时钟设置标签页 -->
                    <div class="edit-content hidden" id="clocks-tab">
                        <h3 class="text-xl font-semibold mb-4">世界时钟设置</h3>
                        
                        <div class="mb-4">
                            <button id="add-city-btn" class="px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                                <i class="fa fa-plus mr-2" aria-hidden="true"></i>添加城市
                            </button>
                        </div>
                        
                        <div id="cities-list" class="space-y-3 max-h-[60vh] overflow-y-auto">
                            <!-- 城市列表将通过JS动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 广告管理标签页 -->
                    <div class="edit-content hidden" id="ads-tab">
                        <h3 class="text-xl font-semibold mb-4">广告管理</h3>
                        
                        <div class="space-y-6">
                            <!-- 广告位1设置 -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h4 class="font-medium mb-3">广告位 1</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">广告图片</label>
                                        <input type="file" id="ad1-image" accept="image/*" class="w-full">
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            支持JPG、PNG格式，最大3MB
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">广告链接</label>
                                        <input type="url" id="ad1-url" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="https://example.com">
                                    </div>
                                    <div>
                                        <button id="save-ad1" class="px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                                            保存广告位1
                                        </button>
                                        <button id="delete-ad1" class="px-4 py-2 ml-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                            删除广告
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 广告位2设置 -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h4 class="font-medium mb-3">广告位 2</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">广告图片</label>
                                        <input type="file" id="ad2-image" accept="image/*" class="w-full">
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            支持JPG、PNG格式，最大3MB
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">广告链接</label>
                                        <input type="url" id="ad2-url" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="https://example.com">
                                    </div>
                                    <div>
                                        <button id="save-ad2" class="px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                                            保存广告位2
                                        </button>
                                        <button id="delete-ad2" class="px-4 py-2 ml-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                            删除广告
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 广告位3设置 -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h4 class="font-medium mb-3">广告位 3</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">广告图片</label>
                                        <input type="file" id="ad3-image" accept="image/*" class="w-full">
                                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            支持JPG、PNG格式，最大3MB
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">广告链接</label>
                                        <input type="url" id="ad3-url" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="https://example.com">
                                    </div>
                                    <div>
                                        <button id="save-ad3" class="px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                                            保存广告位3
                                        </button>
                                        <button id="delete-ad3" class="px-4 py-2 ml-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                                            删除广告
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3">
                <button id="cancel-edit" class="px-6 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    取消
                </button>
                <button id="save-changes" class="px-6 py-2 bg-space-purple text-white rounded-lg hover:bg-space-purple/80 transition-colors">
                    保存更改
                </button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑书签模态框 -->
    <div id="bookmark-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="bookmark-modal-backdrop"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <button id="close-bookmark-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fa fa-times" aria-hidden="true"></i>
            </button>
            
            <h2 class="text-2xl font-bold mb-6" id="bookmark-modal-title">添加书签</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">标题</label>
                    <input type="text" id="bookmark-title" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="网站标题">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">URL</label>
                    <input type="url" id="bookmark-url" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="https://example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">文件夹</label>
                    <select id="bookmark-folder" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue">
                        <!-- 文件夹选项将通过JS动态生成 -->
                    </select>
                </div>
            </div>
            
            <div class="mt-6 flex gap-3">
                <button id="delete-bookmark-confirm" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors hidden">
                    <i class="fa fa-trash mr-2" aria-hidden="true"></i>删除
                </button>
                <button id="cancel-bookmark" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    取消
                </button>
                <button id="save-bookmark" class="flex-1 px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                    保存
                </button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑文件夹模态框 -->
    <div id="folder-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="folder-modal-backdrop"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <button id="close-folder-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fa fa-times" aria-hidden="true"></i>
            </button>
            
            <h2 class="text-2xl font-bold mb-6" id="folder-modal-title">添加文件夹</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">文件夹名称</label>
                    <input type="text" id="folder-name" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="我的文件夹">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">父文件夹</label>
                    <select id="parent-folder" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue">
                        <option value="">无（根目录）</option>
                        <!-- 文件夹选项将通过JS动态生成 -->
                    </select>
                </div>
            </div>
            
            <div class="mt-6 flex gap-3">
                <button id="cancel-folder" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    取消
                </button>
                <button id="save-folder" class="flex-1 px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                    保存
                </button>
            </div>
        </div>
    </div>

    <!-- 添加城市模态框 -->
    <div id="city-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="city-modal-backdrop"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <button id="close-city-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fa fa-times" aria-hidden="true"></i>
            </button>
            
            <h2 class="text-2xl font-bold mb-6" id="city-modal-title">添加城市</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">城市名称</label>
                    <input type="text" id="city-name" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="例如：北京">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">时区 <span class="text-xs text-gray-500">(例如：Asia/Shanghai)</span></label>
                    <input type="text" id="city-timezone" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-space-blue" placeholder="时区标识符">
                    <div class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                        常见时区：Asia/Shanghai（北京）、America/New_York（纽约）、Europe/London（伦敦）、Asia/Tokyo（东京）
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex gap-3">
                <button id="delete-city-confirm" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors hidden">
                    <i class="fa fa-trash mr-2" aria-hidden="true"></i>删除
                </button>
                <button id="cancel-city" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    取消
                </button>
                <button id="save-city" class="flex-1 px-4 py-2 bg-space-blue text-white rounded-lg hover:bg-space-blue/80 transition-colors">
                    保存
                </button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="confirm-modal-backdrop"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <h3 class="text-xl font-bold mb-4" id="confirm-title">确认操作</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-6" id="confirm-message">您确定要执行此操作吗？</p>
            <div class="flex gap-3">
                <button id="confirm-cancel" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    取消
                </button>
                <button id="confirm-ok" class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    确认
                </button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="toast" class="fixed bottom-6 right-6 z-50 max-w-sm bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transform translate-y-20 opacity-0 transition-all duration-300 hidden">
        <div class="flex items-start">
            <div id="toast-icon" class="mr-3 mt-0.5">
                <i class="fa fa-check-circle text-green-500 text-xl" aria-hidden="true"></i>
            </div>
            <div class="flex-1">
                <h4 id="toast-title" class="font-semibold">操作成功</h4>
                <p id="toast-message" class="text-sm text-gray-600 dark:text-gray-300 mt-1">您的操作已成功完成</p>
            </div>
            <button id="close-toast" class="ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i class="fa fa-times" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <!-- 加载动画 -->
    <div id="loader" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm hidden">
        <div class="bg-white dark:bg-gray-800 rounded-full p-6 shadow-xl">
            <div class="w-12 h-12 border-4 border-gray-200 dark:border-gray-700 border-t-space-blue rounded-full animate-spin"></div>
        </div>
    </div>

    <script>
        // 应用数据结构
        const appData = {
            github: {
                username: '',
                repo: '',
                token: '',
                validated: false
            },
            bookmarks: {
                folders: [],  // 文件夹数组 { id, name, parentId }
                items: []     // 书签数组 { id, title, url, folderId }
            },
            cities: [
                { name: '北京', timezone: 'Asia/Shanghai' },
                { name: '纽约', timezone: 'America/New_York' },
                { name: '伦敦', timezone: 'Europe/London' },
                { name: '东京', timezone: 'Asia/Tokyo' }
            ],
            ads: {
                ad1: { image: '', url: '' },
                ad2: { image: '', url: '' },
                ad3: { image: '', url: '' }
            },
            deploymentDate: new Date(),  // 部署日期，实际使用时会从数据中加载
            selectedFolderId: null,      // 当前选中的文件夹ID
            editingBookmarkId: null,     // 当前正在编辑的书签ID
            editingFolderId: null,       // 当前正在编辑的文件夹ID
            editingCityId: null,         // 当前正在编辑的城市ID
            lastActivityTime: new Date() // 用于控制控制栏显示/隐藏
        };

        // DOM 元素
        const elements = {
            themeToggle: document.getElementById('theme-toggle'),
            settingsBtn: document.getElementById('settings-btn'),
            editCenterBtn: document.getElementById('edit-center-btn'),
            controls: document.getElementById('controls'),
            stars: document.getElementById('stars'),
            uptimeDisplay: document.getElementById('uptime-display'),
            healthReminder: document.getElementById('health-reminder'),
            nextReminder: document.getElementById('next-reminder'),
            worldClocks: document.getElementById('world-clocks'),
            addClockBtn: document.getElementById('add-clock-btn'),
            searchInput: document.getElementById('search-input'),
            bookmarkContainer: document.getElementById('bookmark-container'),
            emptyBookmarkMsg: document.getElementById('empty-bookmark-msg'),
            bookmarkCount: document.getElementById('bookmark-count'),
            totalBookmarks: document.getElementById('total-bookmarks'),
            currentYear: document.getElementById('current-year'),
            footerHostname: document.getElementById('footer-hostname'),
            ad1: document.getElementById('ad-1'),
            ad2: document.getElementById('ad-2'),
            ad3: document.getElementById('ad-3'),
            
            // 设置模态框
            settingsModal: document.getElementById('settings-modal'),
            settingsModalBackdrop: document.getElementById('settings-modal-backdrop'),
            closeSettings: document.getElementById('close-settings'),
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            validateGithub: document.getElementById('validate-github'),
            saveGithub: document.getElementById('save-github'),
            githubValidationStatus: document.getElementById('github-validation-status'),
            enterEditCenter: document.getElementById('enter-edit-center'),
            
            // 编辑中心
            editCenterModal: document.getElementById('edit-center-modal'),
            editCenterBackdrop: document.getElementById('edit-center-backdrop'),
            closeEditCenter: document.getElementById('close-edit-center'),
            editTabs: document.querySelectorAll('.edit-tab'),
            editContents: document.querySelectorAll('.edit-content'),
            cancelEdit: document.getElementById('cancel-edit'),
            saveChanges: document.getElementById('save-changes'),
            
            // 书签管理
            importBookmarks: document.getElementById('import-bookmarks'),
            bookmarkFile: document.getElementById('bookmark-file'),
            exportBookmarks: document.getElementById('export-bookmarks'),
            addBookmarkBtn: document.getElementById('add-bookmark-btn'),
            addFolderBtn: document.getElementById('add-folder-btn'),
            folderTree: document.getElementById('folder-tree'),
            selectedFolderInfo: document.getElementById('selected-folder-info'),
            folderBookmarks: document.getElementById('folder-bookmarks'),
            currentFolderName: document.getElementById('current-folder-name'),
            renameFolderBtn: document.getElementById('rename-folder-btn'),
            deleteFolderBtn: document.getElementById('delete-folder-btn'),
            folderBookmarksList: document.getElementById('folder-bookmarks-list'),
            
            // 时钟设置
            addCityBtn: document.getElementById('add-city-btn'),
            citiesList: document.getElementById('cities-list'),
            
            // 广告管理
            ad1Image: document.getElementById('ad1-image'),
            ad1Url: document.getElementById('ad1-url'),
            saveAd1: document.getElementById('save-ad1'),
            deleteAd1: document.getElementById('delete-ad1'),
            ad2Image: document.getElementById('ad2-image'),
            ad2Url: document.getElementById('ad2-url'),
            saveAd2: document.getElementById('save-ad2'),
            deleteAd2: document.getElementById('delete-ad2'),
            ad3Image: document.getElementById('ad3-image'),
            ad3Url: document.getElementById('ad3-url'),
            saveAd3: document.getElementById('save-ad3'),
            deleteAd3: document.getElementById('delete-ad3'),
            
            // 书签模态框
            bookmarkModal: document.getElementById('bookmark-modal'),
            bookmarkModalBackdrop: document.getElementById('bookmark-modal-backdrop'),
            closeBookmarkModal: document.getElementById('close-bookmark-modal'),
            bookmarkModalTitle: document.getElementById('bookmark-modal-title'),
            bookmarkTitle: document.getElementById('bookmark-title'),
            bookmarkUrl: document.getElementById('bookmark-url'),
            bookmarkFolder: document.getElementById('bookmark-folder'),
            deleteBookmarkConfirm: document.getElementById('delete-bookmark-confirm'),
            cancelBookmark: document.getElementById('cancel-bookmark'),
            saveBookmark: document.getElementById('save-bookmark'),
            
            // 文件夹模态框
            folderModal: document.getElementById('folder-modal'),
            folderModalBackdrop: document.getElementById('folder-modal-backdrop'),
            closeFolderModal: document.getElementById('close-folder-modal'),
            folderModalTitle: document.getElementById('folder-modal-title'),
            folderName: document.getElementById('folder-name'),
            parentFolder: document.getElementById('parent-folder'),
            cancelFolder: document.getElementById('cancel-folder'),
            saveFolder: document.getElementById('save-folder'),
            
            // 城市模态框
            cityModal: document.getElementById('city-modal'),
            cityModalBackdrop: document.getElementById('city-modal-backdrop'),
            closeCityModal: document.getElementById('close-city-modal'),
            cityModalTitle: document.getElementById('city-modal-title'),
            cityName: document.getElementById('city-name'),
            cityTimezone: document.getElementById('city-timezone'),
            deleteCityConfirm: document.getElementById('delete-city-confirm'),
            cancelCity: document.getElementById('cancel-city'),
            saveCity: document.getElementById('save-city'),
            
            // 确认对话框
            confirmModal: document.getElementById('confirm-modal'),
            confirmModalBackdrop: document.getElementById('confirm-modal-backdrop'),
            confirmTitle: document.getElementById('confirm-title'),
            confirmMessage: document.getElementById('confirm-message'),
            confirmCancel: document.getElementById('confirm-cancel'),
            confirmOk: document.getElementById('confirm-ok'),
            
            // 通知和加载
            toast: document.getElementById('toast'),
            toastIcon: document.getElementById('toast-icon'),
            toastTitle: document.getElementById('toast-title'),
            toastMessage: document.getElementById('toast-message'),
            closeToast: document.getElementById('close-toast'),
            loader: document.getElementById('loader')
        };

        // 初始化函数
        async function init() {
            // 设置当前年份
            elements.currentYear.textContent = new Date().getFullYear();
            
            // 初始化主题
            initTheme();
            
            // 生成星空背景
            generateStars();
            
            // 加载GitHub配置
            loadGithubConfig();
            
            // 如果有默认仓库信息，填充到表单
            if (window.defaultRepoInfo) {
                elements.githubUsername.value = window.defaultRepoInfo.username || '';
                elements.githubRepo.value = window.defaultRepoInfo.repo || '';
            }
            
            // 从GitHub加载数据
            showLoader();
            await loadDataFromGitHub();
            hideLoader();
            
            // 渲染所有组件
            renderUptime();
            renderHealthReminder();
            renderWorldClocks();
            renderBookmarks();
            renderAds();
            renderFooter();
            
            // 启动定时器
            startTimers();
            
            // 添加事件监听器
            addEventListeners();
            
            // 更新编辑功能状态
            updateEditFeaturesStatus();
            
            // 确保控制栏初始可见
            showControls();
        }

        // 初始化主题
        function initTheme() {
            // 检查用户偏好
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        // 生成星空背景
        function generateStars() {
            const starsCount = 150;
            const starsContainer = elements.stars;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2 + 1;
                const opacity = Math.random() * 0.8 + 0.2;
                
                star.style.position = 'absolute';
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.backgroundColor = 'white';
                star.style.borderRadius = '50%';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.opacity = opacity;
                star.style.animation = `twinkle ${Math.random() * 3 + 2}s ease-in-out infinite`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // 加载GitHub配置
        function loadGithubConfig() {
            const savedGithub = localStorage.getItem('githubConfig');
            if (savedGithub) {
                try {
                    const githubData = JSON.parse(savedGithub);
                    appData.github = { ...appData.github, ...githubData };
                    elements.githubUsername.value = appData.github.username || '';
                    elements.githubRepo.value = appData.github.repo || '';
                    elements.githubToken.value = appData.github.token || '';
                } catch (e) {
                    console.error('Failed to parse GitHub config:', e);
                }
            }
        }

        // 保存GitHub配置
        function saveGithubConfig() {
            appData.github.username = elements.githubUsername.value.trim();
            appData.github.repo = elements.githubRepo.value.trim();
            appData.github.token = elements.githubToken.value.trim();
            
            localStorage.setItem('githubConfig', JSON.stringify({
                username: appData.github.username,
                repo: appData.github.repo,
                token: appData.github.token,
                validated: appData.github.validated
            }));
        }

        // 验证GitHub令牌
        async function validateGitHubToken() {
            showLoader();
            elements.githubValidationStatus.textContent = '正在验证...';
            elements.githubValidationStatus.className = 'text-sm text-yellow-500';
            elements.githubValidationStatus.classList.remove('hidden');
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    appData.github.validated = true;
                    elements.githubValidationStatus.textContent = '验证成功！您可以进入编辑中心了。';
                    elements.githubValidationStatus.className = 'text-sm text-green-500';
                    showToast('验证成功', 'GitHub令牌验证成功', 'success');
                } else {
                    appData.github.validated = false;
                    elements.githubValidationStatus.textContent = '验证失败：无效的令牌或权限不足';
                    elements.githubValidationStatus.className = 'text-sm text-red-500';
                    showToast('验证失败', '无效的令牌或权限不足', 'error');
                }
            } catch (error) {
                appData.github.validated = false;
                elements.githubValidationStatus.textContent = '验证失败：网络错误';
                elements.githubValidationStatus.className = 'text-sm text-red-500';
                showToast('验证失败', '网络错误，请稍后重试', 'error');
                console.error('GitHub validation error:', error);
            } finally {
                hideLoader();
                updateEditFeaturesStatus();
                saveGithubConfig();
            }
        }

        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            try {
                let username = appData.github.username || (window.defaultRepoInfo ? window.defaultRepoInfo.username : '');
                let repo = appData.github.repo || (window.defaultRepoInfo ? window.defaultRepoInfo.repo : '');
                
                // 如果没有仓库信息，使用默认数据
                if (!username || !repo) {
                    console.log('No repo info, using default data');
                    return;
                }
                
                let url;
                let headers = {};
                
                // 有token时使用API，否则使用公开raw地址
                if (appData.github.token && appData.github.validated) {
                    url = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                    headers['Authorization'] = `token ${appData.github.token}`;
                } else {
                    url = `https://raw.githubusercontent.com/${username}/${repo}/gh-pages/bookmarks.json`;
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        console.log('bookmarks.json not found, using default data');
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                let data;
                if (appData.github.token && appData.github.validated) {
                    // 从GitHub API获取的是base64编码的内容
                    const apiResponse = await response.json();
                    const content = atob(apiResponse.content);
                    data = JSON.parse(content);
                } else {
                    // 从raw地址获取的是直接的JSON
                    data = await response.json();
                }
                
                // 合并数据
                if (data) {
                    if (data.bookmarks) {
                        appData.bookmarks = { ...appData.bookmarks, ...data.bookmarks };
                    }
                    if (data.cities) {
                        appData.cities = data.cities;
                    }
                    if (data.ads) {
                        appData.ads = { ...appData.ads, ...data.ads };
                    }
                    if (data.deploymentDate) {
                        appData.deploymentDate = new Date(data.deploymentDate);
                    }
                }
            } catch (error) {
                console.error('Error loading data from GitHub:', error);
                // 失败时使用现有数据
            }
        }

        // 保存数据到GitHub
        async function saveDataToGitHub() {
            showLoader();
            
            try {
                const { username, repo, token } = appData.github;
                
                if (!username || !repo || !token || !appData.github.validated) {
                    throw new Error('GitHub配置不完整或未验证');
                }
                
                // 准备要保存的数据
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    cities: appData.cities,
                    ads: appData.ads,
                    deploymentDate: appData.deploymentDate.toISOString()
                };
                
                const content = JSON.stringify(dataToSave, null, 2);
                
                // 首先获取文件的SHA（如果存在）
                let sha = '';
                const getResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }
                
                // 处理特殊字符，确保能正确编码
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                // 保存文件
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via Space Navigator',
                        content: base64Content,
                        sha: sha // 仅当文件存在时需要
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`保存失败: ${errorData.message || response.statusText}`);
                }
                
                showToast('保存成功', '您的更改已同步到GitHub', 'success');
                return true;
            } catch (error) {
                console.error('Error saving data to GitHub:', error);
                showToast('保存失败', error.message, 'error');
                return false;
            } finally {
                hideLoader();
            }
        }

        // 更新编辑功能状态
        function updateEditFeaturesStatus() {
            const isValidated = appData.github.validated;
            
            elements.enterEditCenter.disabled = !isValidated;
            elements.editCenterBtn.classList.toggle('hidden', !isValidated);
            elements.addClockBtn.classList.toggle('hidden', isValidated);
            elements.addClockBtn.disabled = !isValidated;
            
            // 编辑中心内的按钮状态
            elements.addBookmarkBtn.disabled = !isValidated;
            elements.addFolderBtn.disabled = !isValidated;
            elements.addCityBtn.disabled = !isValidated;
            elements.importBookmarks.disabled = !isValidated;
            elements.exportBookmarks.disabled = !isValidated;
        }

        // 渲染在线时长
        function renderUptime() {
            function updateUptime() {
                const now = new Date();
                const diff = now - appData.deploymentDate;
                
                const seconds = Math.floor((diff / 1000) % 60);
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                const hours = Math.floor(diff / (1000 * 60 * 60));
                
                elements.uptimeDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateUptime();
            return setInterval(updateUptime, 1000);
        }

        // 渲染健康提醒
        function renderHealthReminder() {
            const reminders = [
                "是时候站起来活动一下了",
                "记得多喝水，保持水分",
                "远眺一下，让眼睛休息片刻",
                "深呼吸，放松一下",
                "保持正确的坐姿，保护脊椎"
            ];
            
            // 每小时随机选择一个提醒
            function updateReminder() {
                const now = new Date();
                const nextHour = new Date(now);
                nextHour.setHours(now.getHours() + 1);
                nextHour.setMinutes(0);
                nextHour.setSeconds(0);
                
                const minutesToNext = Math.floor((nextHour - now) / (1000 * 60));
                
                elements.healthReminder.textContent = reminders[Math.floor(Math.random() * reminders.length)];
                elements.nextReminder.textContent = `下次提醒: ${minutesToNext}分钟后`;
            }
            
            updateReminder();
            return setInterval(updateReminder, 60 * 60 * 1000); // 每小时更新一次
        }

        // 渲染世界时钟
        function renderWorldClocks() {
            elements.worldClocks.innerHTML = '';
            
            appData.cities.forEach(city => {
                const clockDiv = document.createElement('div');
                clockDiv.className = 'flex justify-between items-center';
                
                const cityName = document.createElement('span');
                cityName.className = 'font-medium';
                cityName.textContent = city.name;
                
                const cityTime = document.createElement('span');
                cityTime.id = `time-${city.timezone}`;
                
                clockDiv.appendChild(cityName);
                clockDiv.appendChild(cityTime);
                elements.worldClocks.appendChild(clockDiv);
            });
            
            // 更新时间
            function updateTimes() {
                appData.cities.forEach(city => {
                    const timeEl = document.getElementById(`time-${city.timezone}`);
                    if (timeEl) {
                        try {
                            const options = { 
                                hour: '2-digit', 
                                minute: '2-digit', 
                                second: '2-digit',
                                timeZone: city.timezone
                            };
                            const timeString = new Date().toLocaleTimeString('zh-CN', options);
                            timeEl.textContent = timeString;
                        } catch (e) {
                            timeEl.textContent = '无效时区';
                            console.error(`Invalid timezone: ${city.timezone}`, e);
                        }
                    }
                });
            }
            
            updateTimes();
            return setInterval(updateTimes, 1000);
        }

        // 渲染书签（带文件夹结构）
        function renderBookmarks() {
            elements.bookmarkContainer.innerHTML = '';
            elements.emptyBookmarkMsg.classList.add('hidden');
            
            // 计算总书签数量
            const total = appData.bookmarks.items.length;
            elements.bookmarkCount.textContent = `(${total})`;
            elements.totalBookmarks.textContent = total;
            
            if (total === 0) {
                elements.emptyBookmarkMsg.classList.remove('hidden');
                return;
            }
            
            // 构建文件夹树结构
            const folderMap = {};
            appData.bookmarks.folders.forEach(folder => {
                folderMap[folder.id] = { ...folder, children: [], bookmarks: [] };
            });
            
            // 添加根文件夹（虚拟）
            const rootFolders = [];
            
            // 组织文件夹层次结构
            appData.bookmarks.folders.forEach(folder => {
                if (!folder.parentId) {
                    rootFolders.push(folder.id);
                } else if (folderMap[folder.parentId]) {
                    folderMap[folder.parentId].children.push(folder.id);
                }
            });
            
            // 组织书签到相应文件夹
            appData.bookmarks.items.forEach(bookmark => {
                if (bookmark.folderId && folderMap[bookmark.folderId]) {
                    folderMap[bookmark.folderId].bookmarks.push(bookmark);
                } else {
                    // 如果文件夹不存在或没有指定文件夹，放到根目录
                    if (!folderMap['__root']) {
                        folderMap['__root'] = { id: '__root', name: '未分类', children: [], bookmarks: [] };
                        rootFolders.push('__root');
                    }
                    folderMap['__root'].bookmarks.push(bookmark);
                }
            });
            
            // 递归渲染文件夹
            function renderFolder(folderId, level = 0) {
                const folder = folderMap[folderId];
                if (!folder) return null;
                
                const folderDiv = document.createElement('div');
                folderDiv.className = 'mb-6';
                
                // 文件夹标题（可折叠）
                const folderHeader = document.createElement('div');
                folderHeader.className = 'flex items-center mb-3 cursor-pointer folder-header';
                folderHeader.dataset.folderId = folderId;
                
                const folderIcon = document.createElement('i');
                folderIcon.className = 'fa fa-folder-open text-yellow-500 mr-2 folder-icon';
                
                const folderName = document.createElement('h3');
                folderName.className = `font-semibold text-lg ${level > 0 ? 'pl-' + (level * 4) : ''}`;
                folderName.textContent = folder.name;
                
                const itemCount = document.createElement('span');
                itemCount.className = 'ml-2 text-sm text-gray-500 dark:text-gray-400';
                itemCount.textContent = `(${folder.bookmarks.length})`;
                
                folderHeader.appendChild(folderIcon);
                folderHeader.appendChild(folderName);
                folderHeader.appendChild(itemCount);
                
                // 书签网格
                const bookmarksGrid = document.createElement('div');
                bookmarksGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 folder-bookmarks';
                
                // 渲染书签
                folder.bookmarks.forEach(bookmark => {
                    const bookmarkCard = document.createElement('a');
                    bookmarkCard.href = bookmark.url;
                    bookmarkCard.target = '_blank';
                    bookmarkCard.className = 'bg-white dark:bg-gray-800 rounded-lg shadow p-3 hover:shadow-md transition-shadow flex flex-col items-center justify-center text-center h-24 group';
                    
                    // 网站图标或首字母
                    const faviconContainer = document.createElement('div');
                    faviconContainer.className = 'w-10 h-10 rounded-full bg-space-blue/10 flex items-center justify-center mb-2 text-lg font-bold';
                    
                    const favicon = document.createElement('img');
                    favicon.src = `https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(bookmark.url)}&size=32`;
                    favicon.className = 'w-6 h-6 rounded-full';
                    favicon.onerror = function() {
                        // 如果favicon加载失败，显示标题首字母
                        const firstChar = bookmark.title.charAt(0).toUpperCase();
                        faviconContainer.innerHTML = `<span>${firstChar}</span>`;
                    };
                    
                    faviconContainer.appendChild(favicon);
                    
                    // 标题
                    const title = document.createElement('div');
                    title.className = 'text-sm truncate w-full';
                    title.textContent = bookmark.title;
                    
                    bookmarkCard.appendChild(faviconContainer);
                    bookmarkCard.appendChild(title);
                    bookmarksGrid.appendChild(bookmarkCard);
                });
                
                folderDiv.appendChild(folderHeader);
                folderDiv.appendChild(bookmarksGrid);
                
                // 递归渲染子文件夹
                folder.children.forEach(childId => {
                    const childFolder = renderFolder(childId, level + 1);
                    if (childFolder) {
                        folderDiv.appendChild(childFolder);
                    }
                });
                
                return folderDiv;
            }
            
            // 渲染根文件夹
            rootFolders.forEach(folderId => {
                const folderDiv = renderFolder(folderId);
                if (folderDiv) {
                    elements.bookmarkContainer.appendChild(folderDiv);
                }
            });
            
            // 添加文件夹折叠功能
            document.querySelectorAll('.folder-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    e.preventDefault();
                    const folderId = header.dataset.folderId;
                    const bookmarksContainer = header.nextElementSibling;
                    const icon = header.querySelector('.folder-icon');
                    
                    if (bookmarksContainer.style.display === 'none') {
                        bookmarksContainer.style.display = 'grid';
                        icon.className = 'fa fa-folder-open text-yellow-500 mr-2 folder-icon';
                    } else {
                        bookmarksContainer.style.display = 'none';
                        icon.className = 'fa fa-folder text-yellow-500 mr-2 folder-icon';
                    }
                });
            });
        }

        // 渲染广告
        function renderAds() {
            // 广告位1
            if (appData.ads.ad1.image && appData.ads.ad1.url) {
                elements.ad1.innerHTML = `<a href="${appData.ads.ad1.url}" target="_blank"><img src="${appData.ads.ad1.image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
            } else {
                elements.ad1.innerHTML = `
                    <div class="text-center p-4">
                        <p class="text-gray-500 dark:text-gray-400">广告位 1</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">编辑中心可配置</p>
                    </div>
                    <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm">可点击广告</span>
                    </div>
                `;
            }
            
            // 广告位2
            if (appData.ads.ad2.image && appData.ads.ad2.url) {
                elements.ad2.innerHTML = `<a href="${appData.ads.ad2.url}" target="_blank"><img src="${appData.ads.ad2.image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
            } else {
                elements.ad2.innerHTML = `
                    <div class="text-center p-4">
                        <p class="text-gray-500 dark:text-gray-400">广告位 2</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">编辑中心可配置</p>
                    </div>
                    <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm">可点击广告</span>
                    </div>
                `;
            }
            
            // 广告位3
            if (appData.ads.ad3.image && appData.ads.ad3.url) {
                elements.ad3.innerHTML = `<a href="${appData.ads.ad3.url}" target="_blank"><img src="${appData.ads.ad3.image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
            } else {
                elements.ad3.innerHTML = `
                    <div class="text-center p-4">
                        <p class="text-gray-500 dark:text-gray-400">广告位 3</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">编辑中心可配置</p>
                    </div>
                    <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="bg-white/90 dark:bg-gray-800/90 px-3 py-1 rounded-full text-sm">可点击广告</span>
                    </div>
                `;
            }
        }

        // 渲染页脚
        function renderFooter() {
            const hostname = window.location.hostname;
            elements.footerHostname.textContent = hostname;
        }

        // 渲染编辑中心的文件夹树
        function renderFolderTree() {
            elements.folderTree.innerHTML = '';
            
            // 构建文件夹树结构
            const folderMap = {};
            appData.bookmarks.folders.forEach(folder => {
                folderMap[folder.id] = { ...folder, children: [] };
            });
            
            // 根文件夹
            const rootFolders = [];
            
            // 组织文件夹层次
            appData.bookmarks.folders.forEach(folder => {
                if (!folder.parentId) {
                    rootFolders.push(folder.id);
                } else if (folderMap[folder.parentId]) {
                    folderMap[folder.parentId].children.push(folder.id);
                }
            });
            
            // 添加未分类文件夹（虚拟）
            const hasUncategorized = appData.bookmarks.items.some(item => !item.folderId || !folderMap[item.folderId]);
            if (hasUncategorized) {
                folderMap['__root'] = { id: '__root', name: '未分类', parentId: null, children: [] };
                rootFolders.push('__root');
            }
            
            // 递归渲染文件夹
            function renderTreeItem(folderId, level = 0) {
                const folder = folderMap[folderId];
                if (!folder) return null;
                
                const item = document.createElement('div');
                item.className = `flex items-center p-2 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${appData.selectedFolderId === folderId ? 'bg-space-blue/10 text-space-blue' : ''}`;
                item.dataset.folderId = folderId;
                
                const indent = document.createElement('div');
                indent.className = `w-${level * 4} inline-block`;
                
                const icon = document.createElement('i');
                icon.className = `fa fa-folder-o mr-2 ${appData.selectedFolderId === folderId ? 'text-space-blue' : ''}`;
                
                const name = document.createElement('span');
                name.textContent = folder.name;
                
                const count = document.createElement('span');
                const bookmarkCount = appData.bookmarks.items.filter(item => item.folderId === folderId).length;
                count.className = 'ml-2 text-xs text-gray-500 dark:text-gray-400';
                count.textContent = `(${bookmarkCount})`;
                
                item.appendChild(indent);
                item.appendChild(icon);
                item.appendChild(name);
                item.appendChild(count);
                
                // 添加点击事件
                item.addEventListener('click', () => {
                    appData.selectedFolderId = folderId;
                    renderFolderTree();
                    renderFolderBookmarks();
                });
                
                const container = document.createElement('div');
                container.appendChild(item);
                
                // 递归添加子文件夹
                folder.children.forEach(childId => {
                    const childItem = renderTreeItem(childId, level + 1);
                    if (childItem) {
                        container.appendChild(childItem);
                    }
                });
                
                return container;
            }
            
            // 渲染根文件夹
            rootFolders.forEach(folderId => {
                const treeItem = renderTreeItem(folderId);
                if (treeItem) {
                    elements.folderTree.appendChild(treeItem);
                }
            });
        }

        // 渲染选中文件夹的书签
        function renderFolderBookmarks() {
            if (!appData.selectedFolderId) {
                elements.selectedFolderInfo.classList.remove('hidden');
                elements.folderBookmarks.classList.add('hidden');
                return;
            }
            
            elements.selectedFolderInfo.classList.add('hidden');
            elements.folderBookmarks.classList.remove('hidden');
            
            // 获取文件夹名称
            let folderName = '未分类';
            if (appData.selectedFolderId !== '__root') {
                const folder = appData.bookmarks.folders.find(f => f.id === appData.selectedFolderId);
                if (folder) {
                    folderName = folder.name;
                }
            }
            elements.currentFolderName.textContent = folderName;
            
            // 筛选该文件夹的书签
            const folderBookmarks = appData.bookmarks.items.filter(item => {
                if (appData.selectedFolderId === '__root') {
                    // 未分类的书签
                    return !item.folderId || !appData.bookmarks.folders.some(f => f.id === item.folderId);
                }
                return item.folderId === appData.selectedFolderId;
            });
            
            // 渲染书签列表
            elements.folderBookmarksList.innerHTML = '';
            
            if (folderBookmarks.length === 0) {
                elements.folderBookmarksList.innerHTML = `
                    <div class="text-center py-4 text-gray-500 dark:text-gray-400">
                        该文件夹中没有书签
                    </div>
                `;
                return;
            }
            
            folderBookmarks.forEach(bookmark => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-2 border-b border-gray-100 dark:border-gray-700 last:border-0';
                
                const info = document.createElement('div');
                info.className = 'flex items-center';
                
                const favicon = document.createElement('div');
                favicon.className = 'w-8 h-8 rounded-full bg-space-blue/10 flex items-center justify-center mr-3 text-sm font-bold';
                
                const img = document.createElement('img');
                img.src = `https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(bookmark.url)}&size=16`;
                img.className = 'w-4 h-4 rounded-full';
                img.onerror = function() {
                    // 如果favicon加载失败，显示标题首字母
                    const firstChar = bookmark.title.charAt(0).toUpperCase();
                    favicon.innerHTML = `<span>${firstChar}</span>`;
                };
                favicon.appendChild(img);
                
                const details = document.createElement('div');
                
                const title = document.createElement('div');
                title.className = 'font-medium';
                title.textContent = bookmark.title;
                
                const url = document.createElement('div');
                url.className = 'text-xs text-gray-500 dark:text-gray-400 truncate max-w-xs';
                url.textContent = new URL(bookmark.url).hostname;
                
                details.appendChild(title);
                details.appendChild(url);
                info.appendChild(favicon);
                info.appendChild(details);
                
                const actions = document.createElement('div');
                actions.className = 'flex items-center';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'p-1 text-gray-500 hover:text-space-blue mr-2';
                editBtn.innerHTML = '<i class="fa fa-pencil" aria-hidden="true"></i>';
                editBtn.addEventListener('click', () => editBookmark(bookmark.id));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'p-1 text-gray-500 hover:text-red-500';
                deleteBtn.innerHTML = '<i class="fa fa-trash" aria-hidden="true"></i>';
                deleteBtn.addEventListener('click', () => confirmDeleteBookmark(bookmark.id));
                
                actions.appendChild(editBtn);
                actions.appendChild(deleteBtn);
                
                item.appendChild(info);
                item.appendChild(actions);
                
                elements.folderBookmarksList.appendChild(item);
            });
        }

        // 渲染城市列表
        function renderCitiesList() {
            elements.citiesList.innerHTML = '';
            
            appData.cities.forEach((city, index) => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-lg';
                
                const info = document.createElement('div');
                
                const name = document.createElement('div');
                name.className = 'font-medium';
                name.textContent = city.name;
                
                const timezone = document.createElement('div');
                timezone.className = 'text-sm text-gray-500 dark:text-gray-400';
                timezone.textContent = city.timezone;
                
                // 显示当前时间
                const time = document.createElement('div');
                time.className = 'mt-1 text-sm';
                try {
                    const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: city.timezone };
                    time.textContent = new Date().toLocaleTimeString('zh-CN', options);
                } catch (e) {
                    time.textContent = '无效时区';
                    time.className = 'mt-1 text-sm text-red-500';
                }
                
                info.appendChild(name);
                info.appendChild(timezone);
                info.appendChild(time);
                
                const actions = document.createElement('div');
                
                const editBtn = document.createElement('button');
                editBtn.className = 'px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors mr-2';
                editBtn.innerHTML = '<i class="fa fa-pencil mr-1" aria-hidden="true"></i> 编辑';
                editBtn.addEventListener('click', () => editCity(index));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'px-3 py-1 bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors';
                deleteBtn.innerHTML = '<i class="fa fa-trash mr-1" aria-hidden="true"></i> 删除';
                deleteBtn.addEventListener('click', () => confirmDeleteCity(index));
                
                actions.appendChild(editBtn);
                actions.appendChild(deleteBtn);
                
                item.appendChild(info);
                item.appendChild(actions);
                
                elements.citiesList.appendChild(item);
            });
            
            if (appData.cities.length === 0) {
                elements.citiesList.innerHTML = `
                    <div class="text-center py-6 text-gray-500 dark:text-gray-400">
                        暂无城市，请添加
                    </div>
                `;
            }
        }

        // 填充文件夹选择下拉框
        function populateFolderSelect(selectElement, excludeId = null) {
            selectElement.innerHTML = '<option value="">无（根目录）</option>';
            
            // 构建文件夹树结构
            const folderMap = {};
            appData.bookmarks.folders.forEach(folder => {
                if (folder.id !== excludeId) {
                    folderMap[folder.id] = { ...folder, children: [] };
                }
            });
            
            // 组织文件夹层次
            appData.bookmarks.folders.forEach(folder => {
                if (folder.id !== excludeId && folder.parentId && folderMap[folder.parentId]) {
                    folderMap[folder.parentId].children.push(folder.id);
                }
            });
            
            // 获取根文件夹
            const rootFolders = appData.bookmarks.folders
                .filter(folder => !folder.parentId && folder.id !== excludeId)
                .map(folder => folder.id);
            
            // 递归添加文件夹选项
            function addFolderOptions(folderId, level = 0) {
                const folder = folderMap[folderId];
                if (!folder) return;
                
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = ' '.repeat(level * 2) + folder.name;
                selectElement.appendChild(option);
                
                // 添加子文件夹
                folder.children.forEach(childId => {
                    addFolderOptions(childId, level + 1);
                });
            }
            
            rootFolders.forEach(folderId => {
                addFolderOptions(folderId);
            });
        }

        // 导入书签文件
        function importBookmarkFile(file) {
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    // 解析书签HTML
                    const bookmarkNodes = doc.querySelectorAll('a');
                    const folderNodes = doc.querySelectorAll('h3');
                    
                    // 创建临时文件夹映射
                    const tempFolderMap = new Map();
                    let currentFolderId = null;
                    let folderCounter = 0;
                    let bookmarkCounter = 0;
                    
                    // 解析文件夹
                    folderNodes.forEach(node => {
                        const folderId = `imported-folder-${folderCounter++}`;
                        const folderName = node.textContent.trim();
                        const parentId = currentFolderId;
                        
                        tempFolderMap.set(node, { id: folderId, name: folderName, parentId });
                        
                        // 如果下一个元素是文件夹列表，则进入子文件夹
                        const nextSibling = node.nextElementSibling;
                        if (nextSibling && nextSibling.tagName === 'DL') {
                            currentFolderId = folderId;
                        } else {
                            // 找到最近的关闭点
                            let ancestor = node.closest('dl').parentNode;
                            while (ancestor && ancestor.tagName !== 'DL') {
                                ancestor = ancestor.parentNode;
                            }
                            if (ancestor) {
                                const folderNode = ancestor.previousElementSibling;
                                if (folderNode && folderNode.tagName === 'H3' && tempFolderMap.has(folderNode)) {
                                    currentFolderId = tempFolderMap.get(folderNode).id;
                                } else {
                                    currentFolderId = null;
                                }
                            } else {
                                currentFolderId = null;
                            }
                        }
                    });
                    
                    // 将临时文件夹转换为实际文件夹
                    const importedFolders = Array.from(tempFolderMap.values());
                    
                    // 为每个导入的文件夹生成唯一ID
                    importedFolders.forEach(folder => {
                        // 检查是否已存在同名同层级文件夹
                        const existingFolder = appData.bookmarks.folders.find(f => 
                            f.name === folder.name && f.parentId === folder.parentId
                        );
                        
                        if (!existingFolder) {
                            // 生成新ID
                            folder.id = generateId('folder');
                            appData.bookmarks.folders.push(folder);
                        } else {
                            // 使用现有文件夹ID
                            tempFolderMap.forEach((val, key) => {
                                if (val.id === folder.id) {
                                    val.id = existingFolder.id;
                                }
                                if (val.parentId === folder.id) {
                                    val.parentId = existingFolder.id;
                                }
                            });
                        }
                    });
                    
                    // 解析书签
                    const importedBookmarks = [];
                    bookmarkNodes.forEach(node => {
                        const title = node.textContent.trim();
                        const url = node.href;
                        
                        // 找到所属文件夹
                        let folderNode = node.closest('dl').previousElementSibling;
                        while (folderNode && folderNode.tagName !== 'H3') {
                            folderNode = folderNode.previousElementSibling;
                        }
                        
                        let folderId = null;
                        if (folderNode && tempFolderMap.has(folderNode)) {
                            folderId = tempFolderMap.get(folderNode).id;
                        }
                        
                        importedBookmarks.push({
                            id: `imported-bookmark-${bookmarkCounter++}`,
                            title,
                            url,
                            folderId
                        });
                    });
                    
                    // 去重并添加书签
                    let addedCount = 0;
                    let duplicateCount = 0;
                    
                    importedBookmarks.forEach(bookmark => {
                        // 检查是否已存在相同URL的书签
                        const isDuplicate = appData.bookmarks.items.some(item => 
                            item.url.toLowerCase() === bookmark.url.toLowerCase()
                        );
                        
                        if (!isDuplicate) {
                            // 生成新ID
                            bookmark.id = generateId('bookmark');
                            appData.bookmarks.items.push(bookmark);
                            addedCount++;
                        } else {
                            duplicateCount++;
                        }
                    });
                    
                    // 更新UI
                    renderBookmarks();
                    renderFolderTree();
                    if (appData.selectedFolderId) {
                        renderFolderBookmarks();
                    }
                    
                    showToast(
                        '导入成功', 
                        `成功导入 ${addedCount} 个书签，跳过 ${duplicateCount} 个重复书签`, 
                        'success'
                    );
                } catch (error) {
                    console.error('Error importing bookmarks:', error);
                    showToast('导入失败', '无法解析书签文件，请确保文件格式正确', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // 导出书签
        function exportBookmarks() {
            // 创建HTML书签文件内容
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            // 构建文件夹树
            const folderMap = {};
            appData.bookmarks.folders.forEach(folder => {
                folderMap[folder.id] = { ...folder, children: [], bookmarks: [] };
            });
            
            // 组织文件夹层次
            appData.bookmarks.folders.forEach(folder => {
                if (folder.parentId && folderMap[folder.parentId]) {
                    folderMap[folder.parentId].children.push(folder.id);
                }
            });
            
            // 组织书签到文件夹
            appData.bookmarks.items.forEach(bookmark => {
                if (bookmark.folderId && folderMap[bookmark.folderId]) {
                    folderMap[bookmark.folderId].bookmarks.push(bookmark);
                } else {
                    // 根目录书签
                    if (!html.includes('<H3>未分类</H3>')) {
                        html += `<H3>未分类</H3>\n<DL><p>`;
                    }
                    html += `<DT><A HREF="${escapeHtml(bookmark.url)}">${escapeHtml(bookmark.title)}</A>\n`;
                }
            });
            
            // 递归添加文件夹和书签
            function addFolder(folderId) {
                const folder = folderMap[folderId];
                if (!folder) return;
                
                html += `<H3>${escapeHtml(folder.name)}</H3>\n<DL><p>`;
                
                // 添加书签
                folder.bookmarks.forEach(bookmark => {
                    html += `<DT><A HREF="${escapeHtml(bookmark.url)}">${escapeHtml(bookmark.title)}</A>\n`;
                });
                
                // 递归添加子文件夹
                folder.children.forEach(childId => {
                    addFolder(childId);
                });
                
                html += `</DL><p>\n`;
            }
            
            // 添加所有根文件夹
            appData.bookmarks.folders
                .filter(folder => !folder.parentId)
                .forEach(folder => {
                    addFolder(folder.id);
                });
            
            html += `</DL><p>`;
            
            // 创建并下载文件
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bookmarks_${new Date().toISOString().slice(0,10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('导出成功', '书签已成功导出为HTML文件', 'success');
        }

        // 添加新书签
        function addBookmark() {
            appData.editingBookmarkId = null;
            elements.bookmarkModalTitle.textContent = '添加书签';
            elements.bookmarkTitle.value = '';
            elements.bookmarkUrl.value = '';
            elements.deleteBookmarkConfirm.classList.add('hidden');
            
            // 填充文件夹选择框
            populateFolderSelect(elements.bookmarkFolder);
            
            // 如果有选中的文件夹，默认选中
            if (appData.selectedFolderId && appData.selectedFolderId !== '__root') {
                elements.bookmarkFolder.value = appData.selectedFolderId;
            }
            
            showModal(elements.bookmarkModal);
        }

        // 编辑书签
        function editBookmark(id) {
            const bookmark = appData.bookmarks.items.find(item => item.id === id);
            if (!bookmark) return;
            
            appData.editingBookmarkId = id;
            elements.bookmarkModalTitle.textContent = '编辑书签';
            elements.bookmarkTitle.value = bookmark.title;
            elements.bookmarkUrl.value = bookmark.url;
            elements.deleteBookmarkConfirm.classList.remove('hidden');
            
            // 填充文件夹选择框
            populateFolderSelect(elements.bookmarkFolder);
            elements.bookmarkFolder.value = bookmark.folderId || '';
            
            showModal(elements.bookmarkModal);
        }

        // 保存书签
        function saveBookmark() {
            const title = elements.bookmarkTitle.value.trim();
            const url = elements.bookmarkUrl.value.trim();
            const folderId = elements.bookmarkFolder.value || null;
            
            if (!title || !url) {
                showToast('保存失败', '标题和URL不能为空', 'error');
                return;
            }
            
            // 确保URL以http://或https://开头
            let formattedUrl = url;
            if (!formattedUrl.startsWith('http://') && !formattedUrl.startsWith('https://')) {
                formattedUrl = 'https://' + formattedUrl;
            }
            
            try {
                // 验证URL格式
                new URL(formattedUrl);
            } catch (e) {
                showToast('保存失败', 'URL格式不正确', 'error');
                return;
            }
            
            if (appData.editingBookmarkId) {
                // 更新现有书签
                const index = appData.bookmarks.items.findIndex(item => item.id === appData.editingBookmarkId);
                if (index !== -1) {
                    appData.bookmarks.items[index] = {
                        ...appData.bookmarks.items[index],
                        title,
                        url: formattedUrl,
                        folderId
                    };
                    showToast('更新成功', '书签已更新', 'success');
                }
            } else {
                // 检查是否重复
                const isDuplicate = appData.bookmarks.items.some(item => 
                    item.url.toLowerCase() === formattedUrl.toLowerCase()
                );
                
                if (isDuplicate) {
                    showToast('保存失败', '已存在相同URL的书签', 'error');
                    return;
                }
                
                // 添加新书签
                appData.bookmarks.items.push({
                    id: generateId('bookmark'),
                    title,
                    url: formattedUrl,
                    folderId
                });
                showToast('添加成功', '新书签已添加', 'success');
            }
            
            // 更新UI
            renderBookmarks();
            renderFolderTree();
            if (appData.selectedFolderId) {
                renderFolderBookmarks();
            }
            
            hideModal(elements.bookmarkModal);
        }

        // 确认删除书签
        function confirmDeleteBookmark(id) {
            showConfirmDialog(
                '删除书签',
                '您确定要删除这个书签吗？此操作无法撤销。',
                () => deleteBookmark(id)
            );
        }

        // 删除书签
        function deleteBookmark(id) {
            const index = appData.bookmarks.items.findIndex(item => item.id === id);
            if (index !== -1) {
                appData.bookmarks.items.splice(index, 1);
                showToast('删除成功', '书签已删除', 'success');
                
                // 更新UI
                renderBookmarks();
                renderFolderTree();
                if (appData.selectedFolderId) {
                    renderFolderBookmarks();
                }
            }
        }

        // 添加新文件夹
        function addFolder() {
            appData.editingFolderId = null;
            elements.folderModalTitle.textContent = '添加文件夹';
            elements.folderName.value = '';
            
            // 填充父文件夹选择框
            populateFolderSelect(elements.parentFolder);
            
            showModal(elements.folderModal);
        }

        // 重命名文件夹
        function renameFolder() {
            if (!appData.selectedFolderId || appData.selectedFolderId === '__root') return;
            
            const folder = appData.bookmarks.folders.find(f => f.id === appData.selectedFolderId);
            if (!folder) return;
            
            appData.editingFolderId = appData.selectedFolderId;
            elements.folderModalTitle.textContent = '重命名文件夹';
            elements.folderName.value = folder.name;
            
            // 填充父文件夹选择框，排除当前文件夹
            populateFolderSelect(elements.parentFolder, appData.selectedFolderId);
            elements.parentFolder.value = folder.parentId || '';
            
            showModal(elements.folderModal);
        }

        // 保存文件夹
        function saveFolder() {
            const name = elements.folderName.value.trim();
            const parentId = elements.parentFolder.value || null;
            
            if (!name) {
                showToast('保存失败', '文件夹名称不能为空', 'error');
                return;
            }
            
            // 检查是否存在同名同层级文件夹
            const isDuplicate = appData.bookmarks.folders.some(f => 
                f.name === name && f.parentId === parentId && f.id !== appData.editingFolderId
            );
            
            if (isDuplicate) {
                showToast('保存失败', '已存在同名文件夹', 'error');
                return;
            }
            
            if (appData.editingFolderId) {
                // 更新现有文件夹
                const index = appData.bookmarks.folders.findIndex(f => f.id === appData.editingFolderId);
                if (index !== -1) {
                    // 检查是否将文件夹移动到其子文件夹中
                    if (parentId) {
                        let currentId = parentId;
                        let isChild = false;
                        
                        while (currentId) {
                            if (currentId === appData.editingFolderId) {
                                isChild = true;
                                break;
                            }
                            const parentFolder = appData.bookmarks.folders.find(f => f.id === currentId);
                            currentId = parentFolder ? parentFolder.parentId : null;
                        }
                        
                        if (isChild) {
                            showToast('保存失败', '不能将文件夹移动到其子文件夹中', 'error');
                            return;
                        }
                    }
                    
                    appData.bookmarks.folders[index] = {
                        ...appData.bookmarks.folders[index],
                        name,
                        parentId
                    };
                    showToast('更新成功', '文件夹已更新', 'success');
                }
            } else {
                // 添加新文件夹
                appData.bookmarks.folders.push({
                    id: generateId('folder'),
                    name,
                    parentId
                });
                showToast('添加成功', '新文件夹已添加', 'success');
            }
            
            // 更新UI
            renderFolderTree();
            populateFolderSelect(elements.bookmarkFolder);
            populateFolderSelect(elements.parentFolder);
            
            hideModal(elements.folderModal);
        }

        // 确认删除文件夹
        function confirmDeleteFolder() {
            if (!appData.selectedFolderId || appData.selectedFolderId === '__root') return;
            
            // 检查是否有子文件夹
            const hasChildren = appData.bookmarks.folders.some(f => f.parentId === appData.selectedFolderId);
            
            // 检查是否有书签
            const hasBookmarks = appData.bookmarks.items.some(item => item.folderId === appData.selectedFolderId);
            
            let message = '您确定要删除这个文件夹吗？';
            if (hasChildren || hasBookmarks) {
                message += ' 此操作将同时删除所有子文件夹和其中的书签，且无法撤销。';
            }
            
            showConfirmDialog(
                '删除文件夹',
                message,
                () => deleteFolder()
            );
        }

        // 删除文件夹
        function deleteFolder() {
            if (!appData.selectedFolderId || appData.selectedFolderId === '__root') return;
            
            // 递归删除所有子文件夹
            function deleteChildFolders(parentId) {
                const childFolders = appData.bookmarks.folders.filter(f => f.parentId === parentId);
                childFolders.forEach(folder => {
                    deleteChildFolders(folder.id);
                    const index = appData.bookmarks.folders.findIndex(f => f.id === folder.id);
                    if (index !== -1) {
                        appData.bookmarks.folders.splice(index, 1);
                    }
                });
            }
            
            // 删除子文件夹
            deleteChildFolders(appData.selectedFolderId);
            
            // 删除当前文件夹
            const folderIndex = appData.bookmarks.folders.findIndex(f => f.id === appData.selectedFolderId);
            if (folderIndex !== -1) {
                appData.bookmarks.folders.splice(folderIndex, 1);
            }
            
            // 删除该文件夹下的书签
            appData.bookmarks.items = appData.bookmarks.items.filter(item => item.folderId !== appData.selectedFolderId);
            
            // 重置选中的文件夹
            appData.selectedFolderId = null;
            
            showToast('删除成功', '文件夹已删除', 'success');
            
            // 更新UI
            renderBookmarks();
            renderFolderTree();
            renderFolderBookmarks();
        }

        // 添加新城市
        function addCity() {
            appData.editingCityId = null;
            elements.cityModalTitle.textContent = '添加城市';
            elements.cityName.value = '';
            elements.cityTimezone.value = '';
            elements.deleteCityConfirm.classList.add('hidden');
            
            showModal(elements.cityModal);
        }

        // 编辑城市
        function editCity(index) {
            if (index < 0 || index >= appData.cities.length) return;
            
            const city = appData.cities[index];
            appData.editingCityId = index;
            
            elements.cityModalTitle