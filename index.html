<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 探索网络宇宙</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%230f172a'/><circle cx='50' cy='50' r='20' fill='%2338bdf8'/><circle cx='30' cy='30' r='5' fill='%23e2e8f0'/><circle cx='70' cy='40' r='3' fill='%23e2e8f0'/><circle cx='40' cy='70' r='4' fill='%23e2e8f0'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            black: '#0a0e17',
                            dark: '#121a29',
                            blue: '#1e3a8a',
                            purple: '#4c1d95',
                            pink: '#ec4899',
                            glow: '#3b82f6'
                        },
                        star: {
                            white: '#f8fafc',
                            yellow: '#facc15',
                            blue: '#38bdf8'
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif']
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite',
                        'rotate': 'rotate 20s linear infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.3 }
                        },
                        rotate: {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .star { position: absolute; background-color: white; border-radius: 50%; animation: twinkle 2s infinite; }
            .glow { box-shadow: 0 0 15px theme('colors.space.glow'); }
            .text-shadow { text-shadow: 0 0 10px theme('colors.space.glow'); }
            .bg-grid { background-size: 40px 40px; background-image: linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(to bottom, rgba(255,255,255,0.05) 1px, transparent 1px); }
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 dark:bg-space-black text-gray-800 dark:text-gray-100 transition-colors duration-300 min-h-screen font-sans">
    <div id="stars" class="fixed inset-0 z-0 pointer-events-none"></div>
    
    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-white/80 dark:bg-space-dark/80 backdrop-blur-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-space-blue to-space-purple flex items-center justify-center animate-rotate">
                    <i class="fa fa-compass text-white text-xl"></i>
                </div>
                <h1 class="text-xl font-bold font-space text-shadow">星际导航</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-space-blue/30 transition-colors">
                    <i class="fa fa-moon-o dark:hidden text-xl"></i>
                    <i class="fa fa-sun-o hidden dark:block text-xl text-star-yellow"></i>
                </button>
                <button id="edit-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-space-blue/30 transition-colors">
                    <i class="fa fa-cog text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 pt-24 pb-20 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-white dark:bg-space-dark rounded-xl p-5 shadow-lg dark:shadow-space-blue/20 border border-gray-200 dark:border-space-blue/30 transform hover:-translate-y-1 transition-all">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-lg font-space">在线时长</h3>
                    <i class="fa fa-clock-o text-space-glow"></i>
                </div>
                <div class="h-40">
                    <canvas id="onlineChart"></canvas>
                </div>
                <div class="mt-3 text-sm text-gray-500 dark:text-gray-400">
                    本周总时长: <span id="total-online" class="font-medium">0小时</span>
                </div>
            </div>
            
            <div class="bg-white dark:bg-space-dark rounded-xl p-5 shadow-lg dark:shadow-space-blue/20 border border-gray-200 dark:border-space-blue/30 transform hover:-translate-y-1 transition-all">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-lg font-space">健康提醒</h3>
                    <i class="fa fa-heartbeat text-space-pink"></i>
                </div>
                <div id="health-reminders" class="space-y-3">
                    <div class="p-3 bg-blue-50 dark:bg-space-blue/20 rounded-lg border-l-4 border-space-glow">
                        <div class="font-medium">休息提醒</div>
                        <div class="text-sm text-gray-600 dark:text-gray-300">每50分钟起身活动</div>
                    </div>
                    <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                        <div class="font-medium">用眼健康</div>
                        <div class="text-sm text-gray-600 dark:text-gray-300">遵循20-20-20规则</div>
                    </div>
                    <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-space-purple">
                        <div class="font-medium">饮水提醒</div>
                        <div class="text-sm text-gray-600 dark:text-gray-300">记得补充水分</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white dark:bg-space-dark rounded-xl p-5 shadow-lg dark:shadow-space-blue/20 border border-gray-200 dark:border-space-blue/30 transform hover:-translate-y-1 transition-all">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-lg font-space">世界时间</h3>
                    <div class="flex space-x-2">
                        <button id="add-timezone" class="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-space-blue/30 transition-colors">
                            <i class="fa fa-plus text-sm"></i>
                        </button>
                    </div>
                </div>
                <div id="timezones" class="space-y-3 max-h-40 overflow-y-auto scrollbar-hide">
                </div>
            </div>
        </div>
        
        <div id="ad-1" class="mb-10 rounded-xl-xl overflow-hidden shadow-lg relative group">
            <div class="absolute inset-0 bg-gradient-to-tr from-space-blue/20 to-transparent z-10"></div>
            <img src="https://picsum.photos/1200/200?random=1" alt="广告图片1" class="w-full h-40 object-cover transition-transform duration-500 group-hover:scale-105">
            <a href="#" class="absolute inset-0 z-20"></a>
        </div>
        
        <div id="bookmark-groups" class="space-y-10">
        </div>
        
        <div id="ad-2" class="my-10 rounded-xl overflow-hidden shadow-lg relative group">
            <div class="absolute inset-0 bg-gradient-to-tr from-space-purple/20 to-transparent z-10"></div>
            <img src="https://picsum.photos/1200/200?random=2" alt="广告图片2" class="w-full h-40 object-cover transition-transform duration-500 group-hover:scale-105">
            <a href="#" class="absolute inset-0 z-20"></a>
        </div>
        
        <div id="ad-3" class="my-10 rounded-xl overflow-hidden shadow-lg relative group">
            <div class="absolute inset-0 bg-gradient-to-tr from-space-pink/20 to-transparent z-10"></div>
            <img src="https://picsum.photos/1200/200?random=3" alt="广告图片3" class="w-full h-40 object-cover transition-transform duration-500 group-hover:scale-105">
            <a href="#" class="absolute inset-0 z-20"></a>
        </div>
    </main>
    
    <footer class="bg-white dark:bg-space-dark py-6 border-t border-gray-200 dark:border-space-blue/30 relative z-10">
        <div class="container mx-auto px-4">
            <div class="dark-white flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">共收录<span id="total-bookmarks" class="font-medium mx-1">0</span>个网站</div>
                <div>
                    <script>document.write(`Copyright © 2018-${new Date().getFullYear()} 星际导航, All Rights Reserved`)</script>
                </div>
            </div>
        </div>
    </footer>
    
    <div id="github-settings-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-space-dark rounded-xl p-6 w-full max-w-md shadow-2xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold font-space">GitHub 配置</h3>
                <button id="close-settings" class="p-1 hover:bg-gray-200 dark:hover:bg-space-blue/30 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">仓库 (username/repo-name)</label>
                    <input type="text" id="github-repo" placeholder="默认仓库将自动填充" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Personal Access Token</label>
                    <input type="password" id="github-token" placeholder="可选，用于私有仓库和修改操作" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">需要 repo 权限，仅用于访问您的GitHub仓库</p>
                </div>
                <button id="save-github-settings" class="w-full bg-space-blue hover:bg-space-blue/80 text-white py-2 rounded-lg transition-colors font-medium">保存配置</button>
            </div>
        </div>
    </div>
    
    <div id="edit-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden overflow-hidden">
        <div class="flex h-full">
            <div class="w-64 bg-white dark:bg-space-dark border-r border-gray-200 dark:border-space-blue/30 overflow-y-auto">
                <div class="p-4 border-b border-gray-200 dark:border-space-blue/30">
                    <h3 class="font-bold text-lg font-space">编辑中心</h3>
                </div>
                <div class="p-2">
                    <button id="import-bookmarks" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-space-blue/20 transition-colors mb-1">
                        <i class="fa fa-upload mr-2"></i>导入书签
                    </button>
                    <button id="export-bookmarks" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-space-blue/20 transition-colors mb-1">
                        <i class="fa fa-download mr-2"></i>导出书签
                    </button>
                    <button id="backup-data" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-space-blue/20 transition-colors mb-1">
                        <i class="fa fa-save mr-2"></i>备份数据
                    </button>
                    <button id="restore-data" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-space-blue/20 transition-colors mb-1">
                        <i class="fa fa-refresh mr-2"></i>恢复数据
                    </button>
                    <button id="manage-ads" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-space-blue/20 transition-colors mb-1">
                        <i class="fa fa-bullhorn mr-2"></i>管理广告
                    </button>
                    <button id="manage-timezones" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-space-blue/20 transition-colors mb-1">
                        <i class="fa fa-clock-o mr-2"></i>管理时区
                    </button>
                    <button id="save-changes" class="w-full bg-space-blue hover:bg-space-blue/80 text-white p-3 rounded-lg transition-colors mt-4 font-medium">
                        <i class="fa fa-github mr-2"></i>保存更改
                    </button>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6 font-space">书签管理</h2>
                    
                    <div class="bg-white dark:bg-space-dark rounded-xl p-5 shadow-md dark:shadow-space-blue/20 border border-gray-200 dark:border-space-blue/30 mb-8">
                        <h3 class="font-semibold text-lg mb-4">添加新书签</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-1">网址</label>
                                <input type="url" id="new-bookmark-url" placeholder="https://example.com" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">分组</label>
                                <input type="text" id="new-bookmark-group" placeholder="默认" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                            </div>
                            <div class="md:col-span-3">
                                <label class="block text-sm font-medium mb-1">标题 (可选)</label>
                                <input type="text" id="new-bookmark-title" placeholder="网站标题" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                            </div>
                            <div class="md:col-span-3">
                                <button id="add-bookmark-btn" class="bg-space-blue hover:bg-space-blue/80 text-white py-2 px-4 rounded-lg transition-colors">
                                    添加书签
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="edit-bookmarks-container">
                    </div>
                </div>
            </div>
            
            <button id="close-edit" class="absolute top-4 right-4 p-2 bg-white/20 hover:bg-white/30 rounded-full text-white transition-colors">
                <i class="fa fa-times text-xl"></i>
            </button>
        </div>
    </div>
    
    <div id="ads-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-space-dark rounded-xl p-6 w-full max-w-2xl shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold font-space">管理广告</h3>
                <button class="close-ads-modal p-1 hover:bg-gray-200 dark:hover:bg-space-blue/30 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div class="border border-gray-200 dark:border-space-blue/30 rounded-lg p-4">
                    <h4 class="font-medium mb-3">广告位 1</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">图片URL</label>
                            <input type="url" id="ad1-url" placeholder="广告图片URL" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">链接URL</label>
                            <input type="url" id="ad1-link" placeholder="广告链接URL" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">上传图片 (最大3M)</label>
                            <input type="file" id="ad1-upload" accept="image/*" class="w-full text-sm text-gray-500 dark:text-gray-400">
                        </div>
                        <button data-ad="1" class="delete-ad-btn text-red-500 hover:text-red-700 dark:hover:text-red-400 text-sm">
                            <i class="fa fa-trash mr-1"></i> 删除广告
                        </button>
                    </div>
                </div>
                
                <div class="border border-gray-200 dark:border-space-blue/30 rounded-lg p-4">
                    <h4 class="font-medium mb-3">广告位 2</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">图片URL</label>
                            <input type="url" id="ad2-url" placeholder="广告图片URL" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">链接URL</label>
                            <input type="url" id="ad2-link" placeholder="广告链接URL" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">上传图片 (最大3M)</label>
                            <input type="file" id="ad2-upload" accept="image/*" class="w-full text-sm text-gray-500 dark:text-gray-400">
                        </div>
                        <button data-ad="2" class="delete-ad-btn text-red-500 hover:text-red-700 dark:hover:text-red-400 text-sm">
                            <i class="fa fa-trash mr-1"></i> 删除广告
                        </button>
                    </div>
                </div>
                
                <div class="border border-gray-200 dark:border-space-blue/30 rounded-lg p-4">
                    <h4 class="font-medium mb-3">广告位 3</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">图片URL</label>
                            <input type="url" id="ad3-url" placeholder="广告图片URL" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">链接URL</label>
                            <input type="url" id="ad3-link" placeholder="广告链接URL" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">上传图片 (最大3M)</label>
                            <input type="file" id="ad3-upload" accept="image/*" class="w-full text-sm text-gray-500 dark:text-gray-400">
                        </div>
                        <button data-ad="3" class="delete-ad-btn text-red-500 hover:text-red-700 dark:hover:text-red-400 text-sm">
                            <i class="fa fa-trash mr-1"></i> 删除广告
                        </button>
                    </div>
                </div>
                
                <button class="save-ads-btn w-full bg-space-blue hover:bg-space-blue/80 text-white py-2 rounded-lg transition-colors font-medium">
                    保存广告设置
                </button>
            </div>
        </div>
    </div>
    
    <div id="timezones-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-space-dark rounded-xl p-6 w-full max-w-lg shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold font-space">管理时区</h3>
                <button class="close-timezones-modal p-1 hover:bg-gray-200 dark:hover:bg-space-blue/30 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <div class="flex gap-2">
                    <input type="text" id="new-timezone-name" placeholder="城市名称" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                    <input type="text" id="new-timezone-offset" placeholder="UTC偏移 (例如 +8)" class="w-24 px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50">
                    <button id="add-timezone-btn" class="bg-space-blue hover:bg-space-blue/80 text-white px-4 rounded-lg transition-colors">
                        <i class="fa fa-plus"></i>
                    </button>
                </div>
            </div>
            
            <div id="timezones-list" class="space-y-2">
            </div>
            
            <button class="save-timezones-btn w-full bg-space-blue hover:bg-space-blue/80 text-white py-2 rounded-lg transition-colors font-medium mt-4">
                保存时区设置
            </button>
        </div>
    </div>
    
    <div id="notification" class="fixed bottom-4 right-4 bg-white dark:bg-space-dark rounded-lg shadow-lg p-4 transform translate-y-20 opacity-0 transition-all duration-300 max-w-sm z-50 border border-gray-200 dark:border-space-blue/30">
        <div class="flex items-start">
            <div id="notification-icon" class="mr-3 text-xl"></div>
            <div>
                <h4 id="notification-title" class="font-medium"></h4>
                <p id="notification-message" class="text-sm text-gray-600 dark:text-gray-300"></p>
            </div>
        </div>
    </div>
    
    <script>
        const appData = {
            bookmarks: {},
            ads: {
                1: { imageUrl: 'https://picsum.photos/1200/200?random=1', linkUrl: '#' },
                2: { imageUrl: 'https://picsum.photos/1200/200?random=2', linkUrl: '#' },
                3: { imageUrl: 'https://picsum.photos/1200/200?random=3', linkUrl: '#' }
            },
            timezones: [
                { name: '北京', offset: '+8' },
                { name: '伦敦', offset: '0' },
                { name: '纽约', offset: '-4' }
            ],
            onlineTime: {
                labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                data: [2.5, 3.2, 1.8, 4.0, 2.1, 5.5, 3.8]
            },
            github: {
                repo: '',
                token: ''
            }
        };
        
        const DEFAULT_GITHUB_REPO = 'username/space-navigation';
        
        const elements = {
            themeToggle: document.getElementById('theme-toggle'),
            editBtn: document.getElementById('edit-btn'),
            editModal: document.getElementById('edit-modal'),
            closeEdit: document.getElementById('close-edit'),
            navbar: document.getElementById('navbar'),
            stars: document.getElementById('stars'),
            bookmarkGroups: document.getElementById('bookmark-groups'),
            editBookmarksContainer: document.getElementById('edit-bookmarks-container'),
            importBookmarks: document.getElementById('import-bookmarks'),
            exportBookmarks: document.getElementById('export-bookmarks'),
            backupData: document.getElementById('backup-data'),
            restoreData: document.getElementById('restore-data'),
            saveChanges: document.getElementById('save-changes'),
            manageAds: document.getElementById('manage-ads'),
            adsModal: document.getElementById('ads-modal'),
            closeAdsModal: document.querySelectorAll('.close-ads-modal'),
            saveAdsBtn: document.querySelector('.save-ads-btn'),
            deleteAdBtn: document.querySelectorAll('.delete-ad-btn'),
            manageTimezones: document.getElementById('manage-timezones'),
            timezonesModal: document.getElementById('timezones-modal'),
            closeTimezonesModal: document.querySelectorAll('.close-timezones-modal'),
            saveTimezonesBtn: document.querySelector('.save-timezones-btn'),
            addTimezoneBtn: document.getElementById('add-timezone-btn'),
            timezonesList: document.getElementById('timezones-list'),
            addTimezone: document.getElementById('add-timezone'),
            newBookmarkUrl: document.getElementById('new-bookmark-url'),
            newBookmarkTitle: document.getElementById('new-bookmark-title'),
            newBookmarkGroup: document.getElementById('new-bookmark-group'),
            addBookmarkBtn: document.getElementById('add-bookmark-btn'),
            githubSettingsModal: document.getElementById('github-settings-modal'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            saveGithubSettings: document.getElementById('save-github-settings'),
            closeSettings: document.getElementById('close-settings'),
            totalBookmarks: document.getElementById('total-bookmarks'),
            totalOnline: document.getElementById('total-online'),
            timezonesContainer: document.getElementById('timezones'),
            notification: document.getElementById('notification'),
            notificationIcon: document.getElementById('notification-icon'),
            notificationTitle: document.getElementById('notification-title'),
            notificationMessage: document.getElementById('notification-message')
        };
        
        async function init() {
            createStars();
            initTheme();
            initNavbarBehavior();
            await loadDataFromGitHub();
            renderOnlineChart();
            renderTimezones();
            renderBookmarks();
            renderAds();
            setupEventListeners();
            updateTotalBookmarks();
            updateTotalOnlineTime();
        }
        
        function createStars() {
            const count = 150;
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2;
                star.classList.add('star');
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                star.style.opacity = Math.random();
                elements.stars.appendChild(star);
            }
        }
        
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        function initNavbarBehavior() {
            let lastScrollTop = 0;
            let hideTimeout;
            
            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                clearTimeout(hideTimeout);
                elements.navbar.classList.remove('translate-y-[-100%]');
                
                hideTimeout = setTimeout(() => {
                    if (scrollTop > 100) {
                        elements.navbar.classList.add('translate-y-[-100%]');
                    }
                }, 3000);
                
                lastScrollTop = scrollTop;
            });
        }
        
        async function loadDataFromGitHub() {
            try {
                const savedGithubRepo = localStorage.getItem('githubRepo');
                const savedGithubToken = localStorage.getItem('githubToken');
                
                appData.github.repo = savedGithubRepo || DEFAULT_GITHUB_REPO;
                appData.github.token = savedGithubToken || '';
                
                elements.githubRepo.value = appData.github.repo;
                elements.githubToken.value = appData.github.token;
                
                let url;
                let headers = {};
                
                if (appData.github.token) {
                    url = `https://api.github.com/repos/${appData.github.repo}/contents/bookmarks.json`;
                    headers = {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    };
                } else {
                    url = `https://raw.githubusercontent.com/${appData.github.repo}/main/bookmarks.json`;
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                let data;
                if (appData.github.token) {
                    const apiData = await response.json();
                    data = JSON.parse(atob(apiData.content));
                } else {
                    data = await response.json();
                }
                
                if (data.bookmarks) appData.bookmarks = data.bookmarks;
                if (data.ads) appData.ads = data.ads;
                if (data.timezones) appData.timezones = data.timezones;
                if (data.onlineTime) appData.onlineTime = data.onlineTime;
                
                showNotification('success', '数据加载成功', '已从GitHub加载最新数据');
            } catch (error) {
                console.error('Failed to load data from GitHub:', error);
                showNotification('error', '数据加载失败', '使用本地默认数据');
                
                const localData = localStorage.getItem('backupData');
                if (localData) {
                    try {
                        const data = JSON.parse(localData);
                        if (data.bookmarks) appData.bookmarks = data.bookmarks;
                        if (data.ads) appData.ads = data.ads;
                        if (data.timezones) appData.timezones = data.timezones;
                        if (data.onlineTime) appData.onlineTime = data.onlineTime;
                        showNotification('info', '使用本地备份', '已加载最近的本地备份数据');
                    } catch (e) {
                        console.error('Failed to parse local backup:', e);
                    }
                }
            }
        }
        
        async function saveDataToGitHub() {
            try {
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    ads: appData.ads,
                    timezones: appData.timezones,
                    onlineTime: appData.onlineTime
                };
                
                const jsonString = JSON.stringify(dataToSave);
                const encoder = new TextEncoder();
                const dataBytes = encoder.encode(jsonString);
                const base64Content = btoa(String.fromCharCode(...new Uint8Array(dataBytes)));
                
                let url = `https://api.github.com/repos/${appData.github.repo}/contents/bookmarks.json`;
                let sha;
                
                try {
                    const checkResponse = await fetch(url, {
                        headers: {
                            'Authorization': `token ${appData.github.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (checkResponse.ok) {
                        const existingData = await checkResponse.json();
                        sha = existingData.sha;
                    }
                } catch (error) {
                    console.log('File does not exist, creating new one');
                }
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via space navigation app',
                        content: base64Content,
                        sha: sha
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                localStorage.setItem('backupData', jsonString);
                return true;
            } catch (error) {
                console.error('Failed to save data to GitHub:', error);
                return false;
            }
        }
        
        function renderOnlineChart() {
            const ctx = document.getElementById('onlineChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: appData.onlineTime.labels,
                    datasets: [{
                        label: '在线时长 (小时)',
                        data: appData.onlineTime.data,
                        backgroundColor: [
                            'rgba(56, 189, 248, 0.7)',
                            'rgba(56, 189, 248, 0.7)',
                            'rgba(56, 189, 248, 0.7)',
                            'rgba(56, 189, 248, 0.7)',
                            'rgba(56, 189, 248, 0.7)',
                            'rgba(236, 72, 153, 0.7)',
                            'rgba(236, 72, 153, 0.7)'
                        ],
                        borderColor: [
                            'rgba(56, 189, 248, 1)',
                            'rgba(56, 189, 248, 1)',
                            'rgba(56, 189, 248, 1)',
                            'rgba(56, 189, 248, 1)',
                            'rgba(56, 189, 248, 1)',
                            'rgba(236, 72, 153, 1)',
                            'rgba(236, 72, 153, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function updateTotalOnlineTime() {
            const total = appData.onlineTime.data.reduce((sum, hours) => sum + hours, 0).toFixed(1);
            elements.totalOnline.textContent = `${total}小时`;
        }
        
        function renderTimezones() {
            elements.timezonesContainer.innerHTML = '';
            
            appData.timezones.forEach((timezone) => {
                const timezoneEl = document.createElement('div');
                timezoneEl.className = 'flex justify-between items-center p-2 bg-gray-50 dark:bg-space-blue/10 rounded-lg';
                
                const now = new Date();
                const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
                const offsetHours = parseFloat(timezone.offset);
                const localTime = new Date(utcTime + offsetHours * 3600000);
                const timeString = localTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                timezoneEl.innerHTML = `
                    <div>
                        <div class="font-medium">${timezone.name}</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">UTC${timezone.offset}</div>
                    </div>
                    <div class="text-xl font-mono">${timeString}</div>
                `;
                
                elements.timezonesContainer.appendChild(timezoneEl);
            });
            
            renderTimezonesList();
        }
        
        function renderTimezonesList() {
            elements.timezonesList.innerHTML = '';
            
            appData.timezones.forEach((timezone, index) => {
                const timezoneEl = document.createElement('div');
                timezoneEl.className = 'flex justify-between items-center p-2 bg-gray-50 dark:bg-space-blue/10 rounded-lg';
                
                timezoneEl.innerHTML = `
                    <div>
                        <div class="font-medium">${timezone.name}</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">UTC${timezone.offset}</div>
                    </div>
                    <button data-index="${index}" class="delete-timezone-btn text-red-500 hover:text-red-700 dark:hover:text-red-400">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                
                elements.timezonesList.appendChild(timezoneEl);
            });
            
            document.querySelectorAll('.delete-timezone-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    appData.timezones.splice(index, 1);
                    renderTimezonesList();
                });
            });
        }
        
        function renderBookmarks() {
            elements.bookmarkGroups.innerHTML = '';
            
            Object.keys(appData.bookmarks).forEach(groupName => {
                const bookmarks = appData.bookmarks[groupName];
                
                const groupEl = document.createElement('div');
                groupEl.className = 'bookmark-group';
                
                const groupTitle = document.createElement('h2');
                groupTitle.className = 'text-xl font-bold mb-4 font-space flex items-center';
                groupTitle.innerHTML = `<i class="fa fa-folder-open-o mr-2 text-space-glow"></i>${groupName}`;
                groupEl.appendChild(groupTitle);
                
                const bookmarksGrid = document.createElement('div');
                bookmarksGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4';
                groupEl.appendChild(bookmarksGrid);
                
                bookmarks.forEach((bookmark) => {
                    const bookmarkEl = document.createElement('a');
                    bookmarkEl.href = bookmark.url;
                    bookmarkEl.target = '_blank';
                    bookmarkEl.className = 'bg-white dark:bg-space-dark rounded-lg p-3 shadow-md dark:shadow-space-blue/20 border border-gray-200 dark:border-space-blue/30 hover:shadow-lg dark:hover:shadow-space-blue/30 hover:-translate-y-1 transition-all flex flex-col items-center text-center group';
                    
                    let faviconHtml = '';
                    if (bookmark.favicon) {
                        faviconHtml = `<img src="${bookmark.favicon}" alt="${bookmark.title} 图标" class="w-8 h-8 mb-2 rounded opacity-80 group-hover:opacity-100 transition-opacity">`;
                    } else if (bookmark.title && bookmark.title.trim() !== '') {
                        const firstChar = bookmark.title.trim()[0].toUpperCase();
                        faviconHtml = `<div class="w-8 h-8 mb-2 rounded bg-space-blue/20 dark:bg-space-blue/30 flex items-center justify-center text-space-glow font-bold">${firstChar}</div>`;
                    } else {
                        faviconHtml = `<div class="w-8 h-8 mb-2 rounded bg-gray-200 dark:bg-space-dark flex items-center justify-center text-gray-500 dark:text-gray-400"><i class="fa fa-globe"></i></div>`;
                    }
                    
                    bookmarkEl.innerHTML = `
                        ${faviconHtml}
                        <span class="text-sm font-medium truncate w-full">${bookmark.title || new URL(bookmark.url).hostname}</span>
                    `;
                    
                    bookmarksGrid.appendChild(bookmarkEl);
                });
                
                elements.bookmarkGroups.appendChild(groupEl);
            });
            
            renderEditBookmarks();
            updateTotalBookmarks();
        }
        
        function renderEditBookmarks() {
            elements.editBookmarksContainer.innerHTML = '';
            
            Object.keys(appData.bookmarks).forEach(groupName => {
                const bookmarks = appData.bookmarks[groupName];
                
                const groupEl = document.createElement('div');
                groupEl.className = 'mb-8';
                
                const groupHeader = document.createElement('div');
                groupHeader.className = 'flex justify-between items-center mb-4';
                groupHeader.innerHTML = `
                    <h3 class="text-xl font-bold font-space">${groupName}</h3>
                    <button data-group="${groupName}" class="delete-group-btn text-red-500 hover:text-red-700 dark:hover:text-red-400 text-sm">
                        <i class="fa fa-trash mr-1"></i> 删除分组
                    </button>
                `;
                groupEl.appendChild(groupHeader);
                
                const bookmarksList = document.createElement('div');
                bookmarksList.className = 'grid grid-cols-1 md:grid-cols-2 gap-3';
                groupEl.appendChild(bookmarksList);
                
                bookmarks.forEach((bookmark, index) => {
                    const bookmarkEl = document.createElement('div');
                    bookmarkEl.className = 'bg-white dark:bg-space-dark rounded-lg p-4 shadow-md-md dark:shadow-space-blue/20 border border-gray-200 dark:border-space-blue/30';
                    
                    bookmarkEl.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <div class="font-medium">${bookmark.title || new URL(bookmark.url).hostname}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400 truncate w-48">${bookmark.url}</div>
                            </div>
                            <div class="flex space-x-2">
                                <button data-group="${groupName}" data-index="${index}" class="edit-bookmark-btn p-1.5 rounded hover:bg-gray-200 dark:hover:bg-space-blue/30 transition-colors">
                                    <i class="fa fa-pencil"></i>
                                </button>
                                <button data-group="${groupName}" data-index="${index}" class="delete-bookmark-btn p-1.5 rounded hover:bg-gray-200 dark:hover:bg-space-blue/30 transition-colors">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="edit-bookmark-form hidden space-y-2">
                            <div>
                                <input type="url" value="${bookmark.url}" class="bookmark-url w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50 text-sm">
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" value="${bookmark.title || ''}" placeholder="标题" class="bookmark-title px-3 py-2 rounded-lg border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50 text-sm">
                                <input type="text" value="${groupName}" placeholder="分组" class="bookmark-group px-3 py-2 rounded-lg border border border-gray-300 dark:border-space-blue/50 bg-gray-100 dark:bg-space-black focus:outline-none focus:ring-2 focus:ring-space-glow dark:bg-opacity-50 text-sm">
                            </div>
                            <div class="flex justify-end space-x-2">
                                <button class="cancel-edit-btn px-3 py-1 bg-gray-200 dark:bg-space-dark dark:border-space-blue/50 rounded text-sm">取消</button>
                                <button data-original-group="${groupName}" data-index="${index}" class="save-edit-btn px-3 py-1 bg-space-blue hover:bg-space-blue/80 text-white rounded text-sm">保存</button>
                            </div>
                        </div>
                    `;
                    
                    bookmarksList.appendChild(bookmarkEl);
                });
                
                elements.editBookmarksContainer.appendChild(groupEl);
            });
            
            setupEditBookmarkListeners();
        }
        
        function setupEditBookmarkListeners() {
            document.querySelectorAll('.edit-bookmark-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.edit-bookmark-form').forEach(f => f.classList.add('hidden'));
                    const form = e.currentTarget.closest('.bg-white, .bg-space-dark').querySelector('.edit-bookmark-form');
                    form.classList.remove('hidden');
                });
            });
            
            document.querySelectorAll('.cancel-edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.currentTarget.closest('.edit-bookmark-form').classList.add('hidden');
                });
            });
            
            document.querySelectorAll('.save-edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const originalGroup = e.currentTarget.dataset.originalGroup;
                    const index = parseInt(e.currentTarget.dataset.index);
                    const bookmarkEl = e.currentTarget.closest('.bg-white, .bg-space-dark');
                    const url = bookmarkEl.querySelector('.bookmark-url').value;
                    const title = bookmarkEl.querySelector('.bookmark-title').value;
                    const newGroup = bookmarkEl.querySelector('.bookmark-group').value;
                    
                    try {
                        new URL(url);
                    } catch (error) {
                        showNotification('error', '无效的URL', '请输入有效的网址');
                        return;
                    }
                    
                    getFavicon(url).then(favicon => {
                        const bookmark = appData.bookmarks[originalGroup][index];
                        appData.bookmarks[originalGroup].splice(index, 1);
                        
                        if (appData.bookmarks[originalGroup].length === 0) {
                            delete appData.bookmarks[originalGroup];
                        }
                        
                        if (!appData.bookmarks[newGroup]) {
                            appData.bookmarks[newGroup] = [];
                        }
                        
                        appData.bookmarks[newGroup].push({
                            url: url,
                            title: title || bookmark.title,
                            favicon: favicon || bookmark.favicon
                        });
                        
                        renderBookmarks();
                        showNotification('success', '书签已更新', '书签信息已成功更新');
                    });
                });
            });
            
            document.querySelectorAll('.delete-bookmark-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const group = e.currentTarget.dataset.group;
                    const index = parseInt(e.currentTarget.dataset.index);
                    const bookmark = appData.bookmarks[group][index];
                    const bookmarkName = bookmark.title || new URL(bookmark.url).hostname;
                    
                    if (confirm(`确定要删除书签 "${bookmarkName}" 吗？`)) {
                        appData.bookmarks[group].splice(index, 1);
                        
                        if (appData.bookmarks[group].length === 0) {
                            delete appData.bookmarks[group];
                        }
                        
                        renderBookmarks();
                        showNotification('info', '书签已删除', `"${bookmarkName}" 已从收藏中移除`);
                    }
                });
            });
            
            document.querySelectorAll('.delete-group-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const group = e.currentTarget.dataset.group;
                    const bookmarkCount = appData.bookmarks[group].length;
                    
                    if (confirm(`确定要删除分组 "${group}" 吗？这将同时删除该分组中的 ${bookmarkCount} 个书签。`)) {
                        delete appData.bookmarks[group];
                        renderBookmarks();
                        showNotification('info', '分组已删除', `"${group}" 分组及其中的书签已移除`);
                    }
                });
            });
        }
        
        function renderAds() {
            for (let i = 1; i <= 3; i++) {
                const ad = appData.ads[i];
                if (ad) {
                    const adEl = document.getElementById(`ad-${i}`);
                    const imgEl = adEl.querySelector('img');
                    const linkEl = adEl.querySelector('a');
                    
                    imgEl.src = ad.imageUrl;
                    imgEl.alt = `广告图片 ${i}`;
                    linkEl.href = ad.linkUrl;
                    
                    document.getElementById(`ad${i}-url`).value = ad.imageUrl || '';
                    document.getElementById(`ad${i}-link`).value = ad.linkUrl || '';
                }
            }
        }
        
        function updateTotalBookmarks() {
            let total = 0;
            Object.values(appData.bookmarks).forEach(bookmarks => {
                total += bookmarks.length;
            });
            elements.totalBookmarks.textContent = total;
        }
        
        function getFavicon(url) {
            try {
                const parsedUrl = new URL(url);
                return new Promise(resolve => {
                    const testImg = new Image();
                    testImg.src = `${parsedUrl.protocol}//${parsedUrl.hostname}/favicon.ico`;
                    testImg.onload = () => resolve(testImg.src);
                    testImg.onerror = () => {
                        resolve(`https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(parsedUrl.href)}&size=32`);
                    };
                });
            } catch (error) {
                console.error('Failed to get favicon:', error);
                return Promise.resolve(null);
            }
        }
        
        function importBookmarks(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(e.target.result, 'text/html');
                    const bookmarks = doc.querySelectorAll('a');
                    
                    let importedCount = 0;
                    let duplicateCount = 0;
                    
                    const existingUrls = new Set();
                    Object.values(appData.bookmarks).forEach(group => {
                        group.forEach(bookmark => {
                            existingUrls.add(bookmark.url);
                        });
                    });
                    
                    bookmarks.forEach(bookmark => {
                        const url = bookmark.href;
                        const title = bookmark.textContent.trim();
                        
                        if (!url || url === 'about:blank' || existingUrls.has(url)) {
                            duplicateCount++;
                            return;
                        }
                        
                        let groupName = '默认';
                        let parent = bookmark.parentNode;
                        while (parent && parent.tagName !== 'DL') {
                            if (parent.tagName === 'H3') {
                                groupName = parent.textContent.trim() || groupName;
                                break;
                            }
                            parent = parent.parentNode;
                        }
                        
                        getFavicon(url).then(favicon => {
                            if (!appData.bookmarks[groupName]) {
                                appData.bookmarks[groupName] = [];
                            }
                            
                            appData.bookmarks[groupName].push({
                                url: url,
                                title: title,
                                favicon: favicon
                            });
                            
                            existingUrls.add(url);
                            importedCount++;
                            renderBookmarks();
                        });
                    });
                    
                    showNotification('success', '书签导入完成', `成功导入 ${importedCount} 个书签，跳过 ${duplicateCount} 个重复项`);
                } catch (error) {
                    console.error('Failed to import bookmarks:', error);
                    showNotification('error', '导入失败', '无法解析书签文件，请确保文件格式正确');
                }
            };
            
            reader.readAsText(file);
        }
        
        function exportBookmarks() {
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            Object.keys(appData.bookmarks).forEach(groupName => {
                html += `<DT><H3>${groupName}</H3>
<DL><p>`;
                
                appData.bookmarks[groupName].forEach(bookmark => {
                    html += `<DT><A HREF="${bookmark.url}">${bookmark.title || new URL(bookmark.url).hostname}</A>`;
                });
                
                html += `</DL><p>`;
            });
            
            html += `</DL><p>`;
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `星际导航书签_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('success', '书签导出成功', '书签已导出为HTML文件');
        }
        
        function backupData() {
            const dataToBackup = {
                bookmarks: appData.bookmarks,
                ads: appData.ads,
                timezones: appData.timezones,
                onlineTime: appData.onlineTime
            };
            
            const jsonString = JSON.stringify(dataToBackup, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `星际导航备份_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('success', '数据备份成功', '所有数据已导出为JSON文件');
        }
        
        function restoreData(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    
                    if (restoredData.bookmarks) appData.bookmarks = restoredData.bookmarks;
                    if (restoredData.ads) appData.ads = restoredData.ads;
                    if (restoredData.timezones) appData.timezones = restoredData.timezones;
                    if (restoredData.onlineTime) appData.onlineTime = restoredData.onlineTime;
                    
                    renderBookmarks();
                    renderAds();
                    renderTimezones();
                    renderOnlineChart();
                    updateTotalOnlineTime();
                    
                    showNotification('success', '数据恢复成功', '已从备份文件恢复数据');
                } catch (error) {
                    console.error('Failed to restore data:', error);
                    showNotification('error', '恢复失败', '无法解析备份文件，请确保文件格式正确');
                }
            };
            
            reader.readAsText(file);
        }
        
        function showNotification(type, title, message) {
            const iconMap = {
                success: '<i class="fa fa-check-circle text-green-500"></i>',
                error: '<i class="fa fa-exclamation-circle text-red-500"></i>',
                info: '<i class="fa fa-info-circle text-blue-500"></i>'
            };
            
            elements.notificationIcon.innerHTML = iconMap[type] || iconMap.info;
            elements.notificationTitle.textContent = title;
            elements.notificationMessage.textContent = message;
            
            elements.notification.classList.remove('translate-y-20', 'opacity-0');
            elements.notification.classList.add('translate-y-0', 'opacity-100');
            
            setTimeout(() => {
                elements.notification.classList.remove('translate-y-0', 'opacity-100');
                elements.notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
        
        function setupEventListeners() {
            elements.themeToggle.addEventListener('click', () => {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.theme = 'light';
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.theme = 'dark';
                }
                renderOnlineChart();
            });
            
            elements.editBtn.addEventListener('click', () => {
                const savedGithubRepo = localStorage.getItem('githubRepo');
                
                if (!savedGithubRepo) {
                    elements.githubSettingsModal.classList.remove('hidden');
                    elements.githubSettingsModal.classList.add('flex');
                } else {
                    elements.editModal.classList.remove('hidden');
                    elements.editModal.classList.add('flex');
                }
            });
            
            elements.closeEdit.addEventListener('click', () => {
                elements.editModal.classList.remove('flex');
                elements.editModal.classList.add('hidden');
            });
            
            elements.closeSettings.addEventListener('click', () => {
                elements.githubSettingsModal.classList.remove('flex');
                elements.githubSettingsModal.classList.add('hidden');
            });
            
            elements.saveGithubSettings.addEventListener('click', () => {
                const repo = elements.githubRepo.value.trim();
                const token = elements.githubToken.value.trim();
                
                if (!repo) {
                    showNotification('error', '配置错误', '请输入GitHub仓库地址');
                    return;
                }
                
                localStorage.setItem('githubRepo', repo);
                localStorage.setItem('githubToken', token);
                
                appData.github.repo = repo;
                appData.github.token = token;
                
                elements.githubSettingsModal.classList.remove('flex');
                elements.githubSettingsModal.classList.add('hidden');
                elements.editModal.classList.remove('hidden');
                elements.editModal.classList.add('flex');
                
                showNotification('success', '配置已保存', 'GitHub设置已更新');
            });
            
            elements.importBookmarks.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.html';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        importBookmarks(file);
                    }
                };
                
                input.click();
            });
            
            elements.exportBookmarks.addEventListener('click', exportBookmarks);
            
            elements.backupData.addEventListener('click', backupData);
            
            elements.restoreData.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        restoreData(file);
                    }
                };
                
                input.click();
            });
            
            elements.manageAds.addEventListener('click', () => {
                elements.adsModal.classList.remove('hidden');
                elements.adsModal.classList.add('flex');
            });
            
            elements.closeAdsModal.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.adsModal.classList.remove('flex');
                    elements.adsModal.classList.add('hidden');
                });
            });
            
            elements.deleteAdBtn.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const adId = e.currentTarget.dataset.ad;
                    if (confirm(`确定要删除广告位 ${adId} 吗？`)) {
                        appData.ads[adId] = { imageUrl: '', linkUrl: '#' };
                        document.getElementById(`ad${adId}-url`).value = '';
                        document.getElementById(`ad${adId}-link`).value = '#';
                        renderAds();
                    }
                });
            });
            
            elements.saveAdsBtn.addEventListener('click', () => {
                for (let i = 1; i <= 3; i++) {
                    const imageUrl = document.getElementById(`ad${i}-url`).value.trim();
                    const linkUrl = document.getElementById(`ad${i}-link`).value.trim();
                    
                    appData.ads[i] = {
                        imageUrl: imageUrl || `https://picsum.photos/1200/200?random=${i}`,
                        linkUrl: linkUrl || '#'
                    };
                }
                
                renderAds();
                elements.adsModal.classList.remove('flex');
                elements.adsModal.classList.add('hidden');
                showNotification('success', '广告设置已保存', '广告配置已更新');
            });
            
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`ad${i}-upload`).addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 3 * 1024 * 1024) {
                            showNotification('error', '文件过大', '图片大小不能超过3M');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            document.getElementById(`ad${i}-url`).value = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            elements.manageTimezones.addEventListener('click', () => {
                elements.timezonesModal.classList.remove('hidden');
                elements.timezonesModal.classList.add('flex');
            });
            
            elements.closeTimezonesModal.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.timezonesModal.classList.remove('flex');
                    elements.timezonesModal.classList.add('hidden');
                });
            });
            
            elements.addTimezoneBtn.addEventListener('click', () => {
                const name = document.getElementById('new-timezone-name').value.trim();
                const offset = document.getElementById('new-timezone-offset').value.trim();
                
                if (!name || !offset) {
                    showNotification('error', '输入错误', '请填写城市名称和UTC偏移');
                    return;
                }
                
                if (!/^[+-]\d{1,2}$/.test(offset)) {
                    showNotification('error', '格式错误', 'UTC偏移格式应为 +8 或 -5 这样的形式');
                    return;
                }
                
                appData.timezones.push({ name, offset });
                renderTimezonesList();
                
                document.getElementById('new-timezone-name').value = '';
                document.getElementById('new-timezone-offset').value = '';
            });
            
            elements.addTimezone.addEventListener('click', () => {
                elements.timezonesModal.classList.remove('hidden');
                elements.timezonesModal.classList.add('flex');
            });
            
            elements.saveTimezonesBtn.addEventListener('click', () => {
                renderTimezones();
                elements.timezonesModal.classList.remove('flex');
                elements.timezonesModal.classList.add('hidden');
                showNotification('success', '时区设置已保存', '时区配置已更新');
            });
            
            elements.addBookmarkBtn.addEventListener('click', () => {
                const url = elements.newBookmarkUrl.value.trim();
                const title = elements.newBookmarkTitle.value.trim();
                const group = elements.newBookmarkGroup.value.trim() || '默认';
                
                try {
                    new URL(url);
                } catch (error) {
                    showNotification('error', '无效的URL', '请输入有效的网址，例如 https://example.com');
                    return;
                }
                
                let isDuplicate = false;
                Object.values(appData.bookmarks).forEach(bookmarks => {
                    bookmarks.forEach(bookmark => {
                        if (bookmark.url === url) {
                            isDuplicate = true;
                        }
                    });
                });
                
                if (isDuplicate) {
                    showNotification('warning', '书签已存在', '该网址已在收藏夹中');
                    return;
                }
                
                getFavicon(url).then(favicon => {
                    if (!appData.bookmarks[group]) {
                        appData.bookmarks[group] = [];
                    }
                    
                    appData.bookmarks[group].push({
                        url: url,
                        title: title,
                        favicon: favicon
                    });
                    
                    elements.newBookmarkUrl.value = '';
                    elements.newBookmarkTitle.value = '';
                    
                    renderBookmarks();
                    showNotification('success', '书签已添加', '成功添加新书签');
                });
            });
            
            elements.saveChanges.addEventListener('click', async () => {
                elements.saveChanges.disabled = true;
                elements.saveChanges.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>保存中...';
                
                const success = await saveDataToGitHub();
                
                elements.saveChanges.disabled = false;
                elements.saveChanges.innerHTML = '<i class="fa fa-github mr-2"></i>保存更改';
                
                if (success) {
                    showNotification('success', '保存成功', '所有更改已同步到GitHub');
                    elements.editModal.classList.remove('flex');
                    elements.editModal.classList.add('hidden');
                } else {
                    showNotification('error', '保存失败', '无法同步到GitHub，请检查配置或稍后重试');
                }
            });
            
            elements.editModal.addEventListener('click', (e) => {
                if (e.target === elements.editModal) {
                    elements.editModal.classList.remove('flex');
                    elements.editModal.classList.add('hidden');
                }
            });
            
            elements.adsModal.addEventListener('click', (e) => {
                if (e.target === elements.adsModal) {
                    elements.adsModal.classList.remove('flex');
                    elements.adsModal.classList.add('hidden');
                }
            });
            
            elements.timezonesModal.addEventListener('click', (e) => {
                if (e.target === elements.timezonesModal) {
                    elements.timezonesModal.classList.remove('flex');
                    elements.timezonesModal.classList.add('hidden');
                }
            });
            
            elements.githubSettingsModal.addEventListener('click', (e) => {
                if (e.target === elements.githubSettingsModal) {
                    elements.githubSettingsModal.classList.remove('flex');
                    elements.githubSettingsModal.classList.add('hidden');
                }
            });
            
            setInterval(renderTimezones, 1000);
        }
        
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    