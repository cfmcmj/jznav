<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 宇宙书签</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231a1a2e'/%3E%3Ccircle cx='50' cy='50' r='25' fill='%23e2b13c'/%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            dark: '#0d1117',
                            darker: '#0a0e14',
                            blue: '#165DFF',
                            purple: '#7B2FFD',
                            pink: '#FF2E93',
                            accent: '#4FD1C5',
                            star: '#E2B13C'
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif']
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.5 }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 0 8px currentColor;
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle var(--twinkle-duration, 2s) infinite;
            }
            .bookmark-hover {
                transition: all 0.3s ease;
            }
            .bookmark-hover:hover {
                transform: translateY(-3px) scale(1.02);
                box-shadow: 0 10px 25px -5px rgba(22, 93, 255, 0.3);
            }
            .glass {
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            .glass-dark {
                background: rgba(10, 14, 20, 0.8);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.05);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-space-dark text-gray-200 min-h-screen overflow-x-hidden relative">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0 pointer-events-none"></div>
    
    <!-- 顶部导航栏 -->
    <header id="navbar" class="glass-dark fixed top-0 left-0 right-0 z-50 transition-all duration-300 py-3 px-4 md:px-8">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-space-blue to-space-purple flex items-center justify-center animate-pulse-slow">
                    <i class="fa fa-compass text-white text-xl"></i>
                </div>
                <h1 class="text-xl md:text-2xl font-space font-bold bg-clip-text text-transparent bg-gradient-to-r from-space-blue to-space-purple">星际导航</h1>
            </div>
            
            <div class="hidden md:block relative w-1/3">
                <input type="text" id="search-input" placeholder="搜索书签..." 
                    class="w-full bg-space-darker border border-gray-700 rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all">
                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
            
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-800 transition-colors">
                    <i class="fa fa-moon-o text-space-star"></i>
                </button>
                <button id="settings-btn" class="p-2 rounded-full hover:bg-gray-800 transition-colors">
                    <i class="fa fa-cog text-space-accent"></i>
                </button>
                <button id="edit-center-btn" class="hidden md:flex items-center space-x-1 bg-space-blue hover:bg-space-blue/80 text-white px-3 py-1.5 rounded-full transition-all" disabled>
                    <i class="fa fa-pencil"></i>
                    <span>编辑中心</span>
                </button>
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-full hover:bg-gray-800 transition-colors">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- 移动端搜索框 -->
        <div class="mt-3 md:hidden relative">
            <input type="text" id="mobile-search-input" placeholder="搜索书签..." 
                class="w-full bg-space-darker border border-gray-700 rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all">
            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
    </header>

    <!-- 移动端菜单 -->
    <div id="mobile-menu" class="fixed inset-0 bg-space-darker/95 z-40 transform translate-x-full transition-transform duration-300 md:hidden">
        <div class="p-4 flex justify-end">
            <button id="close-mobile-menu" class="p-2">
                <i class="fa fa-times text-2xl"></i>
            </button>
        </div>
        <div class="flex flex-col items-center space-y-6 mt-10">
            <button id="mobile-edit-center-btn" class="flex items-center space-x-2 bg-space-blue hover:bg-space-blue/80 text-white px-4 py-2 rounded-full transition-all" disabled>
                <i class="fa fa-pencil"></i>
                <span>编辑中心</span>
            </button>
            <button id="mobile-theme-toggle" class="flex items-center space-x-2 p-4 rounded-full hover:bg-gray-800 transition-colors">
                <i class="fa fa-moon-o text-space-star"></i>
                <span>切换主题</span>
            </button>
            <button id="mobile-settings-btn" class="flex items-center space-x-2 p-4 rounded-full hover:bg-gray-800 transition-colors">
                <i class="fa fa-cog text-space-accent"></i>
                <span>设置</span>
            </button>
        </div>
    </div>

    <!-- 主内容区 -->
    <main class="container mx-auto pt-24 pb-16 px-4 relative z-10">
        <!-- 顶部小组件 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- 在线时长 -->
            <div class="glass rounded-xl p-5 bookmark-hover">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-space font-semibold text-lg">太空航行时间</h3>
                    <div class="w-8 h-8 rounded-full bg-space-purple/20 flex items-center justify-center">
                        <i class="fa fa-clock-o text-space-purple"></i>
                    </div>
                </div>
                <div class="flex items-end space-x-1">
                    <span id="online-time" class="text-2xl md:text-3xl font-bold text-white">00:00:00</span>
                    <span class="text-sm text-gray-400 mb-1">hh:mm:ss</span>
                </div>
                <p class="text-sm text-gray-400 mt-2">自部署以来</p>
            </div>
            
            <!-- 健康提醒 -->
            <div class="glass rounded-xl p-5 bookmark-hover">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-space font-semibold text-lg">健康提醒</h3>
                    <div class="w-8 h-8 rounded-full bg-space-pink/20 flex items-center justify-center">
                        <i class="fa fa-heartbeat text-space-pink"></i>
                    </div>
                </div>
                <div id="health-reminder" class="text-lg font-medium">
                    保持健康，定时休息
                </div>
                <p id="next-reminder" class="text-sm text-gray-400 mt-2">
                    下次提醒: 1小时后
                </p>
            </div>
            
            <!-- 世界时钟 -->
            <div class="glass rounded-xl p-5 bookmark-hover">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-space font-semibold text-lg">全球时间</h3>
                    <div class="w-8 h-8 rounded-full bg-space-accent/20 flex items-center justify-center">
                        <i class="fa fa-globe text-space-accent"></i>
                    </div>
                </div>
                <div id="world-clocks" class="space-y-2">
                    <!-- 时钟将通过JS动态生成 -->
                </div>
            </div>
        </div>
        
        <!-- 广告位 1 -->
        <div id="ad-slot-1" class="my-8 rounded-xl overflow-hidden bookmark-hover relative h-40 md:h-56 bg-gradient-to-r from-space-blue/20 to-space-purple/20 flex items-center justify-center">
            <div class="text-center p-4">
                <p class="text-gray-400 text-sm">广告位 1</p>
                <p class="text-gray-500 text-xs">在编辑中心配置</p>
            </div>
        </div>
        
        <!-- 书签文件夹 -->
        <div id="bookmark-folders" class="space-y-6 mb-8">
            <!-- 书签文件夹将通过JS动态生成 -->
        </div>
        
        <!-- 广告位 2 -->
        <div id="ad-slot-2" class="my-8 rounded-xl overflow-hidden bookmark-hover relative h-40 md:h-56 bg-gradient-to-r from-space-purple/20 to-space-pink/20 flex items-center justify-center">
            <div class="text-center p-4">
                <p class="text-gray-400 text-sm">广告位 2</p>
                <p class="text-gray-500 text-xs">在编辑中心配置</p>
            </div>
        </div>
        
        <!-- 所有书签（无文件夹） -->
        <div id="all-bookmarks" class="mb-8">
            <h2 class="text-xl font-space font-bold mb-4 flex items-center">
                <i class="fa fa-bookmark text-space-star mr-2"></i>
                所有书签
            </h2>
            <div id="bookmarks-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3">
                <!-- 书签将通过JS动态生成 -->
            </div>
        </div>
        
        <!-- 广告位 3 -->
        <div id="ad-slot-3" class="my-8 rounded-xl overflow-hidden bookmark-hover relative h-40 md:h-56 bg-gradient-to-r from-space-pink/20 to-space-blue/20 flex items-center justify-center">
            <div class="text-center p-4">
                <p class="text-gray-400 text-sm">广告位 3</p>
                <p class="text-gray-500 text-xs">在编辑中心配置</p>
            </div>
        </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="glass-dark py-6 px-4 relative z-10">
        <div class="container mx-auto text-center">
            <div class="dark-white mb-2">
                <div id="total-bookmarks">共收录0个网站</div>
            </div>
            <div class="dark-white text-sm text-gray-400">
                <div id="copyright">Copyright © 2018-2023, All Rights Reserved</div>
            </div>
        </div>
    </footer>
    
    <!-- 设置模态框 -->
    <div id="settings-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6 transform scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-space font-bold">设置</h2>
                <button id="close-settings" class="p-2 hover:bg-gray-800 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="font-medium mb-3">GitHub 配置</h3>
                    <p class="text-sm text-gray-400 mb-4">配置GitHub仓库以同步您的书签数据</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm mb-1">GitHub 用户名</label>
                            <input type="text" id="github-username" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="username">
                        </div>
                        
                        <div>
                            <label class="block text-sm mb-1">仓库名称</label>
                            <input type="text" id="github-repo" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="repository">
                        </div>
                        
                        <div>
                            <label class="block text-sm mb-1">个人访问令牌 <span class="text-red-400 text-xs">(需要repo权限)</span></label>
                            <input type="password" id="github-token" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="ghp_...">
                            <p class="text-xs text-gray-500 mt-1">创建令牌: <a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank" class="text-space-blue hover:underline">https://github.com/settings/tokens/new</a></p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button id="validate-github" class="flex-1 bg-space-blue hover:bg-space-blue/80 text-white py-2 rounded-lg transition-all text-sm">
                                验证
                            </button>
                            <button id="save-github" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded-lg transition-all text-sm">
                                保存配置
                            </button>
                        </div>
                        
                        <div id="github-status" class="text-sm py-2 px-3 rounded-lg hidden">
                            <!-- 状态信息将通过JS动态更新 -->
                        </div>
                    </div>
                </div>
                
                <div class="pt-4 border-t border-gray-800">
                    <button id="open-edit-center-from-settings" class="w-full bg-space-purple hover:bg-space-purple/80 text-white py-2.5 rounded-lg transition-all font-medium" disabled>
                        进入编辑中心
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 编辑中心模态框 -->
    <div id="edit-center-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass rounded-xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col transform scale-95 transition-transform duration-300">
            <div class="p-6 border-b border-gray-800 flex justify-between items-center">
                <h2 class="text-xl font-space font-bold">编辑中心</h2>
                <div class="flex space-x-2">
                    <button id="save-changes" class="flex items-center space-x-1 bg-space-blue hover:bg-space-blue/80 text-white px-4 py-1.5 rounded-lg transition-all text-sm">
                        <i class="fa fa-save"></i>
                        <span>保存更改</span>
                    </button>
                    <button id="close-edit-center" class="p-2 hover:bg-gray-800 rounded-full transition-colors">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex flex-1 overflow-hidden">
                <!-- 编辑中心导航 -->
                <div class="w-16 md:w-48 border-r border-gray-800 flex flex-col">
                    <button class="edit-tab active flex items-center justify-center md:justify-start p-4 hover:bg-gray-800 transition-colors flex-1" data-tab="bookmarks">
                        <i class="fa fa-bookmark text-space-star text-lg"></i>
                        <span class="hidden md:inline ml-2">书签管理</span>
                    </button>
                    <button class="edit-tab flex items-center justify-center md:justify-start p-4 hover:bg-gray-800 transition-colors flex-1" data-tab="cities">
                        <i class="fa fa-clock-o text-space-accent text-lg"></i>
                        <span class="hidden md:inline ml-2">城市时钟</span>
                    </button>
                    <button class="edit-tab flex items-center justify-center md:justify-start p-4 hover:bg-gray-800 transition-colors flex-1" data-tab="ads">
                        <i class="fa fa-bullhorn text-space-pink text-lg"></i>
                        <span class="hidden md:inline ml-2">广告管理</span>
                    </button>
                </div>
                
                <!-- 编辑内容区域 -->
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- 书签管理 -->
                    <div id="bookmarks-tab" class="edit-content">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-3">
                            <h3 class="text-lg font-medium">书签管理</h3>
                            <div class="flex flex-wrap gap-2">
                                <button id="import-bookmarks" class="flex items-center space-x-1 bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                    <i class="fa fa-upload"></i>
                                    <span>导入书签</span>
                                </button>
                                <button id="export-bookmarks" class="flex items-center space-x-1 bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                    <i class="fa fa-download"></i>
                                    <span>导出书签</span>
                                </button>
                                <input type="file" id="bookmark-file" accept=".html" class="hidden">
                                <button id="add-bookmark" class="flex items-center space-x-1 bg-space-purple hover:bg-space-purple/80 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                    <i class="fa fa-plus"></i>
                                    <span>添加书签</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-sm text-gray-400">共 <span id="edit-bookmark-count">0</span> 个书签</p>
                        </div>
                        
                        <div id="edit-bookmarks-container" class="space-y-4">
                            <!-- 书签编辑内容将通过JS动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 城市时钟管理 -->
                    <div id="cities-tab" class="edit-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium">城市时钟管理</h3>
                            <button id="add-city" class="flex items-center space-x-1 bg-space-accent hover:bg-space-accent/80 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                <i class="fa fa-plus"></i>
                                <span>添加城市</span>
                            </button>
                        </div>
                        
                        <div id="cities-list" class="space-y-3">
                            <!-- 城市列表将通过JS动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 广告管理 -->
                    <div id="ads-tab" class="edit-content hidden">
                        <h3 class="text-lg font-medium mb-6">广告管理</h3>
                        
                        <div class="space-y-6">
                            <!-- 广告位1 -->
                            <div class="glass rounded-xl p-5">
                                <h4 class="font-medium mb-4">广告位 1</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm mb-1">广告图片</label>
                                        <div class="flex items-center space-x-3">
                                            <div id="ad1-preview" class="w-24 h-24 rounded-lg bg-gray-800 flex items-center justify-center overflow-hidden">
                                                <i class="fa fa-picture-o text-gray-500"></i>
                                            </div>
                                            <div>
                                                <button id="upload-ad1" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                                    上传图片
                                                </button>
                                                <input type="file" id="ad1-file" accept="image/*" class="hidden">
                                                <p class="text-xs text-gray-500 mt-1">最大3MB</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1">广告链接</label>
                                        <input type="url" id="ad1-url" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="https://example.com">
                                    </div>
                                    <button id="remove-ad1" class="text-red-400 hover:text-red-300 text-sm transition-colors">
                                        <i class="fa fa-trash-o mr-1"></i> 移除广告
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 广告位2 -->
                            <div class="glass rounded-xl p-5">
                                <h4 class="font-medium mb-4">广告位 2</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm mb-1">广告图片</label>
                                        <div class="flex items-center space-x-3">
                                            <div id="ad2-preview" class="w-24 h-24 rounded-lg bg-gray-800 flex items-center justify-center overflow-hidden">
                                                <i class="fa fa-picture-o text-gray-500"></i>
                                            </div>
                                            <div>
                                                <button id="upload-ad2" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                                    上传图片
                                                </button>
                                                <input type="file" id="ad2-file" accept="image/*" class="hidden">
                                                <p class="text-xs text-gray-500 mt-1">最大3MB</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1">广告链接</label>
                                        <input type="url" id="ad2-url" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="https://example.com">
                                    </div>
                                    <button id="remove-ad2" class="text-red-400 hover:text-red-300 text-sm transition-colors">
                                        <i class="fa fa-trash-o mr-1"></i> 移除广告
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 广告位3 -->
                            <div class="glass rounded-xl p-5">
                                <h4 class="font-medium mb-4">广告位 3</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm mb-1">广告图片</label>
                                        <div class="flex items-center space-x-3">
                                            <div id="ad3-preview" class="w-24 h-24 rounded-lg bg-gray-800 flex items-center justify-center overflow-hidden">
                                                <i class="fa fa-picture-o text-gray-500"></i>
                                            </div>
                                            <div>
                                                <button id="upload-ad3" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition-all text-sm">
                                                    上传图片
                                                </button>
                                                <input type="file" id="ad3-file" accept="image/*" class="hidden">
                                                <p class="text-xs text-gray-500 mt-1">最大3MB</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm mb-1">广告链接</label>
                                        <input type="url" id="ad3-url" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="https://example.com">
                                    </div>
                                    <button id="remove-ad3" class="text-red-400 hover:text-red-300 text-sm transition-colors">
                                        <i class="fa fa-trash-o mr-1"></i> 移除广告
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加/编辑书签模态框 -->
    <div id="bookmark-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass rounded-xl w-full max-w-md p-6 transform scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-6">
                <h2 id="bookmark-modal-title" class="text-xl font-space font-bold">添加书签</h2>
                <button id="close-bookmark-modal" class="p-2 hover:bg-gray-800 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <input type="hidden" id="bookmark-id">
                <input type="hidden" id="bookmark-folder">
                
                <div>
                    <label class="block text-sm mb-1">文件夹</label>
                    <select id="bookmark-folder-select" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm">
                        <option value="">无文件夹</option>
                    </select>
                    <div class="flex items-center mt-2">
                        <input type="text" id="new-folder-name" placeholder="新建文件夹名称" class="flex-1 bg-space-darker border border-gray-700 rounded-lg py-1.5 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm mr-2">
                        <button id="create-folder" class="bg-gray-700 hover:bg-gray-600 text-white px-2 py-1.5 rounded-lg transition-all text-sm">
                            创建
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm mb-1">网站名称</label>
                    <input type="text" id="bookmark-name" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="例如：GitHub">
                </div>
                
                <div>
                    <label class="block text-sm mb-1">网站URL</label>
                    <input type="url" id="bookmark-url" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="例如：https://github.com">
                </div>
                
                <div class="pt-4 flex space-x-3">
                    <button id="cancel-bookmark" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded-lg transition-all">
                        取消
                    </button>
                    <button id="save-bookmark" class="flex-1 bg-space-blue hover:bg-space-blue/80 text-white py-2 rounded-lg transition-all">
                        保存
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加城市模态框 -->
    <div id="city-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass rounded-xl w-full max-w-md p-6 transform scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-space font-bold">添加城市</h2>
                <button id="close-city-modal" class="p-2 hover:bg-gray-800 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <input type="hidden" id="city-id">
                
                <div>
                    <label class="block text-sm mb-1">城市名称</label>
                    <input type="text" id="city-name" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="例如：北京">
                </div>
                
                <div>
                    <label class="block text-sm mb-1">时区 <span class="text-xs text-gray-500">(例如：Asia/Shanghai)</span></label>
                    <input type="text" id="city-timezone" class="w-full bg-space-darker border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-space-blue/50 transition-all text-sm" placeholder="例如：Asia/Shanghai">
                    <p class="text-xs text-gray-500 mt-1">时区列表: <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" class="text-space-blue hover:underline">查看所有时区</a></p>
                </div>
                
                <div class="pt-4 flex space-x-3">
                    <button id="cancel-city" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded-lg transition-all">
                        取消
                    </button>
                    <button id="save-city" class="flex-1 bg-space-accent hover:bg-space-accent/80 text-white py-2 rounded-lg transition-all">
                        保存
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 提示消息 -->
    <div id="toast" class="fixed bottom-6 right-6 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center">
        <i id="toast-icon" class="fa fa-info-circle mr-2"></i>
        <span id="toast-message"></span>
    </div>
    
    <!-- 加载动画 -->
    <div id="loader" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass rounded-full p-6 flex flex-col items-center">
            <div class="w-12 h-12 border-4 border-gray-700 border-t-space-blue rounded-full animate-spin"></div>
            <p class="mt-4 text-sm">加载中...</p>
        </div>
    </div>

    <script>
        // 应用数据
        const appData = {
            bookmarks: [],
            folders: [],
            cities: ["北京", "纽约", "伦敦", "东京"],
            cityTimezones: {
                "北京": "Asia/Shanghai",
                "纽约": "America/New_York",
                "伦敦": "Europe/London",
                "东京": "Asia/Tokyo"
            },
            ads: [
                { id: 1, image: "", url: "" },
                { id: 2, image: "", url: "" },
                { id: 3, image: "", url: "" }
            ],
            github: {
                username: "",
                repo: "",
                token: "",
                validated: false
            },
            deploymentDate: new Date(),
            searchQuery: ""
        };

        // DOM 元素
        const elements = {
            navbar: document.getElementById('navbar'),
            stars: document.getElementById('stars'),
            themeToggle: document.getElementById('theme-toggle'),
            mobileThemeToggle: document.getElementById('mobile-theme-toggle'),
            settingsBtn: document.getElementById('settings-btn'),
            mobileSettingsBtn: document.getElementById('mobile-settings-btn'),
            settingsModal: document.getElementById('settings-modal'),
            closeSettings: document.getElementById('close-settings'),
            editCenterBtn: document.getElementById('edit-center-btn'),
            mobileEditCenterBtn: document.getElementById('mobile-edit-center-btn'),
            editCenterModal: document.getElementById('edit-center-modal'),
            closeEditCenter: document.getElementById('close-edit-center'),
            openEditCenterFromSettings: document.getElementById('open-edit-center-from-settings'),
            saveChanges: document.getElementById('save-changes'),
            onlineTime: document.getElementById('online-time'),
            healthReminder: document.getElementById('health-reminder'),
            nextReminder: document.getElementById('next-reminder'),
            worldClocks: document.getElementById('world-clocks'),
            bookmarksGrid: document.getElementById('bookmarks-grid'),
            bookmarkFolders: document.getElementById('bookmark-folders'),
            totalBookmarks: document.getElementById('total-bookmarks'),
            copyright: document.getElementById('copyright'),
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            validateGithub: document.getElementById('validate-github'),
            saveGithub: document.getElementById('save-github'),
            githubStatus: document.getElementById('github-status'),
            searchInput: document.getElementById('search-input'),
            mobileSearchInput: document.getElementById('mobile-search-input'),
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            mobileMenu: document.getElementById('mobile-menu'),
            closeMobileMenu: document.getElementById('close-mobile-menu'),
            importBookmarks: document.getElementById('import-bookmarks'),
            exportBookmarks: document.getElementById('export-bookmarks'),
            bookmarkFile: document.getElementById('bookmark-file'),
            addBookmark: document.getElementById('add-bookmark'),
            bookmarkModal: document.getElementById('bookmark-modal'),
            closeBookmarkModal: document.getElementById('close-bookmark-modal'),
            bookmarkModalTitle: document.getElementById('bookmark-modal-title'),
            bookmarkId: document.getElementById('bookmark-id'),
            bookmarkFolder: document.getElementById('bookmark-folder'),
            bookmarkFolderSelect: document.getElementById('bookmark-folder-select'),
            newFolderName: document.getElementById('new-folder-name'),
            createFolder: document.getElementById('create-folder'),
            bookmarkName: document.getElementById('bookmark-name'),
            bookmarkUrl: document.getElementById('bookmark-url'),
            cancelBookmark: document.getElementById('cancel-bookmark'),
            saveBookmark: document.getElementById('save-bookmark'),
            editBookmarkCount: document.getElementById('edit-bookmark-count'),
            editBookmarksContainer: document.getElementById('edit-bookmarks-container'),
            addCity: document.getElementById('add-city'),
            citiesList: document.getElementById('cities-list'),
            cityModal: document.getElementById('city-modal'),
            closeCityModal: document.getElementById('close-city-modal'),
            cityId: document.getElementById('city-id'),
            cityName: document.getElementById('city-name'),
            cityTimezone: document.getElementById('city-timezone'),
            cancelCity: document.getElementById('cancel-city'),
            saveCity: document.getElementById('save-city'),
            uploadAd1: document.getElementById('upload-ad1'),
            ad1File: document.getElementById('ad1-file'),
            ad1Preview: document.getElementById('ad1-preview'),
            ad1Url: document.getElementById('ad1-url'),
            removeAd1: document.getElementById('remove-ad1'),
            uploadAd2: document.getElementById('upload-ad2'),
            ad2File: document.getElementById('ad2-file'),
            ad2Preview: document.getElementById('ad2-preview'),
            ad2Url: document.getElementById('ad2-url'),
            removeAd2: document.getElementById('remove-ad2'),
            uploadAd3: document.getElementById('upload-ad3'),
            ad3File: document.getElementById('ad3-file'),
            ad3Preview: document.getElementById('ad3-preview'),
            ad3Url: document.getElementById('ad3-url'),
            removeAd3: document.getElementById('remove-ad3'),
            adSlot1: document.getElementById('ad-slot-1'),
            adSlot2: document.getElementById('ad-slot-2'),
            adSlot3: document.getElementById('ad-slot-3'),
            toast: document.getElementById('toast'),
            toastIcon: document.getElementById('toast-icon'),
            toastMessage: document.getElementById('toast-message'),
            loader: document.getElementById('loader')
        };

        // 初始化星空背景
        function createStars() {
            const starsCount = 150;
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // 随机位置
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // 随机大小
                const size = Math.random() * 2 + 1;
                
                // 随机闪烁频率
                const duration = Math.random() * 3 + 1;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.setProperty('--twinkle-duration', `${duration}s`);
                
                // 随机亮度
                const opacity = Math.random() * 0.8 + 0.2;
                star.style.opacity = opacity;
                
                elements.stars.appendChild(star);
            }
        }

        // 显示提示消息
        function showToast(message, type = 'info') {
            elements.toastMessage.textContent = message;
            
            // 设置图标
            elements.toastIcon.className = '';
            switch (type) {
                case 'success':
                    elements.toastIcon.className = 'fa fa-check-circle mr-2 text-green-400';
                    break;
                case 'error':
                    elements.toastIcon.className = 'fa fa-exclamation-circle mr-2 text-red-400';
                    break;
                case 'warning':
                    elements.toastIcon.className = 'fa fa-exclamation-triangle mr-2 text-yellow-400';
                    break;
                default:
                    elements.toastIcon.className = 'fa fa-info-circle mr-2 text-blue-400';
            }
            
            // 显示提示
            elements.toast.classList.remove('translate-y-20', 'opacity-0');
            elements.toast.classList.add('translate-y-0', 'opacity-100');
            
            // 3秒后隐藏
            setTimeout(() => {
                elements.toast.classList.remove('translate-y-0', 'opacity-100');
                elements.toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // 显示加载动画
        function showLoader() {
            elements.loader.classList.remove('opacity-0', 'pointer-events-none');
            elements.loader.classList.add('opacity-100', 'pointer-events-auto');
        }

        // 隐藏加载动画
        function hideLoader() {
            elements.loader.classList.remove('opacity-100', 'pointer-events-auto');
            elements.loader.classList.add('opacity-0', 'pointer-events-none');
        }

        // 验证GitHub Token
        async function validateGitHubToken() {
            showLoader();
            elements.githubStatus.textContent = '验证中...';
            elements.githubStatus.className = 'text-sm py-2 px-3 rounded-lg bg-gray-800 text-gray-300';
            elements.githubStatus.classList.remove('hidden');
            
            const username = elements.githubUsername.value.trim();
            const repo = elements.githubRepo.value.trim();
            const token = elements.githubToken.value.trim();
            
            if (!username || !repo || !token) {
                elements.githubStatus.textContent = '请填写所有字段';
                elements.githubStatus.className = 'text-sm py-2 px-3 rounded-lg bg-red-900/30 text-red-400';
                hideLoader();
                return false;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    appData.github.username = username;
                    appData.github.repo = repo;
                    appData.github.token = token;
                    appData.github.validated = true;
                    
                    elements.githubStatus.textContent = '验证成功！您可以进入编辑中心了';
                    elements.githubStatus.className = 'text-sm py-2 px-3 rounded-lg bg-green-900/30 text-green-400';
                    
                    // 保存配置
                    saveGitHubConfig();
                    updateEditFeaturesStatus();
                    hideLoader();
                    return true;
                } else {
                    const error = await response.json();
                    elements.githubStatus.textContent = `验证失败: ${error.message || '未知错误'}`;
                    elements.githubStatus.className = 'text-sm py-2 px-3 rounded-lg bg-red-900/30 text-red-400';
                    appData.github.validated = false;
                    updateEditFeaturesStatus();
                    hideLoader();
                    return false;
                }
            } catch (error) {
                elements.githubStatus.textContent = `验证失败: ${error.message}`;
                elements.githubStatus.className = 'text-sm py-2 px-3 rounded-lg bg-red-900/30 text-red-400';
                appData.github.validated = false;
                updateEditFeaturesStatus();
                hideLoader();
                return false;
            }
        }

        // 保存GitHub配置
        function saveGitHubConfig() {
            const config = {
                username: elements.githubUsername.value.trim(),
                repo: elements.githubRepo.value.trim(),
                token: elements.githubToken.value.trim(),
                validated: appData.github.validated
            };
            
            localStorage.setItem('githubConfig', JSON.stringify(config));
        }

        // 加载GitHub配置
        function loadGitHubConfig() {
            const config = localStorage.getItem('githubConfig');
            if (config) {
                try {
                    const parsed = JSON.parse(config);
                    appData.github = parsed;
                    elements.githubUsername.value = parsed.username || '';
                    elements.githubRepo.value = parsed.repo || '';
                    elements.githubToken.value = parsed.token || '';
                    return true;
                } catch (e) {
                    console.error('Failed to parse GitHub config', e);
                    return false;
                }
            }
            return false;
        }

        // 更新编辑功能状态
        function updateEditFeaturesStatus() {
            const isEnabled = appData.github.validated;
            
            elements.editCenterBtn.disabled = !isEnabled;
            elements.mobileEditCenterBtn.disabled = !isEnabled;
            elements.openEditCenterFromSettings.disabled = !isEnabled;
            
            // 更新按钮样式
            if (isEnabled) {
                elements.editCenterBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                elements.mobileEditCenterBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                elements.openEditCenterFromSettings.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                elements.editCenterBtn.classList.add('opacity-50', 'cursor-not-allowed');
                elements.mobileEditCenterBtn.classList.add('opacity-50', 'cursor-not-allowed');
                elements.openEditCenterFromSettings.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            // 更新编辑中心内的功能
            document.querySelectorAll('#cities-tab button, #bookmarks-tab button').forEach(btn => {
                if (btn.id !== 'import-bookmarks' && btn.id !== 'export-bookmarks') {
                    btn.disabled = !isEnabled;
                    if (!isEnabled) {
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    } else {
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                }
            });
        }

        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            // 如果没有配置GitHub，使用默认仓库
            let username = appData.github.username;
            let repo = appData.github.repo;
            
            // 检查是否有自动注入的仓库信息（来自GitHub Actions）
            const metaTag = document.querySelector('meta[name="github-repo-info"]');
            if (metaTag && !username && !repo) {
                const repoInfo = metaTag.content;
                if (repoInfo && repoInfo.includes('/')) {
                    [username, repo] = repoInfo.split('/');
                }
            }
            
            // 如果仍没有仓库信息，使用默认值
            if (!username || !repo) {
                username = 'default-user';
                repo = 'default-repo';
            }
            
            try {
                let url;
                let options = {};
                
                // 如果有token，使用API，否则使用raw.githubusercontent.com
                if (appData.github.token) {
                    url = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                    options.headers = {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    };
                } else {
                    url = `https://raw.githubusercontent.com/${username}/${repo}/main/bookmarks.json`;
                }
                
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    // 如果公开仓库也不存在，使用本地存储
                    if (!appData.github.token) {
                        console.log('No public repository found, using local storage');
                        loadFromLocalStorage();
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                let data;
                if (appData.github.token) {
                    const apiData = await response.json();
                    // 解码base64内容
                    const content = atob(apiData.content);
                    data = JSON.parse(content);
                } else {
                    data = await response.json();
                }
                
                // 合并数据
                if (data.bookmarks) appData.bookmarks = data.bookmarks;
                if (data.folders) appData.folders = data.folders;
                if (data.cities) appData.cities = data.cities;
                if (data.cityTimezones) appData.cityTimezones = data.cityTimezones;
                if (data.ads) appData.ads = data.ads;
                
                // 保存到本地存储作为备份
                saveToLocalStorage();
                
                showToast('数据已从GitHub加载', 'success');
            } catch (error) {
                console.error('Failed to load data from GitHub:', error);
                showToast('从GitHub加载数据失败，使用本地数据', 'warning');
                loadFromLocalStorage();
            }
        }

        // 保存数据到GitHub
        async function saveDataToGitHub() {
            if (!appData.github.validated || !appData.github.username || !appData.github.repo || !appData.github.token) {
                showToast('GitHub配置无效，无法保存', 'error');
                return false;
            }
            
            showLoader();
            
            try {
                // 首先获取文件的SHA
                const getUrl = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                const getResponse = await fetch(getUrl, {
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = '';
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    sha = data.sha;
                }
                
                // 准备要保存的数据
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    folders: appData.folders,
                    cities: appData.cities,
                    cityTimezones: appData.cityTimezones,
                    ads: appData.ads
                };
                
                // 转换为UTF-8并编码为base64
                const content = JSON.stringify(dataToSave, null, 2);
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                // 保存数据
                const putUrl = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                const putResponse = await fetch(putUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via Space Navigator',
                        content: base64Content,
                        sha: sha // 只有文件已存在时需要
                    })
                });
                
                if (!putResponse.ok) {
                    const error = await putResponse.json();
                    throw new Error(error.message || 'Failed to save data');
                }
                
                // 同时保存到本地存储
                saveToLocalStorage();
                
                hideLoader();
                showToast('数据已成功保存到GitHub', 'success');
                return true;
            } catch (error) {
                console.error('Failed to save data to GitHub:', error);
                hideLoader();
                showToast(`保存数据到GitHub失败: ${error.message}`, 'error');
                return false;
            }
        }

        // 保存数据到本地存储
        function saveToLocalStorage() {
            const data = {
                bookmarks: appData.bookmarks,
                folders: appData.folders,
                cities: appData.cities,
                cityTimezones: appData.cityTimezones,
                ads: appData.ads,
                deploymentDate: appData.deploymentDate.toISOString()
            };
            
            localStorage.setItem('spaceNavigatorData', JSON.stringify(data));
        }

        // 从本地存储加载数据
        function loadFromLocalStorage() {
            const data = localStorage.getItem('spaceNavigatorData');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    if (parsed.bookmarks) appData.bookmarks = parsed.bookmarks;
                    if (parsed.folders) appData.folders = parsed.folders;
                    if (parsed.cities) appData.cities = parsed.cities;
                    if (parsed.cityTimezones) appData.cityTimezones = parsed.cityTimezones;
                    if (parsed.ads) appData.ads = parsed.ads;
                    if (parsed.deploymentDate) appData.deploymentDate = new Date(parsed.deploymentDate);
                    return true;
                } catch (e) {
                    console.error('Failed to parse local data', e);
                    return false;
                }
            }
            return false;
        }

        // 生成唯一ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        // 渲染书签
        function renderBookmarks() {
            // 清空现有内容
            elements.bookmarksGrid.innerHTML = '';
            elements.bookmarkFolders.innerHTML = '';
            elements.editBookmarksContainer.innerHTML = '';
            
            // 更新计数
            elements.totalBookmarks.textContent = `共收录${appData.bookmarks.length}个网站`;
            elements.editBookmarkCount.textContent = appData.bookmarks.length;
            
            // 更新文件夹选择器
            elements.bookmarkFolderSelect.innerHTML = '<option value="">无文件夹</option>';
            appData.folders.forEach(folder => {
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                elements.bookmarkFolderSelect.appendChild(option);
            });
            
            // 过滤书签
            let filteredBookmarks = appData.bookmarks;
            if (appData.searchQuery) {
                const query = appData.searchQuery.toLowerCase();
                filteredBookmarks = appData.bookmarks.filter(bookmark => 
                    bookmark.name.toLowerCase().includes(query) || 
                    bookmark.url.toLowerCase().includes(query)
                );
            }
            
            // 按文件夹分组
            const bookmarksByFolder = {};
            const uncategorizedBookmarks = [];
            
            filteredBookmarks.forEach(bookmark => {
                if (bookmark.folder) {
                    if (!bookmarksByFolder[bookmark.folder]) {
                        bookmarksByFolder[bookmark.folder] = [];
                    }
                    bookmarksByFolder[bookmark.folder].push(bookmark);
                } else {
                    uncategorizedBookmarks.push(bookmark);
                }
            });
            
            // 渲染文件夹书签
            appData.folders.forEach(folder => {
                const folderBookmarks = bookmarksByFolder[folder.id] || [];
                if (folderBookmarks.length === 0 && appData.searchQuery) return;
                
                const folderElement = document.createElement('div');
                folderElement.className = 'glass rounded-xl p-5';
                
                // 文件夹标题和切换按钮
                const folderHeader = document.createElement('div');
                folderHeader.className = 'flex justify-between items-center mb-4';
                
                const folderTitle = document.createElement('h3');
                folderTitle.className = 'font-space font-semibold text-lg flex items-center';
                folderTitle.innerHTML = `<i class="fa fa-folder text-space-purple mr-2"></i>${folder.name} <span class="text-sm text-gray-400 ml-2">(${folderBookmarks.length})</span>`;
                
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'text-gray-400 hover:text-white transition-colors';
                toggleBtn.innerHTML = '<i class="fa fa-chevron-down"></i>';
                toggleBtn.dataset.folderId = folder.id;
                toggleBtn.addEventListener('click', (e) => {
                    const folderId = e.currentTarget.dataset.folderId;
                    const content = document.getElementById(`folder-content-${folderId}`);
                    content.classList.toggle('hidden');
                    
                    // 切换图标
                    const icon = e.currentTarget.querySelector('i');
                    if (content.classList.contains('hidden')) {
                        icon.className = 'fa fa-chevron-right';
                    } else {
                        icon.className = 'fa fa-chevron-down';
                    }
                });
                
                folderHeader.appendChild(folderTitle);
                folderHeader.appendChild(toggleBtn);
                folderElement.appendChild(folderHeader);
                
                // 文件夹内容
                const folderContent = document.createElement('div');
                folderContent.id = `folder-content-${folder.id}`;
                folderContent.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3';
                
                folderBookmarks.forEach(bookmark => {
                    folderContent.appendChild(createBookmarkElement(bookmark));
                });
                
                folderElement.appendChild(folderContent);
                elements.bookmarkFolders.appendChild(folderElement);
            });
            
            // 渲染未分类书签
            uncategorizedBookmarks.forEach(bookmark => {
                elements.bookmarksGrid.appendChild(createBookmarkElement(bookmark));
            });
            
            // 渲染编辑中心的书签列表
            appData.bookmarks.forEach(bookmark => {
                const folderName = appData.folders.find(f => f.id === bookmark.folder)?.name || '无';
                
                const bookmarkElement = document.createElement('div');
                bookmarkElement.className = 'glass rounded-lg p-4 flex justify-between items-center';
                bookmarkElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded bg-space-blue/20 flex items-center justify-center text-space-blue">
                            ${getFaviconHtml(bookmark.url, bookmark.name)}
                        </div>
                        <div>
                            <div class="font-medium">${bookmark.name}</div>
                            <div class="text-xs text-gray-400 truncate max-w-[200px]">${bookmark.url}</div>
                            <div class="text-xs text-gray-500 mt-1">文件夹: ${folderName}</div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-bookmark-btn p-1.5 text-gray-400 hover:text-space-blue transition-colors" data-id="${bookmark.id}">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button class="delete-bookmark-btn p-1.5 text-gray-400 hover:text-red-400 transition-colors" data-id="${bookmark.id}">
                            <i class="fa fa-trash-o"></i>
                        </button>
                    </div>
                `;
                
                elements.editBookmarksContainer.appendChild(bookmarkElement);
                
                // 添加编辑和删除事件
                bookmarkElement.querySelector('.edit-bookmark-btn').addEventListener('click', () => editBookmark(bookmark.id));
                bookmarkElement.querySelector('.delete-bookmark-btn').addEventListener('click', () => deleteBookmark(bookmark.id));
            });
        }

        // 创建书签元素
        function createBookmarkElement(bookmark) {
            const bookmarkElement = document.createElement('a');
            bookmarkElement.href = bookmark.url;
            bookmarkElement.target = '_blank';
            bookmarkElement.className = 'glass rounded-lg p-3 flex flex-col items-center text-center bookmark-hover h-full';
            
            bookmarkElement.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-space-blue/20 flex items-center justify-center mb-2">
                    ${getFaviconHtml(bookmark.url, bookmark.name)}
                </div>
                <span class="text-sm font-medium truncate w-full">${bookmark.name}</span>
            `;
            
            return bookmarkElement;
        }

        // 获取Favicon HTML
        function getFaviconHtml(url, name) {
            try {
                const parsedUrl = new URL(url);
                const domain = parsedUrl.hostname;
                // 使用简化的域名作为favicon来源
                const faviconUrl = `https://${domain}/favicon.ico`;
                return `<img src="${faviconUrl}" alt="Favicon" class="w-5 h-5 rounded" onerror="this.onerror=null;this.innerHTML='${name.charAt(0).toUpperCase()}'">`;
            } catch (e) {
                // 如果URL解析失败，使用名称首字母
                return `<span class="text-sm font-bold">${name.charAt(0).toUpperCase()}</span>`;
            }
        }

        // 添加书签
        function addBookmark() {
            elements.bookmarkModalTitle.textContent = '添加书签';
            elements.bookmarkId.value = '';
            elements.bookmarkFolder.value = '';
            elements.bookmarkFolderSelect.value = '';
            elements.bookmarkName.value = '';
            elements.bookmarkUrl.value = '';
            elements.newFolderName.value = '';
            
            openModal(elements.bookmarkModal);
        }

        // 编辑书签
        function editBookmark(id) {
            const bookmark = appData.bookmarks.find(b => b.id === id);
            if (!bookmark) return;
            
            elements.bookmarkModalTitle.textContent = '编辑书签';
            elements.bookmarkId.value = bookmark.id;
            elements.bookmarkFolder.value = bookmark.folder || '';
            elements.bookmarkFolderSelect.value = bookmark.folder || '';
            elements.bookmarkName.value = bookmark.name;
            elements.bookmarkUrl.value = bookmark.url;
            elements.newFolderName.value = '';
            
            openModal(elements.bookmarkModal);
        }

        // 保存书签
        function saveBookmark() {
            const id = elements.bookmarkId.value;
            const folderId = elements.bookmarkFolderSelect.value;
            const name = elements.bookmarkName.value.trim();
            const url = elements.bookmarkUrl.value.trim();
            
            if (!name || !url) {
                showToast('请填写名称和URL', 'error');
                return;
            }
            
            // 确保URL以http开头
            let formattedUrl = url;
            if (!formattedUrl.startsWith('http://') && !formattedUrl.startsWith('https://')) {
                formattedUrl = 'https://' + formattedUrl;
            }
            
            if (id) {
                // 更新现有书签
                const index = appData.bookmarks.findIndex(b => b.id === id);
                if (index !== -1) {
                    appData.bookmarks[index] = {
                        ...appData.bookmarks[index],
                        folder: folderId || '',
                        name,
                        url: formattedUrl
                    };
                    showToast('书签已更新', 'success');
                }
            } else {
                // 添加新书签
                // 检查是否已存在相同URL的书签
                const existing = appData.bookmarks.find(b => b.url === formattedUrl);
                if (existing) {
                    showToast('该URL的书签已存在', 'warning');
                    return;
                }
                
                appData.bookmarks.push({
                    id: generateId(),
                    folder: folderId || '',
                    name,
                    url: formattedUrl,
                    added: new Date().toISOString()
                });
                showToast('书签已添加', 'success');
            }
            
            closeModal(elements.bookmarkModal);
            renderBookmarks();
            saveToLocalStorage();
        }

        // 删除书签
        function deleteBookmark(id) {
            if (!confirm('确定要删除这个书签吗？')) return;
            
            const index = appData.bookmarks.findIndex(b => b.id === id);
            if (index !== -1) {
                appData.bookmarks.splice(index, 1);
                renderBookmarks();
                saveToLocalStorage();
                showToast('书签已删除', 'success');
            }
        }

        // 创建文件夹
        function createFolder() {
            const name = elements.newFolderName.value.trim();
            if (!name) {
                showToast('请输入文件夹名称', 'error');
                return;
            }
            
            // 检查是否已存在同名文件夹
            const existing = appData.folders.find(f => f.name === name);
            if (existing) {
                showToast('该文件夹已存在', 'warning');
                return;
            }
            
            const folderId = generateId();
            appData.folders.push({
                id: folderId,
                name
            });
            
            // 更新文件夹选择器
            const option = document.createElement('option');
            option.value = folderId;
            option.textContent = name;
            elements.bookmarkFolderSelect.appendChild(option);
            
            // 选中新文件夹
            elements.bookmarkFolderSelect.value = folderId;
            
            // 清空输入
            elements.newFolderName.value = '';
            
            showToast(`文件夹"${name}"已创建`, 'success');
            saveToLocalStorage();
        }

        // 导入书签
        function importBookmarks() {
            elements.bookmarkFile.click();
        }

        // 处理书签文件导入
        function handleBookmarkFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.type !== 'text/html' && !file.name.endsWith('.html')) {
                showToast('请导入HTML格式的书签文件', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(e.target.result, 'text/html');
                    const bookmarkElements = doc.querySelectorAll('a');
                    
                    if (bookmarkElements.length === 0) {
                        showToast('未找到书签数据', 'error');
                        return;
                    }
                    
                    let importedCount = 0;
                    let existingCount = 0;
                    
                    // 处理文件夹
                    const folders = {};
                    const folderElements = doc.querySelectorAll('h3');
                    folderElements.forEach(folderEl => {
                        const folderName = folderEl.textContent.trim();
                        if (folderName && !appData.folders.some(f => f.name === folderName)) {
                            const folderId = generateId();
                            folders[folderName] = folderId;
                            appData.folders.push({ id: folderId, name: folderName });
                        } else if (folderName) {
                            const existingFolder = appData.folders.find(f => f.name === folderName);
                            folders[folderName] = existingFolder.id;
                        }
                    });
                    
                    // 处理书签
                    bookmarkElements.forEach(bookmarkEl => {
                        const name = bookmarkEl.textContent.trim();
                        const url = bookmarkEl.href;
                        
                        if (!name || !url) return;
                        
                        // 检查是否已存在相同URL的书签
                        const existing = appData.bookmarks.find(b => b.url === url);
                        if (existing) {
                            existingCount++;
                            return;
                        }
                        
                        // 尝试确定书签所属文件夹
                        let folderId = '';
                        let parent = bookmarkEl.parentNode;
                        while (parent && parent.tagName !== 'DL') {
                            if (parent.previousElementSibling && parent.previousElementSibling.tagName === 'H3') {
                                const folderName = parent.previousElementSibling.textContent.trim();
                                folderId = folders[folderName] || '';
                                break;
                            }
                            parent = parent.parentNode;
                        }
                        
                        appData.bookmarks.push({
                            id: generateId(),
                            folder: folderId,
                            name,
                            url,
                            added: new Date().toISOString()
                        });
                        
                        importedCount++;
                    });
                    
                    renderBookmarks();
                    saveToLocalStorage();
                    showToast(`成功导入 ${importedCount} 个书签，${existingCount} 个已存在`, 'success');
                } catch (error) {
                    console.error('Failed to import bookmarks:', error);
                    showToast(`导入失败: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // 导出书签
        function exportBookmarks() {
            if (appData.bookmarks.length === 0) {
                showToast('没有书签可导出', 'warning');
                return;
            }
            
            // 创建HTML格式的书签文件
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            // 按文件夹分组
            const bookmarksByFolder = {};
            const uncategorizedBookmarks = [];
            
            appData.bookmarks.forEach(bookmark => {
                if (bookmark.folder) {
                    if (!bookmarksByFolder[bookmark.folder]) {
                        bookmarksByFolder[bookmark.folder] = [];
                    }
                    bookmarksByFolder[bookmark.folder].push(bookmark);
                } else {
                    uncategorizedBookmarks.push(bookmark);
                }
            });
            
            // 添加有文件夹的书签
            appData.folders.forEach(folder => {
                const folderBookmarks = bookmarksByFolder[folder.id] || [];
                if (folderBookmarks.length === 0) return;
                
                html += `<DT><H3>${folder.name}</H3>
<DL><p>`;
                
                folderBookmarks.forEach(bookmark => {
                    html += `<DT><A HREF="${bookmark.url}">${bookmark.name}</A>`;
                });
                
                html += `</DL><p>`;
            });
            
            // 添加未分类书签
            uncategorizedBookmarks.forEach(bookmark => {
                html += `<DT><A HREF="${bookmark.url}">${bookmark.name}</A>`;
            });
            
            html += `</DL><p>`;
            
            // 创建并下载文件
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `space-bookmarks-${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast(`已导出 ${appData.bookmarks.length} 个书签`, 'success');
        }

        // 渲染城市时钟
        function renderCities() {
            // 清空现有内容
            elements.worldClocks.innerHTML = '';
            elements.citiesList.innerHTML = '';
            
            // 渲染主页面的时钟
            appData.cities.forEach(city => {
                const timezone = appData.cityTimezones[city] || 'UTC';
                const timeElement = document.createElement('div');
                timeElement.className = 'flex justify-between items-center';
                
                // 初始时间
                const now = new Date();
                const options = { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit',
                    timeZone: timezone
                };
                const timeString = now.toLocaleTimeString('zh-CN', options);
                
                timeElement.innerHTML = `
                    <span class="text-gray-300">${city} (${timezone.split('/')[1] || timezone})</span>
                    <span class="font-medium">${timeString}</span>
                `;
                
                // 存储时区信息用于更新
                timeElement.dataset.timezone = timezone;
                
                elements.worldClocks.appendChild(timeElement);
            });
            
            // 渲染编辑中心的城市列表
            appData.cities.forEach((city, index) => {
                const timezone = appData.cityTimezones[city] || 'UTC';
                const cityElement = document.createElement('div');
                cityElement.className = 'glass rounded-lg p-4 flex justify-between items-center';
                cityElement.innerHTML = `
                    <div>
                        <div class="font-medium">${city}</div>
                        <div class="text-xs text-gray-400">${timezone}</div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-city-btn p-1.5 text-gray-400 hover:text-space-accent transition-colors" data-index="${index}">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button class="delete-city-btn p-1.5 text-gray-400 hover:text-red-400 transition-colors" data-index="${index}">
                            <i class="fa fa-trash-o"></i>
                        </button>
                    </div>
                `;
                
                elements.citiesList.appendChild(cityElement);
                
                // 添加编辑和删除事件
                cityElement.querySelector('.edit-city-btn').addEventListener('click', () => editCity(index));
                cityElement.querySelector('.delete-city-btn').addEventListener('click', () => deleteCity(index));
            });
        }

        // 更新时钟显示
        function updateClocks() {
            document.querySelectorAll('#world-clocks > div').forEach(el => {
                const timezone = el.dataset.timezone;
                const now = new Date();
                const options = { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit',
                    timeZone: timezone
                };
                const timeString = now.toLocaleTimeString('zh-CN', options);
                el.querySelector('span:last-child').textContent = timeString;
            });
        }

        // 添加城市
        function addCity() {
            elements.cityId.value = '';
            elements.cityName.value = '';
            elements.cityTimezone.value = '';
            
            openModal(elements.cityModal);
        }

        // 编辑城市
        function editCity(index) {
            if (index < 0 || index >= appData.cities.length) return;
            
            const city = appData.cities[index];
            const timezone = appData.cityTimezones[city] || '';
            
            elements.cityId.value = index;
            elements.cityName.value = city;
            elements.cityTimezone.value = timezone;
            
            openModal(elements.cityModal);
        }

        // 保存城市
        function saveCity() {
            const index = elements.cityId.value;
            const name = elements.cityName.value.trim();
            const timezone = elements.cityTimezone.value.trim();
            
            if (!name || !timezone) {
                showToast('请填写城市名称和时区', 'error');
                return;
            }
            
            if (index !== '') {
                // 更新现有城市
                const oldName = appData.cities[index];
                appData.cities[index] = name;
                
                // 更新时区映射
                if (oldName !== name) {
                    delete appData.cityTimezones[oldName];
                }
                appData.cityTimezones[name] = timezone;
                
                showToast('城市已更新', 'success');
            } else {
                // 添加新城市
                // 检查是否已存在
                if (appData.cities.includes(name)) {
                    showToast('该城市已存在', 'warning');
                    return;
                }
                
                appData.cities.push(name);
                appData.cityTimezones[name] = timezone;
                
                showToast('城市已添加', 'success');
            }
            
            closeModal(elements.cityModal);
            renderCities();
            saveToLocalStorage();
        }

        // 删除城市
        function deleteCity(index) {
            if (!confirm('确定要删除这个城市吗？')) return;
            
            if (index >= 0 && index < appData.cities.length) {
                const city = appData.cities[index];
                appData.cities.splice(index, 1);
                delete appData.cityTimezones[city];
                
                renderCities();
                saveToLocalStorage();
                showToast('城市已删除', 'success');
            }
        }

        // 渲染广告
        function renderAds() {
            // 渲染广告位1
            if (appData.ads[0] && appData.ads[0].image && appData.ads[0].url) {
                elements.adSlot1.innerHTML = `<a href="${appData.ads[0].url}" target="_blank"><img src="${appData.ads[0].image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
                elements.ad1Preview.innerHTML = `<img src="${appData.ads[0].image}" alt="广告预览" class="w-full h-full object-cover">`;
                elements.ad1Url.value = appData.ads[0].url;
            } else {
                elements.adSlot1.innerHTML = `
                    <div class="text-center p-4">
                        <p class="text-gray-400 text-sm">广告位 1</p>
                        <p class="text-gray-500 text-xs">在编辑中心配置</p>
                    </div>
                `;
                elements.ad1Preview.innerHTML = '<i class="fa fa-picture-o text-gray-500"></i>';
                elements.ad1Url.value = '';
            }
            
            // 渲染广告位2
            if (appData.ads[1] && appData.ads[1].image && appData.ads[1].url) {
                elements.adSlot2.innerHTML = `<a href="${appData.ads[1].url}" target="_blank"><img src="${appData.ads[1].image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
                elements.ad2Preview.innerHTML = `<img src="${appData.ads[1].image}" alt="广告预览" class="w-full h-full object-cover">`;
                elements.ad2Url.value = appData.ads[1].url;
            } else {
                elements.adSlot2.innerHTML = `
                    <div class="text-center p-4">
                        <p class="text-gray-400 text-sm">广告位 2</p>
                        <p class="text-gray-500 text-xs">在编辑中心配置</p>
                    </div>
                `;
                elements.ad2Preview.innerHTML = '<i class="fa fa-picture-o text-gray-500"></i>';
                elements.ad2Url.value = '';
            }
            
            // 渲染广告位3
            if (appData.ads[2] && appData.ads[2].image && appData.ads[2].url) {
                elements.adSlot3.innerHTML = `<a href="${appData.ads[2].url}" target="_blank"><img src="${appData.ads[2].image}" alt="广告图片" class="w-full h-full object-cover"></a>`;
                elements.ad3Preview.innerHTML = `<img src="${appData.ads[2].image}" alt="广告预览" class="w-full h-full object-cover">`;
                elements.ad3Url.value = appData.ads[2].url;
            } else {
                elements.adSlot3.innerHTML = `
                    <div class="text-center p-4">
                        <p class="text-gray-400 text-sm">广告位 3</p>
                        <p class="text-gray-500 text-xs">在编辑中心配置</p>
                    </div>
                `;
                elements.ad3Preview.innerHTML = '<i class="fa fa-picture-o text-gray-500"></i>';
                elements.ad3Url.value = '';
            }
        }

        // 处理广告图片上传
        function handleAdUpload(fileInputId, adIndex) {
            const fileInput = document.getElementById(fileInputId);
            const file = fileInput.files[0];
            
            if (!file) return;
            
            // 检查文件大小（3MB）
            if (file.size > 3 * 1024 * 1024) {
                showToast('文件大小不能超过3MB', 'error');
                return;
            }
            
            // 检查文件类型
            if (!file.type.startsWith('image/')) {
                showToast('请上传图片文件', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                if (!appData.ads[adIndex]) {
                    appData.ads[adIndex] = { id: adIndex + 1, image: '', url: '' };
                }
                
                appData.ads[adIndex].image = e.target.result;
                
                // 更新预览
                renderAds();
                saveToLocalStorage();
                showToast('广告图片已上传', 'success');
            };
            reader.readAsDataURL(file);
        }

        // 保存广告链接
        function saveAdUrl(adIndex, url) {
            if (!appData.ads[adIndex]) {
                appData.ads[adIndex] = { id: adIndex + 1, image: '', url: '' };
            }
            
            appData.ads[adIndex].url = url;
            saveToLocalStorage();
        }

        // 移除广告
        function removeAd(adIndex) {
            if (appData.ads[adIndex]) {
                appData.ads[adIndex] = { id: adIndex + 1, image: '', url: '' };
                renderAds();
                saveToLocalStorage();
                showToast('广告已移除', 'success');
            }
        }

        // 更新在线时长
        function updateOnlineTime() {
            const now = new Date();
            const diff = now - appData.deploymentDate;
            
            const seconds = Math.floor((diff / 1000) % 60);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            elements.onlineTime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // 更新健康提醒
        function updateHealthReminder() {
            const hour = new Date().getHours();
            
            let reminder = '';
            let nextReminder = '';
            
            if (hour >= 6 && hour < 9) {
                reminder = '早上好！开始新的一天探索吧';
                nextReminder = '下次提醒: 中午12点';
            } else if (hour >= 9 && hour < 12) {
                reminder = '保持专注，适当休息眼睛';
                nextReminder = '下次提醒: 中午12点';
            } else if (hour >= 12 && hour < 14) {
                reminder = '午餐时间到了，补充能量';
                nextReminder = '下次提醒: 下午3点';
            } else if (hour >= 14 && hour < 17) {
                reminder = '下午时光，保持高效工作';
                nextReminder = '下次提醒: 下午5点';
            } else if (hour >= 17 && hour < 19) {
                reminder = '傍晚时分，适当放松';
                nextReminder = '下次提醒: 晚上8点';
            } else if (hour >= 19 && hour < 22) {
                reminder = '晚上好，准备放松休息';
                nextReminder = '下次提醒: 睡前';
            } else {
                reminder = '夜深了，注意休息';
                nextReminder = '下次提醒: 早上7点';
            }
            
            elements.healthReminder.textContent = reminder;
            elements.nextReminder.textContent = nextReminder;
        }

        // 打开模态框
        function openModal(modal) {
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100', 'pointer-events-auto');
            modal.querySelector('div').classList.remove('scale-95');
            modal.querySelector('div').classList.add('scale-100');
            document.body.style.overflow = 'hidden';
        }

        // 关闭模态框
        function closeModal(modal) {
            modal.classList.remove('opacity-100', 'pointer-events-auto');
            modal.classList.add('opacity-0', 'pointer-events-none');
            modal.querySelector('div').classList.remove('scale-100');
            modal.querySelector('div').classList.add('scale-95');
            document.body.style.overflow = '';
        }

        // 切换编辑中心标签
        function switchEditTab(tabId) {
            // 移除所有活动状态
            document.querySelectorAll('.edit-tab').forEach(tab => {
                tab.classList.remove('active', 'bg-gray-800');
            });
            document.querySelectorAll('.edit-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // 设置当前活动状态
            document.querySelector(`.edit-tab[data-tab="${tabId}"]`).classList.add('active', 'bg-gray-800');
            document.getElementById(`${tabId}-tab`).classList.remove('hidden');
        }

        // 初始化事件监听
        function initEventListeners() {
            // 主题切换
            elements.themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('light');
                const icon = elements.themeToggle.querySelector('i');
                if (document.documentElement.classList.contains('light')) {
                    icon.classList.remove('fa-moon-o');
                    icon.classList.add('fa-sun-o');
                } else {
                    icon.classList.remove('fa-sun-o');
                    icon.classList.add('fa-moon-o');
                }
            });
            
            elements.mobileThemeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('light');
                const icon = elements.mobileThemeToggle.querySelector('i');
                if (document.documentElement.classList.contains('light')) {
                    icon.classList.remove('fa-moon-o');
                    icon.classList.add('fa-sun-o');
                } else {
                    icon.classList.remove('fa-sun-o');
                    icon.classList.add('fa-moon-o');
                }
                elements.mobileMenu.classList.add('translate-x-full');
            });
            
            // 设置模态框
            elements.settingsBtn.addEventListener('click', () => openModal(elements.settingsModal));
            elements.mobileSettingsBtn.addEventListener('click', () => {
                openModal(elements.settingsModal);
                elements.mobileMenu.classList.add('translate-x-full');
            });
            elements.closeSettings.addEventListener('click', () => closeModal(elements.settingsModal));
            
            // 编辑中心
            elements.editCenterBtn.addEventListener('click', () => openModal(elements.editCenterModal));
            elements.mobileEditCenterBtn.addEventListener('click', () => {
                openModal(elements.editCenterModal);
                elements.mobileMenu.classList.add('translate-x-full');
            });
            elements.closeEditCenter.addEventListener('click', () => closeModal(elements.editCenterModal));
            elements.openEditCenterFromSettings.addEventListener('click', () => {
                closeModal(elements.settingsModal);
                openModal(elements.editCenterModal);
            });
            
            // 移动端菜单
            elements.mobileMenuBtn.addEventListener('click', () => {
                elements.mobileMenu.classList.remove('translate-x-full');
            });
            elements.closeMobileMenu.addEventListener('click', () => {
                elements.mobileMenu.classList.add('translate-x-full');
            });
            
            // GitHub 配置
            elements.validateGithub.addEventListener('click', validateGitHubToken);
            elements.saveGithub.addEventListener('click', () => {
                saveGitHubConfig();
                showToast('GitHub配置已保存', 'success');
            });
            
            // 编辑中心标签切换
            document.querySelectorAll('.edit-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    switchEditTab(tabId);
                });
            });
            
            // 保存更改
            elements.saveChanges.addEventListener('click', async () => {
                // 保存广告链接
                saveAdUrl(0, elements.ad1Url.value);
                saveAdUrl(1, elements.ad2Url.value);
                saveAdUrl(2, elements.ad3Url.value);
                
                // 保存到GitHub
                await saveDataToGitHub();
                
                // 刷新显示
                renderAds();
            });
            
            // 书签管理
            elements.importBookmarks.addEventListener('click', importBookmarks);
            elements.exportBookmarks.addEventListener('click', exportBookmarks);
            elements.bookmarkFile.addEventListener('change', handleBookmarkFile);
            elements.addBookmark.addEventListener('click', addBookmark);
            elements.closeBookmarkModal.addEventListener('click', () => closeModal(elements.bookmarkModal));
            elements.cancelBookmark.addEventListener('click', () => closeModal(elements.bookmarkModal));
            elements.saveBookmark.addEventListener('click', saveBookmark);
            elements.createFolder.addEventListener('click', createFolder);
            
            // 城市管理
            elements.addCity.addEventListener('click', addCity);
            elements.closeCityModal.addEventListener('click', () => closeModal(elements.cityModal));
            elements.cancelCity.addEventListener('click', () => closeModal(elements.cityModal));
            elements.saveCity.addEventListener('click', saveCity);
            
            // 广告管理
            elements.uploadAd1.addEventListener('click', () => elements.ad1File.click());
            elements.ad1File.addEventListener('change', () => handleAdUpload('ad1-file', 0));
            elements.removeAd1.addEventListener('click', () => removeAd(0));
            
            elements.uploadAd2.addEventListener('click', () => elements.ad2File.click());
            elements.ad2File.addEventListener('change', () => handleAdUpload('ad2-file', 1));
            elements.removeAd2.addEventListener('click', () => removeAd(1));
            
            elements.uploadAd3.addEventListener('click', () => elements.ad3File.click());
            elements.ad3File.addEventListener('change', () => handleAdUpload('ad3-file', 2));
            elements.removeAd3.addEventListener('click', () => removeAd(2));
            
            // 搜索功能
            elements.searchInput.addEventListener('input', (e) => {
                appData.searchQuery = e.target.value;
                renderBookmarks();
            });
            
            elements.mobileSearchInput.addEventListener('input', (e) => {
                appData.searchQuery = e.target.value;
                renderBookmarks();
            });
            
            // 导航栏显示/隐藏
            let lastScrollTime = 0;
            let navbarVisible = true;
            
            window.addEventListener('scroll', () => {
                lastScrollTime = Date.now();
                elements.navbar.classList.remove('opacity-0', 'pointer-events-none');
                elements.navbar.classList.add('opacity-100', 'pointer-events-auto');
                navbarVisible = true;
                
                // 3秒后隐藏
                clearTimeout(window.navbarTimeout);
                window.navbarTimeout = setTimeout(() => {
                    if (Date.now() - lastScrollTime > 3000) {
                        elements.navbar.classList.remove('opacity-100', 'pointer-events-auto');
                        elements.navbar.classList.add('opacity-0', 'pointer-events-none');
                        navbarVisible = false;
                    }
                }, 3000);
            });
            
            // 点击页面显示导航栏
            document.addEventListener('click', () => {
                if (!navbarVisible) {
                    elements.navbar.classList.remove('opacity-0', 'pointer-events-none');
                    elements.navbar.classList.add('opacity-100', 'pointer-events-auto');
                    navbarVisible = true;
                    
                    // 3秒后隐藏
                    clearTimeout(window.navbarTimeout);
                    window.navbarTimeout = setTimeout(() => {
                        elements.navbar.classList.remove('opacity-100', 'pointer-events-auto');
                        elements.navbar.classList.add('opacity-0', 'pointer-events-none');
                        navbarVisible = false;
                    }, 3000);
                }
            });
        }

        // 初始化
        async function init() {
            // 创建星空背景
            createStars();
            
            // 加载配置和数据
            loadGitHubConfig();
            
            // 检查是否有自动注入的仓库信息
            const repoInfo = document.querySelector('meta[name="github-repo-info"]')?.content;
            if (repoInfo && !appData.github.username && !appData.github.repo) {
                const [username, repo] = repoInfo.split('/');
                if (username && repo) {
                    appData.github.username = username;
                    appData.github.repo = repo;
                    elements.githubUsername.value = username;
                    elements.githubRepo.value = repo;
                }
            }
            
            // 从GitHub加载数据，如果失败则从本地加载
            await loadDataFromGitHub();
            
            // 初始化UI
            renderBookmarks();
            renderCities();
            renderAds();
            updateOnlineTime();
            updateHealthReminder();
            
            // 设置时钟更新定时器
            setInterval(updateClocks, 1000);
            setInterval(updateOnlineTime, 1000);
            setInterval(updateHealthReminder, 60000); // 每分钟更新一次健康提醒
            
            // 更新版权信息
            elements.copyright.textContent = `Copyright © 2018-${new Date().getFullYear()}, All Rights Reserved`;
            
            // 初始化事件监听
            initEventListeners();
            
            // 更新编辑功能状态
            updateEditFeaturesStatus();
        }

        // 启动应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
