<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际导航 | 外太空主题书签</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231a237e'/%3E%3Ccircle cx='50' cy='50' r='30' fill='%233949ab'/%3E%3Ccircle cx='50' cy='50' r='15' fill='%237986cb'/%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind 配置
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            black: '#0a0e17',
                            dark: '#121a29',
                            blue: '#1e3a8a',
                            purple: '#4c1d95',
                            pink: '#8b5cf6',
                            glow: '#3b82f6'
                        },
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-slow': 'float 8s ease-in-out infinite',
                        'float-fast': 'float 4s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'twinkle': 'twinkle 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        twinkle: {
                            '0%': { opacity: 0.3 },
                            '100%': { opacity: 1 },
                        }
                    }
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .glass-dark {
                background: rgba(10, 14, 23, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.08);
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle 2s infinite alternate;
            }
            .planet {
                position: absolute;
                border-radius: 50%;
                filter: blur(0.5px);
            }
            .bookmark-shadow {
                box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            }
            .text-shadow {
                text-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .folder-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }
            .folder-open .folder-content {
                max-height: 2000px;
                transition: max-height 0.6s ease-in;
            }
            .rotate-icon {
                transition: transform 0.3s ease;
            }
            .folder-open .rotate-icon {
                transform: rotate(90deg);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-space-black text-gray-100 min-h-screen overflow-x-hidden relative font-sans" id="app-body">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0"></div>
    
    <!-- 漂浮行星 -->
    <div class="planet bg-space-blue/30 w-64 h-64 top-20 left-[10%] animate-float-slow blur-md"></div>
    <div class="planet bg-space-purple/20 w-40 h-40 top-40 right-[15%] animate-float blur-md"></div>
    <div class="planet bg-space-pink/20 w-24 h-24 bottom-20 left-[20%] animate-float-fast blur-md"></div>
    
    <!-- 顶部固定控制栏 -->
    <header id="control-bar" class="fixed top-0 left-0 right-0 z-50 glass-dark transition-all duration-500 transform translate-y-0">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="text-space-glow text-xl font-bold font-space">星际导航</div>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/10 transition-colors" aria-label="切换主题">
                    <i class="fa fa-moon-o text-gray-300"></i>
                </button>
                <button id="settings-btn" class="p-2 rounded-full hover:bg-white/10 transition-colors" aria-label="设置">
                    <i class="fa fa-cog text-gray-300"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-20 pb-16 relative z-10">
        <!-- 主页内容 -->
        <section id="home-page" class="space-y-8">
            <!-- 顶部三组件 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 在线时长统计 -->
                <div class="glass rounded-xl p-5 bookmark-shadow transform hover:scale-[1.02] transition-transform">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-space text-lg text-space-glow">在线时长</h3>
                        <i class="fa fa-clock-o text-gray-400"></i>
                    </div>
                    <div class="text-2xl font-bold" id="online-duration">00:00:00</div>
                    <div class="text-sm text-gray-400 mt-2">自部署以来</div>
                </div>
                
                <!-- 健康提醒 -->
                <div class="glass rounded-xl p-5 bookmark-shadow transform hover:scale-[1.02] transition-transform">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-space text-lg text-space-glow">健康提醒</h3>
                        <i class="fa fa-heartbeat text-gray-400"></i>
                    </div>
                    <div id="health-reminder" class="text-base">该休息一下了</div>
                    <div class="text-sm text-gray-400 mt-2">下次提醒: <span id="next-reminder">15:30</span></div>
                </div>
                
                <!-- 世界时钟 -->
                <div class="glass rounded-xl p-5 bookmark-shadow transform hover:scale-[1.02] transition-transform">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-space text-lg text-space-glow">世界时钟</h3>
                        <i class="fa fa-globe text-gray-400"></i>
                    </div>
                    <div id="world-clocks" class="space-y-1">
                        <div class="flex justify-between"><span>北京</span><span id="time-beijing">08:00</span></div>
                        <div class="flex justify-between"><span>伦敦</span><span id="time-london">00:00</span></div>
                        <div class="flex justify-between"><span>纽约</span><span id="time-newyork">19:00</span></div>
                        <div class="flex justify-between"><span>东京</span><span id="time-tokyo">09:00</span></div>
                    </div>
                </div>
            </div>
            
            <!-- 搜索功能 -->
            <div class="glass rounded-xl p-4 bookmark-shadow max-w-2xl mx-auto">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索书签..." 
                        class="w-full bg-transparent border border-gray-600 rounded-lg py-3 px-4 pl-10 focus:outline-none focus:border-space-glow transition-colors">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <!-- 广告位 1 -->
            <div class="glass rounded-xl overflow-hidden bookmark-shadow">
                <div class="ad-container h-40 md:h-56 flex items-center justify-center">
                    <img src="https://picsum.photos/1200/300?random=1" alt="外太空探索广告" class="w-full h-full object-cover">
                </div>
            </div>
            
            <!-- 书签分类和内容 -->
            <div class="space-y-6">
                <!-- 书签分类标题 -->
                <div class="flex justify-between items-center">
                    <h2 class="font-space text-2xl text-space-glow">我的书签</h2>
                    <span id="bookmark-count" class="glass px-3 py-1 rounded-full text-sm">0 个网站</span>
                </div>
                
                <!-- 书签容器 -->
                <div id="bookmarks-container" class="space-y-6">
                    <!-- 书签将通过JS动态加载 -->
                    <div class="text-center py-12 text-gray-500">
                        <i class="fa fa-bookmark-o text-4xl mb-3"></i>
                        <p>暂无书签数据</p>
                        <p class="text-sm mt-1">请在编辑中心添加你的第一个书签</p>
                    </div>
                </div>
            </div>
            
            <!-- 广告位 2 -->
            <div class="glass rounded-xl overflow-hidden bookmark-shadow">
                <div class="ad-container h-40 md:h-56 flex items-center justify-center">
                    <img src="https://picsum.photos/1200/300?random=2" alt="宇宙科技广告" class="w-full h-full object-cover">
                </div>
            </div>
            
            <!-- 广告位 3 -->
            <div class="glass rounded-xl overflow-hidden bookmark-shadow">
                <div class="ad-container h-40 md:h-56 flex items-center justify-center">
                    <img src="https://picsum.photos/1200/300?random=3" alt="星际旅行广告" class="w-full h-full object-cover">
                </div>
            </div>
        </section>
        
        <!-- 编辑中心 (默认隐藏) -->
        <section id="edit-center" class="space-y-8 hidden">
            <div class="glass rounded-xl p-6 bookmark-shadow">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-space text-2xl text-space-glow">编辑中心</h2>
                    <button id="back-to-home" class="px-4 py-2 bg-space-blue/50 hover:bg-space-blue rounded-lg transition-colors">
                        <i class="fa fa-arrow-left mr-1"></i> 返回主页
                    </button>
                </div>
                
                <!-- 编辑功能状态提示 -->
                <div id="edit-status" class="mb-6 p-4 bg-amber-500/20 border border-amber-500/30 rounded-lg text-amber-300 text-sm">
                    <i class="fa fa-info-circle mr-2"></i>
                    <span>请先完成GitHub验证以启用编辑功能</span>
                </div>
                
                <!-- GitHub设置 -->
                <div class="mb-8">
                    <h3 class="font-space text-xl text-white mb-4 flex items-center">
                        <i class="fa fa-github mr-2 text-gray-400"></i> GitHub 同步设置
                    </h3>
                    <div class="glass-dark rounded-lg p-5 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-300 mb-1">GitHub 用户名</label>
                                <input type="text" id="github-username" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="用户名">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-300 mb-1">仓库名称</label>
                                <input type="text" id="github-repo" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="仓库名">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-300 mb-1">Personal Access Token (需要repo权限)</label>
                            <input type="password" id="github-token" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="ghp_...">
                            <p class="text-xs text-gray-500 mt-1">创建地址: https://github.com/settings/tokens</p>
                        </div>
                        <div class="flex space-x-3">
                            <button id="validate-github" class="px-4 py-2 bg-space-blue/50 hover:bg-space-blue rounded-lg transition-colors flex-1 sm:flex-none">
                                <i class="fa fa-check mr-1"></i> 验证 Token
                            </button>
                            <button id="save-github-settings" class="px-4 py-2 bg-green-600/50 hover:bg-green-600 rounded-lg transition-colors flex-1 sm:flex-none">
                                <i class="fa fa-save mr-1"></i> 保存设置
                            </button>
                        </div>
                        <div id="github-validation-result" class="hidden p-3 rounded-lg text-sm"></div>
                    </div>
                </div>
                
                <!-- 书签管理 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-space text-xl text-white flex items-center">
                            <i class="fa fa-bookmark mr-2 text-gray-400"></i> 书签管理
                        </h3>
                        <button id="add-bookmark-btn" class="px-3 py-1 bg-space-blue/50 hover:bg-space-blue rounded-lg transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-plus mr-1"></i> 添加书签
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- 导入导出 -->
                        <div class="glass-dark rounded-lg p-4 flex flex-wrap gap-3">
                            <label class="px-4 py-2 bg-space-purple/50 hover:bg-space-purple rounded-lg transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" disabled id="import-bookmark-label">
                                <i class="fa fa-upload mr-1"></i> 导入书签
                                <input type="file" id="import-bookmark" accept=".html" class="hidden" disabled>
                            </label>
                            <button id="export-bookmark" class="px-4 py-2 bg-space-pink/50 hover:bg-space-pink rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fa fa-download mr-1"></i> 导出书签
                            </button>
                            <button id="save-bookmarks" class="px-4 py-2 bg-green-600/50 hover:bg-green-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fa fa-save mr-1"></i> 保存更改
                            </button>
                        </div>
                        
                        <!-- 书签列表 -->
                        <div class="glass-dark rounded-lg p-4">
                            <div id="edit-bookmarks-container" class="max-h-[500px] overflow-y-auto scrollbar-hide space-y-3">
                                <!-- 编辑状态的书签将通过JS动态加载 -->
                                <div class="text-center py-10 text-gray-500">
                                    <p>暂无书签数据</p>
                                    <p class="text-sm mt-1">验证GitHub后添加你的第一个书签</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 世界时钟管理 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-space text-xl text-white flex items-center">
                            <i class="fa fa-clock-o mr-2 text-gray-400"></i> 世界时钟管理
                        </h3>
                        <button id="add-city-btn" class="px-3 py-1 bg-space-blue/50 hover:bg-space-blue rounded-lg transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-plus mr-1"></i> 添加城市
                        </button>
                    </div>
                    
                    <div class="glass-dark rounded-lg p-4">
                        <div id="cities-container" class="space-y-3">
                            <!-- 城市将通过JS动态加载 -->
                        </div>
                    </div>
                </div>
                
                <!-- 广告管理 -->
                <div class="mb-8">
                    <h3 class="font-space text-xl text-white mb-4 flex items-center">
                        <i class="fa fa-bullhorn mr-2 text-gray-400"></i> 广告管理
                    </h3>
                    
                    <div class="glass-dark rounded-lg p-4 space-y-4">
                        <div id="ads-container" class="space-y-6">
                            <!-- 广告位1 -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <h4 class="text-gray-300">广告位 1</h4>
                                    <button class="edit-ad-btn text-sm text-space-glow hover:underline disabled:opacity-50 disabled:cursor-not-allowed" disabled>编辑</button>
                                </div>
                                <div class="border border-gray-700 rounded-lg overflow-hidden h-32 bg-space-dark/50 flex items-center justify-center">
                                    <img id="ad-1-preview" src="https://picsum.photos/1200/300?random=1" alt="广告预览" class="w-full h-full object-cover">
                                </div>
                            </div>
                            
                            <!-- 广告位2 -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <h4 class="text-gray-300">广告位 2</h4>
                                    <button class="edit-ad-btn text-sm text-space-glow hover:underline disabled:opacity-50 disabled:cursor-not-allowed" disabled>编辑</button>
                                </div>
                                <div class="border border-gray-700 rounded-lg overflow-hidden h-32 bg-space-dark/50 flex items-center justify-center">
                                    <img id="ad-2-preview" src="https://picsum.photos/1200/300?random=2" alt="广告预览" class="w-full h-full object-cover">
                                </div>
                            </div>
                            
                            <!-- 广告位3 -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <h4 class="text-gray-300">广告位 3</h4>
                                    <button class="edit-ad-btn text-sm text-space-glow hover:underline disabled:opacity-50 disabled:cursor-not-allowed" disabled>编辑</button>
                                </div>
                                <div class="border border-gray-700 rounded-lg overflow-hidden h-32 bg-space-dark/50 flex items-center justify-center">
                                    <img id="ad-3-preview" src="https://picsum.photos/1200/300?random=3" alt="广告预览" class="w-full h-full object-cover">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- 底部信息 -->
    <footer class="relative z-10 py-6 border-t border-gray-800">
        <div class="container mx-auto px-4">
            <div class="dark-white text-center space-y-2">
                <div>共收录<span id="footer-total">0</span>个网站</div>
                <div>Copyright © 2018-<span id="current-year">2023</span> <span id="footer-hostname">example.com</span>, All Rights Reserved</div>
            </div>
        </div>
    </footer>
    
    <!-- 设置对话框 (默认隐藏) -->
    <div id="settings-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-5 border-b border-gray-700 flex justify-between items-center">
                <h3 class="font-space text-xl text-space-glow">设置</h3>
                <button id="close-settings" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-5">
                <div>
                    <h4 class="text-gray-300 mb-2">主题设置</h4>
                    <div class="flex space-x-3">
                        <button id="theme-dark" class="flex-1 py-2 border border-gray-700 rounded-lg bg-space-dark text-white">
                            <i class="fa fa-moon-o mr-1"></i> 黑夜模式
                        </button>
                        <button id="theme-light" class="flex-1 py-2 border border-gray-700 rounded-lg bg-gray-100 text-space-dark">
                            <i class="fa fa-sun-o mr-1"></i> 白天模式
                        </button>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-gray-300 mb-2">编辑中心</h4>
                    <p class="text-sm text-gray-400 mb-3">需要GitHub验证才能访问编辑中心</p>
                    <button id="enter-edit-center" class="w-full py-3 bg-space-blue/50 hover:bg-space-blue rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        进入编辑中心
                    </button>
                </div>
                
                <div>
                    <h4 class="text-gray-300 mb-2">关于</h4>
                    <p class="text-sm text-gray-400">星际导航是一个外太空主题的书签导航网站，帮助你管理和快速访问常用网站。</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加/编辑书签对话框 (默认隐藏) -->
    <div id="bookmark-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-xl max-w-md w-full mx-4">
            <div class="p-5 border-b border-gray-700 flex justify-between items-center">
                <h3 id="bookmark-modal-title" class="font-space text-xl text-space-glow">添加书签</h3>
                <button id="close-bookmark-modal" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <input type="hidden" id="bookmark-id">
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="bookmark-name">网站名称</label>
                    <input type="text" id="bookmark-name" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="例如：谷歌">
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="bookmark-url">网站URL</label>
                    <input type="url" id="bookmark-url" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="例如：https://google.com">
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="bookmark-folder">文件夹</label>
                    <input type="text" id="bookmark-folder" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="例如：搜索引擎（可选）">
                </div>
                <div class="pt-2">
                    <button id="save-bookmark" class="w-full py-3 bg-green-600/50 hover:bg-green-600 rounded-lg transition-colors">
                        保存书签
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加城市对话框 (默认隐藏) -->
    <div id="city-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-xl max-w-md w-full mx-4">
            <div class="p-5 border-b border-gray-700 flex justify-between items-center">
                <h3 class="font-space text-xl text-space-glow">添加城市</h3>
                <button id="close-city-modal" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="city-name">城市名称</label>
                    <input type="text" id="city-name" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="例如：巴黎">
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="city-timezone">时区 (UTC)</label>
                    <select id="city-timezone" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors">
                        <!-- 时区选项将通过JS动态生成 -->
                    </select>
                </div>
                <div class="pt-2">
                    <button id="save-city" class="w-full py-3 bg-green-600/50 hover:bg-green-600 rounded-lg transition-colors">
                        保存城市
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 编辑广告对话框 (默认隐藏) -->
    <div id="ad-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-xl max-w-md w-full mx-4">
            <div class="p-5 border-b border-gray-700 flex justify-between items-center">
                <h3 id="ad-modal-title" class="font-space text-xl text-space-glow">编辑广告</h3>
                <button id="close-ad-modal" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <input type="hidden" id="ad-id">
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="ad-image">广告图片</label>
                    <label class="w-full flex items-center justify-center p-3 border border-gray-700 rounded-lg cursor-pointer hover:bg-white/5 transition-colors">
                        <i class="fa fa-upload mr-2"></i> 选择图片 (最大3M)
                        <input type="file" id="ad-image" accept="image/*" class="hidden">
                    </label>
                    <div class="mt-2 h-40 border border-gray-700 rounded-lg overflow-hidden bg-space-dark/50 flex items-center justify-center">
                        <img id="ad-image-preview" src="" alt="广告预览" class="w-full h-full object-cover">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="ad-url">广告链接</label>
                    <input type="url" id="ad-url" class="w-full bg-space-dark/50 border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="例如：https://example.com">
                </div>
                <div class="pt-2">
                    <button id="save-ad" class="w-full py-3 bg-green-600/50 hover:bg-green-600 rounded-lg transition-colors">
                        保存广告
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 确认对话框 (默认隐藏) -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-xl max-w-md w-full mx-4">
            <div class="p-5 border-b border-gray-700">
                <h3 id="confirm-title" class="font-space text-xl text-space-glow">确认操作</h3>
            </div>
            <div class="p-5">
                <p id="confirm-message" class="text-gray-300 mb-5">确认要执行此操作吗？</p>
                <div class="flex space-x-3">
                    <button id="confirm-cancel" class="flex-1 py-2 border border-gray-700 rounded-lg hover:bg-white/10 transition-colors">
                        取消
                    </button>
                    <button id="confirm-ok" class="flex-1 py-2 bg-red-600/50 hover:bg-red-600 rounded-lg transition-colors">
                        确认
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 通知提示 (默认隐藏) -->
    <div id="notification" class="fixed bottom-5 right-5 z-50 glass rounded-lg p-4 max-w-sm transform translate-y-20 opacity-0 transition-all duration-300 hidden">
        <div class="flex items-start">
            <i id="notification-icon" class="fa fa-info-circle text-space-glow mt-0.5 mr-3"></i>
            <div>
                <h4 id="notification-title" class="font-medium text-white"></h4>
                <p id="notification-message" class="text-sm text-gray-300 mt-1"></p>
            </div>
            <button id="close-notification" class="ml-auto text-gray-400 hover:text-gray-200">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- 加载动画 (默认隐藏) -->
    <div id="loader" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-full p-5">
            <div class="w-12 h-12 border-4 border-gray-700 border-t-space-glow rounded-full animate-spin"></div>
        </div>
    </div>

    <script>
        // 应用数据存储
        const appData = {
            bookmarks: [],
            cities: [
                { name: '北京', timezone: 8 },
                { name: '伦敦', timezone: 0 },
                { name: '纽约', timezone: -5 },
                { name: '东京', timezone: 9 }
            ],
            ads: [
                { id: 1, image: 'https://picsum.photos/1200/300?random=1', url: '#' },
                { id: 2, image: 'https://picsum.photos/1200/300?random=2', url: '#' },
                { id: 3, image: 'https://picsum.photos/1200/300?random=3', url: '#' }
            ],
            github: {
                username: '',
                repo: '',
                token: '',
                validated: false
            },
            deployDate: new Date(), // 部署日期，实际应用中应该从环境变量获取
            theme: 'dark',
            searchQuery: ''
        };

        // DOM 元素引用 - 确保所有元素都能正确获取
        const elements = {
            // 控制栏
            controlBar: document.getElementById('control-bar'),
            themeToggle: document.getElementById('theme-toggle'),
            settingsBtn: document.getElementById('settings-btn'),
            
            // 主页
            homePage: document.getElementById('home-page'),
            editCenter: document.getElementById('edit-center'),
            onlineDuration: document.getElementById('online-duration'),
            healthReminder: document.getElementById('health-reminder'),
            nextReminder: document.getElementById('next-reminder'),
            searchInput: document.getElementById('search-input'),
            bookmarksContainer: document.getElementById('bookmarks-container'),
            bookmarkCount: document.getElementById('bookmark-count'),
            backToHome: document.getElementById('back-to-home'),
            
            // 编辑中心
            editStatus: document.getElementById('edit-status'),
            editBookmarksContainer: document.getElementById('edit-bookmarks-container'),
            addBookmarkBtn: document.getElementById('add-bookmark-btn'),
            importBookmark: document.getElementById('import-bookmark'),
            importBookmarkLabel: document.getElementById('import-bookmark-label'),
            exportBookmark: document.getElementById('export-bookmark'),
            saveBookmarks: document.getElementById('save-bookmarks'),
            addCityBtn: document.getElementById('add-city-btn'),
            citiesContainer: document.getElementById('cities-container'),
            editAdBtns: document.querySelectorAll('.edit-ad-btn'),
            
            // GitHub 设置
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            validateGithub: document.getElementById('validate-github'),
            saveGithubSettings: document.getElementById('save-github-settings'),
            githubValidationResult: document.getElementById('github-validation-result'),
            enterEditCenter: document.getElementById('enter-edit-center'),
            
            // 设置对话框
            settingsModal: document.getElementById('settings-modal'),
            closeSettings: document.getElementById('close-settings'),
            themeDark: document.getElementById('theme-dark'),
            themeLight: document.getElementById('theme-light'),
            
            // 书签对话框
            bookmarkModal: document.getElementById('bookmark-modal'),
            closeBookmarkModal: document.getElementById('close-bookmark-modal'),
            bookmarkModalTitle: document.getElementById('bookmark-modal-title'),
            bookmarkId: document.getElementById('bookmark-id'),
            bookmarkName: document.getElementById('bookmark-name'),
            bookmarkUrl: document.getElementById('bookmark-url'),
            bookmarkFolder: document.getElementById('bookmark-folder'),
            saveBookmark: document.getElementById('save-bookmark'),
            
            // 城市对话框
            cityModal: document.getElementById('city-modal'),
            closeCityModal: document.getElementById('close-city-modal'),
            cityName: document.getElementById('city-name'),
            cityTimezone: document.getElementById('city-timezone'),
            saveCity: document.getElementById('save-city'),
            
            // 广告对话框
            adModal: document.getElementById('ad-modal'),
            closeAdModal: document.getElementById('close-ad-modal'),
            adModalTitle: document.getElementById('ad-modal-title'),
            adId: document.getElementById('ad-id'),
            adImage: document.getElementById('ad-image'),
            adImagePreview: document.getElementById('ad-image-preview'),
            adUrl: document.getElementById('ad-url'),
            saveAd: document.getElementById('save-ad'),
            
            // 确认对话框
            confirmModal: document.getElementById('confirm-modal'),
            confirmCancel: document.getElementById('confirm-cancel'),
            confirmOk: document.getElementById('confirm-ok'),
            confirmTitle: document.getElementById('confirm-title'),
            confirmMessage: document.getElementById('confirm-message'),
            
            // 通知和加载
            notification: document.getElementById('notification'),
            notificationIcon: document.getElementById('notification-icon'),
            notificationTitle: document.getElementById('notification-title'),
            notificationMessage: document.getElementById('notification-message'),
            closeNotification: document.getElementById('close-notification'),
            loader: document.getElementById('loader'),
            
            // 底部信息
            footerTotal: document.getElementById('footer-total'),
            currentYear: document.getElementById('current-year'),
            footerHostname: document.getElementById('footer-hostname')
        };

        // 初始化函数 - 确保正确的执行顺序
        async function init() {
            // 验证所有关键DOM元素是否存在
            validateDomElements();
            
            // 创建星空背景
            createStars();
            
            // 设置当前年份
            elements.currentYear.textContent = new Date().getFullYear();
            
            // 从URL获取仓库信息（模拟GitHub Actions注入）
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('user') && urlParams.has('repo')) {
                appData.github.username = urlParams.get('user');
                appData.github.repo = urlParams.get('repo');
                elements.githubUsername.value = appData.github.username;
                elements.githubRepo.value = appData.github.repo;
            }
            
            // 加载时区选项
            loadTimezoneOptions();
            
            // 加载本地存储的设置
            loadLocalSettings();
            
            // 加载GitHub数据 - 确保数据加载完成后再渲染
            await loadDataFromGitHub();
            
            // 渲染页面
            renderBookmarks();
            renderEditBookmarks();
            renderCities();
            updateBookmarkCount();
            
            // 启动时钟和计时器
            updateClocks();
            setInterval(updateClocks, 1000);
            
            updateOnlineDuration();
            setInterval(updateOnlineDuration, 1000);
            
            // 设置健康提醒
            updateHealthReminder();
            
            // 绑定事件监听 - 确保所有按钮都有事件处理
            bindAllEvents();
        }

        // 验证DOM元素是否存在，解决按钮无响应的根本原因
        function validateDomElements() {
            const criticalElements = [
                'themeToggle', 'settingsBtn', 'backToHome', 
                'validateGithub', 'saveGithubSettings', 'enterEditCenter',
                'addBookmarkBtn', 'importBookmark', 'exportBookmark', 'saveBookmarks',
                'addCityBtn', 'saveBookmark', 'saveCity', 'saveAd'
            ];
            
            criticalElements.forEach(elementName => {
                if (!elements[elementName]) {
                    console.error(`关键元素不存在: ${elementName}，这会导致功能异常`);
                }
            });
        }

        // 创建星空背景
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 200;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // 随机大小
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // 随机位置
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // 随机闪烁动画延迟
                star.style.animationDelay = `${Math.random() * 2}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // 加载时区选项
        function loadTimezoneOptions() {
            const select = elements.cityTimezone;
            if (!select) return;
            
            // 生成UTC-12到UTC+14的时区选项
            for (let i = -12; i <= 14; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `UTC${i >= 0 ? '+' : ''}${i}`;
                select.appendChild(option);
            }
            
            // 默认选中UTC+8（北京时区）
            select.value = 8;
        }

        // 加载本地存储的设置
        function loadLocalSettings() {
            const savedSettings = localStorage.getItem('spaceBookmarkSettings');
            if (savedSettings) {
                try {
                    const parsed = JSON.parse(savedSettings);
                    if (parsed.theme) {
                        appData.theme = parsed.theme;
                        setTheme(appData.theme);
                    }
                    if (parsed.github) {
                        appData.github = { ...appData.github, ...parsed.github };
                        if (elements.githubUsername) elements.githubUsername.value = appData.github.username || '';
                        if (elements.githubToken) elements.githubToken.value = appData.github.token || '';
                        if (elements.githubRepo) elements.githubRepo.value = appData.github.repo || '';
                    }
                } catch (e) {
                    console.error('加载本地设置失败:', e);
                    showNotification('error', '配置加载失败', '无法加载保存的设置，将使用默认值');
                }
            }
            
            // 更新编辑功能状态
            updateEditFeaturesStatus();
        }

        // 保存设置到本地存储
        function saveLocalSettings() {
            const settingsToSave = {
                theme: appData.theme,
                github: {
                    username: appData.github.username,
                    repo: appData.github.repo,
                    token: appData.github.token,
                    validated: appData.github.validated
                }
            };
            localStorage.setItem('spaceBookmarkSettings', JSON.stringify(settingsToSave));
        }

        // 从GitHub加载数据 - 核心优化
        async function loadDataFromGitHub() {
            showLoader();
            
            try {
                let url;
                let headers = {};
                
                // 检查是否有GitHub配置
                if (appData.github.username && appData.github.repo) {
                    if (appData.github.token && appData.github.validated) {
                        // 使用GitHub API（支持私有仓库）
                        url = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                        headers['Authorization'] = `token ${appData.github.token}`;
                    } else {
                        // 使用公开raw地址
                        url = `https://raw.githubusercontent.com/${appData.github.username}/${appData.github.repo}/main/bookmarks.json`;
                    }
                    
                    const response = await fetch(url, { headers });
                    
                    if (response.ok) {
                        let data;
                        if (appData.github.token && appData.github.validated) {
                            // GitHub API返回的是base64编码的数据
                            const apiResponse = await response.json();
                            data = JSON.parse(atob(apiResponse.content));
                        } else {
                            // 公开地址直接返回JSON
                            data = await response.json();
                        }
                        
                        // 合并数据 - 修复数据合并逻辑
                        if (data.bookmarks && Array.isArray(data.bookmarks)) appData.bookmarks = data.bookmarks;
                        if (data.cities && Array.isArray(data.cities)) appData.cities = data.cities;
                        if (data.ads && Array.isArray(data.ads)) appData.ads = data.ads;
                        
                        showNotification('success', '数据加载成功', '已从GitHub加载最新数据');
                        return true;
                    } else if (response.status === 404) {
                        // 文件不存在，使用默认数据
                        showNotification('info', '首次使用', '未找到bookmarks.json，将使用默认数据');
                        return false;
                    } else {
                        throw new Error(`HTTP错误: ${response.status}`);
                    }
                } else {
                    // 没有GitHub配置，使用默认数据
                    showNotification('info', '未配置GitHub', '使用默认书签数据');
                    return false;
                }
            } catch (error) {
                console.error('加载GitHub数据失败:', error);
                showNotification('error', '数据加载失败', '无法从GitHub加载数据，使用本地数据');
                return false;
            } finally {
                hideLoader();
            }
        }

        // 保存数据到GitHub - 核心优化
        async function saveDataToGitHub() {
            showLoader();
            
            try {
                if (!appData.github.username || !appData.github.repo || !appData.github.token || !appData.github.validated) {
                    throw new Error('GitHub配置不完整或未验证');
                }
                
                // 准备要保存的数据
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    cities: appData.cities,
                    ads: appData.ads,
                    updatedAt: new Date().toISOString()
                };
                
                const content = JSON.stringify(dataToSave, null, 2);
                
                // 首先检查文件是否存在
                const checkUrl = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                const checkResponse = await fetch(checkUrl, {
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                if (checkResponse.ok) {
                    const checkData = await checkResponse.json();
                    sha = checkData.sha; // 获取现有文件的SHA
                }
                
                // 解决编码问题 - 处理非Latin1字符
                function b64EncodeUnicode(str) {
                    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, 
                        function toSolidBytes(match, p1) {
                            return String.fromCharCode('0x' + p1);
                        }));
                }
                
                const encodedContent = b64EncodeUnicode(content);
                
                // 保存数据
                const saveUrl = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                const saveResponse = await fetch(saveUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via Space Bookmark Navigator',
                        content: encodedContent,
                        sha: sha // 如果文件存在，需要提供SHA
                    })
                });
                
                if (!saveResponse.ok) {
                    const errorData = await saveResponse.json();
                    throw new Error(errorData.message || `保存失败: HTTP ${saveResponse.status}`);
                }
                
                showNotification('success', '保存成功', '数据已成功同步到GitHub');
                return true;
            } catch (error) {
                console.error('保存数据到GitHub失败:', error);
                showNotification('error', '保存失败', error.message);
                return false;
            } finally {
                hideLoader();
            }
        }

        // 验证GitHub Token - 实现需求中的函数
        async function validateGitHubToken(token) {
            showLoader();
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    return {
                        valid: true,
                        message: `验证成功，欢迎回来，${userData.login}！`
                    };
                } else {
                    return {
                        valid: false,
                        message: `验证失败: ${response.statusText}`
                    };
                }
            } catch (error) {
                console.error('GitHub验证失败:', error);
                return {
                    valid: false,
                    message: `验证出错: ${error.message}`
                };
            } finally {
                hideLoader();
            }
        }

        // 更新编辑功能状态 - 实现需求中的函数
        function updateEditFeaturesStatus() {
            const isEnabled = appData.github.validated;
            
            // 更新状态提示
            if (elements.editStatus) {
                if (isEnabled) {
                    elements.editStatus.innerHTML = '<i class="fa fa-check-circle mr-2 text-green-400"></i><span>已通过GitHub验证，所有编辑功能已启用</span>';
                    elements.editStatus.className = 'mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm';
                } else {
                    elements.editStatus.innerHTML = '<i class="fa fa-info-circle mr-2"></i><span>请先完成GitHub验证以启用编辑功能</span>';
                    elements.editStatus.className = 'mb-6 p-4 bg-amber-500/20 border border-amber-500/30 rounded-lg text-amber-300 text-sm';
                }
            }
            
            // 更新按钮状态 - 确保所有按钮状态正确
            if (elements.addBookmarkBtn) elements.addBookmarkBtn.disabled = !isEnabled;
            if (elements.importBookmark) elements.importBookmark.disabled = !isEnabled;
            if (elements.importBookmarkLabel) elements.importBookmarkLabel.disabled = !isEnabled;
            if (elements.exportBookmark) elements.exportBookmark.disabled = !isEnabled;
            if (elements.saveBookmarks) elements.saveBookmarks.disabled = !isEnabled;
            if (elements.addCityBtn) elements.addCityBtn.disabled = !isEnabled;
            if (elements.enterEditCenter) elements.enterEditCenter.disabled = !isEnabled;
            
            if (elements.editAdBtns) {
                elements.editAdBtns.forEach(btn => {
                    btn.disabled = !isEnabled;
                });
            }
        }

        // 渲染书签 - 支持文件夹折叠/展开
        function renderBookmarks() {
            const container = elements.bookmarksContainer;
            if (!container) return;
            
            container.innerHTML = '';
            
            // 过滤书签
            let filteredBookmarks = appData.bookmarks;
            if (appData.searchQuery) {
                const query = appData.searchQuery.toLowerCase();
                filteredBookmarks = appData.bookmarks.filter(bookmark => 
                    bookmark.name.toLowerCase().includes(query) || 
                    bookmark.url.toLowerCase().includes(query) ||
                    (bookmark.folder && bookmark.folder.toLowerCase().includes(query))
                );
            }
            
            if (filteredBookmarks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fa fa-bookmark-o text-4xl mb-3"></i>
                        <p>未找到书签</p>
                        <p class="text-sm mt-1">${appData.searchQuery ? '尝试其他搜索关键词' : '请在编辑中心添加书签'}</p>
                    </div>
                `;
                return;
            }
            
            // 按文件夹分组
            const bookmarksByFolder = {};
            filteredBookmarks.forEach(bookmark => {
                const folder = bookmark.folder || '未分类';
                if (!bookmarksByFolder[folder]) {
                    bookmarksByFolder[folder] = [];
                }
                bookmarksByFolder[folder].push(bookmark);
            });
            
            // 获取文件夹列表并排序
            const folders = Object.keys(bookmarksByFolder).sort();
            
            // 渲染每个文件夹 - 支持折叠/展开
            folders.forEach(folder => {
                // 创建文件夹容器
                const folderElement = document.createElement('div');
                folderElement.className = 'folder-item glass rounded-lg bookmark-shadow overflow-hidden';
                
                // 文件夹标题栏（可点击折叠/展开）
                const folderHeader = document.createElement('div');
                folderHeader.className = 'folder-header p-3 flex justify-between items-center cursor-pointer';
                folderHeader.innerHTML = `
                    <h3 class="font-space text-space-glow flex items-center">
                        <i class="fa fa-folder-o rotate-icon mr-2"></i>${folder}
                        <span class="ml-2 text-xs bg-gray-700 px-1.5 py-0.5 rounded">${bookmarksByFolder[folder].length}</span>
                    </h3>
                    <i class="fa fa-chevron-down text-xs text-gray-400 rotate-icon"></i>
                `;
                
                // 文件夹内容区域
                const folderContent = document.createElement('div');
                folderContent.className = 'folder-content p-3 pt-0';
                
                // 书签网格
                const bookmarksGrid = document.createElement('div');
                bookmarksGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4';
                
                // 添加书签到网格
                bookmarksByFolder[folder].forEach(bookmark => {
                    const bookmarkElement = document.createElement('a');
                    bookmarkElement.href = bookmark.url;
                    bookmarkElement.target = '_blank';
                    bookmarkElement.className = 'glass rounded-lg p-3 flex flex-col items-center justify-center h-24 hover:bg-white/10 transition-all transform hover:scale-[1.03]';
                    
                    // 尝试获取favicon，失败则显示首字符
                    let faviconHtml = '';
                    try {
                        const url = new URL(bookmark.url);
                        faviconHtml = `<img src="${url.protocol}//${url.hostname}/favicon.ico" alt="${bookmark.name}的图标" class="w-8 h-8 mb-2 object-contain">`;
                    } catch (e) {
                        const firstChar = bookmark.name.charAt(0).toUpperCase();
                        faviconHtml = `<div class="w-8 h-8 mb-2 rounded-full bg-space-blue/50 flex items-center justify-center text-lg">${firstChar}</div>`;
                    }
                    
                    bookmarkElement.innerHTML = `
                        ${faviconHtml}
                        <div class="text-center text-sm truncate w-full">${bookmark.name}</div>
                    `;
                    
                    bookmarksGrid.appendChild(bookmarkElement);
                });
                
                // 组装文件夹元素
                folderContent.appendChild(bookmarksGrid);
                folderElement.appendChild(folderHeader);
                folderElement.appendChild(folderContent);
                container.appendChild(folderElement);
                
                // 添加文件夹折叠/展开功能
                folderHeader.addEventListener('click', () => {
                    folderElement.classList.toggle('folder-open');
                });
                
                // 默认展开第一个文件夹
                if (folders.indexOf(folder) === 0) {
                    folderElement.classList.add('folder-open');
                }
            });
        }

        // 渲染编辑模式的书签
        function renderEditBookmarks() {
            const container = elements.editBookmarksContainer;
            if (!container) return;
            
            container.innerHTML = '';
            
            if (appData.bookmarks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10 text-gray-500">
                        <p>暂无书签数据</p>
                        <p class="text-sm mt-1">点击"添加书签"按钮开始</p>
                    </div>
                `;
                return;
            }
            
            // 按文件夹分组
            const bookmarksByFolder = {};
            appData.bookmarks.forEach(bookmark => {
                const folder = bookmark.folder || '未分类';
                if (!bookmarksByFolder[folder]) {
                    bookmarksByFolder[folder] = [];
                }
                bookmarksByFolder[folder].push(bookmark);
            });
            
            // 获取文件夹列表并排序
            const folders = Object.keys(bookmarksByFolder).sort();
            
            // 渲染每个文件夹
            folders.forEach(folder => {
                // 文件夹标题 - 可折叠/展开
                const folderHeader = document.createElement('div');
                folderHeader.className = 'folder-header flex justify-between items-center mb-2 cursor-pointer';
                folderHeader.innerHTML = `
                    <h4 class="font-medium text-gray-300 flex items-center">
                        <i class="fa fa-folder rotate-icon mr-2 text-gray-500"></i>${folder}
                        <span class="ml-2 text-xs bg-gray-700 px-1.5 py-0.5 rounded">${bookmarksByFolder[folder].length}</span>
                    </h4>
                    <i class="fa fa-chevron-down text-xs text-gray-400 rotate-icon"></i>
                `;
                
                // 文件夹内容
                const folderContent = document.createElement('div');
                folderContent.className = 'folder-content ml-4 space-y-2';
                
                // 添加书签到文件夹
                bookmarksByFolder[folder].forEach(bookmark => {
                    const bookmarkElement = document.createElement('div');
                    bookmarkElement.className = 'flex justify-between items-center p-3 bg-space-dark/30 rounded-lg';
                    
                    bookmarkElement.innerHTML = `
                        <div class="flex items-center">
                            <div class="mr-3">
                                ${bookmark.url ? `<img src="${getFaviconUrl(bookmark.url)}" alt="${bookmark.name}的图标" class="w-6 h-6 object-contain">` : ''}
                            </div>
                            <div class="min-w-0">
                                <div class="font-medium truncate">${bookmark.name}</div>
                                <div class="text-xs text-gray-400 truncate">${bookmark.url}</div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-bookmark-btn p-1.5 text-gray-400 hover:text-space-glow" data-id="${bookmark.id}">
                                <i class="fa fa-pencil"></i>
                            </button>
                            <button class="delete-bookmark-btn p-1.5 text-gray-400 hover:text-red-400" data-id="${bookmark.id}">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    folderContent.appendChild(bookmarkElement);
                    
                    // 绑定编辑和删除事件 - 确保按钮有响应
                    const editBtn = bookmarkElement.querySelector('.edit-bookmark-btn');
                    if (editBtn) {
                        editBtn.addEventListener('click', (e) => {
                            e.stopPropagation(); // 防止触发文件夹折叠
                            openEditBookmarkModal(bookmark.id);
                        });
                    }
                    
                    const deleteBtn = bookmarkElement.querySelector('.delete-bookmark-btn');
                    if (deleteBtn) {
                        deleteBtn.addEventListener('click', (e) => {
                            e.stopPropagation(); // 防止触发文件夹折叠
                            openConfirmModal(
                                '删除书签',
                                `确定要删除书签"${bookmark.name}"吗？此操作不可撤销。`,
                                () => {
                                    deleteBookmark(bookmark.id);
                                }
                            );
                        });
                    }
                });
                
                // 添加到容器
                container.appendChild(folderHeader);
                container.appendChild(folderContent);
                
                // 添加文件夹折叠/展开功能
                folderHeader.addEventListener('click', () => {
                    folderHeader.classList.toggle('folder-open');
                    folderContent.classList.toggle('folder-open');
                });
                
                // 默认展开第一个文件夹
                if (folders.indexOf(folder) === 0) {
                    folderHeader.classList.add('folder-open');
                    folderContent.classList.add('folder-open');
                }
                
                // 添加文件夹分隔线
                const divider = document.createElement('div');
                divider.className = 'my-3 border-t border-gray-800';
                container.appendChild(divider);
            });
        }

        // 获取网站favicon URL
        function getFaviconUrl(url) {
            try {
                const parsedUrl = new URL(url);
                return `${parsedUrl.protocol}//${parsedUrl.hostname}/favicon.ico`;
            } catch (e) {
                return '';
            }
        }

        // 渲染城市列表
        function renderCities() {
            const container = elements.citiesContainer;
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.cities.forEach((city, index) => {
                const cityElement = document.createElement('div');
                cityElement.className = 'flex justify-between items-center p-3 bg-space-dark/30 rounded-lg';
                
                // 计算当前城市时间
                const now = new Date();
                const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
                const cityTime = new Date(utcTime + city.timezone * 3600000);
                const timeString = cityTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                cityElement.innerHTML = `
                    <div>
                        <div class="font-medium">${city.name}</div>
                        <div class="text-xs text-gray-400">UTC${city.timezone >= 0 ? '+' : ''}${city.timezone}</div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-lg font-mono">${timeString}</div>
                        <button class="delete-city-btn text-gray-400 hover:text-red-400" data-index="${index}">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(cityElement);
                
                // 绑定删除事件 - 确保按钮有响应
                const deleteBtn = cityElement.querySelector('.delete-city-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        openConfirmModal(
                            '删除城市',
                            `确定要从世界时钟中删除"${city.name}"吗？`,
                            () => {
                                deleteCity(index);
                            }
                        );
                    });
                }
            });
        }

        // 更新世界时钟
        function updateClocks() {
            const now = new Date();
            const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
            
            // 更新城市时间
            appData.cities.forEach((city) => {
                const cityTime = new Date(utcTime + city.timezone * 3600000);
                const timeString = cityTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                // 更新主页上的时钟显示
                const cityKey = city.name.toLowerCase().replace(/\s+/g, '');
                const timeElement = document.getElementById(`time-${cityKey}`);
                if (timeElement) {
                    timeElement.textContent = timeString;
                }
            });
        }

        // 更新在线时长
        function updateOnlineDuration() {
            if (!elements.onlineDuration) return;
            
            const now = new Date();
            const diff = now - appData.deployDate;
            
            // 计算时分秒
            const seconds = Math.floor((diff / 1000) % 60);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            // 格式化显示
            const durationString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            elements.onlineDuration.textContent = durationString;
        }

        // 更新健康提醒
        function updateHealthReminder() {
            if (!elements.healthReminder || !elements.nextReminder) return;
            
            const now = new Date();
            const minutes = now.getMinutes();
            
            // 每小时的第20和50分钟提醒休息
            let nextReminder;
            let reminderText;
            
            if (minutes < 20) {
                nextReminder = `${now.getHours()}:20`;
                reminderText = '工作顺利';
            } else if (minutes < 50) {
                nextReminder = `${now.getHours()}:50`;
                reminderText = '继续努力';
            } else {
                const nextHour = (now.getHours() + 1) % 24;
                nextReminder = `${nextHour}:20`;
                reminderText = '准备休息一下';
            }
            
            elements.healthReminder.textContent = reminderText;
            elements.nextReminder.textContent = nextReminder;
        }

        // 更新书签计数
        function updateBookmarkCount() {
            const count = appData.bookmarks.length;
            if (elements.bookmarkCount) elements.bookmarkCount.textContent = `${count} 个网站`;
            if (elements.footerTotal) elements.footerTotal.textContent = count;
        }

        // 添加书签
        function addBookmark(name, url, folder = '') {
            const newBookmark = {
                id: Date.now().toString(),
                name,
                url,
                folder: folder.trim() || ''
            };
            
            appData.bookmarks.push(newBookmark);
            
            // 去重（基于URL）
            appData.bookmarks = [...new Map(appData.bookmarks.map(item => [item.url, item])).values()];
            
            renderBookmarks();
            renderEditBookmarks();
            updateBookmarkCount();
            
            return newBookmark;
        }

        // 编辑书签
        function editBookmark(id, name, url, folder = '') {
            const index = appData.bookmarks.findIndex(bookmark => bookmark.id === id);
            if (index !== -1) {
                appData.bookmarks[index].name = name;
                appData.bookmarks[index].url = url;
                appData.bookmarks[index].folder = folder.trim() || '';
                
                // 去重（基于URL）
                const duplicateIndex = appData.bookmarks.findIndex((b, i) => b.url === url && i !== index);
                if (duplicateIndex !== -1) {
                    appData.bookmarks.splice(index, 1);
                    showNotification('info', '书签已合并', '已存在相同URL的书签，已自动合并');
                }
                
                renderBookmarks();
                renderEditBookmarks();
                return true;
            }
            return false;
        }

        // 删除书签
        function deleteBookmark(id) {
            const initialLength = appData.bookmarks.length;
            appData.bookmarks = appData.bookmarks.filter(bookmark => bookmark.id !== id);
            
            if (appData.bookmarks.length < initialLength) {
                renderBookmarks();
                renderEditBookmarks();
                updateBookmarkCount();
                showNotification('info', '书签已删除', '书签已从列表中移除');
                return true;
            }
            return false;
        }

        // 添加城市
        function addCity(name, timezone) {
            // 检查是否已存在同名城市
            const exists = appData.cities.some(city => city.name.toLowerCase() === name.toLowerCase());
            if (exists) {
                showNotification('warning', '城市已存在', '该城市已在列表中');
                return false;
            }
            
            appData.cities.push({
                name,
                timezone: parseInt(timezone)
            });
            
            renderCities();
            // 添加主页显示元素
            const cityKey = name.toLowerCase().replace(/\s+/g, '');
            const clocksContainer = document.getElementById('world-clocks');
            if (clocksContainer) {
                const cityTimeElement = document.createElement('div');
                cityTimeElement.className = 'flex justify-between';
                cityTimeElement.innerHTML = `<span>${name}</span><span id="time-${cityKey}">--:--</span>`;
                clocksContainer.appendChild(cityTimeElement);
            }
            
            showNotification('success', '城市已添加', `已添加${name}到世界时钟`);
            return true;
        }

        // 删除城市
        function deleteCity(index) {
            if (appData.cities.length <= 1) {
                showNotification('warning', '无法删除', '至少保留一个城市');
                return false;
            }
            
            const deletedCity = appData.cities.splice(index, 1)[0];
            renderCities();
            
            // 移除主页显示元素
            const cityKey = deletedCity.name.toLowerCase().replace(/\s+/g, '');
            const timeElement = document.getElementById(`time-${cityKey}`);
            if (timeElement && timeElement.parentElement) {
                timeElement.parentElement.remove();
            }
            
            showNotification('info', '城市已删除', `已从世界时钟移除${deletedCity.name}`);
            return true;
        }

        // 更新广告
        function updateAd(id, imageUrl, url) {
            const adIndex = appData.ads.findIndex(ad => ad.id === id);
            if (adIndex !== -1) {
                if (imageUrl) {
                    appData.ads[adIndex].image = imageUrl;
                    // 更新预览
                    const previewElement = document.getElementById(`ad-${id}-preview`);
                    if (previewElement) {
                        previewElement.src = imageUrl;
                    }
                }
                if (url) {
                    appData.ads[adIndex].url = url;
                }
                
                showNotification('success', '广告已更新', '广告内容已更新');
                return true;
            }
            return false;
        }

        // 导入书签 - 按文件夹结构导入并去重
        function importBookmarks(htmlContent) {
            // 简单解析书签HTML文件
            try {
                // 创建临时DOM解析器
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                
                // 递归解析书签结构
                function parseBookmarks(element, currentFolder = '') {
                    const bookmarks = [];
                    let childNodes = Array.from(element.childNodes);
                    
                    for (let i = 0; i < childNodes.length; i++) {
                        const node = childNodes[i];
                        
                        // 处理文件夹
                        if (node.tagName === 'DT' && node.firstChild && node.firstChild.tagName === 'H3') {
                            const folderName = node.firstChild.textContent.trim();
                            const nextNode = childNodes[i + 1];
                            
                            // 查找文件夹对应的DL元素
                            if (nextNode && nextNode.tagName === 'DL') {
                                // 递归解析子文件夹
                                const subBookmarks = parseBookmarks(nextNode, currentFolder ? `${currentFolder}/${folderName}` : folderName);
                                bookmarks.push(...subBookmarks);
                                i++; // 跳过已处理的DL元素
                            }
                        }
                        // 处理书签
                        else if (node.tagName === 'DT' && node.firstChild && node.firstChild.tagName === 'A') {
                            const aTag = node.firstChild;
                            const name = aTag.textContent.trim();
                            const url = aTag.href;
                            
                            if (name && url) {
                                bookmarks.push({
                                    name,
                                    url,
                                    folder: currentFolder
                                });
                            }
                        }
                        // 处理包含书签的列表
                        else if (node.tagName === 'DL') {
                            const subBookmarks = parseBookmarks(node, currentFolder);
                            bookmarks.push(...subBookmarks);
                        }
                    }
                    
                    return bookmarks;
                }
                
                // 开始解析
                const allBookmarks = parseBookmarks(doc);
                
                let importedCount = 0;
                let existingCount = 0;
                
                // 导入书签并去重
                allBookmarks.forEach(bookmark => {
                    // 跳过已存在的书签
                    const exists = appData.bookmarks.some(b => b.url === bookmark.url);
                    if (exists) {
                        existingCount++;
                        return;
                    }
                    
                    addBookmark(bookmark.name, bookmark.url, bookmark.folder);
                    importedCount++;
                });
                
                return {
                    success: true,
                    imported: importedCount,
                    existing: existingCount
                };
            } catch (error) {
                console.error('导入书签失败:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }

        // 导出书签
        function exportBookmarks() {
            // 创建书签HTML内容
            const now = new Date();
            const htmlContent = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签 - 导出于 ${now.toLocaleString()}</H1>
<DL><p>
${generateBookmarkHtml()}
</DL><p>`;
            
            // 创建下载链接
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bookmarks_${now.getTime()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            return true;
        }

        // 生成书签HTML
        function generateBookmarkHtml() {
            // 按文件夹分组
            const bookmarksByFolder = {};
            appData.bookmarks.forEach(bookmark => {
                const folder = bookmark.folder || '未分类';
                if (!bookmarksByFolder[folder]) {
                    bookmarksByFolder[folder] = [];
                }
                bookmarksByFolder[folder].push(bookmark);
            });
            
            let html = '';
            
            // 为每个文件夹生成HTML
            Object.keys(bookmarksByFolder).forEach(folder => {
                html += `<DT><H3>${escapeHtml(folder)}</H3>\n`;
                html += `<DL><p>\n`;
                
                bookmarksByFolder[folder].forEach(bookmark => {
                    html += `<DT><A HREF="${escapeHtml(bookmark.url)}">${escapeHtml(bookmark.name)}</A>\n`;
                });
                
                html += `</DL><p>\n`;
            });
            
            return html;
        }

        // HTML转义
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // 打开添加书签对话框
        function openAddBookmarkModal() {
            if (!elements.bookmarkModal) return;
            
            elements.bookmarkModalTitle.textContent = '添加书签';
            elements.bookmarkId.value = '';
            elements.bookmarkName.value = '';
            elements.bookmarkUrl.value = '';
            elements.bookmarkFolder.value = '';
            
            elements.bookmarkModal.classList.remove('hidden');
        }

        // 打开编辑书签对话框
        function openEditBookmarkModal(id) {
            if (!elements.bookmarkModal) return;
            
            const bookmark = appData.bookmarks.find(b => b.id === id);
            if (bookmark) {
                elements.bookmarkModalTitle.textContent = '编辑书签';
                elements.bookmarkId.value = bookmark.id;
                elements.bookmarkName.value = bookmark.name;
                elements.bookmarkUrl.value = bookmark.url;
                elements.bookmarkFolder.value = bookmark.folder || '';
                
                elements.bookmarkModal.classList.remove('hidden');
            }
        }

        // 打开添加城市对话框
        function openAddCityModal() {
            if (!elements.cityModal) return;
            
            elements.cityName.value = '';
            elements.cityTimezone.value = 8; // 默认UTC+8
            
            elements.cityModal.classList.remove('hidden');
        }

        // 打开编辑广告对话框
        function openEditAdModal(id) {
            if (!elements.adModal) return;
            
            const ad = appData.ads.find(a => a.id === id);
            if (ad) {
                elements.adModalTitle.textContent = `编辑广告 ${id}`;
                elements.adId.value = ad.id;
                elements.adImagePreview.src = ad.image;
                elements.adUrl.value = ad.url;
                
                elements.adModal.classList.remove('hidden');
            }
        }

        // 打开确认对话框
        function openConfirmModal(title, message, confirmCallback) {
            if (!elements.confirmModal) return;
            
            elements.confirmTitle.textContent = title;
            elements.confirmMessage.textContent = message;
            
            // 保存确认回调
            const handleConfirm = function() {
                confirmCallback();
                elements.confirmModal.classList.add('hidden');
                elements.confirmOk.removeEventListener('click', handleConfirm); // 清除回调
            };
            
            elements.confirmOk.addEventListener('click', handleConfirm);
            elements.confirmModal.classList.remove('hidden');
        }

        // 显示通知
        function showNotification(type, title, message) {
            if (!elements.notification) return;
            
            const iconMap = {
                success: 'fa-check-circle text-green-400',
                error: 'fa-exclamation-circle text-red-400',
                info: 'fa-info-circle text-space-glow',
                warning: 'fa-exclamation-triangle text-amber-400'
            };
            
            elements.notificationIcon.className = `fa ${iconMap[type] || iconMap.info} mt-0.5 mr-3`;
            elements.notificationTitle.textContent = title;
            elements.notificationMessage.textContent = message;
            
            elements.notification.classList.remove('hidden');
            // 触发重排后添加动画
            setTimeout(() => {
                elements.notification.classList.remove('translate-y-20', 'opacity-0');
            }, 10);
            
            // 5秒后自动关闭
            setTimeout(hideNotification, 5000);
        }

        // 隐藏通知
        function hideNotification() {
            if (!elements.notification) return;
            
            elements.notification.classList.add('translate-y-20', 'opacity-0');
            setTimeout(() => {
                elements.notification.classList.add('hidden');
            }, 300);
        }

        // 显示加载动画
        function showLoader() {
            if (elements.loader) elements.loader.classList.remove('hidden');
        }

        // 隐藏加载动画
        function hideLoader() {
            if (elements.loader) elements.loader.classList.add('hidden');
        }

        // 设置主题
        function setTheme(theme) {
            const body = document.getElementById('app-body');
            if (!body) return;
            
            if (theme === 'dark') {
                body.classList.add('bg-space-black');
                body.classList.remove('bg-gray-100', 'text-space-dark');
                if (elements.themeToggle) elements.themeToggle.innerHTML = '<i class="fa fa-sun-o text-gray-300"></i>';
            } else {
                body.classList.remove('bg-space-black');
                body.classList.add('bg-gray-100', 'text-space-dark');
                if (elements.themeToggle) elements.themeToggle.innerHTML = '<i class="fa fa-moon-o text-gray-700"></i>';
            }
            
            appData.theme = theme;
            saveLocalSettings();
        }

        // 切换主题
        function toggleTheme() {
            setTheme(appData.theme === 'dark' ? 'light' : 'dark');
        }

        // 绑定所有事件 - 重点解决按钮无响应问题
        function bindAllEvents() {
            // 控制栏自动隐藏逻辑
            let scrollTimer;
            window.addEventListener('scroll', () => {
                // 显示控制栏
                if (elements.controlBar) {
                    elements.controlBar.classList.remove('translate-y-[-100%]');
                }
                
                // 清除之前的计时器
                clearTimeout(scrollTimer);
                
                // 设置新计时器，3秒后隐藏
                scrollTimer = setTimeout(() => {
                    if (elements.controlBar) {
                        elements.controlBar.classList.add('translate-y-[-100%]');
                    }
                }, 3000);
            }, { passive: true });
            
            // 主题切换 - 确保按钮有响应
            if (elements.themeToggle) {
                elements.themeToggle.addEventListener('click', toggleTheme);
            }
            if (elements.themeDark) {
                elements.themeDark.addEventListener('click', () => setTheme('dark'));
            }
            if (elements.themeLight) {
                elements.themeLight.addEventListener('click', () => setTheme('light'));
            }
            
            // 设置对话框 - 确保按钮有响应
            if (elements.settingsBtn) {
                elements.settingsBtn.addEventListener('click', () => {
                    if (elements.settingsModal) {
                        elements.settingsModal.classList.remove('hidden');
                    }
                });
            }
            
            if (elements.closeSettings) {
                elements.closeSettings.addEventListener('click', () => {
                    if (elements.settingsModal) {
                        elements.settingsModal.classList.add('hidden');
                    }
                });
            }
            
            // 点击对话框外部关闭
            if (elements.settingsModal) {
                elements.settingsModal.addEventListener('click', (e) => {
                    if (e.target === elements.settingsModal) {
                        elements.settingsModal.classList.add('hidden');
                    }
                });
            }
            
            // 主页和编辑中心切换 - 确保按钮有响应
            if (elements.enterEditCenter) {
                elements.enterEditCenter.addEventListener('click', () => {
                    if (elements.homePage && elements.editCenter && elements.settingsModal) {
                        elements.homePage.classList.add('hidden');
                        elements.editCenter.classList.remove('hidden');
                        elements.settingsModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.backToHome) {
                elements.backToHome.addEventListener('click', () => {
                    if (elements.editCenter && elements.homePage) {
                        elements.editCenter.classList.add('hidden');
                        elements.homePage.classList.remove('hidden');
                    }
                });
            }
            
            // 搜索功能 - 确保输入框有响应
            if (elements.searchInput) {
                elements.searchInput.addEventListener('input', (e) => {
                    appData.searchQuery = e.target.value;
                    renderBookmarks();
                });
            }
            
            // GitHub设置 - 确保按钮有响应
            if (elements.validateGithub) {
                elements.validateGithub.addEventListener('click', async () => {
                    const token = elements.githubToken ? elements.githubToken.value.trim() : '';
                    if (!token) {
                        showNotification('warning', '输入错误', '请输入GitHub Token');
                        return;
                    }
                    
                    const result = await validateGitHubToken(token);
                    if (elements.githubValidationResult) {
                        elements.githubValidationResult.textContent = result.message;
                        
                        if (result.valid) {
                            elements.githubValidationResult.className = 'p-3 rounded-lg text-sm text-green-400 bg-green-500/10';
                            appData.github.token = token;
                            appData.github.validated = true;
                            saveLocalSettings();
                            updateEditFeaturesStatus();
                        } else {
                            elements.githubValidationResult.className = 'p-3 rounded-lg text-sm text-red-400 bg-red-500/10';
                            appData.github.validated = false;
                            updateEditFeaturesStatus();
                        }
                        
                        elements.githubValidationResult.classList.remove('hidden');
                    }
                });
            }
            
            if (elements.saveGithubSettings) {
                elements.saveGithubSettings.addEventListener('click', () => {
                    const username = elements.githubUsername ? elements.githubUsername.value.trim() : '';
                    const repo = elements.githubRepo ? elements.githubRepo.value.trim() : '';
                    const token = elements.githubToken ? elements.githubToken.value.trim() : '';
                    
                    if (!username || !repo) {
                        showNotification('warning', '输入错误', '请填写GitHub用户名和仓库名');
                        return;
                    }
                    
                    appData.github.username = username;
                    appData.github.repo = repo;
                    
                    // 如果token有变化，需要重新验证
                    if (token && token !== appData.github.token) {
                        appData.github.token = token;
                        appData.github.validated = false;
                        if (elements.githubValidationResult) {
                            elements.githubValidationResult.classList.add('hidden');
                        }
                        updateEditFeaturesStatus();
                        showNotification('info', '设置已保存', '请验证GitHub Token以启用编辑功能');
                    } else {
                        showNotification('success', '设置已保存', 'GitHub设置已更新');
                    }
                    
                    saveLocalSettings();
                });
            }
            
            // 书签管理 - 确保按钮有响应
            if (elements.addBookmarkBtn) {
                elements.addBookmarkBtn.addEventListener('click', openAddBookmarkModal);
            }
            
            if (elements.closeBookmarkModal) {
                elements.closeBookmarkModal.addEventListener('click', () => {
                    if (elements.bookmarkModal) {
                        elements.bookmarkModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.bookmarkModal) {
                elements.bookmarkModal.addEventListener('click', (e) => {
                    if (e.target === elements.bookmarkModal) {
                        elements.bookmarkModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.saveBookmark) {
                elements.saveBookmark.addEventListener('click', () => {
                    const id = elements.bookmarkId ? elements.bookmarkId.value : '';
                    const name = elements.bookmarkName ? elements.bookmarkName.value.trim() : '';
                    const url = elements.bookmarkUrl ? elements.bookmarkUrl.value.trim() : '';
                    const folder = elements.bookmarkFolder ? elements.bookmarkFolder.value.trim() : '';
                    
                    if (!name || !url) {
                        showNotification('warning', '输入错误', '网站名称和URL为必填项');
                        return;
                    }
                    
                    // 确保URL以http开头
                    let formattedUrl = url;
                    if (!formattedUrl.startsWith('http://') && !formattedUrl.startsWith('https://')) {
                        formattedUrl = `https://${formattedUrl}`;
                    }
                    
                    if (id) {
                        // 编辑现有书签
                        if (editBookmark(id, name, formattedUrl, folder)) {
                            showNotification('success', '书签已更新', '书签信息已更新');
                            if (elements.bookmarkModal) {
                                elements.bookmarkModal.classList.add('hidden');
                            }
                        } else {
                            showNotification('error', '更新失败', '未找到该书签');
                        }
                    } else {
                        // 添加新书签
                        addBookmark(name, formattedUrl, folder);
                        showNotification('success', '书签已添加', '新书签已添加到列表');
                        if (elements.bookmarkModal) {
                            elements.bookmarkModal.classList.add('hidden');
                        }
                    }
                });
            }
            
            // 导入导出书签 - 确保按钮有响应
            if (elements.importBookmark) {
                elements.importBookmark.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // 检查文件大小和类型
                    if (file.size > 10 * 1024 * 1024) {
                        showNotification('error', '文件过大', '请选择小于10MB的文件');
                        return;
                    }
                    
                    if (!file.name.endsWith('.html')) {
                        showNotification('error', '文件类型错误', '请选择HTML格式的书签文件');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const result = importBookmarks(event.target.result);
                        if (result.success) {
                            showNotification('success', '导入完成', `成功导入${result.imported}个书签，${result.existing}个已存在`);
                        } else {
                            showNotification('error', '导入失败', result.message);
                        }
                        // 重置文件输入，允许重复选择同一文件
                        elements.importBookmark.value = '';
                    };
                    reader.readAsText(file);
                });
            }
            
            // 为导入书签的label添加点击事件，解决文件选择无响应问题
            if (elements.importBookmarkLabel) {
                elements.importBookmarkLabel.addEventListener('click', (e) => {
                    if (!elements.importBookmark.disabled) {
                        e.preventDefault();
                        if (elements.importBookmark) {
                            elements.importBookmark.click();
                        }
                    }
                });
            }
            
            if (elements.exportBookmark) {
                elements.exportBookmark.addEventListener('click', () => {
                    if (appData.bookmarks.length === 0) {
                        showNotification('warning', '无书签可导出', '请先添加书签');
                        return;
                    }
                    
                    if (exportBookmarks()) {
                        showNotification('success', '导出成功', '书签已导出为HTML文件');
                    }
                });
            }
            
            // 保存书签更改到GitHub - 确保按钮有响应
            if (elements.saveBookmarks) {
                elements.saveBookmarks.addEventListener('click', async () => {
                    const success = await saveDataToGitHub();
                    if (success) {
                        renderBookmarks();
                        renderEditBookmarks();
                    }
                });
            }
            
            // 城市管理 - 确保按钮有响应
            if (elements.addCityBtn) {
                elements.addCityBtn.addEventListener('click', openAddCityModal);
            }
            
            if (elements.closeCityModal) {
                elements.closeCityModal.addEventListener('click', () => {
                    if (elements.cityModal) {
                        elements.cityModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.cityModal) {
                elements.cityModal.addEventListener('click', (e) => {
                    if (e.target === elements.cityModal) {
                        elements.cityModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.saveCity) {
                elements.saveCity.addEventListener('click', () => {
                    const name = elements.cityName ? elements.cityName.value.trim() : '';
                    const timezone = elements.cityTimezone ? elements.cityTimezone.value : '';
                    
                    if (!name) {
                        showNotification('warning', '输入错误', '城市名称为必填项');
                        return;
                    }
                    
                    if (addCity(name, timezone)) {
                        if (elements.cityModal) {
                            elements.cityModal.classList.add('hidden');
                        }
                    }
                });
            }
            
            // 广告管理 - 确保按钮有响应
            if (elements.editAdBtns) {
                elements.editAdBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const adId = parseInt(btn.closest('.space-y-2').querySelector('h4').textContent.replace('广告位 ', ''));
                        openEditAdModal(adId);
                    });
                });
            }
            
            if (elements.closeAdModal) {
                elements.closeAdModal.addEventListener('click', () => {
                    if (elements.adModal) {
                        elements.adModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.adModal) {
                elements.adModal.addEventListener('click', (e) => {
                    if (e.target === elements.adModal) {
                        elements.adModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.adImage) {
                elements.adImage.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // 检查文件大小
                    if (file.size > 3 * 1024 * 1024) {
                        showNotification('error', '文件过大', '图片大小不能超过3MB');
                        return;
                    }
                    
                    // 检查文件类型
                    if (!file.type.startsWith('image/')) {
                        showNotification('error', '文件类型错误', '请选择图片文件');
                        return;
                    }
                    
                    // 预览图片
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        if (elements.adImagePreview) {
                            elements.adImagePreview.src = event.target.result;
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            if (elements.saveAd) {
                elements.saveAd.addEventListener('click', async () => {
                    const id = elements.adId ? parseInt(elements.adId.value) : 0;
                    const url = elements.adUrl ? elements.adUrl.value.trim() : '';
                    const imageUrl = elements.adImagePreview ? elements.adImagePreview.src : '';
                    
                    // 只更新有变化的内容
                    const currentAd = appData.ads.find(ad => ad.id === id);
                    if (!currentAd) {
                        showNotification('error', '保存失败', '未找到该广告');
                        return;
                    }
                    
                    let hasChanges = false;
                    if (url && url !== currentAd.url) {
                        hasChanges = true;
                    }
                    
                    // 检查图片是否有变化（不是默认图片且不是空）
                    if (imageUrl && imageUrl !== currentAd.image && !imageUrl.startsWith('data:')) {
                        hasChanges = true;
                    }
                    
                    if (hasChanges) {
                        updateAd(id, imageUrl, url);
                        // 保存到GitHub
                        await saveDataToGitHub();
                        if (elements.adModal) {
                            elements.adModal.classList.add('hidden');
                        }
                    } else {
                        showNotification('info', '未做更改', '没有检测到任何更改');
                    }
                });
            }
            
            // 确认对话框 - 确保按钮有响应
            if (elements.confirmCancel) {
                elements.confirmCancel.addEventListener('click', () => {
                    if (elements.confirmModal) {
                        elements.confirmModal.classList.add('hidden');
                    }
                });
            }
            
            if (elements.confirmModal) {
                elements.confirmModal.addEventListener('click', (e) => {
                    if (e.target === elements.confirmModal) {
                        elements.confirmModal.classList.add('hidden');
                    }
                });
            }
            
            // 通知关闭 - 确保按钮有响应
            if (elements.closeNotification) {
                elements.closeNotification.addEventListener('click', hideNotification);
            }
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    