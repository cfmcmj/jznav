<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际书签 | Cosmic Bookmarks</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%234F46E5'/%3E%3Ccircle cx='35' cy='40' r='10' fill='%23F59E0B'/%3E%3Ccircle cx='65' cy='60' r='8' fill='%23EC4899'/%3E%3Ccircle cx='40' cy='70' r='6' fill='%2310B981'/%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind配置
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        cosmic: {
                            blue: '#1E40AF',
                            purple: '#7C3AED',
                            pink: '#EC4899',
                            yellow: '#F59E0B',
                            green: '#10B981',
                            dark: '#0F172A',
                            light: '#F8FAFC'
                        }
                    },
                    fontFamily: {
                        space: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-slow': 'float 8s ease-in-out infinite',
                        'float-fast': 'float 4s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' }
                        },
                        twinkle: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.5 }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
            .glass-dark {
                background: rgba(15, 23, 42, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle 3s infinite;
            }
            .planet {
                position: absolute;
                border-radius: 50%;
                filter: blur(0.5px);
            }
            .text-shadow {
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            }
            .bookmark-hover {
                transition: all 0.3s ease;
            }
            .bookmark-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body class="font-space bg-gradient-to-br from-cosmic-dark to-cosmic-blue text-white min-h-screen transition-colors duration-300">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0"></div>
    
    <!-- 漂浮星球 -->
    <div class="planet bg-cosmic-purple/30 w-64 h-64 top-20 left-[10%] animate-float-slow hidden md:block"></div>
    <div class="planet bg-cosmic-yellow/20 w-40 h-40 top-1/3 right-[15%] animate-float"></div>
    <div class="planet bg-cosmic-pink/20 w-24 h-24 bottom-20 left-[20%] animate-float-fast"></div>
    
    <!-- 顶部控制栏 -->
    <header id="control-bar" class="fixed top-0 left-0 right-0 z-50 glass-dark px-4 py-3 flex justify-end items-center transition-all duration-300">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/10 transition-colors mr-3">
            <i class="fa fa-moon-o text-xl"></i>
        </button>
        <button id="settings-btn" class="p-2 rounded-full hover:bg-white/10 transition-colors">
            <i class="fa fa-cog text-xl"></i>
        </button>
    </header>
    
    <!-- 设置对话框 -->
    <div id="settings-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="modal-backdrop"></div>
        <div class="glass-dark rounded-2xl p-6 w-full max-w-md relative z-10 transform transition-all">
            <h2 class="text-2xl font-bold mb-4 text-center">设置</h2>
            
            <div class="mb-4">
                <label class="block text-sm mb-2">GitHub 用户名</label>
                <input type="text" id="github-username" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm mb-2">仓库名称</label>
                <input type="text" id="github-repo" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm mb-2">GitHub 访问令牌 <span class="text-xs text-gray-400">(需要 repo 权限)</span></label>
                <input type="password" id="github-token" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="flex space-x-3 mb-4">
                <button id="validate-token" class="flex-1 bg-cosmic-purple hover:bg-cosmic-purple/80 text-white py-2 rounded-lg transition-colors">
                    验证令牌
                </button>
                <button id="save-settings" class="flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg transition-colors">
                    保存设置
                </button>
            </div>
            
            <div id="validation-status" class="mb-4 h-6 text-sm text-center hidden"></div>
            
            <button id="enter-edit-btn" class="w-full bg-cosmic-green hover:bg-cosmic-green/80 text-white py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                进入编辑中心
            </button>
            
            <button id="close-settings" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16 relative z-10">
        <!-- 主页 -->
        <section id="home-page">
            <!-- 顶部三组件 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <!-- 在线时长统计 -->
                <div class="glass-dark rounded-xl p-5 bookmark-hover">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-clock-o mr-2 text-cosmic-yellow"></i>
                        在线时长
                    </h3>
                    <div id="uptime-display" class="text-2xl font-mono">00:00:00</div>
                    <div class="text-sm text-gray-400 mt-1">自部署以来</div>
                </div>
                
                <!-- 健康提醒 -->
                <div class="glass-dark rounded-xl p-5 bookmark-hover">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-heartbeat mr-2 text-cosmic-pink"></i>
                        健康提醒
                    </h3>
                    <div id="health-advice" class="mb-1">该休息一下了</div>
                    <div class="text-sm text-gray-400">下次提醒: <span id="next-reminder">15:30</span></div>
                </div>
                
                <!-- 世界时钟 -->
                <div class="glass-dark rounded-xl p-5 bookmark-hover">
                    <h3 class="text-lg font-semibold mb-2 flex items-center">
                        <i class="fa fa-globe mr-2 text-cosmic-green"></i>
                        世界时钟
                    </h3>
                    <div id="world-clocks" class="space-y-1">
                        <div class="flex justify-between">
                            <span>北京</span>
                            <span id="beijing-time" class="font-mono"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>纽约</span>
                            <span id="newyork-time" class="font-mono"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>伦敦</span>
                            <span id="london-time" class="font-mono"></span>
                        </div>
                        <div class="flex justify-between">
                            <span>东京</span>
                            <span id="tokyo-time" class="font-mono"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 搜索框 -->
            <div class="max-w-2xl mx-auto mb-8">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索书签..." 
                        class="w-full glass-dark border border-white/20 rounded-full px-5 py-4 pl-12 focus:outline-none focus:ring-2 focus:ring-cosmic-purple transition-all">
                    <i class="fa fa-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <!-- 广告位 1 -->
            <div class="glass-dark rounded-xl p-4 mb-8 overflow-hidden relative group">
                <div class="absolute top-2 right-2 bg-black/30 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">广告</div>
                <div class="aspect-video bg-gradient-to-r from-cosmic-purple/20 to-cosmic-blue/20 rounded-lg flex items-center justify-center">
                    <span class="text-gray-400">广告位 1</span>
                </div>
            </div>
            
            <!-- 书签展示区 -->
            <div class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-bookmark mr-2 text-cosmic-yellow"></i>
                    书签
                    <span id="bookmark-count" class="ml-2 text-sm bg-white/10 px-2 py-0.5 rounded-full">0</span>
                </h2>
                
                <!-- 书签文件夹 -->
                <div id="bookmark-folders" class="space-y-6">
                    <!-- 默认文件夹 -->
                    <div class="bookmark-folder">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold flex items-center">
                                <i class="fa fa-folder mr-2 text-cosmic-green"></i>
                                常用网站
                            </h3>
                            <button class="toggle-folder text-gray-400 hover:text-white">
                                <i class="fa fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <!-- 书签网格 -->
                        <div class="folder-content grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3">
                            <!-- 书签将通过JS动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 广告位 2 -->
            <div class="glass-dark rounded-xl p-4 mb-8 overflow-hidden relative group">
                <div class="absolute top-2 right-2 bg-black/30 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">广告</div>
                <div class="aspect-video bg-gradient-to-r from-cosmic-pink/20 to-cosmic-purple/20 rounded-lg flex items-center justify-center">
                    <span class="text-gray-400">广告位 2</span>
                </div>
            </div>
            
            <!-- 广告位 3 -->
            <div class="glass-dark rounded-xl p-4 mb-8 overflow-hidden relative group">
                <div class="absolute top-2 right-2 bg-black/30 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">广告</div>
                <div class="aspect-video bg-gradient-to-r from-cosmic-yellow/20 to-cosmic-pink/20 rounded-lg flex items-center justify-center">
                    <span class="text-gray-400">广告位 3</span>
                </div>
            </div>
        </section>
        
        <!-- 编辑中心 (默认隐藏) -->
        <section id="edit-center" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold">编辑中心</h1>
                <button id="back-to-home" class="glass-dark px-4 py-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i class="fa fa-arrow-left mr-1"></i> 返回主页
                </button>
            </div>
            
            <!-- 编辑功能选项卡 -->
            <div class="glass-dark rounded-xl p-1 mb-6 flex flex-wrap">
                <button class="edit-tab active flex-1 sm:flex-none px-4 py-2 rounded-lg" data-tab="bookmarks">
                    <i class="fa fa-bookmark mr-1"></i> 书签管理
                </button>
                <button class="edit-tab flex-1 sm:flex-none px-4 py-2 rounded-lg" data-tab="clocks">
                    <i class="fa fa-clock-o mr-1"></i> 时钟设置
                </button>
                <button class="edit-tab flex-1 sm:flex-none px-4 py-2 rounded-lg" data-tab="ads">
                    <i class="fa fa-bullhorn mr-1"></i> 广告管理
                </button>
            </div>
            
            <!-- 书签管理 tab -->
            <div class="edit-content active" id="bookmarks-tab">
                <div class="glass-dark rounded-xl p-5 mb-6">
                    <h2 class="text-xl font-bold mb-4">书签管理</h2>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="add-bookmark" class="flex items-center bg-cosmic-purple hover:bg-cosmic-purple/80 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-plus mr-2"></i> 添加书签
                        </button>
                        <label for="import-bookmarks" class="flex items-center bg-cosmic-green hover:bg-cosmic-green/80 text-white px-4 py-2 rounded-lg transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-upload mr-2"></i> 导入书签
                        </label>
                        <input type="file" id="import-bookmarks" accept=".html" class="hidden" disabled>
                        <button id="export-bookmarks" class="flex items-center bg-cosmic-blue hover:bg-cosmic-blue/80 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-download mr-2"></i> 导出书签
                        </button>
                    </div>
                    
                    <!-- 书签列表 -->
                    <div id="bookmark-list" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                        <!-- 书签项目将通过JS动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 时钟设置 tab -->
            <div class="edit-content hidden" id="clocks-tab">
                <div class="glass-dark rounded-xl p-5">
                    <h2 class="text-xl font-bold mb-4">世界时钟设置</h2>
                    
                    <button id="add-clock" class="flex items-center bg-cosmic-purple hover:bg-cosmic-purple/80 text-white px-4 py-2 rounded-lg transition-colors mb-6 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fa fa-plus mr-2"></i> 添加城市
                    </button>
                    
                    <div id="clocks-list" class="space-y-3">
                        <!-- 时钟项目将通过JS动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 广告管理 tab -->
            <div class="edit-content hidden" id="ads-tab">
                <div class="glass-dark rounded-xl p-5">
                    <h2 class="text-xl font-bold mb-4">广告管理</h2>
                    
                    <div class="space-y-6">
                        <!-- 广告位 1 设置 -->
                        <div class="border border-white/10 rounded-lg p-4">
                            <h3 class="font-semibold mb-3">广告位 1</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm mb-1">广告图片</label>
                                    <input type="file" id="ad1-image" accept="image/*" class="w-full text-sm text-gray-300 disabled:opacity-50" disabled>
                                </div>
                                <div>
                                    <label class="block text-sm mb-1">链接地址</label>
                                    <input type="url" id="ad1-url" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple disabled:opacity-50" disabled>
                                </div>
                                <button id="remove-ad1" class="text-red-400 hover:text-red-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fa fa-trash mr-1"></i> 移除广告
                                </button>
                            </div>
                        </div>
                        
                        <!-- 广告位 2 设置 -->
                        <div class="border border-white/10 rounded-lg p-4">
                            <h3 class="font-semibold mb-3">广告位 2</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm mb-1">广告图片</label>
                                    <input type="file" id="ad2-image" accept="image/*" class="w-full text-sm text-gray-300 disabled:opacity-50" disabled>
                                </div>
                                <div>
                                    <label class="block text-sm mb-1">链接地址</label>
                                    <input type="url" id="ad2-url" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple disabled:opacity-50" disabled>
                                </div>
                                <button id="remove-ad2" class="text-red-400 hover:text-red-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fa fa-trash mr-1"></i> 移除广告
                                </button>
                            </div>
                        </div>
                        
                        <!-- 广告位 3 设置 -->
                        <div class="border border-white/10 rounded-lg p-4">
                            <h3 class="font-semibold mb-3">广告位 3</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm mb-1">广告图片</label>
                                    <input type="file" id="ad3-image" accept="image/*" class="w-full text-sm text-gray-300 disabled:opacity-50" disabled>
                                </div>
                                <div>
                                    <label class="block text-sm mb-1">链接地址</label>
                                    <input type="url" id="ad3-url" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple disabled:opacity-50" disabled>
                                </div>
                                <button id="remove-ad3" class="text-red-400 hover:text-red-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fa fa-trash mr-1"></i> 移除广告
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 保存更改按钮 -->
            <div class="fixed bottom-6 right-6 z-20">
                <button id="save-changes" class="flex items-center bg-cosmic-green hover:bg-cosmic-green/80 text-white px-6 py-3 rounded-full shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fa fa-save mr-2"></i> 保存更改
                    <span id="save-loading" class="ml-2 hidden">
                        <i class="fa fa-spinner fa-spin"></i>
                    </span>
                </button>
            </div>
        </section>
    </main>
    
    <!-- 添加/编辑书签对话框 -->
    <div id="bookmark-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="bookmark-modal-backdrop"></div>
        <div class="glass-dark rounded-2xl p-6 w-full max-w-md relative z-10">
            <h2 class="text-2xl font-bold mb-4" id="bookmark-modal-title">添加书签</h2>
            
            <input type="hidden" id="bookmark-id">
            
            <div class="mb-4">
                <label class="block text-sm mb-2">文件夹</label>
                <select id="bookmark-folder" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
                    <option value="常用网站">常用网站</option>
                </select>
                <div class="flex mt-2">
                    <input type="text" id="new-folder-name" placeholder="新文件夹名称" class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple mr-2">
                    <button id="add-folder" class="bg-cosmic-purple/80 hover:bg-cosmic-purple text-white px-3 py-2 rounded-lg transition-colors">
                        添加
                    </button>
                </div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm mb-2">网站名称</label>
                <input type="text" id="bookmark-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm mb-2">网址</label>
                <input type="url" id="bookmark-url" placeholder="https://" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="flex space-x-3">
                <button id="cancel-bookmark" class="flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg transition-colors">
                    取消
                </button>
                <button id="save-bookmark" class="flex-1 bg-cosmic-green hover:bg-cosmic-green/80 text-white py-2 rounded-lg transition-colors">
                    保存
                </button>
            </div>
            
            <button id="close-bookmark-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- 添加城市对话框 -->
    <div id="city-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="city-modal-backdrop"></div>
        <div class="glass-dark rounded-2xl p-6 w-full max-w-md relative z-10">
            <h2 class="text-xl font-bold mb-4">添加城市</h2>
            
            <div class="mb-6">
                <label class="block text-sm mb-2">城市名称</label>
                <input type="text" id="city-name" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm mb-2">时区 (例如: Asia/Shanghai)</label>
                <input type="text" id="city-timezone" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cosmic-purple">
            </div>
            
            <div class="flex space-x-3">
                <button id="cancel-city" class="flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg transition-colors">
                    取消
                </button>
                <button id="save-city" class="flex-1 bg-cosmic-green hover:bg-cosmic-green/80 text-white py-2 rounded-lg transition-colors">
                    保存
                </button>
            </div>
            
            <button id="close-city-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- 确认删除对话框 -->
    <div id="confirm-delete-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="confirm-delete-backdrop"></div>
        <div class="glass-dark rounded-2xl p-6 w-full max-w-md relative z-10">
            <h2 class="text-xl font-bold mb-2">确认删除</h2>
            <p class="text-gray-300 mb-6" id="delete-message">你确定要删除这个项目吗？此操作无法撤销。</p>
            
            <input type="hidden" id="delete-id">
            <input type="hidden" id="delete-type">
            
            <div class="flex space-x-3">
                <button id="cancel-delete" class="flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg transition-colors">
                    取消
                </button>
                <button id="confirm-delete" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg transition-colors">
                    删除
                </button>
            </div>
        </div>
    </div>
    
    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 glass-dark px-6 py-3 rounded-full shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 max-w-sm text-center">
        <span id="notification-message"></span>
    </div>
    
    <!-- 底部信息 -->
    <footer class="container mx-auto px-4 pb-8 relative z-10">
        <div class="dark-white text-center text-gray-400 text-sm">
            <div>共收录<span id="footer-total">0</span>个网站</div>
            <div>Copyright © 2018-<span id="current-year"></span> <span id="footer-hostname">cosmic.bookmarks</span>, All Rights Reserved</div>
        </div>
    </footer>
    
    <script>
        // 应用数据
        const appData = {
            github: {
                username: '',
                repo: '',
                token: '',
                validated: false
            },
            bookmarks: {
                folders: [{ name: '常用网站', items: [] }],
                total: 0
            },
            clocks: [
                { name: '北京', timezone: 'Asia/Shanghai' },
                { name: '纽约', timezone: 'America/New_York' },
                { name: '伦敦', timezone: 'Europe/London' },
                { name: '东京', timezone: 'Asia/Tokyo' }
            ],
            ads: [
                { image: '', url: '' },
                { image: '', url: '' },
                { image: '', url: '' }
            ],
            deploymentDate: new Date(), // 实际部署时会替换为真实日期
            settings: {
                theme: 'dark'
            }
        };
        
        // DOM 元素
        const elements = {
            controlBar: document.getElementById('control-bar'),
            themeToggle: document.getElementById('theme-toggle'),
            settingsBtn: document.getElementById('settings-btn'),
            settingsModal: document.getElementById('settings-modal'),
            modalBackdrop: document.getElementById('modal-backdrop'),
            closeSettings: document.getElementById('close-settings'),
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            validateToken: document.getElementById('validate-token'),
            saveSettings: document.getElementById('save-settings'),
            validationStatus: document.getElementById('validation-status'),
            enterEditBtn: document.getElementById('enter-edit-btn'),
            homePage: document.getElementById('home-page'),
            editCenter: document.getElementById('edit-center'),
            backToHome: document.getElementById('back-to-home'),
            editTabs: document.querySelectorAll('.edit-tab'),
            editContents: document.querySelectorAll('.edit-content'),
            addBookmark: document.getElementById('add-bookmark'),
            importBookmarks: document.getElementById('import-bookmarks'),
            exportBookmarks: document.getElementById('export-bookmarks'),
            bookmarkList: document.getElementById('bookmark-list'),
            bookmarkModal: document.getElementById('bookmark-modal'),
            bookmarkModalBackdrop: document.getElementById('bookmark-modal-backdrop'),
            closeBookmarkModal: document.getElementById('close-bookmark-modal'),
            cancelBookmark: document.getElementById('cancel-bookmark'),
            bookmarkModalTitle: document.getElementById('bookmark-modal-title'),
            bookmarkId: document.getElementById('bookmark-id'),
            bookmarkFolder: document.getElementById('bookmark-folder'),
            newFolderName: document.getElementById('new-folder-name'),
            addFolder: document.getElementById('add-folder'),
            bookmarkName: document.getElementById('bookmark-name'),
            bookmarkUrl: document.getElementById('bookmark-url'),
            saveBookmark: document.getElementById('save-bookmark'),
            addClock: document.getElementById('add-clock'),
            clocksList: document.getElementById('clocks-list'),
            cityModal: document.getElementById('city-modal'),
            cityModalBackdrop: document.getElementById('city-modal-backdrop'),
            closeCityModal: document.getElementById('close-city-modal'),
            cancelCity: document.getElementById('cancel-city'),
            cityName: document.getElementById('city-name'),
            cityTimezone: document.getElementById('city-timezone'),
            saveCity: document.getElementById('save-city'),
            ad1Image: document.getElementById('ad1-image'),
            ad1Url: document.getElementById('ad1-url'),
            removeAd1: document.getElementById('remove-ad1'),
            ad2Image: document.getElementById('ad2-image'),
            ad2Url: document.getElementById('ad2-url'),
            removeAd2: document.getElementById('remove-ad2'),
            ad3Image: document.getElementById('ad3-image'),
            ad3Url: document.getElementById('ad3-url'),
            removeAd3: document.getElementById('remove-ad3'),
            saveChanges: document.getElementById('save-changes'),
            saveLoading: document.getElementById('save-loading'),
            confirmDeleteModal: document.getElementById('confirm-delete-modal'),
            confirmDeleteBackdrop: document.getElementById('confirm-delete-backdrop'),
            cancelDelete: document.getElementById('cancel-delete'),
            confirmDelete: document.getElementById('confirm-delete'),
            deleteId: document.getElementById('delete-id'),
            deleteType: document.getElementById('delete-type'),
            deleteMessage: document.getElementById('delete-message'),
            notification: document.getElementById('notification'),
            notificationMessage: document.getElementById('notification-message'),
            uptimeDisplay: document.getElementById('uptime-display'),
            healthAdvice: document.getElementById('health-advice'),
            nextReminder: document.getElementById('next-reminder'),
            searchInput: document.getElementById('search-input'),
            bookmarkCount: document.getElementById('bookmark-count'),
            footerTotal: document.getElementById('footer-total'),
            currentYear: document.getElementById('current-year'),
            footerHostname: document.getElementById('footer-hostname'),
            bookmarkFolders: document.getElementById('bookmark-folders')
        };
        
        // 初始化函数
        async function init() {
            // 设置当前年份
            elements.currentYear.textContent = new Date().getFullYear();
            
            // 生成星空背景
            createStars();
            
            // 加载设置
            loadSettings();
            
            // 从GitHub加载数据
            await loadDataFromGitHub();
            
            // 渲染数据
            renderBookmarks();
            renderClocks();
            renderAds();
            updateBookmarkCount();
            
            // 更新世界时钟
            updateWorldClocks();
            setInterval(updateWorldClocks, 1000);
            
            // 更新在线时长
            updateUptime();
            setInterval(updateUptime, 1000);
            
            // 设置健康提醒
            updateHealthReminder();
            
            // 设置控制栏自动隐藏
            setupControlBarAutoHide();
            
            // 绑定事件监听器
            bindEventListeners();
        }
        
        // 创建星空背景
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starsCount = window.innerWidth < 768 ? 100 : 200;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // 随机大小
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // 随机位置
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // 随机闪烁动画延迟
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                // 随机不透明度
                star.style.opacity = Math.random() * 0.8 + 0.2;
                
                starsContainer.appendChild(star);
            }
        }
        
        // 加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('cosmicBookmarksSettings');
            if (savedSettings) {
                const parsed = JSON.parse(savedSettings);
                appData.github = parsed.github || appData.github;
                appData.settings = parsed.settings || appData.settings;
                
                // 更新表单
                elements.githubUsername.value = appData.github.username;
                elements.githubRepo.value = appData.github.repo;
                elements.githubToken.value = appData.github.token;
                
                // 应用主题
                applyTheme(appData.settings.theme);
            }
            
            // 更新编辑功能状态
            updateEditFeaturesStatus();
        }
        
        // 保存设置
        function saveSettings() {
            appData.github.username = elements.githubUsername.value;
            appData.github.repo = elements.githubRepo.value;
            appData.github.token = elements.githubToken.value;
            
            localStorage.setItem('cosmicBookmarksSettings', JSON.stringify({
                github: appData.github,
                settings: appData.settings
            }));
            
            showNotification('设置已保存');
        }
        
        // 应用主题
        function applyTheme(theme) {
            if (theme === 'light') {
                document.documentElement.classList.add('light');
                document.body.classList.remove('from-cosmic-dark', 'to-cosmic-blue');
                document.body.classList.add('from-cosmic-light', 'to-blue-100');
                document.body.classList.add('text-cosmic-dark');
                elements.themeToggle.innerHTML = '<i class="fa fa-sun-o text-xl"></i>';
            } else {
                document.documentElement.classList.remove('light');
                document.body.classList.remove('from-cosmic-light', 'to-blue-100', 'text-cosmic-dark');
                document.body.classList.add('from-cosmic-dark', 'to-cosmic-blue', 'text-white');
                elements.themeToggle.innerHTML = '<i class="fa fa-moon-o text-xl"></i>';
            }
            appData.settings.theme = theme;
        }
        
        // 切换主题
        function toggleTheme() {
            const newTheme = appData.settings.theme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            saveSettings();
        }
        
        // 验证GitHub令牌
        async function validateGitHubToken() {
            const token = elements.githubToken.value;
            if (!token) {
                showValidationStatus('请输入GitHub令牌', 'error');
                return;
            }
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    appData.github.validated = true;
                    showValidationStatus('令牌验证成功', 'success');
                    updateEditFeaturesStatus();
                    saveSettings();
                } else {
                    appData.github.validated = false;
                    showValidationStatus('令牌验证失败，请检查令牌是否有效', 'error');
                    updateEditFeaturesStatus();
                }
            } catch (error) {
                appData.github.validated = false;
                showValidationStatus('验证时发生错误，请稍后重试', 'error');
                updateEditFeaturesStatus();
                console.error('GitHub token validation error:', error);
            }
        }
        
        // 显示验证状态
        function showValidationStatus(message, type) {
            elements.validationStatus.textContent = message;
            elements.validationStatus.classList.remove('hidden', 'text-green-400', 'text-red-400');
            
            if (type === 'success') {
                elements.validationStatus.classList.add('text-green-400');
            } else {
                elements.validationStatus.classList.add('text-red-400');
            }
            
            // 5秒后隐藏
            setTimeout(() => {
                elements.validationStatus.classList.add('hidden');
            }, 5000);
        }
        
        // 更新编辑功能状态
        function updateEditFeaturesStatus() {
            const isEnabled = appData.github.validated;
            
            // 编辑中心访问权限
            elements.enterEditBtn.disabled = !isEnabled;
            
            // 书签管理功能
            elements.addBookmark.disabled = !isEnabled;
            elements.importBookmarks.disabled = !isEnabled;
            elements.exportBookmarks.disabled = !isEnabled;
            
            // 时钟设置功能
            elements.addClock.disabled = !isEnabled;
            
            // 广告管理功能
            elements.ad1Image.disabled = !isEnabled;
            elements.ad1Url.disabled = !isEnabled;
            elements.removeAd1.disabled = !isEnabled;
            
            elements.ad2Image.disabled = !isEnabled;
            elements.ad2Url.disabled = !isEnabled;
            elements.removeAd2.disabled = !isEnabled;
            
            elements.ad3Image.disabled = !isEnabled;
            elements.ad3Url.disabled = !isEnabled;
            elements.removeAd3.disabled = !isEnabled;
            
            // 保存更改按钮
            elements.saveChanges.disabled = !isEnabled;
        }
        
        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            showNotification('正在加载数据...', 0);
            
            try {
                let url;
                const headers = {};
                
                if (appData.github.username && appData.github.repo) {
                    if (appData.github.token && appData.github.validated) {
                        // 使用API端点，支持私有仓库
                        url = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                        headers['Authorization'] = `token ${appData.github.token}`;
                    } else {
                        // 使用raw地址，仅支持公共仓库
                        url = `https://raw.githubusercontent.com/${appData.github.username}/${appData.github.repo}/main/bookmarks.json`;
                    }
                    
                    const response = await fetch(url, { headers });
                    
                    if (response.ok) {
                        let data;
                        
                        if (appData.github.token && appData.github.validated) {
                            // API返回的是base64编码的内容
                            const apiData = await response.json();
                            const decodedContent = atob(apiData.content);
                            data = JSON.parse(decodedContent);
                        } else {
                            // 直接解析JSON
                            data = await response.json();
                        }
                        
                        // 合并数据
                        if (data.bookmarks) appData.bookmarks = data.bookmarks;
                        if (data.clocks) appData.clocks = data.clocks;
                        if (data.ads) appData.ads = data.ads;
                        
                        showNotification('数据加载成功');
                        return true;
                    } else if (response.status === 404) {
                        // 文件不存在，使用默认数据
                        showNotification('首次使用，将创建新的数据文件');
                    } else {
                        showNotification('加载数据失败，使用默认数据', 'error');
                        console.error('Failed to load data from GitHub:', response.statusText);
                    }
                } else {
                    showNotification('未设置GitHub仓库信息，使用默认数据');
                }
            } catch (error) {
                showNotification('加载数据时发生错误，使用默认数据', 'error');
                console.error('Error loading data from GitHub:', error);
            }
            
            return false;
        }
        
        // 保存数据到GitHub
        async function saveDataToGitHub() {
            if (!appData.github.username || !appData.github.repo || !appData.github.token || !appData.github.validated) {
                showNotification('请先完成GitHub验证', 'error');
                return false;
            }
            
            // 显示加载状态
            elements.saveLoading.classList.remove('hidden');
            elements.saveChanges.disabled = true;
            showNotification('正在保存数据...', 0);
            
            try {
                // 准备要保存的数据
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    clocks: appData.clocks,
                    ads: appData.ads,
                    updatedAt: new Date().toISOString()
                };
                
                // 字符串化并编码
                const content = JSON.stringify(dataToSave, null, 2);
                
                // 处理非Latin1字符编码问题
                const uint8Array = new TextEncoder().encode(content);
                const base64Content = btoa(String.fromCharCode(...uint8Array));
                
                // 检查文件是否已存在
                const checkUrl = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                const checkResponse = await fetch(checkUrl, {
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                const method = checkResponse.ok ? 'PUT' : 'POST';
                const body = {
                    message: `Update bookmarks - ${new Date().toISOString()}`,
                    content: base64Content
                };
                
                // 如果文件存在，需要提供sha
                if (checkResponse.ok) {
                    const existingData = await checkResponse.json();
                    body.sha = existingData.sha;
                }
                
                // 保存数据
                const saveResponse = await fetch(checkUrl, {
                    method,
                    headers: {
                        'Authorization': `token ${appData.github.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                if (saveResponse.ok) {
                    showNotification('数据保存成功');
                    elements.saveLoading.classList.add('hidden');
                    elements.saveChanges.disabled = false;
                    return true;
                } else {
                    const errorData = await saveResponse.json();
                    console.error('Failed to save data to GitHub:', errorData);
                    showNotification(`保存失败: ${errorData.message || '未知错误'}`, 'error');
                }
            } catch (error) {
                console.error('Error saving data to GitHub:', error);
                showNotification(`保存数据时发生错误: ${error.message}`, 'error');
            }
            
            // 隐藏加载状态
            elements.saveLoading.classList.add('hidden');
            elements.saveChanges.disabled = false;
            return false;
        }
        
        // 渲染书签
        function renderBookmarks() {
            // 清空现有内容
            elements.bookmarkFolders.innerHTML = '';
            elements.bookmarkList.innerHTML = '';
            elements.bookmarkFolder.innerHTML = '';
            
            // 更新文件夹下拉菜单
            appData.bookmarks.folders.forEach(folder => {
                const option = document.createElement('option');
                option.value = folder.name;
                option.textContent = folder.name;
                elements.bookmarkFolder.appendChild(option);
            });
            
            // 渲染主页书签
            appData.bookmarks.folders.forEach(folder => {
                // 创建文件夹容器
                const folderElement = document.createElement('div');
                folderElement.className = 'bookmark-folder';
                folderElement.dataset.folder = folder.name;
                
                // 文件夹标题
                const folderHeader = document.createElement('div');
                folderHeader.className = 'flex items-center justify-between mb-3';
                folderHeader.innerHTML = `
                    <h3 class="font-semibold flex items-center">
                        <i class="fa fa-folder mr-2 text-cosmic-green"></i>
                        ${folder.name}
                        <span class="ml-2 text-sm bg-white/10 px-2 py-0.5 rounded-full">${folder.items.length}</span>
                    </h3>
                    <button class="toggle-folder text-gray-400 hover:text-white">
                        <i class="fa fa-chevron-down"></i>
                    </button>
                `;
                
                // 书签网格
                const bookmarksGrid = document.createElement('div');
                bookmarksGrid.className = 'folder-content grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3';
                
                // 添加书签
                folder.items.forEach((bookmark, index) => {
                    // 创建书签元素
                    const bookmarkElement = document.createElement('a');
                    bookmarkElement.href = bookmark.url;
                    bookmarkElement.target = '_blank';
                    bookmarkElement.className = 'glass-dark rounded-lg p-3 flex flex-col items-center text-center bookmark-hover';
                    
                    // 获取favicon或使用首字母
                    let faviconHtml = '';
                    try {
                        const url = new URL(bookmark.url);
                        faviconHtml = `<img src="${url.protocol}//${url.hostname}/favicon.ico" alt="${bookmark.name} favicon" class="w-8 h-8 mb-2 object-contain favicon">`;
                    } catch (e) {
                        // 无法解析URL时使用首字母
                        const initial = bookmark.name.charAt(0).toUpperCase();
                        faviconHtml = `<div class="w-8 h-8 mb-2 rounded-full bg-cosmic-purple/30 flex items-center justify-center text-lg">${initial}</div>`;
                    }
                    
                    bookmarkElement.innerHTML = `
                        ${faviconHtml}
                        <span class="text-sm truncate w-full">${bookmark.name}</span>
                    `;
                    
                    bookmarksGrid.appendChild(bookmarkElement);
                });
                
                folderElement.appendChild(folderHeader);
                folderElement.appendChild(bookmarksGrid);
                elements.bookmarkFolders.appendChild(folderElement);
                
                // 为文件夹添加折叠/展开功能
                const toggleBtn = folderElement.querySelector('.toggle-folder');
                toggleBtn.addEventListener('click', () => {
                    const content = folderElement.querySelector('.folder-content');
                    const icon = toggleBtn.querySelector('i');
                    
                    if (content.style.display === 'none') {
                        content.style.display = 'grid';
                        icon.className = 'fa fa-chevron-down';
                    } else {
                        content.style.display = 'none';
                        icon.className = 'fa fa-chevron-right';
                    }
                });
                
                // 渲染编辑中心的书签列表
                folder.items.forEach((bookmark, index) => {
                    const listItem = document.createElement('div');
                    listItem.className = 'glass flex items-center justify-between p-3 rounded-lg';
                    listItem.innerHTML = `
                        <div class="flex items-center">
                            <div class="mr-3 text-cosmic-yellow">
                                <i class="fa fa-bookmark"></i>
                            </div>
                            <div>
                                <div class="font-medium">${bookmark.name}</div>
                                <div class="text-sm text-gray-400 truncate max-w-[200px] sm:max-w-[300px]">${bookmark.url}</div>
                                <div class="text-xs text-gray-500 mt-1">${folder.name}</div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-bookmark p-1.5 text-gray-400 hover:text-white" data-id="${index}" data-folder="${folder.name}">
                                <i class="fa fa-pencil"></i>
                            </button>
                            <button class="delete-bookmark p-1.5 text-gray-400 hover:text-red-400" data-id="${index}" data-folder="${folder.name}">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    `;
                    elements.bookmarkList.appendChild(listItem);
                });
            });
            
            // 绑定编辑和删除书签事件
            document.querySelectorAll('.edit-bookmark').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const folderName = e.currentTarget.dataset.folder;
                    const index = parseInt(e.currentTarget.dataset.id);
                    editBookmark(folderName, index);
                });
            });
            
            document.querySelectorAll('.delete-bookmark').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const folderName = e.currentTarget.dataset.folder;
                    const index = parseInt(e.currentTarget.dataset.id);
                    confirmDelete('bookmark', `${folderName}|${index}`, `确定要删除书签"${getBookmark(folderName, index).name}"吗？`);
                });
            });
            
            // 处理无法加载的favicon
            document.querySelectorAll('.favicon').forEach(img => {
                img.addEventListener('error', () => {
                    const parent = img.parentElement;
                    const bookmarkName = parent.querySelector('span').textContent;
                    const initial = bookmarkName.charAt(0).toUpperCase();
                    
                    // 替换为初始字母
                    img.outerHTML = `<div class="w-8 h-8 mb-2 rounded-full bg-cosmic-purple/30 flex items-center justify-center text-lg">${initial}</div>`;
                });
            });
        }
        
        // 获取书签
        function getBookmark(folderName, index) {
            const folder = appData.bookmarks.folders.find(f => f.name === folderName);
            return folder ? folder.items[index] : null;
        }
        
        // 添加新文件夹
        function addNewFolder(name) {
            if (!name || appData.bookmarks.folders.some(f => f.name === name)) {
                showNotification('文件夹名称已存在或为空', 'error');
                return false;
            }
            
            appData.bookmarks.folders.push({ name, items: [] });
            
            // 更新下拉菜单
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            elements.bookmarkFolder.appendChild(option);
            
            // 选中新文件夹
            elements.bookmarkFolder.value = name;
            
            // 清空输入框
            elements.newFolderName.value = '';
            
            showNotification(`已添加文件夹: ${name}`);
            return true;
        }
        
        // 添加书签
        function addBookmark(folderName, name, url) {
            const folder = appData.bookmarks.folders.find(f => f.name === folderName);
            if (!folder) {
                showNotification('文件夹不存在', 'error');
                return false;
            }
            
            // 检查URL是否有效
            try {
                new URL(url);
            } catch (e) {
                showNotification('请输入有效的URL', 'error');
                return false;
            }
            
            // 检查是否已存在相同URL的书签
            if (folder.items.some(item => item.url === url)) {
                showNotification('此URL已存在于书签中', 'error');
                return false;
            }
            
            folder.items.push({ name, url });
            updateBookmarkCount();
            renderBookmarks();
            
            showNotification(`已添加书签: ${name}`);
            return true;
        }
        
        // 编辑书签
        function editBookmark(folderName, index) {
            const folder = appData.bookmarks.folders.find(f => f.name === folderName);
            if (!folder || index < 0 || index >= folder.items.length) {
                showNotification('书签不存在', 'error');
                return;
            }
            
            const bookmark = folder.items[index];
            
            // 填充表单
            elements.bookmarkModalTitle.textContent = '编辑书签';
            elements.bookmarkId.value = `${folderName}|${index}`;
            elements.bookmarkFolder.value = folderName;
            elements.bookmarkName.value = bookmark.name;
            elements.bookmarkUrl.value = bookmark.url;
            
            // 显示对话框
            elements.bookmarkModal.classList.remove('hidden');
            setTimeout(() => {
                elements.bookmarkModal.querySelector('div[class*="glass-dark"]').classList.add('scale-100');
                elements.bookmarkModal.querySelector('div[class*="glass-dark"]').classList.remove('scale-95');
            }, 10);
        }
        
        // 更新书签
        function updateBookmark(id, folderName, name, url) {
            const [originalFolderName, index] = id.split('|');
            const originalFolder = appData.bookmarks.folders.find(f => f.name === originalFolderName);
            
            if (!originalFolder || index < 0 || index >= originalFolder.items.length) {
                showNotification('书签不存在', 'error');
                return false;
            }
            
            // 如果文件夹变了，移动书签
            if (originalFolderName !== folderName) {
                const newFolder = appData.bookmarks.folders.find(f => f.name === folderName);
                if (!newFolder) {
                    showNotification('目标文件夹不存在', 'error');
                    return false;
                }
                
                // 移除原书签
                const bookmark = originalFolder.items.splice(index, 1)[0];
                
                // 添加到新文件夹
                newFolder.items.push({ name, url });
            } else {
                // 更新现有书签
                originalFolder.items[index] = { name, url };
            }
            
            updateBookmarkCount();
            renderBookmarks();
            
            showNotification(`已更新书签: ${name}`);
            return true;
        }
        
        // 删除书签
        function deleteBookmark(id) {
            const [folderName, index] = id.split('|');
            const folder = appData.bookmarks.folders.find(f => f.name === folderName);
            
            if (!folder || index < 0 || index >= folder.items.length) {
                showNotification('书签不存在', 'error');
                return false;
            }
            
            const bookmarkName = folder.items[index].name;
            folder.items.splice(index, 1);
            
            // 如果文件夹为空，删除文件夹
            if (folder.items.length === 0 && folderName !== '常用网站') {
                const folderIndex = appData.bookmarks.folders.findIndex(f => f.name === folderName);
                appData.bookmarks.folders.splice(folderIndex, 1);
            }
            
            updateBookmarkCount();
            renderBookmarks();
            
            showNotification(`已删除书签: ${bookmarkName}`);
            return true;
        }
        
        // 更新书签计数
        function updateBookmarkCount() {
            let total = 0;
            appData.bookmarks.folders.forEach(folder => {
                total += folder.items.length;
            });
            appData.bookmarks.total = total;
            
            elements.bookmarkCount.textContent = total;
            elements.footerTotal.textContent = total;
        }
        
        // 导入书签
        function importBookmarks(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const parser = new DOMParser();
                    const htmlDoc = parser.parseFromString(e.target.result, 'text/html');
                    const bookmarks = htmlDoc.querySelectorAll('a');
                    
                    if (bookmarks.length === 0) {
                        showNotification('未找到书签数据', 'error');
                        return;
                    }
                    
                    let importedCount = 0;
                    let existingCount = 0;
                    
                    // 处理文件夹结构
                    const folderMap = new Map();
                    appData.bookmarks.folders.forEach(folder => {
                        folderMap.set(folder.name.toLowerCase(), folder.name);
                    });
                    
                    bookmarks.forEach(bookmark => {
                        const name = bookmark.textContent.trim() || '未命名书签';
                        let url = bookmark.href;
                        
                        // 过滤无效链接
                        if (!url || url.startsWith('javascript:') || url === '#') return;
                        
                        // 获取文件夹路径
                        let parent = bookmark.parentElement;
                        let folderPath = [];
                        
                        while (parent && parent.tagName !== 'DL' && parent.tagName !== 'BODY') {
                            if (parent.tagName === 'H3') {
                                folderPath.unshift(parent.textContent.trim() || '未命名文件夹');
                            }
                            parent = parent.parentElement;
                        }
                        
                        // 默认为"常用网站"文件夹
                        let folderName = '常用网站';
                        
                        // 如果有文件夹路径，使用最后一个文件夹
                        if (folderPath.length > 0) {
                            folderName = folderPath[folderPath.length - 1];
                            
                            // 检查文件夹是否存在，不存在则创建
                            if (!folderMap.has(folderName.toLowerCase())) {
                                addNewFolder(folderName);
                                folderMap.set(folderName.toLowerCase(), folderName);
                            }
                        }
                        
                        // 检查是否已存在
                        const folder = appData.bookmarks.folders.find(f => f.name === folderName);
                        const exists = folder.items.some(item => item.url === url);
                        
                        if (!exists) {
                            folder.items.push({ name, url });
                            importedCount++;
                        } else {
                            existingCount++;
                        }
                    });
                    
                    updateBookmarkCount();
                    renderBookmarks();
                    
                    showNotification(`书签导入完成: 新增 ${importedCount} 个, 已存在 ${existingCount} 个`);
                } catch (error) {
                    console.error('Error importing bookmarks:', error);
                    showNotification('书签导入失败，请检查文件格式', 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        // 导出书签
        function exportBookmarks() {
            if (appData.bookmarks.total === 0) {
                showNotification('没有书签可导出', 'error');
                return;
            }
            
            // 创建HTML书签文件内容
            let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>书签导出</TITLE>
<H1>书签</H1>
<DL><p>`;
            
            // 添加文件夹和书签
            appData.bookmarks.folders.forEach(folder => {
                if (folder.items.length === 0) return;
                
                html += `<DT><H3>${folder.name}</H3>
<DL><p>`;
                
                folder.items.forEach(bookmark => {
                    html += `<DT><A HREF="${bookmark.url}">${bookmark.name}</A>`;
                });
                
                html += `</DL><p>`;
            });
            
            html += `</DL><p>`;
            
            // 创建并下载文件
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cosmic-bookmarks-${new Date().toISOString().slice(0, 10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('书签导出成功');
        }
        
        // 渲染时钟
        function renderClocks() {
            elements.clocksList.innerHTML = '';
            
            appData.clocks.forEach((clock, index) => {
                // 在编辑中心显示时钟列表
                const clockItem = document.createElement('div');
                clockItem.className = 'glass flex items-center justify-between p-3 rounded-lg';
                clockItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="mr-3 text-cosmic-blue">
                            <i class="fa fa-clock-o"></i>
                        </div>
                        <div>
                            <div class="font-medium">${clock.name}</div>
                            <div class="text-sm text-gray-400">${clock.timezone}</div>
                        </div>
                    </div>
                    <button class="delete-clock p-1.5 text-gray-400 hover:text-red-400" data-id="${index}">
                        <i class="fa fa-trash"></i>
                    </button>
                `;
                elements.clocksList.appendChild(clockItem);
            });
            
            // 绑定删除时钟事件
            document.querySelectorAll('.delete-clock').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.id);
                    const clock = appData.clocks[index];
                    confirmDelete('clock', index, `确定要删除时钟"${clock.name}"吗？`);
                });
            });
        }
        
        // 更新世界时钟
        function updateWorldClocks() {
            appData.clocks.forEach(clock => {
                try {
                    const options = { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit',
                        hour12: false,
                        timeZone: clock.timezone
                    };
                    const timeString = new Date().toLocaleTimeString('zh-CN', options);
                    
                    // 更新主页上的时钟显示
                    const clockElement = document.getElementById(`${clock.name.toLowerCase()}-time`);
                    if (clockElement) {
                        clockElement.textContent = timeString;
                    }
                } catch (e) {
                    console.error(`Error updating clock for ${clock.name}:`, e);
                }
            });
        }
        
        // 添加城市时钟
        function addCity(name, timezone) {
            if (!name || !timezone) {
                showNotification('城市名称和时区不能为空', 'error');
                return false;
            }
            
            // 检查是否已存在
            if (appData.clocks.some(c => c.name === name || c.timezone === timezone)) {
                showNotification('该城市或时区已存在', 'error');
                return false;
            }
            
            // 验证时区
            try {
                new Date().toLocaleString('en-US', { timeZone: timezone });
            } catch (e) {
                showNotification('无效的时区，请检查格式', 'error');
                return false;
            }
            
            appData.clocks.push({ name, timezone });
            renderClocks();
            
            // 在主页添加时钟显示
            const clocksContainer = document.getElementById('world-clocks');
            const clockElement = document.createElement('div');
            clockElement.className = 'flex justify-between';
            clockElement.innerHTML = `
                <span>${name}</span>
                <span id="${name.toLowerCase()}-time" class="font-mono"></span>
            `;
            clocksContainer.appendChild(clockElement);
            
            showNotification(`已添加城市: ${name}`);
            return true;
        }
        
        // 删除城市时钟
        function deleteClock(index) {
            if (index < 0 || index >= appData.clocks.length) {
                showNotification('时钟不存在', 'error');
                return false;
            }
            
            const clock = appData.clocks[index];
            appData.clocks.splice(index, 1);
            renderClocks();
            
            // 从主页移除时钟显示
            const clockElement = document.getElementById(`${clock.name.toLowerCase()}-time`);
            if (clockElement) {
                clockElement.parentElement.remove();
            }
            
            showNotification(`已删除城市: ${clock.name}`);
            return true;
        }
        
        // 渲染广告
        function renderAds() {
            elements.ad1Url.value = appData.ads[0].url || '';
            elements.ad2Url.value = appData.ads[1].url || '';
            elements.ad3Url.value = appData.ads[2].url || '';
            
            // 显示广告图片
            if (appData.ads[0].image) {
                document.querySelector('#ads-tab .border:nth-child(1) .aspect-video')?.remove();
                const img = document.createElement('img');
                img.src = appData.ads[0].image;
                img.alt = '广告图片';
                img.className = 'w-full h-full object-cover rounded-lg';
                document.querySelector('#ads-tab .border:nth-child(1)').appendChild(img);
            }
            
            if (appData.ads[1].image) {
                document.querySelector('#ads-tab .border:nth-child(2) .aspect-video')?.remove();
                const img = document.createElement('img');
                img.src = appData.ads[1].image;
                img.alt = '广告图片';
                img.className = 'w-full h-full object-cover rounded-lg';
                document.querySelector('#ads-tab .border:nth-child(2)').appendChild(img);
            }
            
            if (appData.ads[2].image) {
                document.querySelector('#ads-tab .border:nth-child(3) .aspect-video')?.remove();
                const img = document.createElement('img');
                img.src = appData.ads[2].image;
                img.alt = '广告图片';
                img.className = 'w-full h-full object-cover rounded-lg';
                document.querySelector('#ads-tab .border:nth-child(3)').appendChild(img);
            }
        }
        
        // 更新广告
        function updateAd(index, imageData, url) {
            if (index < 0 || index >= 3) {
                showNotification('广告位不存在', 'error');
                return false;
            }
            
            appData.ads[index].url = url;
            if (imageData) {
                appData.ads[index].image = imageData;
            }
            
            renderAds();
            return true;
        }
        
        // 移除广告
        function removeAd(index) {
            if (index < 0 || index >= 3) {
                showNotification('广告位不存在', 'error');
                return false;
            }
            
            appData.ads[index] = { image: '', url: '' };
            
            // 重置表单
            if (index === 0) {
                elements.ad1Url.value = '';
            } else if (index === 1) {
                elements.ad2Url.value = '';
            } else {
                elements.ad3Url.value = '';
            }
            
            renderAds();
            showNotification(`已移除广告位 ${index + 1}`);
            return true;
        }
        
        // 确认删除
        function confirmDelete(type, id, message) {
            elements.deleteType.value = type;
            elements.deleteId.value = id;
            elements.deleteMessage.textContent = message;
            
            elements.confirmDeleteModal.classList.remove('hidden');
        }
        
        // 显示通知
        function showNotification(message, type = 'info', duration = 3000) {
            elements.notificationMessage.textContent = message;
            elements.notification.classList.remove('bg-green-500', 'bg-red-500', 'bg-blue-500');
            
            if (type === 'success') {
                elements.notification.classList.add('bg-green-500');
            } else if (type === 'error') {
                elements.notification.classList.add('bg-red-500');
            } else {
                elements.notification.classList.add('bg-blue-500');
            }
            
            // 显示通知
            elements.notification.classList.remove('translate-y-20', 'opacity-0');
            
            // 如果不是永久显示，设置自动隐藏
            if (duration > 0) {
                setTimeout(hideNotification, duration);
            }
        }
        
        // 隐藏通知
        function hideNotification() {
            elements.notification.classList.add('translate-y-20', 'opacity-0');
        }
        
        // 更新在线时长
        function updateUptime() {
            const now = new Date();
            const uptimeMs = now - appData.deploymentDate;
            
            // 转换为时分秒
            const hours = Math.floor(uptimeMs / 3600000);
            const minutes = Math.floor((uptimeMs % 3600000) / 60000);
            const seconds = Math.floor((uptimeMs % 60000) / 1000);
            
            // 格式化显示
            elements.uptimeDisplay.textContent = `${padZero(hours)}:${padZero(minutes)}:${padZero(seconds)}`;
        }
        
        // 更新健康提醒
        function updateHealthReminder() {
            const now = new Date();
            const minutes = now.getMinutes();
            
            // 每小时的第20和50分钟提醒休息
            if (minutes >= 20 && minutes < 25 || minutes >= 50) {
                elements.healthAdvice.textContent = '该休息一下了，保护眼睛哦！';
            } else {
                const nextReminder = minutes < 20 ? 20 : 50;
                elements.healthAdvice.textContent = `距离下次休息还有 ${nextReminder - minutes} 分钟`;
                elements.nextReminder.textContent = `${now.getHours()}:${padZero(nextReminder)}`;
            }
        }
        
        // 数字补零
        function padZero(num) {
            return num < 10 ? `0${num}` : num;
        }
        
        // 设置控制栏自动隐藏
        function setupControlBarAutoHide() {
            let hideTimer;
            
            // 初始显示控制栏
            elements.controlBar.classList.remove('translate-y-[-100%]');
            
            // 滚动时显示控制栏
            window.addEventListener('scroll', () => {
                // 清除现有计时器
                clearTimeout(hideTimer);
                
                // 显示控制栏
                elements.controlBar.classList.remove('translate-y-[-100%]');
                
                // 设置3秒后隐藏
                hideTimer = setTimeout(() => {
                    elements.controlBar.classList.add('translate-y-[-100%]');
                }, 3000);
            });
        }
        
        // 绑定事件监听器
        function bindEventListeners() {
            // 主题切换
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // 设置对话框
            elements.settingsBtn.addEventListener('click', () => {
                elements.settingsModal.classList.remove('hidden');
            });
            
            elements.closeSettings.addEventListener('click', () => {
                elements.settingsModal.classList.add('hidden');
            });
            
            elements.modalBackdrop.addEventListener('click', () => {
                elements.settingsModal.classList.add('hidden');
            });
            
            // 验证GitHub令牌
            elements.validateToken.addEventListener('click', validateGitHubToken);
            
            // 保存设置
            elements.saveSettings.addEventListener('click', saveSettings);
            
            // 进入编辑中心
            elements.enterEditBtn.addEventListener('click', () => {
                elements.homePage.classList.add('hidden');
                elements.editCenter.classList.remove('hidden');
                elements.settingsModal.classList.add('hidden');
            });
            
            // 返回主页
            elements.backToHome.addEventListener('click', () => {
                elements.editCenter.classList.add('hidden');
                elements.homePage.classList.remove('hidden');
            });
            
            // 编辑选项卡切换
            elements.editTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有活动状态
                    elements.editTabs.forEach(t => t.classList.remove('active', 'bg-white/10'));
                    elements.editContents.forEach(c => c.classList.add('hidden'));
                    
                    // 设置当前活动状态
                    tab.classList.add('active', 'bg-white/10');
                    const tabId = tab.dataset.tab;
                    document.getElementById(`${tabId}-tab`).classList.remove('hidden');
                });
            });
            
            // 添加书签
            elements.addBookmark.addEventListener('click', () => {
                elements.bookmarkModalTitle.textContent = '添加书签';
                elements.bookmarkId.value = '';
                elements.bookmarkFolder.value = '常用网站';
                elements.bookmarkName.value = '';
                elements.bookmarkUrl.value = '';
                
                elements.bookmarkModal.classList.remove('hidden');
                setTimeout(() => {
                    elements.bookmarkModal.querySelector('div[class*="glass-dark"]').classList.add('scale-100');
                    elements.bookmarkModal.querySelector('div[class*="glass-dark"]').classList.remove('scale-95');
                }, 10);
            });
            
            // 关闭书签对话框
            elements.closeBookmarkModal.addEventListener('click', () => {
                elements.bookmarkModal.classList.add('hidden');
            });
            
            elements.cancelBookmark.addEventListener('click', () => {
                elements.bookmarkModal.classList.add('hidden');
            });
            
            elements.bookmarkModalBackdrop.addEventListener('click', () => {
                elements.bookmarkModal.classList.add('hidden');
            });
            
            // 添加文件夹
            elements.addFolder.addEventListener('click', () => {
                const folderName = elements.newFolderName.value.trim();
                if (folderName) {
                    addNewFolder(folderName);
                }
            });
            
            // 保存书签
            elements.saveBookmark.addEventListener('click', () => {
                const folderName = elements.bookmarkFolder.value;
                const name = elements.bookmarkName.value.trim();
                const url = elements.bookmarkUrl.value.trim();
                const id = elements.bookmarkId.value;
                
                if (!name || !url) {
                    showNotification('名称和URL不能为空', 'error');
                    return;
                }
                
                if (id) {
                    // 更新现有书签
                    updateBookmark(id, folderName, name, url);
                } else {
                    // 添加新书签
                    addBookmark(folderName, name, url);
                }
                
                elements.bookmarkModal.classList.add('hidden');
            });
            
            // 导入书签
            elements.importBookmarks.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    importBookmarks(file);
                    // 重置输入，允许重复选择同一文件
                    elements.importBookmarks.value = '';
                }
            });
            
            // 导出书签
            elements.exportBookmarks.addEventListener('click', exportBookmarks);
            
            // 添加城市时钟
            elements.addClock.addEventListener('click', () => {
                elements.cityName.value = '';
                elements.cityTimezone.value = '';
                elements.cityModal.classList.remove('hidden');
            });
            
            // 关闭城市对话框
            elements.closeCityModal.addEventListener('click', () => {
                elements.cityModal.classList.add('hidden');
            });
            
            elements.cancelCity.addEventListener('click', () => {
                elements.cityModal.classList.add('hidden');
            });
            
            elements.cityModalBackdrop.addEventListener('click', () => {
                elements.cityModal.classList.add('hidden');
            });
            
            // 保存城市时钟
            elements.saveCity.addEventListener('click', () => {
                const name = elements.cityName.value.trim();
                const timezone = elements.cityTimezone.value.trim();
                
                if (addCity(name, timezone)) {
                    elements.cityModal.classList.add('hidden');
                }
            });
            
            // 广告图片上传
            elements.ad1Image.addEventListener('change', handleAdImageUpload(0));
            elements.ad2Image.addEventListener('change', handleAdImageUpload(1));
            elements.ad3Image.addEventListener('change', handleAdImageUpload(2));
            
            // 广告URL更改
            elements.ad1Url.addEventListener('change', (e) => {
                updateAd(0, null, e.target.value);
            });
            
            elements.ad2Url.addEventListener('change', (e) => {
                updateAd(1, null, e.target.value);
            });
            
            elements.ad3Url.addEventListener('change', (e) => {
                updateAd(2, null, e.target.value);
            });
            
            // 移除广告
            elements.removeAd1.addEventListener('click', () => {
                removeAd(0);
            });
            
            elements.removeAd2.addEventListener('click', () => {
                removeAd(1);
            });
            
            elements.removeAd3.addEventListener('click', () => {
                removeAd(2);
            });
            
            // 保存更改
            elements.saveChanges.addEventListener('click', saveDataToGitHub);
            
            // 确认删除对话框
            elements.cancelDelete.addEventListener('click', () => {
                elements.confirmDeleteModal.classList.add('hidden');
            });
            
            elements.confirmDeleteBackdrop.addEventListener('click', () => {
                elements.confirmDeleteModal.classList.add('hidden');
            });
            
            elements.confirmDelete.addEventListener('click', () => {
                const type = elements.deleteType.value;
                const id = elements.deleteId.value;
                
                if (type === 'bookmark') {
                    deleteBookmark(id);
                } else if (type === 'clock') {
                    deleteClock(parseInt(id));
                }
                
                elements.confirmDeleteModal.classList.add('hidden');
            });
            
            // 搜索功能
            elements.searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                // 过滤书签
                appData.bookmarks.folders.forEach(folder => {
                    const folderElement = document.querySelector(`.bookmark-folder[data-folder="${folder.name}"]`);
                    let hasVisibleItems = false;
                    
                    folder.items.forEach((bookmark, index) => {
                        const bookmarkElement = folderElement.querySelector('.folder-content a:nth-child(' + (index + 1) + ')');
                        const matches = bookmark.name.toLowerCase().includes(searchTerm) || 
                                       bookmark.url.toLowerCase().includes(searchTerm);
                        
                        if (matches) {
                            bookmarkElement.classList.remove('hidden');
                            hasVisibleItems = true;
                        } else {
                            bookmarkElement.classList.add('hidden');
                        }
                    });
                    
                    // 显示/隐藏文件夹
                    if (hasVisibleItems || folder.name.toLowerCase().includes(searchTerm)) {
                        folderElement.classList.remove('hidden');
                    } else {
                        folderElement.classList.add('hidden');
                    }
                });
            });
        }
        
        // 处理广告图片上传
        function handleAdImageUpload(index) {
            return function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // 检查文件大小（最大3MB）
                if (file.size > 3 * 1024 * 1024) {
                    showNotification('图片大小不能超过3MB', 'error');
                    return;
                }
                
                // 检查文件类型
                if (!file.type.startsWith('image/')) {
                    showNotification('请上传图片文件', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const urlInput = index === 0 ? elements.ad1Url : 
                                   index === 1 ? elements.ad2Url : 
                                   elements.ad3Url;
                    
                    updateAd(index, event.target.result, urlInput.value);
                    showNotification(`广告图片已更新`);
                    
                    // 重置输入，允许重复选择同一文件
                    if (index === 0) {
                        elements.ad1Image.value = '';
                    } else if (index === 1) {
                        elements.ad2Image.value = '';
                    } else {
                        elements.ad3Image.value = '';
                    }
                };
                reader.readAsDataURL(file);
            };
        }
        
        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
