<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际书签 | 探索网络宇宙</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231a202c'/%3E%3Ccircle cx='50' cy='50' r='30' fill='%234a5568'/%3E%3Ccircle cx='50' cy='50' r='15' fill='%239f7aea'/%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind配置
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        space: {
                            black: '#0a0e17',
                            dark: '#12192c',
                            blue: '#1e3a8a',
                            purple: '#4c1d95',
                            pink: '#8b5cf6',
                            glow: '#a78bfa'
                        }
                    },
                    fontFamily: {
                        space: ['Orbitron', 'sans-serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-slow': 'float 8s ease-in-out infinite',
                        'float-fast': 'float 4s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'twinkle': 'twinkle 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        twinkle: {
                            '0%': { opacity: 0.3 },
                            '100%': { opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .glass-dark {
                background: rgba(10, 14, 23, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.08);
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle 2s infinite alternate;
            }
            .planet {
                position: absolute;
                border-radius: 50%;
                filter: blur(0.5px);
            }
            .bookmark-shadow {
                box-shadow: 0 8px 32px rgba(167, 139, 250, 0.1);
            }
            .text-shadow {
                text-shadow: 0 0 8px rgba(167, 139, 250, 0.6);
            }
            .rotate-slow {
                animation: rotate 200s linear infinite;
            }
            @keyframes rotate {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-space-black text-gray-100 min-h-screen overflow-x-hidden relative font-sans">
    <!-- 星空背景 -->
    <div id="stars" class="fixed inset-0 z-0"></div>
    
    <!-- 行星装饰 -->
    <div class="planet bg-space-purple/30 w-64 h-64 top-20 -left-32 rotate-slow hidden md:block"></div>
    <div class="planet bg-space-blue/20 w-96 h-96 bottom-20 -right-48 rotate-slow hidden lg:block"></div>
    <div class="planet bg-space-pink/20 w-32 h-32 top-1/3 right-1/4 animate-float-slow hidden md:block"></div>

    <!-- 顶部控制栏 -->
    <header id="control-bar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 transform translate-y-0">
        <div class="glass-dark px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <h1 class="text-xl font-space font-bold text-space-glow text-shadow">星际书签</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/10 transition-colors" aria-label="切换主题">
                    <i class="fa fa-moon-o text-gray-300"></i>
                </button>
                <button id="settings-btn" class="p-2 rounded-full hover:bg-white/10 transition-colors" aria-label="设置">
                    <i class="fa fa-cog text-gray-300"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16 relative z-10">
        <!-- 主页 -->
        <section id="home-page" class="space-y-8">
            <!-- 顶部三组件 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- 在线时长统计 -->
                <div class="glass rounded-xl p-4 bookmark-shadow transform hover:scale-[1.02] transition-transform">
                    <h3 class="text-sm text-gray-400 mb-2">已探索</h3>
                    <div class="flex items-end space-x-2">
                        <span id="online-time" class="text-2xl font-space font-bold text-space-glow">0天0时0分</span>
                        <span class="text-xs text-gray-400 mb-1">宇宙时间</span>
                    </div>
                </div>
                
                <!-- 健康提醒 -->
                <div class="glass rounded-xl p-4 bookmark-shadow transform hover:scale-[1.02] transition-transform">
                    <h3 class="text-sm text-gray-400 mb-2">星际提示</h3>
                    <div>
                        <p id="health-reminder" class="text-base">每小时请休息5分钟，保护您的星际航行视力</p>
                        <p id="next-reminder" class="text-xs text-gray-400 mt-1">下次提醒: 60分钟后</p>
                    </div>
                </div>
                
                <!-- 世界时钟 -->
                <div class="glass rounded-xl p-4 bookmark-shadow transform hover:scale-[1.02] transition-transform">
                    <h3 class="text-sm text-gray-400 mb-2">星际时钟</h3>
                    <div id="world-clocks" class="space-y-1">
                        <div class="flex justify-between">
                            <span>地球 - 北京</span>
                            <span id="beijing-time" class="font-medium">00:00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>地球 - 伦敦</span>
                            <span id="london-time" class="font-medium">00:00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>地球 - 纽约</span>
                            <span id="newyork-time" class="font-medium">00:00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>地球 - 东京</span>
                            <span id="tokyo-time" class="font-medium">00:00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 搜索框 -->
            <div class="glass rounded-xl p-4 bookmark-shadow">
                <div class="relative">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="search-input" placeholder="搜索书签..." 
                           class="w-full bg-transparent border border-gray-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:border-space-glow transition-colors">
                </div>
            </div>
            
            <!-- 广告位1 -->
            <div class="glass rounded-xl p-4 bookmark-shadow">
                <div class="h-24 md:h-32 bg-gray-800/50 rounded-lg flex items-center justify-center">
                    <p class="text-gray-400 text-center">星际广告位 #1</p>
                </div>
            </div>
            
            <!-- 书签分类和内容 -->
            <div class="space-y-6">
                <h2 class="text-xl font-space font-bold text-space-glow">我的星际站点</h2>
                
                <!-- 书签文件夹列表 -->
                <div id="bookmark-folders" class="space-y-4">
                    <!-- 示例文件夹 -->
                    <div class="bookmark-folder">
                        <div class="flex items-center justify-between glass rounded-t-xl p-3 cursor-pointer folder-header">
                            <div class="flex items-center space-x-2">
                                <i class="fa fa-folder text-space-pink"></i>
                                <h3 class="font-medium">常用工具</h3>
                            </div>
                            <i class="fa fa-chevron-down text-xs text-gray-400 transition-transform duration-300"></i>
                        </div>
                        <div class="glass rounded-b-xl p-4 mt-[-1px] folder-content">
                            <!-- 书签网格 -->
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                                <!-- 示例书签 -->
                                <a href="https://google.com" target="_blank" class="bookmark-item group">
                                    <div class="glass rounded-lg p-3 h-full flex flex-col items-center justify-center text-center transform group-hover:scale-[1.05] transition-all bookmark-shadow">
                                        <div class="w-10 h-10 rounded-full bg-space-blue/30 flex items-center justify-center mb-2">
                                            <img src="https://picsum.photos/200" alt="Google图标" class="w-6 h-6 rounded">
                                        </div>
                                        <span class="text-sm truncate w-full">Google</span>
                                    </div>
                                </a>
                                
                                <a href="https://github.com" target="_blank" class="bookmark-item group">
                                    <div class="glass rounded-lg p-3 h-full flex flex-col items-center justify-center text-center transform group-hover:scale-[1.05] transition-all bookmark-shadow">
                                        <div class="w-10 h-10 rounded-full bg-space-blue/30 flex items-center justify-center mb-2">
                                            <img src="https://picsum.photos/201" alt="GitHub图标" class="w-6 h-6 rounded">
                                        </div>
                                        <span class="text-sm truncate w-full">GitHub</span>
                                    </div>
                                </a>
                                
                                <a href="https://stackoverflow.com" target="_blank" class="bookmark-item group">
                                    <div class="glass rounded-lg p-3 h-full flex flex-col items-center justify-center text-center transform group-hover:scale-[1.05] transition-all bookmark-shadow">
                                        <div class="w-10 h-10 rounded-full bg-space-blue/30 flex items-center justify-center mb-2">
                                            <img src="https://picsum.photos/202" alt="Stack Overflow图标" class="w-6 h-6 rounded">
                                        </div>
                                        <span class="text-sm truncate w-full">Stack Overflow</span>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 未分类书签 -->
                <div class="bookmark-folder">
                    <div class="flex items-center justify-between glass rounded-t-xl p-3 cursor-pointer folder-header">
                        <div class="flex items-center space-x-2">
                            <i class="fa fa-folder-open text-space-pink"></i>
                            <h3 class="font-medium">未分类</h3>
                        </div>
                        <i class="fa fa-chevron-down text-xs text-gray-400 transition-transform duration-300"></i>
                    </div>
                    <div class="glass rounded-b-xl p-4 mt-[-1px] folder-content">
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3" id="unclassified-bookmarks">
                            <!-- 书签将通过JS动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 广告位2 -->
            <div class="glass rounded-xl p-4 bookmark-shadow">
                <div class="h-24 md:h-32 bg-gray-800/50 rounded-lg flex items-center justify-center">
                    <p class="text-gray-400 text-center">星际广告位 #2</p>
                </div>
            </div>
            
            <!-- 广告位3 -->
            <div class="glass rounded-xl p-4 bookmark-shadow">
                <div class="h-24 md:h-32 bg-gray-800/50 rounded-lg flex items-center justify-center">
                    <p class="text-gray-400 text-center">星际广告位 #3</p>
                </div>
            </div>
        </section>
        
        <!-- 编辑中心 (默认隐藏) -->
        <section id="edit-center" class="space-y-8 hidden">
            <div class="glass rounded-xl p-6 bookmark-shadow">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-space font-bold text-space-glow">星际编辑中心</h2>
                    <button id="back-to-home" class="p-2 rounded-full hover:bg-white/10 transition-colors" aria-label="返回主页">
                        <i class="fa fa-arrow-left text-gray-300"></i>
                    </button>
                </div>
                
                <!-- GitHub设置 -->
                <div class="mb-8">
                    <h3 class="text-lg font-medium mb-4 flex items-center">
                        <i class="fa fa-github text-gray-400 mr-2"></i>
                        GitHub 同步设置
                    </h3>
                    <div class="space-y-4 glass p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">GitHub 用户名</label>
                                <input type="text" id="github-username" class="w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="用户名">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">仓库名称</label>
                                <input type="text" id="github-repo" class="w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="仓库名">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">个人访问令牌 (需要 repo 权限)</label>
                            <input type="password" id="github-token" class="w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="ghp_...">
                        </div>
                        <div class="flex space-x-2">
                            <button id="validate-github" class="px-4 py-2 bg-space-blue hover:bg-space-blue/80 rounded-lg transition-colors flex items-center">
                                <i class="fa fa-check mr-2"></i> 验证
                            </button>
                            <button id="save-github-settings" class="px-4 py-2 bg-space-purple hover:bg-space-purple/80 rounded-lg transition-colors flex items-center">
                                <i class="fa fa-save mr-2"></i> 保存设置
                            </button>
                        </div>
                        <div id="github-validation-status" class="text-sm text-gray-400">
                            状态: 未验证
                        </div>
                    </div>
                </div>
                
                <!-- 书签管理 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium flex items-center">
                            <i class="fa fa-bookmark text-gray-400 mr-2"></i>
                            书签管理
                        </h3>
                        <div class="flex space-x-2">
                            <button id="add-bookmark-btn" class="px-3 py-1 bg-space-purple/70 hover:bg-space-purple rounded-lg text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fa fa-plus mr-1"></i> 添加书签
                            </button>
                            <label for="import-bookmarks" class="px-3 py-1 bg-space-blue/70 hover:bg-space-blue rounded-lg text-sm transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fa fa-upload mr-1"></i> 导入
                            </label>
                            <input type="file" id="import-bookmarks" accept=".html" class="hidden">
                            <button id="export-bookmarks" class="px-3 py-1 bg-green-600/70 hover:bg-green-600 rounded-lg text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fa fa-download mr-1"></i> 导出
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass p-4 rounded-lg">
                        <div id="bookmarks-management">
                            <!-- 书签管理内容将通过JS动态生成 -->
                            <div class="text-center py-8 text-gray-500">
                                请先完成GitHub验证以管理书签
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 时钟管理 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium flex items-center">
                            <i class="fa fa-clock-o text-gray-400 mr-2"></i>
                            世界时钟管理
                        </h3>
                        <button id="add-city-btn" class="px-3 py-1 bg-space-purple/70 hover:bg-space-purple rounded-lg text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-plus mr-1"></i> 添加城市
                        </button>
                    </div>
                    
                    <div class="glass p-4 rounded-lg">
                        <div id="cities-management">
                            <!-- 城市管理内容将通过JS动态生成 -->
                            <div class="text-center py-8 text-gray-500">
                                请先完成GitHub验证以管理城市
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 广告管理 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium flex items-center">
                            <i class="fa fa-bullhorn text-gray-400 mr-2"></i>
                            广告管理
                        </h3>
                        <button id="add-ad-btn" class="px-3 py-1 bg-space-purple/70 hover:bg-space-purple rounded-lg text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fa fa-plus mr-1"></i> 添加广告
                        </button>
                    </div>
                    
                    <div class="glass p-4 rounded-lg">
                        <div id="ads-management">
                            <!-- 广告管理内容将通过JS动态生成 -->
                            <div class="text-center py-8 text-gray-500">
                                请先完成GitHub验证以管理广告
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 保存更改 -->
                <div class="flex justify-end">
                    <button id="save-changes" class="px-6 py-3 bg-space-glow text-space-dark font-medium rounded-lg hover:bg-space-glow/90 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-save mr-2"></i> 保存更改
                    </button>
                </div>
            </div>
        </section>
    </main>
    
    <!-- 底部信息 -->
    <footer class="container mx-auto px-4 pb-8 relative z-10">
        <div class="glass rounded-xl p-4 bookmark-shadow">
            <div class="dark-white flex flex-col md:flex-row justify-between items-center">
                <div id="total-bookmarks" class="mb-2 md:mb-0">共收录0个网站</div>
                <div id="copyright">Copyright © 2018-2025 example.com, All Rights Reserved</div>
            </div>
        </div>
    </footer>
    
    <!-- 设置对话框 -->
    <div id="settings-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-xl p-6 w-full max-w-md mx-4 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-space font-bold">设置</h3>
                <button id="close-settings" class="p-1 hover:bg-white/10 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <span>自动隐藏控制栏</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="auto-hide-control" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-space-purple"></div>
                    </label>
                </div>
                
                <div class="flex items-center justify-between">
                    <span>健康提醒</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="enable-reminders" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-space-purple"></div>
                    </label>
                </div>
                
                <div class="pt-4 border-t border-gray-800">
                    <button id="open-edit-center" class="w-full py-2 bg-space-purple hover:bg-space-purple/80 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        进入编辑中心
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加书签对话框 -->
    <div id="add-bookmark-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-xl p-6 w-full max-w-md mx-4 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-space font-bold">添加新书签</h3>
                <button class="close-modal p-1 hover:bg-white/10 rounded-full transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">网址</label>
                    <input type="url" id="bookmark-url" class="w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="https://example.com" required>
                </div>
                
                <div>
                    <label class="block text-sm text-gray-400 mb-1">名称</label>
                    <input type="text" id="bookmark-name" class="w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors" placeholder="网站名称">
                </div>
                
                <div>
                    <label class="block text-sm text-gray-400 mb-1">文件夹</label>
                    <select id="bookmark-folder" class="w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:border-space-glow transition-colors">
                        <option value="unclassified">未分类</option>
                    </select>
                </div>
                
                <div class="pt-4 flex space-x-2">
                    <button id="save-bookmark" class="flex-1 py-2 bg-space-purple hover:bg-space-purple/80 rounded-lg transition-colors">
                        保存
                    </button>
                    <button class="close-modal flex-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 加载动画 -->
    <div id="loading-indicator" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-full p-6">
            <div class="w-12 h-12 border-4 border-gray-700 border-t-space-glow rounded-full animate-spin"></div>
        </div>
    </div>
    
    <!-- 提示消息 -->
    <div id="toast" class="fixed bottom-4 right-4 glass px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50"></div>

    <script>
        // 应用数据存储
        const appData = {
            github: {
                username: '',
                repo: '',
                token: '',
                validated: false
            },
            settings: {
                autoHideControl: true,
                enableReminders: true
            },
            bookmarks: {
                folders: [],
                unclassified: []
            },
            cities: [
                { name: '北京', timezone: 'Asia/Shanghai' },
                { name: '伦敦', timezone: 'Europe/London' },
                { name: '纽约', timezone: 'America/New_York' },
                { name: '东京', timezone: 'Asia/Tokyo' }
            ],
            ads: [
                { id: 1, image: '', url: '', active: true },
                { id: 2, image: '', url: '', active: true },
                { id: 3, image: '', url: '', active: true }
            ],
            deploymentDate: new Date(), // 实际应用中应从部署信息获取
            lastHealthCheck: new Date()
        };

        // DOM元素
        const elements = {
            controlBar: document.getElementById('control-bar'),
            themeToggle: document.getElementById('theme-toggle'),
            settingsBtn: document.getElementById('settings-btn'),
            settingsModal: document.getElementById('settings-modal'),
            closeSettings: document.getElementById('close-settings'),
            openEditCenter: document.getElementById('open-edit-center'),
            homePage: document.getElementById('home-page'),
            editCenter: document.getElementById('edit-center'),
            backToHome: document.getElementById('back-to-home'),
            searchInput: document.getElementById('search-input'),
            loadingIndicator: document.getElementById('loading-indicator'),
            toast: document.getElementById('toast'),
            githubUsername: document.getElementById('github-username'),
            githubRepo: document.getElementById('github-repo'),
            githubToken: document.getElementById('github-token'),
            validateGithub: document.getElementById('validate-github'),
            saveGithubSettings: document.getElementById('save-github-settings'),
            githubValidationStatus: document.getElementById('github-validation-status'),
            saveChanges: document.getElementById('save-changes'),
            addBookmarkBtn: document.getElementById('add-bookmark-btn'),
            addBookmarkModal: document.getElementById('add-bookmark-modal'),
            closeModals: document.querySelectorAll('.close-modal'),
            saveBookmark: document.getElementById('save-bookmark'),
            importBookmarks: document.getElementById('import-bookmarks'),
            exportBookmarks: document.getElementById('export-bookmarks'),
            addCityBtn: document.getElementById('add-city-btn'),
            addAdBtn: document.getElementById('add-ad-btn'),
            autoHideControl: document.getElementById('auto-hide-control'),
            enableReminders: document.getElementById('enable-reminders'),
            totalBookmarks: document.getElementById('total-bookmarks'),
            copyright: document.getElementById('copyright'),
            onlineTime: document.getElementById('online-time'),
            healthReminder: document.getElementById('health-reminder'),
            nextReminder: document.getElementById('next-reminder')
        };

        // 初始化星空背景
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // 随机大小
                const size = Math.random() * 2;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // 随机位置
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // 随机闪烁动画延迟
                star.style.animationDelay = `${Math.random() * 2}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // 显示提示消息
        function showToast(message, isError = false) {
            const toast = elements.toast;
            toast.textContent = message;
            toast.classList.toggle('text-red-400', isError);
            toast.classList.toggle('text-green-400', !isError);
            
            // 显示提示
            toast.classList.remove('translate-y-20', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');
            
            // 3秒后隐藏
            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // 显示加载动画
        function showLoading() {
            elements.loadingIndicator.classList.remove('hidden');
        }

        // 隐藏加载动画
        function hideLoading() {
            elements.loadingIndicator.classList.add('hidden');
        }

        // 切换主题
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            elements.themeToggle.innerHTML = isDark 
                ? '<i class="fa fa-sun-o text-yellow-400"></i>' 
                : '<i class="fa fa-moon-o text-gray-300"></i>';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // 控制栏自动隐藏
        let hideControlBarTimeout;
        function resetControlBarTimer() {
            if (!appData.settings.autoHideControl) return;
            
            clearTimeout(hideControlBarTimeout);
            elements.controlBar.classList.remove('translate-y-[-100%]');
            
            hideControlBarTimeout = setTimeout(() => {
                elements.controlBar.classList.add('translate-y-[-100%]');
            }, 3000);
        }

        // 验证GitHub Token
        async function validateGitHubToken() {
            showLoading();
            
            const username = elements.githubUsername.value.trim();
            const token = elements.githubToken.value.trim();
            
            if (!username || !token) {
                hideLoading();
                showToast('请输入用户名和Token', true);
                return false;
            }
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    if (userData.login.toLowerCase() === username.toLowerCase()) {
                        appData.github.validated = true;
                        elements.githubValidationStatus.textContent = '状态: 验证成功 ✓';
                        elements.githubValidationStatus.classList.add('text-green-400');
                        elements.githubValidationStatus.classList.remove('text-red-400', 'text-gray-400');
                        showToast('GitHub验证成功');
                        updateEditFeaturesStatus();
                        return true;
                    } else {
                        appData.github.validated = false;
                        elements.githubValidationStatus.textContent = '状态: 用户名与Token不匹配';
                        elements.githubValidationStatus.classList.add('text-red-400');
                        elements.githubValidationStatus.classList.remove('text-green-400', 'text-gray-400');
                        showToast('用户名与Token不匹配', true);
                    }
                } else {
                    appData.github.validated = false;
                    elements.githubValidationStatus.textContent = '状态: 验证失败 - 无效的Token';
                    elements.githubValidationStatus.classList.add('text-red-400');
                    elements.githubValidationStatus.classList.remove('text-green-400', 'text-gray-400');
                    showToast('GitHub验证失败', true);
                }
            } catch (error) {
                appData.github.validated = false;
                elements.githubValidationStatus.textContent = '状态: 验证出错';
                elements.githubValidationStatus.classList.add('text-red-400');
                elements.githubValidationStatus.classList.remove('text-green-400', 'text-gray-400');
                showToast('验证过程出错', true);
                console.error('GitHub验证错误:', error);
            } finally {
                hideLoading();
            }
            
            return false;
        }

        // 更新编辑功能状态
        function updateEditFeaturesStatus() {
            const isEnabled = appData.github.validated;
            
            elements.openEditCenter.disabled = !isEnabled;
            elements.addBookmarkBtn.disabled = !isEnabled;
            elements.importBookmarks.disabled = !isEnabled;
            elements.exportBookmarks.disabled = !isEnabled;
            elements.addCityBtn.disabled = !isEnabled;
            elements.addAdBtn.disabled = !isEnabled;
            elements.saveChanges.disabled = !isEnabled;
            
            // 如果已启用，刷新管理界面
            if (isEnabled) {
                renderBookmarksManagement();
                renderCitiesManagement();
                renderAdsManagement();
            }
        }

        // 保存GitHub设置
        function saveGitHubSettings() {
            appData.github.username = elements.githubUsername.value.trim();
            appData.github.repo = elements.githubRepo.value.trim();
            appData.github.token = elements.githubToken.value.trim();
            
            // 保存到本地存储
            localStorage.setItem('github-settings', JSON.stringify({
                username: appData.github.username,
                repo: appData.github.repo
                // 不保存token到localStorage，出于安全考虑
            }));
            
            showToast('GitHub设置已保存');
        }

        // 从GitHub加载数据
        async function loadDataFromGitHub() {
            showLoading();
            
            try {
                let url;
                const headers = {};
                
                if (appData.github.token) {
                    // 使用API加载（支持私有仓库）
                    url = `https://api.github.com/repos/${appData.github.username}/${appData.github.repo}/contents/bookmarks.json`;
                    headers['Authorization'] = `token ${appData.github.token}`;
                } else if (appData.github.username && appData.github.repo) {
                    // 公开访问
                    url = `https://raw.githubusercontent.com/${appData.github.username}/${appData.github.repo}/main/bookmarks.json`;
                } else {
                    // 没有配置，使用默认数据
                    hideLoading();
                    return;
                }
                
                const response = await fetch(url, { headers });
                
                if (response.ok) {
                    if (appData.github.token) {
                        // 处理API响应
                        const data = await response.json();
                        const content = atob(data.content);
                        const jsonData = JSON.parse(content);
                        mergeData(jsonData);
                    } else {
                        // 处理直接文件访问
                        const jsonData = await response.json();
                        mergeData(jsonData);
                    }
                    
                    renderBookmarks();
                    renderCities();
                    renderAds();
                    updateBookmarkCount();
                    showToast('数据加载成功');
                } else if (response.status === 404) {
                    // 文件不存在，使用默认数据
                    showToast('首次使用，初始化数据');
                    await saveDataToGitHub(); // 创建初始文件
                } else {
                    showToast('数据加载失败', true);
                    console.error('数据加载失败:', response.statusText);
                }
            } catch (error) {
                showToast('数据加载出错', true);
                console.error('加载GitHub数据错误:', error);
            } finally {
                hideLoading();
            }
        }

        // 合并新数据
        function mergeData(newData) {
            if (newData.bookmarks) {
                appData.bookmarks = { ...appData.bookmarks, ...newData.bookmarks };
            }
            if (newData.cities) {
                appData.cities = newData.cities;
            }
            if (newData.ads) {
                appData.ads = newData.ads;
            }
            if (newData.deploymentDate) {
                appData.deploymentDate = new Date(newData.deploymentDate);
            }
        }

        // 保存数据到GitHub
        async function saveDataToGitHub() {
            showLoading();
            
            try {
                const { username, repo, token } = appData.github;
                
                if (!username || !repo || !token) {
                    hideLoading();
                    showToast('请完成GitHub设置并验证', true);
                    return false;
                }
                
                // 准备要保存的数据
                const dataToSave = {
                    bookmarks: appData.bookmarks,
                    cities: appData.cities,
                    ads: appData.ads,
                    deploymentDate: appData.deploymentDate.toISOString()
                };
                
                const content = JSON.stringify(dataToSave, null, 2);
                
                // 首先检查文件是否存在
                const checkUrl = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                const checkResponse = await fetch(checkUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = '';
                if (checkResponse.ok) {
                    const fileData = await checkResponse.json();
                    sha = fileData.sha;
                }
                
                // 编码内容（处理非Latin1字符）
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                
                // 保存文件
                const saveUrl = `https://api.github.com/repos/${username}/${repo}/contents/bookmarks.json`;
                const saveResponse = await fetch(saveUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Update bookmarks via Space Bookmark Navigator',
                        content: base64Content,
                        ...(sha && { sha })
                    })
                });
                
                if (saveResponse.ok) {
                    showToast('数据已成功同步到GitHub');
                    return true;
                } else {
                    const errorData = await saveResponse.json();
                    showToast(`保存失败: ${errorData.message || '未知错误'}`, true);
                    console.error('保存到GitHub失败:', errorData);
                }
            } catch (error) {
                showToast('保存过程出错', true);
                console.error('保存到GitHub错误:', error);
            } finally {
                hideLoading();
            }
            
            return false;
        }

        // 渲染书签
        function renderBookmarks() {
            const foldersContainer = document.getElementById('bookmark-folders');
            const unclassifiedContainer = document.getElementById('unclassified-bookmarks');
            
            // 清空现有内容
            foldersContainer.innerHTML = '';
            unclassifiedContainer.innerHTML = '';
            
            // 渲染文件夹
            appData.bookmarks.folders.forEach(folder => {
                const folderElement = document.createElement('div');
                folderElement.className = 'bookmark-folder';
                folderElement.innerHTML = `
                    <div class="flex items-center justify-between glass rounded-t-xl p-3 cursor-pointer folder-header">
                        <div class="flex items-center space-x-2">
                            <i class="fa fa-folder text-space-pink"></i>
                            <h3 class="font-medium">${folder.name}</h3>
                        </div>
                        <i class="fa fa-chevron-down text-xs text-gray-400 transition-transform duration-300"></i>
                    </div>
                    <div class="glass rounded-b-xl p-4 mt-[-1px] folder-content">
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                            ${folder.bookmarks.map(bookmark => renderBookmarkItem(bookmark)).join('')}
                        </div>
                    </div>
                `;
                
                foldersContainer.appendChild(folderElement);
                
                // 添加文件夹展开/折叠功能
                const header = folderElement.querySelector('.folder-header');
                const content = folderElement.querySelector('.folder-content');
                const icon = folderElement.querySelector('.fa-chevron-down');
                
                header.addEventListener('click', () => {
                    content.classList.toggle('hidden');
                    icon.classList.toggle('rotate-180');
                });
            });
            
            // 渲染未分类书签
            appData.bookmarks.unclassified.forEach(bookmark => {
                unclassifiedContainer.innerHTML += renderBookmarkItem(bookmark);
            });
        }

        // 渲染单个书签项
        function renderBookmarkItem(bookmark) {
            // 尝试获取favicon，否则使用首字母
            const faviconUrl = `https://${new URL(bookmark.url).hostname}/favicon.ico`;
            const firstChar = bookmark.name.charAt(0).toUpperCase();
            
            return `
                <a href="${bookmark.url}" target="_blank" class="bookmark-item group">
                    <div class="glass rounded-lg p-3 h-full flex flex-col items-center justify-center text-center transform group-hover:scale-[1.05] transition-all bookmark-shadow">
                        <div class="w-10 h-10 rounded-full bg-space-blue/30 flex items-center justify-center mb-2">
                            <img src="${faviconUrl}" alt="${bookmark.name}图标" class="w-6 h-6 rounded" 
                                 onerror="this.style.display='none'; this.parentNode.innerHTML='<span class=\'text-sm\'>${firstChar}</span>'">
                        </div>
                        <span class="text-sm truncate w-full">${bookmark.name}</span>
                    </div>
                </a>
            `;
        }

        // 渲染书签管理界面
        function renderBookmarksManagement() {
            const container = document.getElementById('bookmarks-management');
            container.innerHTML = '';
            
            // 添加所有文件夹
            appData.bookmarks.folders.forEach(folder => {
                const folderElement = document.createElement('div');
                folderElement.className = 'mb-6';
                folderElement.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium flex items-center">
                            <i class="fa fa-folder text-space-pink mr-2"></i>
                            ${folder.name}
                        </h4>
                        <div class="flex space-x-1">
                            <button class="edit-folder p-1 hover:bg-white/10 rounded" data-id="${folder.id}" title="编辑文件夹">
                                <i class="fa fa-pencil text-sm"></i>
                            </button>
                            <button class="delete-folder p-1 hover:bg-white/10 rounded" data-id="${folder.id}" title="删除文件夹">
                                <i class="fa fa-trash text-sm text-red-400"></i>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                        ${folder.bookmarks.map(bookmark => renderManageableBookmark(bookmark, folder.id)).join('')}
                    </div>
                    <button class="add-to-folder text-sm text-space-glow hover:underline" data-folder-id="${folder.id}">
                        <i class="fa fa-plus-circle mr-1"></i> 添加到该文件夹
                    </button>
                `;
                container.appendChild(folderElement);
            });
            
            // 添加未分类书签
            const unclassifiedSection = document.createElement('div');
            unclassifiedSection.className = 'mb-6';
            unclassifiedSection.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium flex items-center">
                        <i class="fa fa-folder-open text-space-pink mr-2"></i>
                        未分类
                    </h4>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    ${appData.bookmarks.unclassified.map(bookmark => renderManageableBookmark(bookmark, 'unclassified')).join('')}
                </div>
            `;
            container.appendChild(unclassifiedSection);
            
            // 添加新建文件夹按钮
            const addFolderBtn = document.createElement('button');
            addFolderBtn.id = 'add-folder-btn';
            addFolderBtn.className = 'mt-4 px-4 py-2 bg-space-blue/70 hover:bg-space-blue rounded-lg transition-colors';
            addFolderBtn.innerHTML = '<i class="fa fa-folder-open mr-2"></i> 新建文件夹';
            container.appendChild(addFolderBtn);
            
            // 绑定事件
            bindBookmarkManagementEvents();
        }

        // 渲染可管理的书签项
        function renderManageableBookmark(bookmark, folderId) {
            return `
                <div class="glass rounded-lg p-3 flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full bg-space-blue/30 flex items-center justify-center">
                            <span class="text-xs">${bookmark.name.charAt(0).toUpperCase()}</span>
                        </div>
                        <div>
                            <div class="font-medium text-sm">${bookmark.name}</div>
                            <div class="text-xs text-gray-400 truncate max-w-xs">${bookmark.url}</div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-bookmark p-1 hover:bg-white/10 rounded" data-id="${bookmark.id}" data-folder="${folderId}" title="编辑">
                            <i class="fa fa-pencil text-sm"></i>
                        </button>
                        <button class="delete-bookmark p-1 hover:bg-white/10 rounded" data-id="${bookmark.id}" data-folder="${folderId}" title="删除">
                            <i class="fa fa-trash text-sm text-red-400"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        // 绑定书签管理事件
        function bindBookmarkManagementEvents() {
            // 删除书签
            document.querySelectorAll('.delete-bookmark').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const bookmarkId = e.currentTarget.dataset.id;
                    const folderId = e.currentTarget.dataset.folder;
                    
                    if (confirm('确定要删除这个书签吗？')) {
                        if (folderId === 'unclassified') {
                            appData.bookmarks.unclassified = appData.bookmarks.unclassified.filter(b => b.id !== bookmarkId);
                        } else {
                            const folder = appData.bookmarks.folders.find(f => f.id === folderId);
                            if (folder) {
                                folder.bookmarks = folder.bookmarks.filter(b => b.id !== bookmarkId);
                            }
                        }
                        
                        renderBookmarksManagement();
                        renderBookmarks();
                        updateBookmarkCount();
                        showToast('书签已删除');
                    }
                });
            });
            
            // 添加到文件夹
            document.querySelectorAll('.add-to-folder').forEach(btn => {
                btn.addEventListener('click', () => {
                    const folderId = btn.dataset.folderId;
                    document.getElementById('bookmark-folder').value = folderId;
                    elements.addBookmarkModal.classList.remove('hidden');
                });
            });
            
            // 新建文件夹
            document.getElementById('add-folder-btn').addEventListener('click', () => {
                const folderName = prompt('请输入文件夹名称:');
                if (folderName && folderName.trim()) {
                    const newFolder = {
                        id: 'folder_' + Date.now(),
                        name: folderName.trim(),
                        bookmarks: []
                    };
                    
                    appData.bookmarks.folders.push(newFolder);
                    
                    // 更新下拉菜单
                    const select = document.getElementById('bookmark-folder');
                    const option = document.createElement('option');
                    option.value = newFolder.id;
                    option.textContent = newFolder.name;
                    select.appendChild(option);
                    
                    renderBookmarksManagement();
                    renderBookmarks();
                    showToast('文件夹已创建');
                }
            });
        }

        // 渲染城市时钟
        function renderCities() {
            const container = document.getElementById('world-clocks');
            container.innerHTML = '';
            
            appData.cities.forEach(city => {
                const cityElement = document.createElement('div');
                cityElement.className = 'flex justify-between';
                cityElement.innerHTML = `
                    <span>${city.name}</span>
                    <span id="time-${city.timezone.replace(/\//g, '-')}" class="font-medium">00:00</span>
                `;
                container.appendChild(cityElement);
            });
            
            // 更新时间
            updateAllTimes();
        }

        // 渲染城市管理界面
        function renderCitiesManagement() {
            const container = document.getElementById('cities-management');
            container.innerHTML = '';
            
            if (appData.cities.length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-gray-500">暂无城市，请添加</div>';
                return;
            }
            
            appData.cities.forEach(city => {
                const cityElement = document.createElement('div');
                cityElement.className = 'glass rounded-lg p-3 flex justify-between items-center mb-2';
                cityElement.innerHTML = `
                    <div>
                        <div class="font-medium">${city.name}</div>
                        <div class="text-xs text-gray-400">${city.timezone}</div>
                    </div>
                    <button class="delete-city p-1 hover:bg-white/10 rounded" data-timezone="${city.timezone}" title="删除">
                        <i class="fa fa-trash text-sm text-red-400"></i>
                    </button>
                `;
                container.appendChild(cityElement);
            });
            
            // 绑定删除事件
            document.querySelectorAll('.delete-city').forEach(btn => {
                btn.addEventListener('click', () => {
                    const timezone = btn.dataset.timezone;
                    appData.cities = appData.cities.filter(city => city.timezone !== timezone);
                    renderCitiesManagement();
                    renderCities();
                    showToast('城市已删除');
                });
            });
        }

        // 渲染广告
        function renderAds() {
            // 实际项目中应根据广告数据渲染
            // 这里简化处理
        }

        // 渲染广告管理界面
        function renderAdsManagement() {
            const container = document.getElementById('ads-management');
            container.innerHTML = '';
            
            appData.ads.forEach(ad => {
                const adElement = document.createElement('div');
                adElement.className = 'glass rounded-lg p-4 mb-4';
                adElement.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium">广告 #${ad.id}</h4>
                        <div class="flex space-x-2">
                            <button class="edit-ad p-1 hover:bg-white/10 rounded" data-id="${ad.id}" title="编辑">
                                <i class="fa fa-pencil text-sm"></i>
                            </button>
                            <button class="delete-ad p-1 hover:bg-white/10 rounded" data-id="${ad.id}" title="删除">
                                <i class="fa fa-trash text-sm text-red-400"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm text-gray-400 mb-1">图片URL</label>
                        <input type="text" class="ad-image w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 text-sm focus:outline-none focus:border-space-glow transition-colors" data-id="${ad.id}" value="${ad.image || ''}" placeholder="https://example.com/ad.jpg">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm text-gray-400 mb-1">链接URL</label>
                        <input type="text" class="ad-url w-full bg-transparent border border-gray-700 rounded-lg py-2 px-3 text-sm focus:outline-none focus:border-space-glow transition-colors" data-id="${ad.id}" value="${ad.url || ''}" placeholder="https://example.com">
                    </div>
                    <div class="flex items-center">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="ad-active sr-only peer" data-id="${ad.id}" ${ad.active ? 'checked' : ''}>
                            <div class="w-9 h-5 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-space-purple"></div>
                        </label>
                        <span class="ml-2 text-sm">启用广告</span>
                    </div>
                `;
                container.appendChild(adElement);
            });
            
            // 绑定广告编辑事件
            document.querySelectorAll('.ad-image, .ad-url').forEach(input => {
                input.addEventListener('change', (e) => {
                    const adId = e.currentTarget.dataset.id;
                    const ad = appData.ads.find(a => a.id == adId);
                    if (ad) {
                        if (e.currentTarget.classList.contains('ad-image')) {
                            ad.image = e.currentTarget.value;
                        } else {
                            ad.url = e.currentTarget.value;
                        }
                    }
                });
            });
            
            document.querySelectorAll('.ad-active').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const adId = e.currentTarget.dataset.id;
                    const ad = appData.ads.find(a => a.id == adId);
                    if (ad) {
                        ad.active = e.currentTarget.checked;
                    }
                });
            });
            
            document.querySelectorAll('.delete-ad').forEach(btn => {
                btn.addEventListener('click', () => {
                    const adId = btn.dataset.id;
                    appData.ads = appData.ads.filter(ad => ad.id != adId);
                    renderAdsManagement();
                    renderAds();
                    showToast('广告已删除');
                });
            });
        }

        // 更新所有时钟
        function updateAllTimes() {
            appData.cities.forEach(city => {
                try {
                    const options = { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        timeZone: city.timezone 
                    };
                    const timeString = new Date().toLocaleTimeString('zh-CN', options);
                    document.getElementById(`time-${city.timezone.replace(/\//g, '-')}`).textContent = timeString;
                } catch (error) {
                    console.error(`更新 ${city.name} 时间失败:`, error);
                }
            });
        }

        // 更新在线时长
        function updateOnlineTime() {
            const now = new Date();
            const diff = now - appData.deploymentDate;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            elements.onlineTime.textContent = `${days}天${hours}时${minutes}分`;
        }

        // 更新健康提醒
        function updateHealthReminder() {
            if (!appData.settings.enableReminders) return;
            
            const now = new Date();
            const diffMinutes = Math.floor((now - appData.lastHealthCheck) / (1000 * 60));
            
            if (diffMinutes >= 60) {
                elements.healthReminder.textContent = '是时候休息一下了！让眼睛远离屏幕5分钟';
                elements.healthReminder.classList.add('text-yellow-400');
            } else {
                elements.healthReminder.textContent = '每小时请休息5分钟，保护您的星际航行视力';
                elements.healthReminder.classList.remove('text-yellow-400');
                
                const nextReminder = 60 - diffMinutes;
                elements.nextReminder.textContent = `下次提醒: ${nextReminder}分钟后`;
            }
        }

        // 更新书签计数
        function updateBookmarkCount() {
            let total = appData.bookmarks.unclassified.length;
            
            appData.bookmarks.folders.forEach(folder => {
                total += folder.bookmarks.length;
            });
            
            elements.totalBookmarks.textContent = `共收录${total}个网站`;
        }

        // 导入书签
        function importBookmarks(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    // 这里简化处理，实际应用中需要解析HTML书签文件
                    showToast('书签导入功能待实现');
                } catch (error) {
                    showToast('书签导入失败', true);
                    console.error('导入书签错误:', error);
                }
            };
            
            reader.readAsText(file);
        }

        // 导出书签
        function exportBookmarks() {
            try {
                // 这里简化处理，实际应用中需要生成HTML书签文件格式
                const dataStr = JSON.stringify(appData.bookmarks, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'space-bookmarks.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showToast('书签已导出');
            } catch (error) {
                showToast('书签导出失败', true);
                console.error('导出书签错误:', error);
            }
        }

        // 添加新城市
        function addNewCity() {
            const cityName = prompt('请输入城市名称:');
            if (!cityName || !cityName.trim()) return;
            
            const timezones = [
                'Africa/Cairo', 'Africa/Johannesburg', 'America/Chicago', 
                'America/Denver', 'America/Los_Angeles', 'America/New_York',
                'America/Sao_Paulo', 'Asia/Dubai', 'Asia/Hong_Kong',
                'Asia/Kolkata', 'Asia/Seoul', 'Asia/Shanghai',
                'Asia/Tokyo', 'Australia/Sydney', 'Europe/London',
                'Europe/Madrid', 'Europe/Moscow', 'Europe/Paris'
            ];
            
            const timezone = prompt(`请选择时区:\n${timezones.join('\n')}`);
            if (!timezone || !timezones.includes(timezone)) {
                showToast('无效的时区', true);
                return;
            }
            
            appData.cities.push({
                name: cityName.trim(),
                timezone: timezone
            });
            
            renderCitiesManagement();
            renderCities();
            showToast('城市已添加');
        }

        // 添加新书签
        function addNewBookmark() {
            const urlInput = document.getElementById('bookmark-url');
            const nameInput = document.getElementById('bookmark-name');
            const folderSelect = document.getElementById('bookmark-folder');
            
            const url = urlInput.value.trim();
            const name = nameInput.value.trim() || new URL(url).hostname;
            const folderId = folderSelect.value;
            
            if (!url) {
                showToast('请输入网址', true);
                return;
            }
            
            // 验证URL格式
            try {
                new URL(url);
            } catch {
                // 尝试添加http://前缀
                try {
                    new URL('http://' + url);
                    urlInput.value = 'http://' + url;
                    return addNewBookmark(); // 重新尝试
                } catch {
                    showToast('无效的网址格式', true);
                    return;
                }
            }
            
            const newBookmark = {
                id: 'bookmark_' + Date.now(),
                name: name,
                url: url
            };
            
            // 添加到相应的文件夹或未分类
            if (folderId === 'unclassified') {
                appData.bookmarks.unclassified.push(newBookmark);
            } else {
                const folder = appData.bookmarks.folders.find(f => f.id === folderId);
                if (folder) {
                    folder.bookmarks.push(newBookmark);
                } else {
                    appData.bookmarks.unclassified.push(newBookmark);
                }
            }
            
            // 重置表单并关闭模态框
            urlInput.value = '';
            nameInput.value = '';
            elements.addBookmarkModal.classList.add('hidden');
            
            // 更新界面
            renderBookmarksManagement();
            renderBookmarks();
            updateBookmarkCount();
            showToast('书签已添加');
        }

        // 初始化页面
        async function init() {
            // 创建星空背景
            createStars();
            
            // 加载保存的设置
            const savedSettings = localStorage.getItem('github-settings');
            if (savedSettings) {
                const { username, repo } = JSON.parse(savedSettings);
                appData.github.username = username || '';
                appData.github.repo = repo || '';
                
                elements.githubUsername.value = username || '';
                elements.githubRepo.value = repo || '';
            }
            
            // 设置版权年份
            elements.copyright.innerHTML = `Copyright © 2018-${new Date().getFullYear()} ${window.location.hostname}, All Rights Reserved`;
            
            // 加载数据
            await loadDataFromGitHub();
            
            // 初始化事件监听
            initEventListeners();
            
            // 启动定时任务
            setInterval(updateAllTimes, 60000); // 每分钟更新一次时间
            setInterval(updateOnlineTime, 60000); // 每分钟更新一次在线时长
            setInterval(updateHealthReminder, 60000); // 每分钟更新一次健康提醒
            
            // 初始更新
            updateAllTimes();
            updateOnlineTime();
            updateHealthReminder();
            updateBookmarkCount();
        }


        // 初始化事件监听
        function initEventListeners() {
            // 主题切换
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // 控制栏显示/隐藏
            window.addEventListener('scroll', resetControlBarTimer);
            
            // 设置对话框
            elements.settingsBtn.addEventListener('click', () => {
                elements.settingsModal.classList.remove('hidden');
                resetControlBarTimer();
            });
            
            elements.closeSettings.addEventListener('click', () => {
                elements.settingsModal.classList.add('hidden');
            });
            
            // 关闭模态框
            elements.closeModals.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.addBookmarkModal.classList.add('hidden');
                });
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', (e) => {
                if (e.target === elements.settingsModal) {
                    elements.settingsModal.classList.add('hidden');
                }
                if (e.target === elements.addBookmarkModal) {
                    elements.addBookmarkModal.classList.add('hidden');
                }
            });
            
            // 自动隐藏控制栏设置
            elements.autoHideControl.addEventListener('change', (e) => {
                appData.settings.autoHideControl = e.target.checked;
                localStorage.setItem('auto-hide-control', e.target.checked);
                resetControlBarTimer();
            });
            
            // 健康提醒设置
            elements.enableReminders.addEventListener('change', (e) => {
                appData.settings.enableReminders = e.target.checked;
                localStorage.setItem('enable-reminders', e.target.checked);
                updateHealthReminder();
            });
            
            // 页面切换
            elements.openEditCenter.addEventListener('click', () => {
                elements.homePage.classList.add('hidden');
                elements.editCenter.classList.remove('hidden');
                elements.settingsModal.classList.add('hidden');
            });
            
            elements.backToHome.addEventListener('click', () => {
                elements.editCenter.classList.add('hidden');
                elements.homePage.classList.remove('hidden');
            });
            
            // GitHub相关
            elements.validateGithub.addEventListener('click', validateGitHubToken);
            elements.saveGithubSettings.addEventListener('click', saveGitHubSettings);
            elements.saveChanges.addEventListener('click', saveDataToGitHub);
            
            // 书签管理
            elements.addBookmarkBtn.addEventListener('click', () => {
                elements.addBookmarkModal.classList.remove('hidden');
            });
            
            elements.saveBookmark.addEventListener('click', addNewBookmark);
            
            elements.importBookmarks.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    importBookmarks(e.target.files[0]);
                    // 重置输入，允许重复选择同一个文件
                    e.target.value = '';
                }
            });
            
            elements.exportBookmarks.addEventListener('click', exportBookmarks);
            
            // 城市管理
            elements.addCityBtn.addEventListener('click', addNewCity);
            
            // 广告管理
            elements.addAdBtn.addEventListener('click', () => {
                const newAdId = appData.ads.length > 0 
                    ? Math.max(...appData.ads.map(ad => ad.id)) + 1 
                    : 1;
                
                appData.ads.push({
                    id: newAdId,
                    image: '',
                    url: '',
                    active: true
                });
                
                renderAdsManagement();
                showToast('广告位已添加');
            });
            
            // 搜索功能
            elements.searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                // 实际应用中实现搜索逻辑
            });
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
